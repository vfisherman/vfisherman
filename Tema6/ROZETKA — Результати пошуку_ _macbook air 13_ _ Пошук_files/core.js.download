if(!Array.prototype.find){Array.prototype.find=function(predicate){if(this==null){throw new TypeError('Array.prototype.find called on null or undefined')}if(typeof predicate!=='function'){throw new TypeError('predicate must be a function')}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0;i<length;i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return value}}return undefined}};function $defined(obj){return(obj!=undefined)};function $type(obj){if(!$defined(obj))return false;if(obj.htmlElement)return'element';var type=typeof obj;if(type=='object'&&obj.nodeName){switch(obj.nodeType){case 1:return'element';case 3:return(/\S/).test(obj.nodeValue)?'textnode':'whitespace'}}if(type=='object'||type=='function'){switch(obj.constructor){case Array:return'array';case RegExp:return'regexp';case Class:return'class'}if(typeof obj.length=='number'){if(obj.item)return'collection';if(obj.callee)return'arguments'}}return type};function $decodeHtml(html){var txt=document.createElement("textarea");txt.innerHTML=html;return txt.value};function $merge(){var mix={};for(var i=0;i<arguments.length;i++){for(var property in arguments[i]){var ap=arguments[i][property];var mp=mix[property];if(mp&&$type(ap)=='object'&&$type(mp)=='object')mix[property]=$merge(mp,ap);else mix[property]=ap}}return mix};var $extend=function(){var args=arguments;if(!args[1])args=[this,args[0]];for(var property in args[1]){if(window.opera){try{args[0][property]=args[1][property]}catch(e){console.log()}}else{args[0][property]=args[1][property]}}return args[0]};var $native=function(){for(var i=0,l=arguments.length;i<l;i++){arguments[i].extend=function(props){for(var prop in props){if(!this.prototype[prop])this.prototype[prop]=props[prop];if(!this[prop])this[prop]=$native.generic(prop)}}}};$native.generic=function(prop){return function(bind){return this.prototype[prop].apply(bind,Array.prototype.slice.call(arguments,1))}};$native(Function,Array,String,Number);function $chk(obj){return!!(obj||obj===0)};function $pick(obj,picked){return $defined(obj)?obj:picked};function $random(min,max){return Math.floor(Math.random()*(max-min+1)+min)};function $time(){return new Date().getTime()};function $clear(timer){clearTimeout(timer);clearInterval(timer);return null};var Abstract=function(obj){obj=obj||{};obj.extend=$extend;return obj};var Window=new Abstract(window);var Document=new Abstract(document);document.head=document.getElementsByTagName('head')[0];window.xpath=!!(document.evaluate);if(window.ActiveXObject)window.ie=true;else if(document.childNodes&&!document.all&&!navigator.taintEnabled)window.webkit=window[window.xpath?'webkit420':'webkit419']=true;else if(document.getBoxObjectFor!=null||window.mozInnerScreenX!=null)window.gecko=true;if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){window.FirefoxVersion=new Number(RegExp.$1);window.ff4AndGreater=(window.FirefoxVersion>=4)}window.khtml=window.webkit;Object.extend=$extend;if(typeof HTMLElement=='undefined'){var HTMLElement=function(){};if(window.webkit)document.createElement("iframe");HTMLElement.prototype=(window.webkit)?window["[[DOMElement.prototype]]"]:{}}HTMLElement.prototype.htmlElement=function(){};if(window.ie6)try{document.execCommand("BackgroundImageCache",false,true)}catch(e){};var Class=function(properties){var klass=function(){return(arguments[0]!==null&&this.initialize&&$type(this.initialize)=='function')?this.initialize.apply(this,arguments):this};$extend(klass,this);klass.prototype=properties;klass.constructor=Class;return klass};Class.empty=function(){};Class.prototype={extend:function(properties){var proto=new this(null);for(var property in properties){var pp=proto[property];proto[property]=Class.Merge(pp,properties[property])}return new Class(proto)},implement:function(){for(var i=0,l=arguments.length;i<l;i++)$extend(this.prototype,arguments[i])}};Class.Merge=function(previous,current){if(previous&&previous!=current){var type=$type(current);if(type!=$type(previous))return current;switch(type){case'function':var merged=function(){this.parent=arguments.callee.parent;return current.apply(this,arguments)};merged.parent=previous;return merged;case'object':return $merge(previous,current)}}return current};var Chain=new Class({chain:function(fn){this.chains=this.chains||[];this.chains.push(fn);return this},callChain:function(){if(this.chains&&this.chains.length)this.chains.shift().delay(10,this)},clearChain:function(){this.chains=[]}});var Events=new Class({addEvent:function(type,fn){if(fn!=Class.empty){var match_values=type.match(/^([^:]+)(?::(.*))?$/i);type=match_values[1];var pseudo_part=match_values[2];if(pseudo_part&&pseudo_part.length){var match_result=pseudo_part.match(/^([A-z]+)(?:\(([^\(\)]+)\))?$/i);if(match_result){var pseudo_name=match_result[1];var pseudo_params_str=match_result[2];if(pseudo_name==='pause'){var duration=250;if(pseudo_params_str){var params=pseudo_params_str.match(/^\d+$/i);if(!params){throw Error('Неверные параметры для псевдо события  "'+pseudo_name+'": "'+type+'"')}duration=parseInt(params[0])}fn._pause_duration=duration}else{throw Error('Неизвестный тип псевдо события  "'+pseudo_name+'" в "'+type+'"')}}else{throw Error('Ошибка в имени события "'+type+'"')}}this.$events=this.$events||{};this.$events[type]=this.$events[type]||[];this.$events[type].include(fn)}return this},fireEvent:function(type,args,delay){if(this.$events&&this.$events[type]){this.$events[type].each(function(fn){fn.create({'bind':this,'delay':delay,'arguments':args})()},this)}return this},removeEvent:function(type,fn){if(this.$events&&this.$events[type])this.$events[type].remove(fn);return this},clearEvents:function(){this.$events={};return this}});var Options=new Class({setOptions:function(){this.options=$merge.apply(null,[this.options].extend(arguments));if(this.addEvent){for(var option in this.options){if($type(this.options[option]=='function')&&(/^on[A-Z]/).test(option))this.addEvent(option,this.options[option])}}return this}});Array.extend({forEach:function(fn,bind){for(var i=0,j=this.length;i<j;i++)fn.call(bind,this[i],i,this)},filter:function(fn,bind){var results=[];for(var i=0,j=this.length;i<j;i++){if(fn.call(bind,this[i],i,this))results.push(this[i])}return results},map:function(fn,bind){var results=[];for(var i=0,j=this.length;i<j;i++)results[i]=fn.call(bind,this[i],i,this);return results},every:function(fn,bind){for(var i=0,j=this.length;i<j;i++){if(!fn.call(bind,this[i],i,this))return false}return true},some:function(fn,bind){for(var i=0,j=this.length;i<j;i++){if(fn.call(bind,this[i],i,this))return true}return false},indexOf:function(item,from){var len=this.length;for(var i=(from<0)?Math.max(0,len+from):from||0;i<len;i++){if(this[i]===item)return i}return-1},copy:function(start,length){start=start||0;if(start<0)start=this.length+start;length=length||(this.length-start);var newArray=[];for(var i=0;i<length;i++)newArray[i]=this[start++];return newArray},remove:function(item){var i=0;var len=this.length;while(i<len){if(this[i]===item){this.splice(i,1);len--}else{i++}}return this},contains:function(item,from){return this.indexOf(item,from)!=-1},associate:function(keys){var obj={},length=Math.min(this.length,keys.length);for(var i=0;i<length;i++)obj[keys[i]]=this[i];return obj},extend:function(array){for(var i=0,j=array.length;i<j;i++)this.push(array[i]);return this},merge:function(array){for(var i=0,l=array.length;i<l;i++)this.include(array[i]);return this},include:function(item){if(!this.contains(item))this.push(item);return this},getRandom:function(){return this[$random(0,this.length-1)]||null},getLast:function(){return this[this.length-1]||null},inArray:function(comparer){for(var i=0;i<this.length;i++){if(comparer(this[i])){return true}}return false},pushIfNotExist:function(element,comparer){var result=false;if(!this.inArray(comparer)){this.push(element);result=true}return result}});Array.prototype.each=Array.prototype.forEach;Array.each=Array.forEach;function $A(array){return Array.copy(array)};function $each(iterable,fn,bind){if(iterable&&typeof iterable.length=='number'&&$type(iterable)!='object'){Array.forEach(iterable,fn,bind)}else{for(var name in iterable)fn.call(bind||iterable,iterable[name],name)}};Array.prototype.test=Array.prototype.contains;String.extend({test:function(regex,params){return(($type(regex)=='string')?new RegExp(regex,params):regex).test(this)},toInt:function(){return parseInt(this,10)},toFloat:function(){return parseFloat(this)},camelCase:function(){return this.replace(/-\D/g,function(match){return match.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/\w[A-Z]/g,function(match){return(match.charAt(0)+'-'+match.charAt(1).toLowerCase())})},capitalize:function(){return this.replace(/\b[a-z]/g,function(match){return match.toUpperCase()})},trim:function(){return this.replace(/^\s+|\s+$/g,'')},clean:function(){return this.replace(/\s{2,}/g,' ').trim()},rgbToHex:function(array){var rgb=this.match(/\d{1,3}/g);return(rgb)?rgb.rgbToHex(array):false},hexToRgb:function(array){var hex=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(hex)?hex.slice(1).hexToRgb(array):false},contains:function(string,s){return(s)?(s+this+s).indexOf(s+string+s)>-1:this.indexOf(string)>-1},escapeRegExp:function(){return this.replace(/([.*+?^${}()|[\]\/\\])/g,'\\$1')}});Array.extend({rgbToHex:function(array){if(this.length<3)return false;if(this.length==4&&this[3]==0&&!array)return'transparent';var hex=[];for(var i=0;i<3;i++){var bit=(this[i]-0).toString(16);hex.push((bit.length==1)?'0'+bit:bit)}return array?hex:'#'+hex.join('')},hexToRgb:function(array){if(this.length!=3)return false;var rgb=[];for(var i=0;i<3;i++){rgb.push(parseInt((this[i].length==1)?this[i]+this[i]:this[i],16))}return array?rgb:'rgb('+rgb.join(',')+')'}});Function.extend({create:function(options){var fn=this;options=$merge({'bind':fn,'event':false,'arguments':null,'delay':false,'periodical':false,'attempt':false},options);if($chk(options.arguments)&&$type(options.arguments)!='array')options.arguments=[options.arguments];return function(event){var args;if(options.event){event=event||window.event;args=[(options.event===true)?event:new options.event(event)];if(options.arguments)args.extend(options.arguments)}else args=options.arguments||arguments;var returns=function(){return fn.apply($pick(options.bind,fn),args)};if(options.delay)return setTimeout(returns,options.delay);if(options.periodical)return setInterval(returns,options.periodical);if(options.attempt)try{return returns()}catch(err){return false};return returns()}},pass:function(args,bind){return this.create({'arguments':args,'bind':bind})},attempt:function(args,bind){return this.create({'arguments':args,'bind':bind,'attempt':true})()},bind:function(bind,args){return this.create({'bind':bind,'arguments':args})},bindAsEventListener:function(bind,args){return this.create({'bind':bind,'event':true,'arguments':args})},delay:function(delay,bind,args){return this.create({'delay':delay,'bind':bind,'arguments':args})()},periodical:function(interval,bind,args){return this.create({'periodical':interval,'bind':bind,'arguments':args})()}});Number.extend({toInt:function(){return parseInt(this)},toFloat:function(){return parseFloat(this)},limit:function(min,max){return Math.min(max,Math.max(min,this))},round:function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision},times:function(fn){for(var i=0;i<this;i++)fn(i)}});var Element=new Class({initialize:function(el,props){if($type(el)=='string'){if(window.ie&&props&&(props.name||props.type)&&window.ieversion<9){var name=(props.name)?' name="'+props.name+'"':'';var type=(props.type)?' type="'+props.type+'"':'';delete props.name;delete props.type;el='<'+el+name+type+'>'}el=document.createElement(el)}el=$(el);return(!props||!el)?el:el.set(props)}});var Elements=new Class({initialize:function(elements){return(elements)?$extend(elements,this):this}});Elements.extend=function(props){for(var prop in props){this.prototype[prop]=props[prop];this[prop]=$native.generic(prop)}};function $(el){if(!el)return null;if(el.htmlElement)return Garbage.collect(el);if([window,document].contains(el))return el;var type=$type(el);if(type=='string'){el=document.getElementById(el);type=(el)?'element':false}if(type!='element')return null;if(el.htmlElement)return Garbage.collect(el);if(['object','embed'].contains(el.tagName.toLowerCase()))return el;$extend(el,Element.prototype);el.htmlElement=function(){};return Garbage.collect(el)};document.getElementsBySelector=document.getElementsByTagName;function $$(){var elements=[];for(var i=0,j=arguments.length;i<j;i++){var selector=arguments[i];switch($type(selector)){case'element':elements.push(selector);case'boolean':break;case false:break;case'string':selector=document.getElementsBySelector(selector,true);default:elements.extend(selector)}}return $$.unique(elements)};$$.unique=function(array){var elements=[];for(var i=0,l=array.length;i<l;i++){if(array[i].$included)continue;var element=$(array[i]);if(element&&!element.$included){element.$included=true;elements.push(element)}}for(var n=0,d=elements.length;n<d;n++)elements[n].$included=null;return new Elements(elements)};Elements.Multi=function(property){return function(){var args=arguments;var items=[];var elements=true;for(var i=0,j=this.length,returns;i<j;i++){returns=this[i][property].apply(this[i],args);if($type(returns)!='element')elements=false;items.push(returns)};return(elements)?$$.unique(items):items}};Element.extend=function(properties){for(var property in properties){HTMLElement.prototype[property]=properties[property];Element.prototype[property]=properties[property];Element[property]=$native.generic(property);var elementsProperty=(Array.prototype[property])?property+'Elements':property;Elements.prototype[elementsProperty]=Elements.Multi(property)}};Element.extend({set:function(props){for(var prop in props){var val=props[prop];switch(prop){case'styles':this.setStyles(val);break;case'events':if(this.addEvents)this.addEvents(val);break;case'properties':this.setProperties(val);break;default:this.setProperty(prop,val)}}return this},inject:function(el,where){el=$(el);switch(where){case'before':el.parentNode.insertBefore(this,el);break;case'after':var next=el.getNext();if(!next)el.parentNode.appendChild(this);else el.parentNode.insertBefore(this,next);break;case'top':var first=el.firstChild;if(first){el.insertBefore(this,first);break}default:el.appendChild(this)}return this},injectBefore:function(el){return this.inject(el,'before')},injectAfter:function(el){return this.inject(el,'after')},injectInside:function(el){return this.inject(el,'bottom')},injectTop:function(el){return this.inject(el,'top')},adopt:function(){var elements=[];$each(arguments,function(argument){elements=elements.concat(argument)});$$(elements).inject(this);return this},remove:function(){if(this.parentNode){return this.parentNode.removeChild(this)}else if(window.ie){return this.removeNode()}},clone:function(contents){var el=$(this.cloneNode(contents!==false));if(!el.$events)return el;el.$events={};for(var type in this.$events)el.$events[type]={'keys':$A(this.$events[type].keys),'values':$A(this.$events[type].values)};return el.removeEvents()},replaceWith:function(el){el=$(el);this.parentNode.replaceChild(el,this);return el},appendText:function(text){this.appendChild(document.createTextNode(text));return this},hasClass:function(className){return this.className.contains(className,' ')},addClass:function(className){if(!this.hasClass(className))this.className=(this.className+' '+className).clean();return this},removeClass:function(className){this.className=this.className.replace(new RegExp('(^|\\s)'+className+'(?:\\s|$)'),'$1').clean();return this},toggleClass:function(className){return this.hasClass(className)?this.removeClass(className):this.addClass(className)},setStyle:function(property,value){switch(property){case'opacity':return this.setOpacity(parseFloat(value));case'float':property=(window.ie)?'styleFloat':'cssFloat'}property=property.camelCase();switch($type(value)){case'number':if(!['zIndex','zoom'].contains(property))value+='px';break;case'array':value='rgb('+value.join(',')+')'}this.style[property]=value;return this},setStyles:function(source){switch($type(source)){case'object':Element.setMany(this,'setStyle',source);break;case'string':this.style.cssText=source}return this},setOpacity:function(opacity){if(opacity==0){if(this.style.visibility!="hidden")this.style.visibility="hidden"}else{if(this.style.visibility!="visible")this.style.visibility="visible"}if(!this.currentStyle||!this.currentStyle.hasLayout)this.style.zoom=1;if(window.ie)this.style.filter=(opacity==1)?'':"alpha(opacity="+opacity*100+")";this.style.opacity=this.$tmp.opacity=opacity;return this},getStyle:function(property){property=property.camelCase();var result=this.style[property];if(!$chk(result)){if(property=='opacity')return this.$tmp.opacity;result=[];for(var style in Element.Styles){if(property==style){Element.Styles[style].each(function(s){var style=this.getStyle(s);result.push(parseInt(style)?style:'0px')},this);if(property=='border'){var every=result.every(function(bit){return(bit==result[0])});return(every)?result[0]:false}return result.join(' ')}}if(property.contains('border')){if(Element.Styles.border.contains(property)){return['Width','Style','Color'].map(function(p){return this.getStyle(property+p)},this).join(' ')}else if(Element.borderShort.contains(property)){return['Top','Right','Bottom','Left'].map(function(p){return this.getStyle('border'+p+property.replace('border',''))},this).join(' ')}}if(document.defaultView)result=document.defaultView.getComputedStyle(this,null).getPropertyValue(property.hyphenate());else if(this.currentStyle)result=this.currentStyle[property]}if(window.ie)result=Element.fixStyle(property,result,this);if(result&&property.test(/color/i)&&result.contains('rgb')){return result.split('rgb').splice(1,4).map(function(color){return color.rgbToHex()}).join(' ')}return result},getStyles:function(){return Element.getMany(this,'getStyle',arguments)},walk:function(brother,start){brother+='Sibling';var el=(start)?this[start]:this[brother];while(el&&$type(el)!='element')el=el[brother];return $(el)},getPrevious:function(){return this.walk('previous')},getNext:function(){return this.walk('next')},getFirst:function(){return this.walk('next','firstChild')},getLast:function(){return this.walk('previous','lastChild')},getParent:function(){return $(this.parentNode)},getChildren:function(){return $$(this.childNodes)},hasChild:function(el){return!!$A(this.getElementsByTagName('*')).contains(el)},getProperty:function(property){var index=Element.Properties[property];if(index)return this[index];var flag=Element.PropertiesIFlag[property]||0;var msie=navigator.userAgent.toLowerCase().match(/msie\s+(\d)/);if(!window.ie||flag||msie&&msie[1]>=7)return this.getAttribute(property,flag);var node=this.attributes[property];return(node)?node.nodeValue:null},removeProperty:function(property){var index=Element.Properties[property];if(index)this[index]='';else this.removeAttribute(property);return this},getProperties:function(){return Element.getMany(this,'getProperty',arguments)},setProperty:function(property,value){var index=Element.Properties[property];if(index)this[index]=value;else this.setAttribute(property,value);return this},setProperties:function(source){return Element.setMany(this,'setProperty',source)},setHTML:function(){this.innerHTML=$A(arguments).join('');return this},setText:function(text){var tag=this.getTag();if(['style','script'].contains(tag)){if(window.ie){if(tag=='style')this.styleSheet.cssText=text;else if(tag=='script')this.setProperty('text',text);return this}else{this.removeChild(this.firstChild);return this.appendText(text)}}this[$defined(this.innerText)?'innerText':'textContent']=text;return this},getText:function(){var tag=this.getTag();if(['style','script'].contains(tag)){if(window.ie){if(tag=='style')return this.styleSheet.cssText;else if(tag=='script')return this.getProperty('text')}else{return this.innerHTML}}return($pick(this.innerText,this.textContent))},getTag:function(){return this.tagName.toLowerCase()},empty:function(){Garbage.trash(this.getElementsByTagName('*'));return this.setHTML('')}});Element.fixStyle=function(property,result,element){if($chk(parseInt(result)))return result;if(['height','width'].contains(property)){var values=(property=='width')?['left','right']:['top','bottom'];var size=0;values.each(function(value){size+=element.getStyle('border-'+value+'-width').toInt()+element.getStyle('padding-'+value).toInt()});return element['offset'+property.capitalize()]-size+'px'}else if(property.test(/border(.+)Width|margin|padding/)){return'0px'}return result};Element.Styles={'border':[],'padding':[],'margin':[]};['Top','Right','Bottom','Left'].each(function(direction){for(var style in Element.Styles)Element.Styles[style].push(style+direction)});Element.borderShort=['borderWidth','borderStyle','borderColor'];Element.getMany=function(el,method,keys){var result={};$each(keys,function(key){result[key]=el[method](key)});return result};Element.setMany=function(el,method,pairs){for(var key in pairs)el[method](key,pairs[key]);return el};Element.Properties=new Abstract({'class':'className','for':'htmlFor','colspan':'colSpan','rowspan':'rowSpan','accesskey':'accessKey','tabindex':'tabIndex','maxlength':'maxLength','readonly':'readOnly','frameborder':'frameBorder','value':'value','disabled':'disabled','checked':'checked','multiple':'multiple','selected':'selected'});Element.PropertiesIFlag={'href':2,'src':2};Element.Methods={Listeners:{addListener:function(type,fn){if(this.addEventListener)this.addEventListener(type,fn,false);else this.attachEvent('on'+type,fn);return this},removeListener:function(type,fn){if(this.removeEventListener)this.removeEventListener(type,fn,false);else this.detachEvent('on'+type,fn);return this}}};window.extend(Element.Methods.Listeners);document.extend(Element.Methods.Listeners);Element.extend(Element.Methods.Listeners);var Garbage={elements:[],collect:function(el){if(!el.$tmp){Garbage.elements.push(el);el.$tmp={'opacity':1}}return el},trash:function(elements){for(var i=0,j=elements.length,el;i<j;i++){if(!(el=elements[i])||!el.$tmp)continue;if(el.$events)el.fireEvent('trash').removeEvents();for(var p in el.$tmp)el.$tmp[p]=null;for(var d in Element.prototype)el[d]=null;Garbage.elements[Garbage.elements.indexOf(el)]=null;el.htmlElement=el.$tmp=el=null}Garbage.elements.remove(null)},empty:function(){Garbage.collect(window);Garbage.collect(document);Garbage.trash(Garbage.elements)}};window.addListener('beforeunload',function(){window.addListener('unload',Garbage.empty);if(window.ie)window.addListener('unload',CollectGarbage)});var Event=new Class({initialize:function(event){if(event&&event.$extended)return event;this.$extended=true;event=event||window.event;this.event=event;this.type=event.type;this.target=event.target||event.srcElement;if(this.target.nodeType==3)this.target=this.target.parentNode;this.shift=event.shiftKey;this.control=event.ctrlKey;this.alt=event.altKey;this.meta=event.metaKey;if(['DOMMouseScroll','mousewheel'].contains(this.type)){this.wheel=(event.wheelDelta)?event.wheelDelta/120:-(event.detail||0)/3}else if(this.type.contains('key')){this.code=event.which||event.keyCode;for(var name in Event.keys){if(Event.keys[name]==this.code){this.key=name;break}}if(this.type=='keydown'){var fKey=this.code-111;if(fKey>0&&fKey<13)this.key='f'+fKey}this.key=this.key||String.fromCharCode(this.code).toLowerCase()}else if(this.type.test(/(click|mouse|menu)/)){this.page={'x':event.pageX||event.clientX+document.documentElement.scrollLeft,'y':event.pageY||event.clientY+document.documentElement.scrollTop};this.client={'x':event.pageX?event.pageX-window.pageXOffset:event.clientX,'y':event.pageY?event.pageY-window.pageYOffset:event.clientY};this.rightClick=(event.which==3)||(event.button==2);switch(this.type){case'mouseover':this.relatedTarget=event.relatedTarget||event.fromElement;break;case'mouseout':this.relatedTarget=event.relatedTarget||event.toElement}this.fixRelatedTarget()}return this},stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){if(this.event.stopPropagation)this.event.stopPropagation();else this.event.cancelBubble=true;return this},preventDefault:function(){if(this.event.preventDefault)this.event.preventDefault();else this.event.returnValue=false;return this}});Event.fix={relatedTarget:function(){if(this.relatedTarget&&this.relatedTarget.nodeType==3)this.relatedTarget=this.relatedTarget.parentNode},relatedTargetGecko:function(){try{Event.fix.relatedTarget.call(this)}catch(e){this.relatedTarget=this.target}}};Event.prototype.fixRelatedTarget=(window.gecko)?Event.fix.relatedTargetGecko:Event.fix.relatedTarget;Event.keys=new Abstract({'enter':13,'up':38,'down':40,'left':37,'right':39,'esc':27,'space':32,'backspace':8,'tab':9,'delete':46});Element.Methods.Events={addEvent:function(type,fn){this.$events=this.$events||{};this.$events[type]=this.$events[type]||{'keys':[],'values':[]};if(this.$events[type].keys.contains(fn))return this;this.$events[type].keys.push(fn);var realType=type;var custom=Element.Events[type];if(custom){if(custom.add)custom.add.call(this,fn);if(custom.map)fn=custom.map;if(custom.type)realType=custom.type}if(!this.addEventListener)fn=fn.create({'bind':this,'event':true});this.$events[type].values.push(fn);return(Element.NativeEvents.contains(realType))?this.addListener(realType,fn):this},removeEvent:function(type,fn){if(!this.$events||!this.$events[type])return this;var pos=this.$events[type].keys.indexOf(fn);if(pos==-1)return this;var key=this.$events[type].keys.splice(pos,1)[0];var value=this.$events[type].values.splice(pos,1)[0];var custom=Element.Events[type];if(custom){if(custom.remove)custom.remove.call(this,fn);if(custom.type)type=custom.type}return(Element.NativeEvents.contains(type))?this.removeListener(type,value):this},addEvents:function(source){return Element.setMany(this,'addEvent',source)},removeEvents:function(type){if(!this.$events)return this;if(!type){for(var evType in this.$events)this.removeEvents(evType);this.$events=null}else if(this.$events[type]){this.$events[type].keys.each(function(fn){this.removeEvent(type,fn)},this);this.$events[type]=null}return this},fireEvent:function(type,args,delay){if(this.$events&&this.$events[type]){this.$events[type].keys.each(function(fn){fn.create({'bind':this,'delay':delay,'arguments':args})()},this)}return this},cloneEvents:function(from,type){if(!from.$events)return this;if(!type){for(var evType in from.$events)this.cloneEvents(from,evType)}else if(from.$events[type]){from.$events[type].keys.each(function(fn){this.addEvent(type,fn)},this)}return this}};window.extend(Element.Methods.Events);document.extend(Element.Methods.Events);Element.extend(Element.Methods.Events);Element.Events=new Abstract({'mouseenter':{type:'mouseover',map:function(event){event=new Event(event);if(event.relatedTarget!=this&&!this.hasChild(event.relatedTarget))this.fireEvent('mouseenter',event)}},'mouseleave':{type:'mouseout',map:function(event){event=new Event(event);if(event.relatedTarget!=this&&!this.hasChild(event.relatedTarget))this.fireEvent('mouseleave',event)}},'mousewheel':{type:(window.gecko)?'DOMMouseScroll':'mousewheel'}});Element.NativeEvents=['click','dblclick','mouseup','mousedown','mousewheel','DOMMouseScroll','mouseover','mouseout','mousemove','keydown','keypress','keyup','load','unload','beforeunload','resize','move','focus','blur','change','submit','reset','select','error','abort','contextmenu','scroll'];Function.extend({bindWithEvent:function(bind,args){return this.create({'bind':bind,'arguments':args,'event':Event})}});Elements.extend({filterByTag:function(tag){return new Elements(this.filter(function(el){return(Element.getTag(el)==tag)}))},filterByClass:function(className,nocash){var elements=this.filter(function(el){return(el.className&&el.className.contains(className,' '))});return(nocash)?elements:new Elements(elements)},filterById:function(id,nocash){var elements=this.filter(function(el){return(el.id==id)});return(nocash)?elements:new Elements(elements)},filterByAttribute:function(name,operator,value,nocash){var elements=this.filter(function(el){var current=Element.getProperty(el,name);if(typeof(current)!='string')return false;if(!current)return false;if(!operator)return true;switch(operator){case'=':return(current==value);case'*=':return(current.contains(value));case'^=':return(current.substr(0,value.length)==value);case'$=':return(current.substr(current.length-value.length)==value);case'!=':return(current!=value);case'~=':return current.contains(value,' ')}return false});return(nocash)?elements:new Elements(elements)}});function $E(selector,filter){return($(filter)||document).getElement(selector)};function $ES(selector,filter){return($(filter)||document).getElementsBySelector(selector)};$$.shared={'regexp':/^(\w*|\*)(?:#([\w-]+)|\.([\w-]+))?(?:\[(\w+)(?:([!*^$]?=)["']?([^"'\]]*)["']?)?])?$/,'xpath':{getParam:function(items,context,param,i){var temp=[context.namespaceURI?'xhtml:':'',param[1]];if(param[2])temp.push('[@id="',param[2],'"]');if(param[3])temp.push('[contains(concat(" ", @class, " "), " ',param[3],' ")]');if(param[4]){if(param[5]&&param[6]){switch(param[5]){case'*=':temp.push('[contains(@',param[4],', "',param[6],'")]');break;case'^=':temp.push('[starts-with(@',param[4],', "',param[6],'")]');break;case'$=':temp.push('[substring(@',param[4],', string-length(@',param[4],') - ',param[6].length,' + 1) = "',param[6],'"]');break;case'=':temp.push('[@',param[4],'="',param[6],'"]');break;case'!=':temp.push('[@',param[4],'!="',param[6],'"]')}}else{temp.push('[@',param[4],']')}}items.push(temp.join(''));return items},getItems:function(items,context,nocash){var elements=[];var xpath=document.evaluate('.//'+items.join('//'),context,$$.shared.resolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,j=xpath.snapshotLength;i<j;i++)elements.push(xpath.snapshotItem(i));return(nocash)?elements:new Elements(elements.map($))}},'normal':{getParam:function(items,context,param,i){if(i==0){if(param[2]){var el=context.getElementById(param[2]);if(!el||((param[1]!='*')&&(Element.getTag(el)!=param[1])))return false;items=[el]}else{items=$A(context.getElementsByTagName(param[1]))}}else{items=$$.shared.getElementsByTagName(items,param[1]);if(param[2])items=Elements.filterById(items,param[2],true)}if(param[3])items=Elements.filterByClass(items,param[3],true);if(param[4])items=Elements.filterByAttribute(items,param[4],param[5],param[6],true);return items},getItems:function(items,context,nocash){return(nocash)?items:$$.unique(items)}},resolver:function(prefix){return(prefix=='xhtml')?'http://www.w3.org/1999/xhtml':false},getElementsByTagName:function(context,tagName){var found=[];for(var i=0,j=context.length;i<j;i++)found.extend(context[i].getElementsByTagName(tagName));return found}};$$.shared.method=(window.xpath)?'xpath':'normal';Element.Methods.Dom={getElements:function(selector,nocash){var items=[];selector=selector.trim().split(' ');for(var i=0,j=selector.length;i<j;i++){var sel=selector[i];var param=sel.match($$.shared.regexp);if(!param)break;param[1]=param[1]||'*';var temp=$$.shared[$$.shared.method].getParam(items,this,param,i);if(!temp)break;items=temp}return $$.shared[$$.shared.method].getItems(items,this,nocash)},getElement:function(selector){return $(this.getElements(selector,true)[0]||false)},getElementsBySelector:function(selector,nocash){var elements=[];selector=selector.split(',');for(var i=0,j=selector.length;i<j;i++)elements=elements.concat(this.getElements(selector[i],true));return(nocash)?elements:$$.unique(elements)}};Element.extend({getElementById:function(id){var el=document.getElementById(id);if(!el)return false;for(var parent=el.parentNode;parent!=this;parent=parent.parentNode){if(!parent)return false}return el},getElementsByClassName:function(className){return this.getElements('.'+className)}});document.extend(Element.Methods.Dom);Element.extend(Element.Methods.Dom);Element.extend({getValue:function(){switch(this.getTag()){case'select':var values=[];$each(this.options,function(option){if(option.selected)values.push($pick(option.value,option.text))});return(this.multiple)?values:values[0];case'input':if(!(this.checked&&['checkbox','radio'].contains(this.type))&&!['hidden','text','password'].contains(this.type))break;case'textarea':return this.value}return false},getFormElements:function(){return $$(this.getElementsByTagName('input'),this.getElementsByTagName('select'),this.getElementsByTagName('textarea'))},toQueryString:function(){var queryString=[];this.getFormElements().each(function(el){var name=el.name;var value=el.getValue();if(value===false||!name||el.disabled)return;var qs=function(val){queryString.push(name+'='+encodeURIComponent(val))};if($type(value)=='array')value.each(qs);else qs(value)});return queryString.join('&')}});Element.extend({scrollTo:function(x,y){this.scrollLeft=x;this.scrollTop=y},getSize:function(){return{'scroll':{'x':this.scrollLeft,'y':this.scrollTop},'size':{'x':this.offsetWidth,'y':this.offsetHeight},'scrollSize':{'x':this.scrollWidth,'y':this.scrollHeight}}},getPosition:function(overflown){overflown=overflown||[];var el=this,left=0,top=0;do{left+=el.offsetLeft||0;top+=el.offsetTop||0;el=el.offsetParent}while(el);overflown.each(function(element){left-=element.scrollLeft||0;top-=element.scrollTop||0});return{'x':left,'y':top}},getTop:function(overflown){return this.getPosition(overflown).y},getLeft:function(overflown){return this.getPosition(overflown).x},getCoordinates:function(overflown){var position=this.getPosition(overflown);var obj={'width':this.offsetWidth,'height':this.offsetHeight,'left':position.x,'top':position.y};obj.right=obj.left+obj.width;obj.bottom=obj.top+obj.height;return obj}});Element.Events.domready={add:function(fn){var domReady,timer;if(window.loaded){fn.call(this);return}domReady=function(){if(window.loaded)return;window.loaded=true;this.fireEvent('domready')}.bind(this);if(document.readyState!==undefined&&(window.webkit||window.gecko)){timer=function(){if(['interactive','loaded','complete'].contains(document.readyState)){timer=$clear(timer);domReady()}}.periodical(50)}else{document.addListener("DOMContentLoaded",domReady);window.addListener("load",domReady)}}};window.onDomReady=function(fn){return this.addEvent('domready',fn)};window.extend({getWidth:function(){return document.documentElement.clientWidth},getHeight:function(){return document.documentElement.clientHeight},getScrollWidth:function(){if(this.ie)return Math.max(document.documentElement.offsetWidth,document.documentElement.scrollWidth);if(this.webkit)return document.body.scrollWidth;return document.documentElement.scrollWidth},getScrollHeight:function(){if(this.ie)return Math.max(document.documentElement.offsetHeight,document.documentElement.scrollHeight);if(this.webkit){if(window.ff4AndGreater&&(window.FirefoxVersion>=8))return document.documentElement.scrollHeight;return document.body.scrollHeight}return document.documentElement.scrollHeight},getScrollLeft:function(){return this.pageXOffset||document.documentElement.scrollLeft},getScrollTop:function(){return this.pageYOffset||document.documentElement.scrollTop},getSize:function(){return{'size':{'x':this.getWidth(),'y':this.getHeight()},'scrollSize':{'x':this.getScrollWidth(),'y':this.getScrollHeight()},'scroll':{'x':this.getScrollLeft(),'y':this.getScrollTop()}}},getPosition:function(){return{'x':0,'y':0}}});var Fx={};Fx.Base=new Class({options:{onStart:Class.empty,onComplete:Class.empty,onCancel:Class.empty,transition:function(p){return-(Math.cos(Math.PI*p)-1)/2},duration:500,unit:'px',wait:true,fps:50},initialize:function(options){this.element=this.element||null;this.setOptions(options);if(this.options.initialize)this.options.initialize.call(this)},step:function(){var time=$time();if(time<this.time+this.options.duration){this.delta=this.options.transition((time-this.time)/this.options.duration);this.setNow();this.increase()}else{this.stop(true);this.set(this.to);this.fireEvent('onComplete',this.element,10);this.callChain()}},set:function(to){this.now=to;this.increase();return this},setNow:function(){this.now=this.compute(this.from,this.to)},compute:function(from,to){return(to-from)*this.delta+from},start:function(from,to){if(!this.options.wait)this.stop();else if(this.timer)return this;this.from=from;this.to=to;this.change=this.to-this.from;this.time=$time();this.timer=this.step.periodical(Math.round(1000/this.options.fps),this);this.fireEvent('onStart',this.element);return this},stop:function(end){if(!this.timer)return this;this.timer=$clear(this.timer);if(!end)this.fireEvent('onCancel',this.element);return this},custom:function(from,to){return this.start(from,to)},clearTimer:function(end){return this.stop(end)}});Fx.Base.implement(new Chain,new Events,new Options);Fx.CSS={select:function(property,to){if(property.test(/color/i))return this.Color;var type=$type(to);if((type=='array')||(type=='string'&&to.contains(' ')))return this.Multi;return this.Single},parse:function(el,property,fromTo){if(!fromTo.push)fromTo=[fromTo];var from=fromTo[0],to=fromTo[1];if(!$chk(to)){to=from;from=el.getStyle(property)}var css=this.select(property,to);return{'from':css.parse(from),'to':css.parse(to),'css':css}}};Fx.CSS.Single={parse:function(value){return parseFloat(value)},getNow:function(from,to,fx){return fx.compute(from,to)},getValue:function(value,unit,property){if(unit=='px'&&property!='opacity')value=Math.round(value);return value+unit}};Fx.CSS.Multi={parse:function(value){return value.push?value:value.split(' ').map(function(v){return parseFloat(v)})},getNow:function(from,to,fx){var now=[];for(var i=0;i<from.length;i++)now[i]=fx.compute(from[i],to[i]);return now},getValue:function(value,unit,property){if(unit=='px'&&property!='opacity')value=value.map(Math.round);return value.join(unit+' ')+unit}};Fx.CSS.Color={parse:function(value){return value.push?value:value.hexToRgb(true)},getNow:function(from,to,fx){var now=[];for(var i=0;i<from.length;i++)now[i]=Math.round(fx.compute(from[i],to[i]));return now},getValue:function(value){return'rgb('+value.join(',')+')'}};Fx.Style=Fx.Base.extend({initialize:function(el,property,options){this.element=$(el);this.property=property;this.parent(options)},hide:function(){return this.set(0)},setNow:function(){this.now=this.css.getNow(this.from,this.to,this)},set:function(to){this.css=Fx.CSS.select(this.property,to);return this.parent(this.css.parse(to))},start:function(from,to){if(this.timer&&this.options.wait)return this;var parsed=Fx.CSS.parse(this.element,this.property,[from,to]);this.css=parsed.css;return this.parent(parsed.from,parsed.to)},increase:function(){this.element.setStyle(this.property,this.css.getValue(this.now,this.options.unit,this.property))}});Element.extend({effect:function(property,options){return new Fx.Style(this,property,options)}});Fx.Styles=Fx.Base.extend({initialize:function(el,options){this.element=$(el);this.parent(options)},setNow:function(){for(var p in this.from)this.now[p]=this.css[p].getNow(this.from[p],this.to[p],this)},set:function(to){var parsed={};this.css={};for(var p in to){this.css[p]=Fx.CSS.select(p,to[p]);parsed[p]=this.css[p].parse(to[p])}return this.parent(parsed)},start:function(obj){if(this.timer&&this.options.wait)return this;this.now={};this.css={};var from={},to={};for(var p in obj){var parsed=Fx.CSS.parse(this.element,p,obj[p]);from[p]=parsed.from;to[p]=parsed.to;this.css[p]=parsed.css}return this.parent(from,to)},increase:function(){for(var p in this.now)this.element.setStyle(p,this.css[p].getValue(this.now[p],this.options.unit,p))}});Element.extend({effects:function(options){return new Fx.Styles(this,options)}});Fx.Elements=Fx.Base.extend({initialize:function(elements,options){this.elements=$$(elements);this.parent(options)},setNow:function(){for(var i in this.from){var iFrom=this.from[i],iTo=this.to[i],iCss=this.css[i],iNow=this.now[i]={};for(var p in iFrom)iNow[p]=iCss[p].getNow(iFrom[p],iTo[p],this)}},set:function(to){var parsed={};this.css={};for(var i in to){var iTo=to[i],iCss=this.css[i]={},iParsed=parsed[i]={};for(var p in iTo){iCss[p]=Fx.CSS.select(p,iTo[p]);iParsed[p]=iCss[p].parse(iTo[p])}}return this.parent(parsed)},start:function(obj){if(this.timer&&this.options.wait)return this;this.now={};this.css={};var from={},to={};for(var i in obj){var iProps=obj[i],iFrom=from[i]={},iTo=to[i]={},iCss=this.css[i]={};for(var p in iProps){var parsed=Fx.CSS.parse(this.elements[i],p,iProps[p]);iFrom[p]=parsed.from;iTo[p]=parsed.to;iCss[p]=parsed.css}}return this.parent(from,to)},increase:function(){for(var i in this.now){var iNow=this.now[i],iCss=this.css[i];for(var p in iNow)this.elements[i].setStyle(p,iCss[p].getValue(iNow[p],this.options.unit,p))}}});Fx.Scroll=Fx.Base.extend({options:{overflown:[],offset:{'x':0,'y':0},wheelStops:true},initialize:function(element,options){this.now=[];this.element=$(element);this.bound={'stop':this.stop.bind(this,false)};this.parent(options);if(this.options.wheelStops){this.addEvent('onStart',function(){document.addEvent('mousewheel',this.bound.stop)}.bind(this));this.addEvent('onComplete',function(){document.removeEvent('mousewheel',this.bound.stop)}.bind(this))}},setNow:function(){for(var i=0;i<2;i++)this.now[i]=this.compute(this.from[i],this.to[i])},scrollTo:function(x,y){if(this.timer&&this.options.wait)return this;var el=this.element.getSize();var values={'x':x,'y':y};for(var z in el.size){var max=el.scrollSize[z]-el.size[z];if($chk(values[z]))values[z]=($type(values[z])=='number')?values[z].limit(0,max):max;else values[z]=el.scroll[z];values[z]+=this.options.offset[z]}return this.start([el.scroll.x,el.scroll.y],[values.x,values.y])},toTop:function(){return this.scrollTo(false,0)},toBottom:function(){return this.scrollTo(false,'full')},toLeft:function(){return this.scrollTo(0,false)},toRight:function(){return this.scrollTo('full',false)},toElement:function(el){var parent=this.element.getPosition(this.options.overflown);var target=$(el).getPosition(this.options.overflown);return this.scrollTo(target.x-parent.x,target.y-parent.y)},increase:function(){this.element.scrollTo(this.now[0],this.now[1])}});Fx.Slide=Fx.Base.extend({options:{mode:'vertical'},initialize:function(el,options){this.element=$(el);this.wrapper=new Element('div',{'styles':$extend(this.element.getStyles('margin'),{'overflow':'hidden'})}).injectAfter(this.element).adopt(this.element);this.element.setStyle('margin',0);this.setOptions(options);this.now=[];this.parent(this.options);this.open=true;this.addEvent('onComplete',function(){this.open=(this.now[0]===0)});if(window.webkit419)this.addEvent('onComplete',function(){if(this.open)this.element.remove().inject(this.wrapper)})},setNow:function(){for(var i=0;i<2;i++)this.now[i]=this.compute(this.from[i],this.to[i])},vertical:function(){this.margin='margin-top';this.layout='height';this.offset=this.element.offsetHeight},horizontal:function(){this.margin='margin-left';this.layout='width';this.offset=this.element.offsetWidth},slideIn:function(mode){this[mode||this.options.mode]();return this.start([this.element.getStyle(this.margin).toInt(),this.wrapper.getStyle(this.layout).toInt()],[0,this.offset])},slideOut:function(mode){this[mode||this.options.mode]();return this.start([this.element.getStyle(this.margin).toInt(),this.wrapper.getStyle(this.layout).toInt()],[-this.offset,0])},hide:function(mode){this[mode||this.options.mode]();this.open=false;return this.set([-this.offset,0])},show:function(mode){this[mode||this.options.mode]();this.open=true;return this.set([0,this.offset])},toggle:function(mode){if(this.wrapper.offsetHeight==0||this.wrapper.offsetWidth==0)return this.slideIn(mode);return this.slideOut(mode)},increase:function(){this.element.setStyle(this.margin,this.now[0]+this.options.unit);this.wrapper.setStyle(this.layout,this.now[1]+this.options.unit)}});Fx.Transition=function(transition,params){params=params||[];if($type(params)!='array')params=[params];return $extend(transition,{easeIn:function(pos){return transition(pos,params)},easeOut:function(pos){return 1-transition(1-pos,params)},easeInOut:function(pos){return(pos<=0.5)?transition(2*pos,params)/2:(2-transition(2*(1-pos),params))/2}})};Fx.Transitions=new Abstract({linear:function(p){return p}});Fx.Transitions.extend=function(transitions){for(var transition in transitions){Fx.Transitions[transition]=new Fx.Transition(transitions[transition]);Fx.Transitions.compat(transition)}};Fx.Transitions.compat=function(transition){['In','Out','InOut'].each(function(easeType){Fx.Transitions[transition.toLowerCase()+easeType]=Fx.Transitions[transition]['ease'+easeType]})};Fx.Transitions.extend({Pow:function(p,x){return Math.pow(p,x[0]||6)},Expo:function(p){return Math.pow(2,8*(p-1))},Circ:function(p){return 1-Math.sin(Math.acos(p))},Sine:function(p){return 1-Math.sin((1-p)*Math.PI/2)},Back:function(p,x){x=x[0]||1.618;return Math.pow(p,2)*((x+1)*p-x)},Bounce:function(p){var value;for(var a=0,b=1;1;a+=b,b/=2){if(p>=(7-4*a)/11){value=-Math.pow((11-6*a-11*p)/4,2)+b*b;break}}return value},Elastic:function(p,x){return Math.pow(2,10*--p)*Math.cos(20*p*Math.PI*(x[0]||1)/3)}});['Quad','Cubic','Quart','Quint'].each(function(transition,i){Fx.Transitions[transition]=new Fx.Transition(function(p){return Math.pow(p,[i+2])});Fx.Transitions.compat(transition)});var Drag={};Drag.Base=new Class({options:{handle:false,unit:'px',onStart:Class.empty,onBeforeStart:Class.empty,onComplete:Class.empty,onSnap:Class.empty,onDrag:Class.empty,limit:false,modifiers:{x:'left',y:'top'},grid:false,snap:6},initialize:function(el,options){this.setOptions(options);this.element=$(el);this.handle=$(this.options.handle)||this.element;this.mouse={'now':{},'pos':{}};this.value={'start':{},'now':{}};this.bound={'start':this.start.bindWithEvent(this),'check':this.check.bindWithEvent(this),'drag':this.drag.bindWithEvent(this),'stop':this.stop.bind(this)};this.attach();if(this.options.initialize)this.options.initialize.call(this)},attach:function(){this.handle.addEvent('mousedown',this.bound.start);return this},detach:function(){this.handle.removeEvent('mousedown',this.bound.start);return this},start:function(event){this.fireEvent('onBeforeStart',this.element);this.mouse.start=event.page;var limit=this.options.limit;this.limit={'x':[],'y':[]};for(var z in this.options.modifiers){if(!this.options.modifiers[z])continue;this.value.now[z]=this.element.getStyle(this.options.modifiers[z]).toInt();this.mouse.pos[z]=event.page[z]-this.value.now[z];if(limit&&limit[z]){for(var i=0;i<2;i++){if($chk(limit[z][i]))this.limit[z][i]=($type(limit[z][i])=='function')?limit[z][i]():limit[z][i]}}}if($type(this.options.grid)=='number')this.options.grid={'x':this.options.grid,'y':this.options.grid};document.addListener('mousemove',this.bound.check);document.addListener('mouseup',this.bound.stop);this.fireEvent('onStart',this.element);event.stop()},check:function(event){var distance=Math.round(Math.sqrt(Math.pow(event.page.x-this.mouse.start.x,2)+Math.pow(event.page.y-this.mouse.start.y,2)));if(distance>this.options.snap){document.removeListener('mousemove',this.bound.check);document.addListener('mousemove',this.bound.drag);this.drag(event);this.fireEvent('onSnap',this.element)}event.stop()},drag:function(event){this.out=false;this.mouse.now=event.page;for(var z in this.options.modifiers){if(!this.options.modifiers[z])continue;this.value.now[z]=this.mouse.now[z]-this.mouse.pos[z];if(this.limit[z]){if($chk(this.limit[z][1])&&(this.value.now[z]>this.limit[z][1])){this.value.now[z]=this.limit[z][1];this.out=true}else if($chk(this.limit[z][0])&&(this.value.now[z]<this.limit[z][0])){this.value.now[z]=this.limit[z][0];this.out=true}}if(this.options.grid[z])this.value.now[z]-=(this.value.now[z]%this.options.grid[z]);this.element.setStyle(this.options.modifiers[z],this.value.now[z]+this.options.unit)}this.fireEvent('onDrag',this.element);event.stop()},stop:function(){document.removeListener('mousemove',this.bound.check);document.removeListener('mousemove',this.bound.drag);document.removeListener('mouseup',this.bound.stop);this.fireEvent('onComplete',this.element)}});Drag.Base.implement(new Events,new Options);Element.extend({makeResizable:function(options){return new Drag.Base(this,$merge({modifiers:{x:'width',y:'height'}},options))}});Drag.Move=Drag.Base.extend({options:{droppables:[],container:false,overflown:[]},initialize:function(el,options){this.setOptions(options);this.element=$(el);this.droppables=$$(this.options.droppables);this.container=$(this.options.container);this.position={'element':this.element.getStyle('position'),'container':false};if(this.container)this.position.container=this.container.getStyle('position');if(!['relative','absolute','fixed'].contains(this.position.element))this.position.element='absolute';var top=this.element.getStyle('top').toInt();var left=this.element.getStyle('left').toInt();if(this.position.element=='absolute'&&!['relative','absolute','fixed'].contains(this.position.container)){top=$chk(top)?top:this.element.getTop(this.options.overflown);left=$chk(left)?left:this.element.getLeft(this.options.overflown)}else{top=$chk(top)?top:0;left=$chk(left)?left:0}this.element.setStyles({'top':top,'left':left,'position':this.position.element});this.parent(this.element)},start:function(event){this.overed=null;if(this.container){var cont=this.container.getCoordinates();var el=this.element.getCoordinates();if(this.position.element=='absolute'&&!['relative','absolute','fixed'].contains(this.position.container)){this.options.limit={'x':[cont.left,cont.right-el.width],'y':[cont.top,cont.bottom-el.height]}}else{this.options.limit={'y':[0,cont.height-el.height],'x':[0,cont.width-el.width]}}}this.parent(event)},drag:function(event){this.parent(event);var overed=this.out?false:this.droppables.filter(this.checkAgainst,this).getLast();if(this.overed!=overed){if(this.overed)this.overed.fireEvent('leave',[this.element,this]);this.overed=overed?overed.fireEvent('over',[this.element,this]):null}return this},checkAgainst:function(el){el=el.getCoordinates(this.options.overflown);var now=this.mouse.now;return(now.x>el.left&&now.x<el.right&&now.y<el.bottom&&now.y>el.top)},stop:function(){if(this.overed&&!this.out)this.overed.fireEvent('drop',[this.element,this]);else this.element.fireEvent('emptydrop',this);this.parent();return this}});Element.extend({makeDraggable:function(options){return new Drag.Move(this,options)}});var XHR=new Class({options:{method:'post',async:true,onRequest:Class.empty,onSuccess:Class.empty,onFailure:Class.empty,urlEncoded:true,encoding:'utf-8',autoCancel:false,headers:{},use_language:false},language_remove_in_url:null,setTransport:function(){this.transport=(window.XMLHttpRequest)?new XMLHttpRequest():(window.ie?new ActiveXObject('Microsoft.XMLHTTP'):false);return this},initialize:function(options){this.setTransport().setOptions(options);this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.headers={};if(this.options.urlEncoded&&this.options.method=='post'){var encoding=(this.options.encoding)?'; charset='+this.options.encoding:'';this.setHeader('Content-type','application/x-www-form-urlencoded'+encoding)}if(this.options.initialize)this.options.initialize.call(this)},onStateChange:function(){if(this.transport.readyState!=4||!this.running)return;this.running=false;var status=0;try{status=this.transport.status}catch(e){};if(this.options.isSuccess.call(this,status))this.onSuccess();else this.onFailure();this.transport.onreadystatechange=Class.empty},isSuccess:function(status){return((status>=200)&&(status<300))},onSuccess:function(){this.response={'text':this.transport.responseText,'xml':this.transport.responseXML};this.fireEvent('onSuccess',[this.response.text,this.response.xml]);this.callChain()},onFailure:function(){this.fireEvent('onFailure',this.transport)},setHeader:function(name,value){this.headers[name]=value;return this},send:function(url,data){url=this.proccessUrl(url);if(this.options.autoCancel)this.cancel();else if(this.running)return this;this.running=true;if(data&&this.options.method=='get'){url=url+(url.contains('?')?'&':'?')+data;data=null}this.transport.open(this.options.method.toUpperCase(),url,this.options.async);if(this.options.withCredentials&&'withCredentials'in this.transport)this.transport.withCredentials=true;this.transport.onreadystatechange=this.onStateChange.bind(this);if((this.options.method=='post')&&this.transport.overrideMimeType){};$extend(this.headers,this.options.headers);for(var type in this.headers)try{this.transport.setRequestHeader(type,this.headers[type])}catch(e){};this.fireEvent('onRequest');this.transport.send($pick(data,null));return this},cancel:function(){if(!this.running)return this;this.running=false;this.transport.abort();this.transport.onreadystatechange=Class.empty;this.setTransport();this.fireEvent('onCancel');return this},proccessUrl:function(url){if(this.options.method==='get'&&this.language_remove_in_url&&!this.options.use_language&&new RegExp('/'+this.language_remove_in_url+'/').test(url)){url=url.replace('/'+this.language_remove_in_url+'/','/');if(this.options.headers.ajaxAction){this.options.headers.ajaxAction=this.options.headers.ajaxAction.replace('/'+this.language_remove_in_url+'/','/')}}return url}});XHR.implement(new Chain,new Events,new Options);var Ajax=XHR.extend({options:{data:null,update:null,onComplete:Class.empty,evalScripts:false,evalResponse:false,use_language:false,token_cookie_name:'uid',token_field_name:'request_token',protect_always:'1'},initialize:function(url,options){this.addEvent('onSuccess',this.onComplete);this.setOptions(options);this.options.data=this.options.data||this.options.postBody;if(!['post','get'].contains(this.options.method)){this._method='_method='+this.options.method;this.options.method='post'}this.parent();this.setHeader('X-Requested-With','XMLHttpRequest');this.setHeader('Accept','text/javascript, text/html, application/xml, text/xml, */*');url=this.proccessUrl(url);this.url=url},onComplete:function(){if(this.options.update)$(this.options.update).empty().setHTML(this.response.text);if(this.options.evalScripts||this.options.evalResponse)this.evalScripts();this.fireEvent('onComplete',[this.response.text,this.response.xml],20)},request:function(data){data=data||this.options.data;if(this.options.protect_always==='1'&&this.options.method==='post'){if(!$defined(data))data={};data[this.options.token_field_name]=Cookie.get(this.options.token_cookie_name)}switch($type(data)){case'element':data=$(data).toQueryString();break;case'object':data=Object.toQueryString(data)}if(this._method)data=(data)?[this._method,data].join('&'):this._method;return this.send(this.url,data)},evalScripts:function(){var script,scripts;if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader('Content-type')))scripts=this.response.text;else{scripts=[];var regexp=/<script[^>]*>([\s\S]*?)<\/script>/gi;while((script=regexp.exec(this.response.text)))scripts.push(script[1]);scripts=scripts.join('\n')}if(scripts)(window.execScript)?window.execScript(scripts):window.setTimeout(scripts,0)},getHeader:function(name){try{return this.transport.getResponseHeader(name)}catch(e){};return null}});Object.toQueryString=function(source){var queryString=[];for(var property in source)queryString.push(encodeURIComponent(property)+'='+encodeURIComponent(source[property]));return queryString.join('&')};Element.extend({send:function(options){return new Ajax(this.getProperty('action'),$merge({data:this.toQueryString()},options,{method:'post'})).request()}});var Cookie=new Abstract({options:{domain:false,path:false,duration:false,secure:true},set:function(key,value,options){options=$merge(this.options,options);value=encodeURIComponent(value);if(options.domain)value+='; domain='+options.domain;if(options.path)value+='; path='+options.path;if(options.duration){var date=new Date();date.setTime(this.getDuration(options.duration));value+='; expires='+date.toGMTString()}if(options.secure||typeof options.secure=='undefined')value+='; secure';document.cookie=key+'='+value;return $extend(options,{'key':key,'value':value})},getDuration:function(days){var date=new Date();return date.getTime()+days*24*60*60*1000},get:function(key){var value=document.cookie.match('(?:^|;)\\s*'+key.escapeRegExp()+'=([^;]*)');return value?decodeURIComponent(value[1]):false},remove:function(cookie,options){if($type(cookie)=='object')this.set(cookie.key,'',$merge(cookie,{duration:-1}));else this.set(cookie,'',$merge(options,{duration:-1}))}});var Json={toString:function(obj){switch($type(obj)){case'string':return'"'+obj.replace(/(["\\])/g,'\\$1')+'"';case'array':return'['+obj.map(Json.toString).join(',')+']';case'object':var string=[];for(var property in obj)string.push(Json.toString(property)+':'+Json.toString(obj[property]));return'{'+string.join(',')+'}';case'number':if(isFinite(obj))break;case false:return'null'}return String(obj)},evaluate:function(str,secure){return(($type(str)!='string')||(secure&&!str.test(/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/)))?null:eval('('+str+')')}};Json.Remote=XHR.extend({initialize:function(url,options){this.url=url;this.addEvent('onSuccess',this.onComplete);this.parent(options);this.setHeader('X-Request','JSON')},send:function(obj){return this.parent(this.url,'json='+Json.toString(obj))},onComplete:function(){this.fireEvent('onComplete',[Json.evaluate(this.response.text,this.options.secure)])}});var Asset=new Abstract({javascript:function(source,properties){properties=$merge({'onload':Class.empty},properties);var script=new Element('script',{'src':source}).addEvents({'load':properties.onload,'error':properties.onerror||function(){},'readystatechange':function(){if(this.readyState=='complete')this.fireEvent('load')}});delete properties.onload;delete properties.onerror;return script.setProperties(properties).inject(document.head)},css:function(source,properties){return new Element('link',$merge({'rel':'stylesheet','media':'screen','type':'text/css','href':source},properties)).inject(document.head)},image:function(source,properties){properties=$merge({'onload':Class.empty,'onabort':Class.empty,'onerror':Class.empty},properties);var image=new Image();image.src=source;var element=new Element('img',{'src':source});['load','abort','error'].each(function(type){var event=properties['on'+type];delete properties['on'+type];element.addEvent(type,function(){this.removeEvent(type,arguments.callee);event.call(this)})});if(image.width&&image.height)element.fireEvent('load',element,1);return element.setProperties(properties)},images:function(sources,options){options=$merge({onComplete:Class.empty,onProgress:Class.empty},options);if(!sources.push)sources=[sources];var images=[];var counter=0;sources.each(function(source){var img=new Asset.image(source,{'onload':function(){options.onProgress.call(this,counter);counter++;if(counter==sources.length)options.onComplete()}});images.push(img)});return new Elements(images)}});var Hash=new Class({length:0,initialize:function(object){this.obj=object||{};this.setLength()},get:function(key){return(this.hasKey(key))?this.obj[key]:null},hasKey:function(key){return(key in this.obj)},set:function(key,value){if(!this.hasKey(key))this.length++;this.obj[key]=value;return this},setLength:function(){this.length=0;for(var p in this.obj)this.length++;return this},remove:function(key){if(this.hasKey(key)){delete this.obj[key];this.length--}return this},each:function(fn,bind){$each(this.obj,fn,bind)},extend:function(obj){$extend(this.obj,obj);return this.setLength()},merge:function(){this.obj=$merge.apply(null,[this.obj].extend(arguments));return this.setLength()},empty:function(){this.obj={};this.length=0;return this},keys:function(){var keys=[];for(var property in this.obj)keys.push(property);return keys},values:function(){var values=[];for(var property in this.obj)values.push(this.obj[property]);return values}});function $H(obj){return new Hash(obj)};Hash.Cookie=Hash.extend({initialize:function(name,options){this.name=name;this.options=$extend({'autoSave':true},options||{});this.load()},save:function(){if(this.length==0){Cookie.remove(this.name,this.options);return true}var str=Json.toString(this.obj);if(str.length>4096)return false;Cookie.set(this.name,str,this.options);return true},load:function(){this.obj=Json.evaluate(Cookie.get(this.name),true)||{};this.setLength()}});Hash.Cookie.Methods={};['extend','set','merge','empty','remove'].each(function(method){Hash.Cookie.Methods[method]=function(){Hash.prototype[method].apply(this,arguments);if(this.options.autoSave)this.save();return this}});Hash.Cookie.implement(Hash.Cookie.Methods);var Color=new Class({initialize:function(color,type){type=type||(color.push?'rgb':'hex');var rgb,hsb;switch(type){case'rgb':rgb=color;hsb=rgb.rgbToHsb();break;case'hsb':rgb=color.hsbToRgb();hsb=color;break;default:rgb=color.hexToRgb(true);hsb=rgb.rgbToHsb()}rgb.hsb=hsb;rgb.hex=rgb.rgbToHex();return $extend(rgb,Color.prototype)},mix:function(){var colors=$A(arguments);var alpha=($type(colors[colors.length-1])=='number')?colors.pop():50;var rgb=this.copy();colors.each(function(color){color=new Color(color);for(var i=0;i<3;i++)rgb[i]=Math.round((rgb[i]/ 100 * (100 - alpha)) + (color[i] /100*alpha))});return new Color(rgb,'rgb')},invert:function(){return new Color(this.map(function(value){return 255-value}))},setHue:function(value){return new Color([value,this.hsb[1],this.hsb[2]],'hsb')},setSaturation:function(percent){return new Color([this.hsb[0],percent,this.hsb[2]],'hsb')},setBrightness:function(percent){return new Color([this.hsb[0],this.hsb[1],percent],'hsb')}});function $RGB(r,g,b){return new Color([r,g,b],'rgb')};function $HSB(h,s,b){return new Color([h,s,b],'hsb')};Array.extend({rgbToHsb:function(){var red=this[0],green=this[1],blue=this[2];var hue,saturation,brightness;var max=Math.max(red,green,blue),min=Math.min(red,green,blue);var delta=max-min;brightness=max/255;saturation=(max!=0)?delta/max:0;if(saturation==0){hue=0}else{var rr=(max-red)/delta;var gr=(max-green)/delta;var br=(max-blue)/delta;if(red==max)hue=br-gr;else if(green==max)hue=2+rr-br;else hue=4+gr-rr;hue/=6;if(hue<0)hue++}return[Math.round(hue*360),Math.round(saturation*100),Math.round(brightness*100)]},hsbToRgb:function(){var br=Math.round(this[2]/100*255);if(this[1]==0){return[br,br,br]}else{var hue=this[0]%360;var f=hue%60;var p=Math.round((this[2]*(100-this[1]))/10000*255);var q=Math.round((this[2]*(6000-this[1]*f))/600000*255);var t=Math.round((this[2]*(6000-this[1]*(60-f)))/600000*255);switch(Math.floor(hue/60)){case 0:return[br,t,p];case 1:return[q,br,p];case 2:return[p,br,t];case 3:return[p,q,br];case 4:return[t,p,br];case 5:return[br,p,q]}}return false}});var Scroller=new Class({options:{area:20,velocity:1,onChange:function(x,y){this.element.scrollTo(x,y)}},initialize:function(element,options){this.setOptions(options);this.element=$(element);this.mousemover=([window,document].contains(element))?$(document.body):this.element},start:function(){this.coord=this.getCoords.bindWithEvent(this);this.mousemover.addListener('mousemove',this.coord)},stop:function(){this.mousemover.removeListener('mousemove',this.coord);this.timer=$clear(this.timer)},getCoords:function(event){this.page=(this.element==window)?event.client:event.page;if(!this.timer)this.timer=this.scroll.periodical(50,this)},scroll:function(){var el=this.element.getSize();var pos=this.element.getPosition();var change={'x':0,'y':0};for(var z in this.page){if(this.page[z]<(this.options.area+pos[z])&&el.scroll[z]!=0)change[z]=(this.page[z]-this.options.area-pos[z])*this.options.velocity;else if(this.page[z]+this.options.area>(el.size[z]+pos[z])&&el.scroll[z]+el.size[z]!=el.scrollSize[z])change[z]=(this.page[z]-el.size[z]+this.options.area-pos[z])*this.options.velocity}if(change.y||change.x)this.fireEvent('onChange',[el.scroll.x+change.x,el.scroll.y+change.y])}});Scroller.implement(new Events,new Options);var Slider=new Class({options:{onChange:Class.empty,onComplete:Class.empty,onTick:function(pos){this.knob.setStyle(this.p,pos)},mode:'horizontal',steps:100,offset:0},initialize:function(el,knob,options){this.element=$(el);this.knob=$(knob);this.setOptions(options);this.previousChange=-1;this.previousEnd=-1;this.step=-1;this.element.addEvent('mousedown',this.clickedElement.bindWithEvent(this));var mod,offset;switch(this.options.mode){case'horizontal':this.z='x';this.p='left';mod={'x':'left','y':false};offset='offsetWidth';break;case'vertical':this.z='y';this.p='top';mod={'x':false,'y':'top'};offset='offsetHeight'}this.max=this.element[offset]-this.knob[offset]+(this.options.offset*2);this.half=this.knob[offset]/2;this.getPos=this.element['get'+this.p.capitalize()].bind(this.element);this.knob.setStyle('position','relative').setStyle(this.p,-this.options.offset);var lim={};lim[this.z]=[-this.options.offset,this.max-this.options.offset];this.drag=new Drag.Base(this.knob,{limit:lim,modifiers:mod,snap:0,onStart:function(){this.draggedKnob()}.bind(this),onDrag:function(){this.draggedKnob()}.bind(this),onComplete:function(){this.draggedKnob();this.end()}.bind(this)});if(this.options.initialize)this.options.initialize.call(this)},set:function(step){this.step=step.limit(0,this.options.steps);this.checkStep();this.end();this.fireEvent('onTick',this.toPosition(this.step));return this},clickedElement:function(event){var position=event.page[this.z]-this.getPos()-this.half;position=position.limit(-this.options.offset,this.max-this.options.offset);this.step=this.toStep(position);this.checkStep();this.end();this.fireEvent('onTick',position)},draggedKnob:function(){this.step=this.toStep(this.drag.value.now[this.z]);this.checkStep()},checkStep:function(){if(this.previousChange!=this.step){this.previousChange=this.step;this.fireEvent('onChange',this.step)}},end:function(){if(this.previousEnd!==this.step){this.previousEnd=this.step;this.fireEvent('onComplete',this.step+'')}},toStep:function(position){return Math.round((position+this.options.offset)/this.max*this.options.steps)},toPosition:function(step){return this.max*step/this.options.steps}});Slider.implement(new Events,new Options);$$.shared.regexp=/^(\w*|\*)(?:#([\w-]+)|\.([\w-]+))?(?:\[([\w-]+)(?:([!*^$]?=)["']?([^"']*)["']?)?])?$/;function $defined_list(obj,list){if($defined(obj)){if(list&&list.length){return $defined_list(obj[list[0]],list.slice(1,list.length))};return true}else{return false}};function formatDataProperty(prop){return prop.replace('data-','').camelCase()};var UID=1;$uid=(window.ie)?function(item){return(item.uid||(item.uid=[UID++]))[0]}:function(item){return item.uid||(item.uid=UID++)};$uid(window);$uid(document);var storage={};var getProp=function(uid){return(storage[uid]||(storage[uid]={}))};Array.extend({getRandomFrom:function(num){var arr=$A(this);var result=[];for(var i=0;i<num&&arr.length;i++)result.include(arr.splice($random(0,arr.length-1),1)[0]);return result},clone:function(){var i=this.length,clone=[i];while(i--){clone[i]=cloneOf(this[i])}return clone},min:function(){return Math.min.apply(null,this)},max:function(){return Math.max.apply(null,this)},erase:function(item){for(var i=this.length;i--;i){if(this[i]===item)this.splice(i,1)}return this},diff:function(array){return this.filter(function(item){return!array.contains(item)})},unique:function(){var checker=[];return this.filter(function(value){if(checker.indexOf(value)===-1){checker.push(value);return true}return false})},});var plural=function(num){if(typeof num==='string'){num=num.replace('\ ','')}num=Number(num);num%=100;if(num>20){num%=10}return(num===0||num>4)?2:(num===1?0:1)};var morphology=function(num,prfxs){var prfxs=prfxs||['','а','ов'];return prfxs[plural(num)]};var addEventOnce_fn=function(type,fn){var events=this,apply=fn.apply;fn.apply=function(thisArg,argArray){events.removeEvent(type,fn);fn.apply=apply;return fn.apply(thisArg,argArray)};this.addEvent(type,fn);return this};Garbage.collect=function(el){return el};var newFireEventFn=function(type,args,delay){var events=Object.clone(this.$events);if(events&&events[type]){events[type].keys.each(function(fn){if(fn instanceof Function){fn.create({'bind':this,'delay':delay,'arguments':args})()}},this)}return this};Events.implement({addEventOnce:addEventOnce_fn,_is_debug:null,_register:[],addEventToRegister:function(event,callback,object){this._register.push({object:object,event:event,callback:callback});object.addEvent(event,callback)},clearRegisterEvents:function(){this._register.each(this.clearRegisterEvent.bind(this));this._register=[]},clearRegisterEvent:function(item){var object=item['object'],event=item['event'],callback=item['callback'];object.removeEvent(event,callback)},removeRegisteredEvent:function(event,object){var event_for_remove=this._register.filter(function(value){return(value['event']==event&&value['object']==object)});if(event_for_remove){event_for_remove.each(this.clearRegisterEvent.bind(this))}},isEventDebug:function(){if(this._is_debug===null){this._is_debug=App.isDebug()}return this._is_debug},fireEvent:function(type,args,delay){if(this.isEventDebug()){}var events=Object.clone(this.$events);if(events&&events[type]){events[type].each(function(fn){if(fn instanceof Function){fn.create({'bind':this,'delay':delay,'arguments':args})()}},this);this.fireEvent(this._getLastEventName(type))}return this},_getLastEventName:function(type){return'end'+type},addLastEvent:function(type,fn){this.addEvent(this._getLastEventName(type),fn)}});Element.extend({addEventOnce:addEventOnce_fn,fireEvent:newFireEventFn,getParentByName:function(name,limit){return this.getParentByAttribute('name',name,limit)},getParentByAttribute:function(name_attribute,value_attribute,limit){limit=limit||5;name_attribute=name_attribute||'name';var parent=this;for(var i=0;i<limit;i++){if(parent!==null&&parent.getTag()!=='html'){parent=parent.getParent();if(parent&&parent.getAttribute(name_attribute)===value_attribute){break}}else{break}}return(i===limit)?null:parent},getParentByClass:function(name,limit){limit=limit||5;var parent=this;for(var i=0;i<limit;i++){if(parent.getTag()!=='html'){parent=parent.getParent();if(parent&&parent.hasClass(name)){break}}}return parent},getVisibleParent:function(limit){limit=limit||5;var parent=this;for(var i=0;i<limit;i++){if(!parent.isVisible()){parent=parent.getParent();if(parent&&parent.isVisible()){break}}}return parent},isValid:function(){var is_hint=function(){return this.getProperty('hint')?this.isValueEqualHint():false}.bind(this),result,not_active_condition=!this.getProperty('name')||this.blocked||this.disabled||!this.isVisible(),required_condition=(this.getProperty('_required')||this.getProperty('required'))?this.value.trim()!=''&&this.is_pattern_valid()&&!is_hint():(this.value.trim()==''||(this.value.trim()!=''&&this.is_pattern_valid())||is_hint());result=(not_active_condition||required_condition)&&this.is_mb_valid();if(result&&this.hasGroup()&&!not_active_condition&&required_condition){var group,class_name=this.getProperty('data-group-class'),constructor=App.getConstructorByClassName(class_name+'_class');if(constructor!==undefined){group=new(constructor)(this.getProperty('data-group-name'),this.form);if(group.isValid()){this.form.getFormElements().filter(function(element){if(element.getProperty('data-group-name')==this.getProperty('data-group-name')){element.highlightReset()}}.bind(this));result=true}else{result=false}}}return result},is_pattern_valid:function(ignore_case){var result=true,modifiers=!$defined(ignore_case)&&ignore_case?'gi':'g',property_value;['pattern','_pattern'].each(function(name){if(property_value=this.getProperty(name)){try{property_value=JSON.parse(property_value)}catch(e){}if($type(property_value)=='array'){property_value.forEach(function(pattern){result&=this.value.test(new RegExp(pattern,modifiers))}.bind(this))}else{result&=this.value.test(new RegExp(property_value,modifiers))}}}.bind(this));return Boolean(result)},is_mb_valid:function(){var result=true,value=this.value.trim();if(value.length>1&&!value.test(/[\u0021-\u07ff]/)){result=false}return result},hasGroup:function(){return this.hasAttribute('data-group-name')},notValid:function(){return this.getFormElements().filter(function(el){return!el.isValid()})},highlightReset:function(className){return this.removeClass(className||'input-invalid')},highlightFieldsReset:function(){this.getFormElements().each(function(el){if(['text','textarea','password','select-one','select-multiple'].contains(el.type))el.highlightReset()});return this},highlightError:function(className){return this.addClass(className||'input-invalid')},checkFields:function(disable_focus){var result=true,validator=this.getValidator();this.highlightFieldsReset();if(validator){validator.validate();this.handleValidationErrors()}var elems=validator?validator.getErrorFields():this.notValid(),index,highlightResetEvents=['keyup','change'],onchange=function(){if(!!this.value.trim()){this.highlightReset()}};if(elems.length){this.fireEvent('onFieldsCheckFailed',[elems]);!disable_focus&&elems[0].focus();elems.each(function(el){!disable_focus&&el.highlightError();for(index=0;index<highlightResetEvents.length;index++){el.removeEvent(highlightResetEvents[index],onchange);el.addEvent(highlightResetEvents[index],onchange)}});result=false}return result},getValidator:function(){if(!this.form_validator&&this.getProperty('data-validator')){this.form_validator=new(App.getConstructorByClassName(this.getProperty('data-validator')))(this)}return this.form_validator||null},handleValidationErrors:function(){this.getValidationErrorsHandlers().forEach(function(errors_handler){errors_handler.handle()})},getValidationErrorsHandlers:function(){if(!this.validation_errors_handlers){this.validation_errors_handlers=[];if(this.getProperty('data-validation-error-handlers')){this.getProperty('data-validation-error-handlers').split(',').forEach(function(class_name){this.validation_errors_handlers.push(new(App.getConstructorByClassName(class_name))(this.getValidator()))}.bind(this))}}return this.validation_errors_handlers},toQueryString:function(){var queryString=[];this.getFormElements().each(function(el){var name=el.name;var value=el.getValue();if(value===false||!name||el.disabled||el.blocked)return;var qs=function(val){queryString.push(name+'='+encodeURIComponent(val))};if($type(value)=='array')value.each(qs);else qs(value)});return queryString.join('&')},trySend:function(options){var callback,allow_after_complete=true;this.addEventOnce('onAfterComplete',function(){allow_after_complete=false}.bind(this));this.fireEvent('onBeforeSend');if(this.checkFields()){this.coverUpHints();this.tryUrchinTracker('_utry');if(!options)options={};if(!$defined(options.not_show_process)||options.not_show_process!=true){this.processStart($defined(options.process)?options.process:window.preloaders!==undefined?preloaders.process_tpl:'')}if(!this.getProperty('action'))this.setProperty('action','/cgi-bin/form.php');if(!options.headers){options.headers={ajaxAction:this.getAjaxAction()}}else if(!options.headers.ajaxAction){options.headers.ajaxAction=this.getAjaxAction()}var start_time=new Date().getTime();if(!options.onComplete||options.onComplete===undefined){options.onComplete=function(response_text){this.processStop();this.showUpHints();var Response=new Response_class(response_text);if(Response.isDone()){this.fireEvent('onResponseDone',[Response]);this.tryUrchinTracker('_udone')}else if(Response.isError()){if(!response_text){var label="Получен пустой ответ"}else if(typeof response_text!="object"){try{var resp=eval('('+response_text+')');if(!$defined(resp.code))throw'err'}catch(e){var resp={message:{content:response_text,code:parseInt('5')}}}var label=!$defined(resp.message)?response_text:resp.message.code+':'+(new Element('span')).setHTML(resp.message.content).getText()}else{var label=response_text.status+' '+response_text.statusText}this.fireEvent('onResponseError',[Response,label]);App.trackEvent('Errors','Send form',label,(new Date().getTime()-start_time));this.fireEvent('onResponseError')}Response.doAction();if($defined(Response.Message))App.showMessage(Response.Message,this);this.fireEvent('onAfterComplete',response_text)}.bind(this)}else{callback=options.onComplete;options.onComplete=function(response_text){callback.apply(this,arguments);if(allow_after_complete){this.fireEvent('onAfterComplete',response_text)}}.bind(this)}if(!options.onFailure)options.onFailure=options.onComplete;this.send(options);return true}else{return false}},getFormData:function(names_array){var form_data={},form_elements=this.getFormElements();if($defined(names_array)){form_elements=form_elements.filter(function(el){return names_array.contains(el.name)})}form_elements.each(function(el){if(el.type=='checkbox'){form_data[el.name]=el.checked?1:0}else{form_data[el.name]=el.value}});return form_data},getElementMessageBlock:function(){var selector=this.getProperty('data-app-message-block'),result=null;if(selector){result=$E(selector)}return result},getAjaxAction:function(){if(this.action){var get=App.parseGET(App.parseURL(this.action).search);return!$defined(get.r)?'':get.r+(get.action?"#"+get.action:'')}else{return location.href}},getStyleRec:function(style){var value=this.getStyle(style);if((value==''||value=='transparent')&&this.getParent()){return this.getParent().getTag()!=='html'?$(this.getParent()).getStyleRec(style):'#FFF'}return value},processStart:function(tpl,top_position){this.processStop();var h=this.offsetHeight;this.process=new Element('div').setStyles({height:h,width:this.offsetWidth,'text-align':'center',position:'relative','z-index':100,'margin-bottom':-h});new Element('div').setStyles({width:'100%',height:'100%','background-color':this.getStyleRec('background-color'),opacity:'0.6'}).injectInside(this.process);var proc=new Element('div').setHTML(App.getHTML(tpl,{})).setStyles({margin:'0 auto','text-align':'center',position:'relative'}).injectInside(this.process.injectTop(this));!top_position&&proc.setStyle('margin-top',-((h+proc.offsetHeight)/2).toInt());top_position&&proc.setStyle('top','-100%')&&proc.setStyle('margin-top',(top_position-(proc.offsetHeight)/2))},processStop:function(){if($type(this.process)=='element'){this.process.remove();this.process=null}},tryUrchinTracker:function(property){var value=this.getProperty(property);if(value)App.tryUrchinTracker(value)},hintStyles:{'font-style':'italic','color':'#CCC'},showHints:function(){this.getElements('form').each(function(form){form.hintFields=form.getElements('input[hint]').merge(form.getElements('textarea[hint]'));form.hintFields.each(function(el){el.isValueEqualHint=function(){return this.value.replace(/[\n\r]/g,'')==this.getProperty('hint').replace(/[\n\r]/g,'')};el.onfocus=el.hideHint=function(){if(this.isValueEqualHint()){this.value='';this.setStyles({'font-style':'','color':''})}};el.onblur=el.showHint=function(){if(this.value==''||this.isValueEqualHint()){this.setStyles(this.hintStyles);(function(){this.value=this.getProperty('hint')}).delay(10,this)}};if(!document.activeElement||document.activeElement!=el)el.showHint()})})},coverUpHints:function(){if($defined(this.hintFields))this.hintFields.each(function(el){el.hideHint()})},showUpHints:function(){if($defined(this.hintFields))this.hintFields.each(function(el){el.showHint()})},showDefault:function(){this.getElements('input[default]').each(function(el){if(el.value==''){var value=el.getProperty('default');if(value.substr(0,11)=='javascript:'){el.value=eval(value.substr(11))}else{el.value=value}}})},checkForms:function(){this.getElements('form').each(function(form){var form_handlers_classes=form.getProperty('data-form-handlers')?form.getProperty('data-form-handlers').split(','):[];if(form.getProperty('name')==='submit-by-ajax'){form_handlers_classes.push('FormSubmitByAjaxHandler_class')}if(form._form_handlers===undefined){form._form_handlers=[];form_handlers_classes.forEach(function(class_name){var constructor=App.getConstructorByClassName(class_name);if(!constructor){throw new Error("Не удалось загрузить тип обработчика формы "+class_name)}form._form_handlers.push((new constructor(form)))})}form._form_handlers.forEach(function(handler){handler.init()});if(form_handlers_classes.indexOf('FormSubmitByAjaxHandler_class')>=0){form.addEvent('submit',function(e){if(!this.checkFields()){new Event(e).stop()}else{this.coverUpHints()}})}})},setFocus:function(descendant){var elements=descendant?this.getFormElements():$A(this);elements.every(function(el){el=$(el);if(el.value==''&&el.getProperty('ban_autofocus')!="1"){el.focus();return 0}else{return 1}})},selectRange:function(start,end){if(this.setSelectionRange){this.focus();this.setSelectionRange(start,end)}else{var value=this.getProperty('value');var diff=value.substr(start,end-start).replace(/\r/g,'').length;start=value.substr(0,start).replace(/\r/g,'').length;var range=this.createTextRange();range.collapse(true);range.moveEnd('character',start+diff);range.moveStart('character',start);range.select()}return this},setCursorPos:function(pos){return this.selectRange(pos,pos)},isDisplayed:function(){return this.getStyle('display')!='none'},isVisible:function(){var w=this.offsetWidth,h=this.offsetHeight;return(w==0&&h==0)?false:(w>0&&h>0)?true:this.style.display!='none'},toggle:function(){return this[this.isDisplayed()?'hide':'show']()},hide:function(){var d;try{d=this.getStyle('display')}catch(e){}if(d=='none')return this;return this.setStyle('display','none')},show:function(display){if(!display&&this.isDisplayed())return this;display=display||'block';return this.setStyle('display',(display=='none')?'block':display)},disable:function(){this.setProperty('disabled','disabled');this.addClass('disabled')},enable:function(){this.removeProperty('disabled');this.removeClass('disabled')},isEnabled:function(){return!this.hasClass('disabled')},retrieve:function(property,dflt){var storage=getProp($uid(this)),prop=storage[property];if(dflt!=null&&prop==null)prop=storage[property]=dflt;return prop!=null?prop:null},store:function(property,value){var storage=getProp($uid(this));storage[property]=value;return this},data:function(property,force){var data=this.retrieve('dataCollection'),ii=0,len,hasData=false,attribs;if(!data||force===true){data={};attribs=this.attributes||[];for(len=attribs.length;ii<len;++ii){if(attribs[ii].name.indexOf('data-')===0){data[formatDataProperty(attribs[ii].name)]=attribs[ii].value;hasData=true}}if(!hasData)data=null;this.store('dataCollection',data)}return property?(data&&data[formatDataProperty(property)]||null):data},getPosition:function(overflown,not_count_bound){var position;overflown=overflown||[];not_count_bound=not_count_bound||false;if(this.getBoundingClientRect&&!not_count_bound){var bound=this.getBoundingClientRect(),body=document.body,docElem=document.documentElement,scroll={x:window.pageXOffset||docElem.scrollLeft||body.scrollLeft,y:window.pageYOffset||docElem.scrollTop||body.scrollTop},client={x:docElem.clientLeft||body.clientLeft||0,y:docElem.clientTop||body.clientTop||0};position={x:bound.left.toInt()+scroll.x-client.x,y:bound.top.toInt()+scroll.y-client.y}}else{var el=this,left=0,top=0;do{left+=el.offsetLeft||0;top+=el.offsetTop||0;el=el.offsetParent}while(el);position={'x':left,'y':top}}overflown.each(function(element){position.x-=element.scrollLeft||0;position.y-=element.scrollTop||0});return position},getCoordinates:function(overflown,not_count_bound){var position=this.getPosition(overflown,not_count_bound);var obj={'width':this.offsetWidth,'height':this.offsetHeight,'left':position.x,'top':position.y};obj.right=obj.left+obj.width;obj.bottom=obj.top+obj.height;return obj},setOpacity:function(opacity){if(opacity==0){if(this.style.visibility!="hidden")this.style.visibility="hidden"}else{if(this.style.visibility!="visible")this.style.visibility="visible"}if(!this.currentStyle||!this.currentStyle.hasLayout)this.style.zoom=1;if(window.ie)this.style.filter=(opacity==1)?'':"alpha(opacity="+opacity*100+")";this.style.opacity=opacity;return this},getStyle:function(property){property=property.camelCase();var result=this.style[property];if(!$chk(result)){result=[];for(var style in Element.Styles){if(property==style){Element.Styles[style].each(function(s){var style=this.getStyle(s);result.push(parseInt(style)?style:'0px')},this);if(property=='border'){var every=result.every(function(bit){return(bit==result[0])});return(every)?result[0]:false}return result.join(' ')}}if(property.contains('border')){if(Element.Styles.border.contains(property)){return['Width','Style','Color'].map(function(p){return this.getStyle(property+p)},this).join(' ')}else if(Element.borderShort.contains(property)){return['Top','Right','Bottom','Left'].map(function(p){return this.getStyle('border'+p+property.replace('border',''))},this).join(' ')}}if(document.defaultView)result=document.defaultView.getComputedStyle(this,null).getPropertyValue(property.hyphenate());else if(this.currentStyle)result=this.currentStyle[property]}if(window.ie)result=Element.fixStyle(property,result,this);if(result&&property.test(/color/i)&&result.contains('rgb')){return result.split('rgb').splice(1,4).map(function(color){return color.rgbToHex()}).join(' ')}return result},isElementOffScreen:function(){var position_select=this.getCoordinates();return window.scrollY>(position_select.bottom)||window.scrollY<(position_select.top)}});String.extend({format:function(){var args=arguments||[];return this.replace(/\{(\d+)\}/g,function(match,number){return args[number]?args[number]:match})},ucfirst:function(){return this.charAt(0).toUpperCase()+this.slice(1)},trim:function(chars){return ltrim(rtrim(chars))},ltrim:function(chars){chars=chars||"\\s";return this.replace(new RegExp("^["+chars+"]+","g"),"")},rtrim:function(chars){chars=chars||"\\s";return this.replace(new RegExp("["+chars+"]+$","g"),"")},url_encode:function(string){return escape(this._utf8_encode(this))},url_decode:function(){return this._utf8_decode(unescape(this))},_utf8_encode:function(string){string=string.replace(/\r\n/g,"\n");var utftext="";for(var n=0;n<string.length;n++){var c=string.charCodeAt(n);if(c<128){utftext+=String.fromCharCode(c)}else if((c>127)&&(c<2048)){utftext+=String.fromCharCode((c>>6)|192);utftext+=String.fromCharCode((c&63)|128)}else{utftext+=String.fromCharCode((c>>12)|224);utftext+=String.fromCharCode(((c>>6)&63)|128);utftext+=String.fromCharCode((c&63)|128)}}return utftext},_utf8_decode:function(utftext){var string="";var i=0;var c=c1=c2=0;while(i<utftext.length){c=utftext.charCodeAt(i);if(c<128){string+=String.fromCharCode(c);i++}else if((c>191)&&(c<224)){c2=utftext.charCodeAt(i+1);string+=String.fromCharCode(((c&31)<<6)|(c2&63));i+=2}else{c2=utftext.charCodeAt(i+1);c3=utftext.charCodeAt(i+2);string+=String.fromCharCode(((c&15)<<12)|((c2&63)<<6)|(c3&63));i+=3}}return string},truncate:function(length,postfix,by_words){var result=this;if(length&&result.length>length){result=result.substr(0,length);if(by_words){result=result.replace(/\s+?(\S+)?$/g,'')}if(postfix){result=result+postfix}}return result},toPriceFormat:function(separator){return this.replace(/(\d)(?=(\d{3})+$)/g,'$1'+String.fromCharCode(separator||8201))},stripTags:function(){var div=document.createElement("div");div.innerHTML=this;return div.textContent||div.innerText||""},getHashNum:function(){var hash=5381,i=this.length;while(i){hash=(hash*33)^this.charCodeAt(--i)}return hash>>>0}});Element.Events.hashchange={add:function(){var hash=self.location.hash;var hashchange=function(){if(hash==self.location.hash)return;else hash=self.location.hash;var value=(hash.indexOf('#')==0?hash.substr(1):hash);window.fireEvent('hashchange',value);document.fireEvent('hashchange',value)};if("onhashchange"in window){window.onhashchange=hashchange}else{hashchange.periodical(50)}}};Element.from=function(str){var result=(new Element('div')).setHTML(str).getChildren();return result.length==1?result.getLast():result};function crc32(str){var crc=0;var table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";var x=0;var y=0;crc=crc^(-1);for(var i=0,iTop=str.length;i<iTop;i++){y=(crc^str.charCodeAt(i))&0xFF;x="0x"+table.substr(y*9,8);crc=(crc>>>8)^x}return crc^(-1)}(function(root){function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3])}function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32((a<<s)|(a>>>(32-s)),b)}function ff(a,b,c,d,x,s,t){return cmn((b&c)|((~b)&d),a,b,x,s,t)}function gg(a,b,c,d,x,s,t){return cmn((b&d)|(c&(~d)),a,b,x,s,t)}function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)}function ii(a,b,c,d,x,s,t){return cmn(c^(b|(~d)),a,b,x,s,t)}function md51(s){var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i;for(i=64;i<=s.length;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)))}s=s.substring(i-64);var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<s.length;i++)tail[i>>2]|=s.charCodeAt(i)<<((i%4)<<3);tail[i>>2]|=0x80<<((i%4)<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i++)tail[i]=0}tail[14]=n*8;md5cycle(state,tail);return state}function md5blk(s){var md5blks=[],i;for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24)}return md5blks}var hex_chr='0123456789abcdef'.split('');function rhex(n){var s='',j=0;for(;j<4;j++)s+=hex_chr[(n>>(j*8+4))&0x0F]+hex_chr[(n>>(j*8))&0x0F];return s}function hex(x){for(var i=0;i<x.length;i++)x[i]=rhex(x[i]);return x.join('')}function md5(s){return hex(md51(s))}function add32(a,b){return(a+b)&0xFFFFFFFF}if(md5('hello')!='5d41402abc4b2a76b9719d911017c592'){function add32(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF),msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF)}}root.md5=md5})(window);window.nativeEncodeURIComponent=window.encodeURIComponent;window.nativeDecodeURIComponent=window.decodeURIComponent;function encodeBase64Unicode(str){return btoa(nativeEncodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode('0x'+p1)}))}function decodeBase64Unicode(str){return nativeDecodeURIComponent(Array.prototype.map.call(atob(str),function(c){return'%'+('00'+c.charCodeAt(0).toString(16)).slice(-2)}).join(''))}var mergeOne=function(source,key,current){switch($type(current)){case'object':if($type(source[key])=='object')Object.merge(source[key],current);else source[key]=Object.clone(current);break;case'array':source[key]=current.clone();break;default:source[key]=current}return source};var cloneOf=function(item){switch($type(item)){case'array':return item.clone();case'object':return Object.clone(item);default:return item}};Object.extend({merge:function(source,k,v){if($type(k)=='string')return mergeOne(source,k,v);for(var i=1,l=arguments.length;i<l;i++){var object=arguments[i];for(var key in object)mergeOne(source,key,object[key])}return source},clone:function(object){var clone={};for(var key in object)clone[key]=cloneOf(object[key]);return clone},append:function(original){for(var i=1,l=arguments.length;i<l;i++){var extended=arguments[i]||{};for(var key in extended)original[key]=extended[key]}return original}});window.extend({addEventOnce:addEventOnce_fn,fireEvent:newFireEventFn});document.extend({addEventOnce:addEventOnce_fn,fireEvent:newFireEventFn,getHeight:function(){return Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)}});(function(){Object.extend({forEach:function(object,fn,bind){for(var key in object){if(hasOwnProperty.call(object,key))fn.call(bind,object[key],key,object)}},subset:function(object,keys){var results={};for(var i=0,l=keys.length;i<l;i++){var k=keys[i];if(k in object)results[k]=object[k]}return results},map:function(object,fn,bind){var results={};for(var key in object){if(hasOwnProperty.call(object,key))results[key]=fn.call(bind,object[key],key,object)}return results},filter:function(object,fn,bind){var results={};for(var key in object){var value=object[key];if(hasOwnProperty.call(object,key)&&fn.call(bind,value,key,object))results[key]=value}return results},every:function(object,fn,bind){for(var key in object){if(hasOwnProperty.call(object,key)&&!fn.call(bind,object[key],key))return false}return true},some:function(object,fn,bind){for(var key in object){if(hasOwnProperty.call(object,key)&&fn.call(bind,object[key],key))return true}return false},keys:function(object){var keys=[];for(var key in object){if(hasOwnProperty.call(object,key))keys.push(key)}return keys},values:function(object){var values=[];for(var key in object){if(hasOwnProperty.call(object,key))values.push(object[key])}return values},getLength:function(object){return Object.keys(object).length},keyOf:function(object,value){for(var key in object){if(hasOwnProperty.call(object,key)&&object[key]===value)return key}return null},contains:function(object,value){return Object.keyOf(object,value)!=null},toQueryString:function(object,base){var queryString=[];Object.each(object,function(value,key){if(base)key=base+'['+key+']';var result;switch(typeof value){case'object':result=Object.toQueryString(value,key);break;case'array':var qs={};value.each(function(val,i){qs[i]=val});result=Object.toQueryString(qs,key);break;default:result=key+'='+encodeURIComponent(value)}if(value!=null)queryString.push(result)});return queryString.join('&')}});Object.each=Object.forEach})();Element.NativeEvents.push('touchstart','touchend','pointerdown','pointerup','mspointerdown','mspointerup','message','initializedlocalstorage','input','drop','dragenter','dragleave','dragover');location.parseHash=function(hash){hash=hash||this.hash;if(!hash)return null;return App.parseGET(hash,'#',';')};location.getHashParam=function(name){var params=this.parseHash();if(params&&$defined(params[name]))return params[name];return null};location.setHashParam=function(name,value){var params=this.parseHash()||{};if(value===null){delete params[name]}else{params[name]=value}location.hash=this.createHash(params)};location.createHash=function(obj){var hash=[];for(name in obj){hash.push(name+'='+obj[name])}return'#'+hash.join(';')};var getURLParameter=function(name){return decodeURIComponent((new RegExp('[?|&]'+name+'='+'([^&;]+?)(&|#|;|$)').exec(location.search)||[null,''])[1].replace(/\+/g,'%20'))||null};Number.isNaN=Number.isNaN||function(value){return typeof value==='number'&&isNaN(value)};Date.isToday=function(date){var now=new Date();return date.getFullYear()===now.getFullYear()&&date.getMonth()===now.getMonth()&&date.getDate()===now.getDate()};Date.isTomorrow=function(date){var tomorrow=new Date();tomorrow.setDate(tomorrow.getDate()+1);return date.getFullYear()===tomorrow.getFullYear()&&date.getMonth()===tomorrow.getMonth()&&date.getDate()===tomorrow.getDate()};var TrimPath;(function(){if(TrimPath==null)TrimPath=new Object();if(TrimPath.evalEx==null)TrimPath.evalEx=function(src){return eval(src)};var UNDEFINED;if(Array.prototype.pop==null)Array.prototype.pop=function(){if(this.length===0){return UNDEFINED}return this[--this.length]};if(Array.prototype.push==null)Array.prototype.push=function(){for(var i=0;i<arguments.length;++i){this[this.length]=arguments[i]}return this.length};TrimPath.parseTemplate=function(tmplContent,optTmplName,optEtc){if(optEtc==null)optEtc=TrimPath.parseTemplate_etc;var funcSrc=parse(tmplContent,optTmplName,optEtc);var func=TrimPath.evalEx(funcSrc,optTmplName,1);if(func!=null)return new optEtc.Template(optTmplName,tmplContent,funcSrc,func,optEtc);return null};try{String.prototype.process=function(context,optFlags){var template=TrimPath.parseTemplate(this,null);if(template!=null)return template.process(context,optFlags);return this}}catch(e){};TrimPath.parseTemplate_etc={};TrimPath.parseTemplate_etc.statementTag="forelse|for|if|elseif|else|var|macro";TrimPath.parseTemplate_etc.statementDef={"if":{delta:1,prefix:"if (",suffix:"){",paramMin:1},"else":{delta:0,prefix:"} else {"},"elseif":{delta:0,prefix:"} else if (",suffix:"){",paramDefault:"true"},"/if":{delta:-1,prefix:"}"},"for":{delta:1,paramMin:3,prefixFunc:function(stmtParts,state,tmplName,etc){if(stmtParts[2]!="in")throw new etc.ParseError(tmplName,state.line,"bad for loop statement: "+stmtParts.join(' '));var iterVar=stmtParts[1];var listVar="__LIST__"+iterVar;return["var ",listVar," = ",stmtParts[3],";","var __LENGTH_STACK__;","if (typeof(__LENGTH_STACK__) == 'undefined' || !__LENGTH_STACK__.length) __LENGTH_STACK__ = new Array();","__LENGTH_STACK__[__LENGTH_STACK__.length] = 0;","if ((",listVar,") != null){ ","var ",iterVar,"_ct = 0;","for (var ",iterVar,"_index in ",listVar,"){ ",iterVar,"_ct++;","if (typeof(",listVar,"[",iterVar,"_index]) == 'function'){continue;}","__LENGTH_STACK__[__LENGTH_STACK__.length - 1]++;","var ",iterVar," = ",listVar,"[",iterVar,"_index];"].join("")}},"forelse":{delta:0,prefix:"} } if (__LENGTH_STACK__[__LENGTH_STACK__.length - 1] == 0){ if (",suffix:"){",paramDefault:"true"},"/for":{delta:-1,prefix:"} }; delete __LENGTH_STACK__[__LENGTH_STACK__.length - 1];"},"var":{delta:0,prefix:"var ",suffix:";"},"macro":{delta:1,prefixFunc:function(stmtParts,state,tmplName,etc){var macroName=stmtParts[1].split('(')[0];return["var ",macroName," = function",stmtParts.slice(1).join(' ').substring(macroName.length),"{ var _OUT_arr = []; var _OUT = { write: function(m){ if (m) _OUT_arr.push(m); } }; "].join('')}},"/macro":{delta:-1,prefix:" return _OUT_arr.join(''); };"}};TrimPath.parseTemplate_etc.modifierDef={"eat":function(v){return""},"escape":function(s){return String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},"capitalize":function(s){return String(s).toUpperCase()},"default":function(s,d){return s!=null?s:d},"money":function(c){if(isNaN(c))return'NaN';c=(''+Math.round(c*100)/100).match(/(\d*)\.?(\d*)/);while(c[2].length<2){c[2]+=0}return c[1]+'.'+c[2]},"integer":function(c){if(isNaN(c))return'NaN';return parseInt(c)},"fractional":function(c){if(isNaN(c))return'NaN';var a=(''+c).match(/\.(\d*)$/);return a&&a[1]?a[1]:"00"},"morphology":function(num,prfxs){return morphology(num,prfxs)},"plural":function(num){return plural(num)}};TrimPath.parseTemplate_etc.modifierDef.h=TrimPath.parseTemplate_etc.modifierDef.escape;TrimPath.parseTemplate_etc.Template=function(tmplName,tmplContent,funcSrc,func,etc){this.process=function(context,flags){if(context==null)context={};if(context._MODIFIERS==null)context._MODIFIERS={};if(context.defined==null)context.defined=function(str){return(context[str]!=undefined)};for(var k in etc.modifierDef){if(context._MODIFIERS[k]==null)context._MODIFIERS[k]=etc.modifierDef[k]}if(flags==null)flags={};var resultArr=[];var resultOut={write:function(m){resultArr.push(m)}};try{func(resultOut,context,flags)}catch(e){if(flags.throwExceptions==true)throw e;var result=new String(resultArr.join("")+"[ERROR: "+e.toString()+(e.message?'; '+e.message:'')+"]");result["exception"]=e;return result}return resultArr.join("")};this.name=tmplName;this.source=tmplContent;this.sourceFunc=funcSrc;this.toString=function(){return"TrimPath.Template ["+tmplName+"]"}};TrimPath.parseTemplate_etc.ParseError=function(name,line,message){this.name=name;this.line=line;this.message=message};TrimPath.parseTemplate_etc.ParseError.prototype.toString=function(){return("TrimPath template ParseError in "+this.name+": line "+this.line+", "+this.message)};var parse=function(body,tmplName,etc){body=cleanWhiteSpace(body);var funcText=["var TrimPath_Template_TEMP = function(_OUT, _CONTEXT, _FLAGS){ with (_CONTEXT){"];var state={stack:[],line:1};var endStmtPrev=-1;while(endStmtPrev+1<body.length){var begStmt=endStmtPrev;begStmt=body.indexOf("{",begStmt+1);while(begStmt>=0){var endStmt=body.indexOf('}',begStmt+1);var stmt=body.substring(begStmt,endStmt);var blockrx=stmt.match(/^\{(cdata|minify|eval)/);if(blockrx){var blockType=blockrx[1];var blockMarkerBeg=begStmt+blockType.length+1;var blockMarkerEnd=body.indexOf('}',blockMarkerBeg);if(blockMarkerEnd>=0){var blockMarker;if(blockMarkerEnd-blockMarkerBeg<=0){blockMarker="{/"+blockType+"}"}else{blockMarker=body.substring(blockMarkerBeg+1,blockMarkerEnd)}var blockEnd=body.indexOf(blockMarker,blockMarkerEnd+1);if(blockEnd>=0){emitSectionText(body.substring(endStmtPrev+1,begStmt),funcText);var blockText=body.substring(blockMarkerEnd+1,blockEnd);if(blockType=='cdata'){emitText(blockText,funcText)}else if(blockType=='minify'){emitText(scrubWhiteSpace(blockText),funcText)}else if(blockType=='eval'){if(blockText!=null&&blockText.length>0)funcText.push('_OUT.write( (function(){ '+blockText+' })() );')}begStmt=endStmtPrev=blockEnd+blockMarker.length-1}}}else if(body.charAt(begStmt-1)!='$'&&body.charAt(begStmt-1)!='\\'){var offset=(body.charAt(begStmt+1)=='/'?2:1);if(body.substring(begStmt+offset,begStmt+10+offset).search(TrimPath.parseTemplate_etc.statementTag)==0)break}begStmt=body.indexOf("{",begStmt+1)}if(begStmt<0)break;var endStmt=body.indexOf("}",begStmt+1);if(endStmt<0)break;emitSectionText(body.substring(endStmtPrev+1,begStmt),funcText);emitStatement(body.substring(begStmt,endStmt+1),state,funcText,tmplName,etc);endStmtPrev=endStmt}emitSectionText(body.substring(endStmtPrev+1),funcText);if(state.stack.length!=0)throw new etc.ParseError(tmplName,state.line,"unclosed, unmatched statement(s): "+state.stack.join(","));funcText.push("}}; TrimPath_Template_TEMP");return funcText.join("")};var emitStatement=function(stmtStr,state,funcText,tmplName,etc){var parts=stmtStr.slice(1,-1).split(' ');var stmt=etc.statementDef[parts[0]];if(stmt==null){emitSectionText(stmtStr,funcText);return}if(stmt.delta<0){if(state.stack.length<=0)throw new etc.ParseError(tmplName,state.line,"close tag does not match any previous statement: "+stmtStr);state.stack.pop()}if(stmt.delta>0)state.stack.push(stmtStr);if(stmt.paramMin!=null&&stmt.paramMin>=parts.length)throw new etc.ParseError(tmplName,state.line,"statement needs more parameters: "+stmtStr);if(stmt.prefixFunc!=null)funcText.push(stmt.prefixFunc(parts,state,tmplName,etc));else funcText.push(stmt.prefix);if(stmt.suffix!=null){if(parts.length<=1){if(stmt.paramDefault!=null)funcText.push(stmt.paramDefault)}else{for(var i=1;i<parts.length;i++){if(i>1)funcText.push(' ');funcText.push(parts[i])}}funcText.push(stmt.suffix)}};var emitSectionText=function(text,funcText){if(text.length<=0)return;emitSectionTextLine(text,funcText)};var emitSectionTextLine=function(line,funcText){var endMarkPrev='}';var endExprPrev=-1;while(endExprPrev+endMarkPrev.length<line.length){var begMark="${",endMark="}";var begExpr=line.indexOf(begMark,endExprPrev+endMarkPrev.length);if(begExpr<0)break;if(line.charAt(begExpr+2)=='%'){begMark="${%";endMark="%}"}var endExpr=line.indexOf(endMark,begExpr+begMark.length);if(endExpr<0)break;emitText(line.substring(endExprPrev+endMarkPrev.length,begExpr),funcText);var exprArr=line.substring(begExpr+begMark.length,endExpr).replace(/\|\|/g,"#@@#").split('|');for(var k in exprArr){if(exprArr[k].replace)exprArr[k]=exprArr[k].replace(/#@@#/g,'||')}funcText.push('_OUT.write(');emitExpression(exprArr,exprArr.length-1,funcText);funcText.push(');');endExprPrev=endExpr;endMarkPrev=endMark}emitText(line.substring(endExprPrev+endMarkPrev.length),funcText)};var emitText=function(text,funcText){if(text==null||text.length<=0)return;text=text.replace(/\\/g,'\\\\');text=text.replace(/\n/g,'\\n');text=text.replace(/"/g,'\\"');funcText.push('_OUT.write("');funcText.push(text);funcText.push('");')};var emitExpression=function(exprArr,index,funcText){var expr=exprArr[index];if(index<=0){funcText.push(expr);return}var parts=expr.split(':');funcText.push('_MODIFIERS["');funcText.push(parts[0]);funcText.push('"](');emitExpression(exprArr,index-1,funcText);if(parts.length>1){funcText.push(',');funcText.push(parts[1])}funcText.push(')')};var cleanWhiteSpace=function(result){result=result.replace(/\t/g,"    ");result=result.replace(/\r\n/g,"\n");result=result.replace(/\r/g,"\n");result=result.replace(/^(\s*\S*(\s+\S+)*)\s*$/,'$1');return result};var scrubWhiteSpace=function(result){result=result.replace(/^\s+/g,"");result=result.replace(/\s+$/g,"");result=result.replace(/\s+/g," ");result=result.replace(/^(\s*\S*(\s+\S+)*)\s*$/,'$1');return result};TrimPath.parseDOMTemplate=function(elementId,optDocument,optEtc){if(optDocument==null)optDocument=document;var element=optDocument.getElementById(elementId);var content=element.value;if(content==null)content=element.innerHTML;content=content.replace(/&lt;/g,"<").replace(/&gt;/g,">");return TrimPath.parseTemplate(content,elementId,optEtc)};TrimPath.processDOMTemplate=function(elementId,context,optFlags,optDocument,optEtc){return TrimPath.parseDOMTemplate(elementId,optDocument,optEtc).process(context,optFlags)}})();window.static_config_app={settings:{'city-chooser':{cities:{"text":"default_data","records":[{"id":1,"title":"Київ","big_city":"1","region":"","district":"","show_all":0,"status":1},{"id":30,"title":"Одеса","big_city":"1","region":"","district":"","show_all":0,"status":1},{"id":28,"title":"Дніпро","big_city":"1","region":"","district":"","show_all":0,"status":1},{"id":31,"title":"Харків","big_city":"1","region":"","district":"","show_all":0,"status":1},{"id":11632,"title":"Запоріжжя","big_city":"1","region":"Запорізька","district":"Запорожье","show_all":0,"status":1},{"id":28050,"title":"Львів","big_city":"1","region":"Львівська","district":"Львов","show_all":0,"status":1}],"random_record":{"id":24602,"title":"Привільне","big_city":"0","region":"Миколаївська","district":"Баштанский","show_all":0,"status":1},"count":6}},languages:{languages:[{"title":"ru","is_current":false,"href":"https:\/\/rozetka.com.ua\/","store":{},"language":{"title":"ru","value":"ru","locale":"ru_UA","name":"ru","is_primary":true}},{"title":"ua","is_current":true,"href":"https:\/\/rozetka.com.ua\/ua\/","store":{},"language":{"title":"ua","value":"uk","locale":"uk_UA","name":"ua","is_primary":false}}],current:'ua',primary:'ru'},menu:{top:[{name:'faq',title:'Запитання та відповіді',href:'https://rozetka.com.ua/faq/'},{name:'credit',title:'Кредит',href:'https://rozetka.com.ua/credit/'},{name:'payments-and-deliveries',title:'Доставка та оплата',href:'https://rozetka.com.ua/payments-and-deliveries/'},{name:'warranty',title:'Гарантія',href:'https://rozetka.com.ua/warranty/'},{name:'contacts',title:'Контакти',href:'https://rozetka.com.ua/contacts/'}],www:{base:'rozetka.com.ua',base_href:'https://rozetka.com.ua/',href:'https://rozetka.com.ua/'},my:{href:'https://my.rozetka.com.ua/',cart:{href:'https://my.rozetka.com.ua/cart/'}}}}};(function(){var domain='rozetka.com.ua';if((new RegExp(domain)).test(document.domain)||document.domain===null){try{document.domain=domain}catch(e){if(window.console!==undefined&&console.error!==undefined){console.error(e)}}}})();XHR.prototype.language_remove_in_url="ua";var preloaders={process_tpl:'<div class=\"preloader-big\">&nbsp;<\/div>',green_process_tpl:'<div class=\"preloader-big\">&nbsp;<\/div>',suggest_process_tpl:'<div class=\"preloader-spiner\">&nbsp;<\/div>'};var PluginEvents_class=new Class({firePluginEvent:function(event_name){var event=null;if(document['createEvent']){event=document.createEvent("HTMLEvents");event.initEvent(event_name,"true","false");document.dispatchEvent(event)}}});!function(a){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j="function"==typeof setImmediate&&setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})},c._setImmediateFn=function(a){j=a},"undefined"!=typeof module&&module.exports?module.exports=c:a.Promise||(a.Promise=c)}(this);(function(){function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();var Config_class=new Class({_data:null,initialize:function(config_data){this._data=config_data||{}},get:function(key){var path=key.split('.'),result=this._data[path.shift()];while(result!==undefined&&path.length){var key_name=path.shift();if(typeof result=='object'&&result!==null){result=result[key_name]}else{result=undefined}}return result}});var URI_class=new Class({_url:{protocol:null,hostname:null,pathname:null,search:null,hash:null},_lang_names:[],options:{languages:[],current:null,primary:null},initialize:function(href,options){this._url=Object.clone(this._url);this.setOptions(App.getSettings('languages'));this.setOptions(options);this.options.languages.forEach(function(lang){this._lang_names.push(lang.language.name)}.bind(this));var a=new Element('a');a.href=href||window.location.href;Object.each(this._url,function(value,name){this._url[name]=a[name];if(name==='pathname'&&a[name][0]!=='/'){this._url[name]='/'+this._url[name]}}.bind(this));var nodes=this._url.pathname.split('/').filter(Boolean);if(nodes.length&&this._lang_names.indexOf(nodes[0])>-1){nodes.shift();this._url.pathname=this._url.pathname.replace(/(.*\/)(ua)\/(.*)/,'$1$3')}},_getHref:function(){return this.get('protocol')+'//'+this.get('hostname')+(this.options.current&&this.options.current!==this.options.primary?'/'+this.options.current:'')+this.get('pathname')+this.get('search')+this.get('hash')},get:function(name){var result=undefined;if(name=='value'){result=this._getHref()}else{result=this._url[name]}return result},getParamsFromPath:function(){var params=null,pathname=this.get('pathname'),nodes=pathname.split('/').filter(Boolean).filter(function(node){return(/=/.test(node))});if(nodes&&nodes.length){params={};nodes.forEach(function(node){var pairs=node.split(';');pairs.forEach(function(pair){var key_value=pair.split('=');if(key_value&&key_value.length>1&&key_value[0]&&key_value[1]){params[key_value[0]]=key_value[1]}})})}return params},set:function(name,value){throw new Error('Method not implemented');return this},toString:function(){return this.get('value')}});URI_class.implement(new Options());Events.implement({attachToObserver:function(events){var property_name;for(property_name in this){if(this[property_name]instanceof Function&&property_name.substring(0,2)=='on'){if(!this.options||!(this.options[property_name]instanceof Function)){this.addEvent(property_name,this[property_name])}}}Observer.register(this,events)}});var Observer_class=new Class({_objects:[],_events:{},_event_handlers:{},initialize:function(){this.register(document,[])},register:function(object,events){var i,j,event_name;for(i=0;i<events.length;i++){if(this._events[events[i]]==undefined){this._events[events[i]]=[];for(j=0;j<this._objects.length;j++){this._objects[j].addEvent(events[i],this._getEventHandler(events[i]))}}this._events[events[i]][this._events[events[i]].length]=object}for(event_name in this._events){object.addEvent(event_name,this._getEventHandler(event_name))}this._objects[this._objects.length]=object},_getEventHandler:function(event_name){var event_handler=this._event_handlers[event_name];if(event_handler==undefined){event_handler=function(){var i,external_event_name;for(i=0;i<this._events[event_name].length;i++){external_event_name='on';external_event_name+=event_name.charAt(0).toUpperCase();external_event_name+=event_name.substr(1);this._events[event_name][i].fireEvent(external_event_name,arguments)}}.bind(this);this._event_handlers[event_name]=event_handler}return event_handler}});var Observer=new Observer_class();var EmptyStorage_class=new Class({Class:'EmptyStorage_class',initialize:function(options){this.setOptions(options)},init:function(){return this},available:function(){return true},"set":function(key,value){if(console&&console.log){console.log('Alert: empty storage don\'t set KEY:'+key+' and VALUE:'+value)}},"get":function(key){if(console&&console.log){console.log('Alert: empty storage don\'t get KEY:'+key)}return null},"remove":function(key){if(console&&console.log){console.log('Alert: empty storage don\'t remove KEY:'+key)}},exist:function(key){if(console&&console.log){console.log('Alert: empty storage don\'t exist KEY:'+key)}}});var LocalStorage_class=EmptyStorage_class.extend({Class:'LocalStorage_class',_storage_service:null,initialize:function(options){this.parent(options);if(window.localStorage){try{window.localStorage.setItem('_tmptest','tmpval');if(window.localStorage===Object(window.localStorage)){this._storage_service=window.localStorage}window.localStorage.removeItem('_tmptest');window.localStorage.length=100}catch(e){}}},available:function(){return!!this._storage_service},"set":function(key,value){if(this.available()){this._storage_service[key]=JSON.stringify(value)}},"get":function(key){var result=null;if(this.available()&&this._storage_service.hasOwnProperty(key)&&this._storage_service[key]!=undefined){try{result=JSON.parse(this._storage_service[key])}catch(e){}}return result},"remove":function(key){if(this.available()){delete this._storage_service[key]}},exist:function(key){return this.available()&&!!this._storage_service.hasOwnProperty(key)},'clear':function(){this.available()&&this._storage_service.clear()}});var LocalStorageCrossDomain_class=LocalStorage_class.extend({Class:'LocalStorageCrossDomain_class',_iframeElement:null,_storage_service_cross_domain:null,_temporary_storage:{},_is_initialized:false,options:{domain:'rozetka.com.ua',iframe_src:location.protocol+'//rg.rozetka.com.ua/iframe_recent_goods',origin:location.protocol+'//rg.rozetka.com.ua'},init:function(){this.parent();this._firstload();return this},initCrossDomainStorage:function(){var updateLocalStorage,self=this;updateLocalStorage=function(e){try{if(self.available()&&e.origin&&e.origin==self.options.origin){var data;data=JSON.parse(e.data);for(var item in data){if(data[item].item_name!==undefined){window.localStorage.setItem(data[item].item_name,data[item].item_value)}}window.removeEvent('message',updateLocalStorage);Object.keys(self._temporary_storage).each(function(key){self.set(key,self._temporary_storage[key])}.bind(self));self._temporary_storage={};self._is_initialized=true;document.fireEvent('initializedlocalstorage');if(!App.getService('CrossDomainLocalStorage')){App.addService('CrossDomainLocalStorage',this)}}}catch(error){App.log(error)}}.bind(this);if(this.available()&&window.postMessage!==undefined&&window.JSON!==undefined&&window.localStorage!==undefined){window.addEvent('message',updateLocalStorage);if(window.localStorage===Object(window.localStorage)){this._storage_service_cross_domain=window.localStorage}if(window.S){Object.each(this._storage_service_cross_domain,function(value,key){if(value&&key!=S.tagname_session_json&&key!=S.tagname_last_server_update&&key!=S.tagname_last_prolonged&&!key.match(/^_dy*/i)){delete this._storage_service_cross_domain[key]}}.bind(this));S.syncStorages()}this.sendPostMessage({'action':'getStorage'})}},isInitialized:function(){return this._is_initialized},available:function(){return!!(this._storage_service_cross_domain||this.parent())},"sendPostMessage":function(params){this._iframeElement.contentWindow.postMessage(params,this.options.iframe_src)},"set":function(key,value){try{if(this._storage_service_cross_domain){this._storage_service_cross_domain[key]=JSON.stringify(value);this.sendPostMessage({'action':'setItem','item_name':key,'item_value':this._storage_service_cross_domain[key]})}else{this._temporary_storage[key]=value}this.parent(key,value)}catch(e){this.onSetExceptionHandler(e)}},"get":function(key){var result=null,service=this._storage_service_cross_domain||this._storage_service;if(!!service&&service.hasOwnProperty(key)&&service[key]!=undefined){try{result=JSON.parse(service[key])}catch(e){}}return result},"getAll":function(){return this._storage_service_cross_domain},"remove":function(key){if(this._storage_service_cross_domain){delete this._storage_service_cross_domain[key];this.sendPostMessage({'action':'delStorage','item_name':key})}this.parent(key)},exist:function(key){var result=false;if(this._storage_service_cross_domain){result=this._storage_service_cross_domain.hasOwnProperty(key)}return result||this.parent(key)},onSetExceptionHandler:function(e){var str=e.toString();if(str.test('quota')||str.test('Storage')||str.test('reached')||str.test('QUOTA')){this.clear()}App.err(str)},syncronize:function(key_for_check,keys_change){var i,source,recipient;if(this.available()&&(this._storage_service_cross_domain.hasOwnProperty(key_for_check)||this._storage_service.hasOwnProperty(key_for_check))&&this._storage_service_cross_domain[key_for_check]!=this._storage_service[key_for_check]){if(!this._storage_service[key_for_check]||this._storage_service_cross_domain[key_for_check]>this._storage_service[key_for_check]){recipient=this._storage_service;source=this._storage_service_cross_domain}else{recipient=this._storage_service_cross_domain;source=this._storage_service}recipient[key_for_check]=source[key_for_check];for(i=0;i<keys_change.length;i++){recipient[keys_change[i]]=source[keys_change[i]]}}},_firstload:function(){App.addOnDomReady(function(){this.loadIFrame()}.bind(this))},loadIFrame:function(){if(this.options.iframe_src){if((new RegExp('rozetka.com.ua')).test(document.domain)||document.domain===null){try{document.domain=this.options.domain}catch(e){if(window.console!==undefined&&console.error!==undefined){console.error(e)}}}this._iframeElement=document.createElement('iframe');this._iframeElement.src=this.options.iframe_src;this._iframeElement.width=0;this._iframeElement.height=0;this._iframeElement.hide();document.body.insertBefore(this._iframeElement,document.body.firstChild);this._iframeElement.addEvent('load',this.initCrossDomainStorage.bind(this))}},'clear':function(){if(this._storage_service_cross_domain){this._storage_service_cross_domain.clear();this.sendPostMessage({action:'clear'})}else{this.parent()}}});var CookieStorage_class=EmptyStorage_class.extend({Class:'CookieStorage_class',options:{domain:'rozetka.com.ua',path:'/',duration:30,cookie:Cookie},available:function(){return true},"set":function(key,value){this.options.cookie.set(key,JSON.stringify(value),{duration:this.options.duration,domain:this.options.domain,path:this.options.path})},"get":function(key){var ret=null,evt=this.options.cookie.get(key);try{ret=JSON.parse(evt)}catch(err){ret=evt}return ret},"remove":function(key){this.options.cookie.remove(key,{domain:this.options.domain,path:this.options.path})},exist:function(key){return!!(this.options.cookie.get(key))}});var Storage_class=new Class({adapters:[LocalStorage_class,CookieStorage_class,EmptyStorage_class],initialize:function(){this.adapters.each(function(adapter_class){if(!this.available){var adapter=new adapter_class();if(adapter.available()){$extend(this,adapter)}}}.bind(this))}});Storage_class.implement(new Options());EmptyStorage_class.implement(new Options(),new Events());var DataManager_class=new Class({data:{},get:function(key){return this.data[key]},set:function(key,value){this.data[key]=value}});var App,App_class;App_class=new Class({_default_storage_class:'Storage_class',_storage:null,_images_src:{},_loaded_scripts:{},_services:{},_queue:{},_domReadyPromise:null,_gtm_js_promise:null,setAppConfig:function(config){if(this.getService('config_app')){throw new Error('Настройки для App уже установлены!')}this.addService('config_app',config)},getSettings:function(name){var config=this.getService('config_app');return config?config.get('settings.'+name):undefined},getURI:function(href){if(!href){href=window.location.href}return new URI_class(href)},addService:function(name,service){if(this._services[name]){throw new Error('Сервис с именем '+name+' уже зарегистрирован')}this._services[name]=service;this.fireEvent('addService',name);return service},domReady:function(){if(this._domReadyPromise===null){var callback=function(resolve,reject){this.addOnDomReady(resolve)};this._domReadyPromise=new Promise(callback.bind(this))}return this._domReadyPromise},gtmLoad:function(timeout){if(this._gtm_js_promise===null){var callback=function(resolve,reject){window['gtm_js_load_flag']===true?resolve():document.addEventListener('gtmLoad',resolve);if(timeout!==undefined){setTimeout(function(){reject()},timeout)}};this._gtm_js_promise=new Promise(callback.bind(this))}return this._gtm_js_promise},getServiceDelay:function(name){if(!this._queue[name]){this._queue[name]=this._getPromiseLoadedService(name)}return this._queue[name]},_getPromiseLoadedService:function(name){var callback=function(resolve,reject){if(this._services[name]){resolve(this._services[name])}else{this.addEvent('addService',function(service_name){if(service_name==name){resolve(this._services[name])}}.bind(this))}};return new Promise(callback.bind(this))},loadScript:function(path,callback_onload,callback_onerror){if(!this._loaded_scripts[path]){Asset.javascript(path,{'onload':function(){this._loaded_scripts[path]=true;callback_onload&&callback_onload()}.bind(this),'onerror':callback_onerror,async:true})}else{callback_onload&&callback_onload()}},getService:function(name){return this._services[name]||null},setStorageClass:function(storage){this._storage=storage},getStorage:function(){var storage_constructor;if(this._storage==null){storage_constructor=App.getConstructorByClassName(this._default_storage_class);this._storage=new storage_constructor()}return this._storage},isDesktop:function(){return(!$defined(window.device_type)||device_type=="computer")&&!this.isTouchDevice()},isTouchDevice:function(){return((('ontouchstart'in window)||(window.navigator.MaxTouchPoints>0)||(window.navigator.msMaxTouchPoints>0))&&!('callPhantom'in window))},setRule:function(selector,rule){var styleSheets=document.styleSheets[document.styleSheets.length-1];if($defined(styleSheets.addRule)){styleSheets.addRule(selector,rule)}else if($defined(styleSheets.insertRule)){styleSheets.insertRule(selector+" {"+rule+"}",styleSheets.cssRules.length)}},parseURL:function(url){var REGEX=/^((\w+):\/\/((\w+):?(\w+)?@)?(([^\/\?:]+):?(\d+)?)?)?(\/?[^\?#]+)?\??([^#]+)?#?([\w-]*)/;var fields={'href':0,'username':4,'password':5,'port':8,'protocol':2,'host':7,'hostname':7,'pathname':9,'search':10,'hash':11};var result={};var r=REGEX.exec(url);for(var field in fields)result[field]=r[fields[field]]?r[fields[field]]:'';if(result.hash)result.hash='#'+result.hash;if(result.search)result.search='?'+result.search;return result},parseGET:function(get,pref,sep){pref=pref||'?';sep=sep||'&';var result={};(get.slice(0,1)==pref?get.slice(1):get).split(sep).each(function(i){if(i.indexOf('=')!=-1){try{result[i.slice(0,i.indexOf('='))]=decodeURIComponent(i.slice(i.indexOf('=')+1))}catch(err){}}else{result[i]=i}});return result},buildUrl:function(url,params,sort){var nodes=url.split('/'),query=[],url_params,value,name;if(nodes[nodes.length-2].indexOf('=')!=-1){url_params=App.parseGET('#'+nodes[nodes.length-2],'#',';');for(name in url_params){if(!$defined(params[name])){params[name]=url_params[name]}}}else{nodes[nodes.length]=''}query=[];if(!sort){for(name in params){query.push(name+'='+params[name])}}else{Object.keys(params).sort(this.getSort(true)).each(function(name){value=('string'==typeof params[name]?params[name].split(','):params[name]);query.push(name+'='+value.sort(this.getSort(false)))}.bind(this))}nodes[nodes.length-2]=query.join(';');if(!nodes[nodes.length-2]){nodes.splice(nodes.length-2,1)}return nodes.join('/')},getSort:function(regular){return function(a,b){var a_nan=isNaN(a),b_nan=isNaN(b),result;if(!a_nan&&!b_nan){result=a-b}else if(a_nan&&b_nan){result=a==b?0:a>b?1:-1}else if(regular){result=(!a_nan&&b_nan)?1:-1}else{result=b?-1:1}return result}},getDataByUrl:function(url){var nodes=url.split('/'),params=nodes[nodes.length-2],url_params=[],result={};if(params.indexOf('=')!=-1){url_params=App.parseGET('#'+params,'#',';');for(name in url_params){if(!result[name]){result[name]=url_params[name].split(',')}}}return result},getGETData:function(get){var result={};for(key in get){if(key.substr(0,5)==='data['){result[key.replace(/data\[([\w-]*)\]([\w-]*)/,"$1$2")]=get[key]}}return result},tryUrchinTracker:function(url){url=this.parseURL(url);if(typeof(pageTracker)!='undefined'){pageTracker._trackPageview(url.pathname)}else if(window._gaq!=undefined){_gaq.push(['_trackPageview',url.pathname])}},trackEvent:function(category,action,opt_label,opt_value,opt_noninteraction){if(typeof(pageTracker)!='undefined'){pageTracker._trackEvent(category,action,opt_label,opt_value,opt_noninteraction)}else if(window._gaq!=undefined){_gaq.push(['_trackEvent',category,action,opt_label,opt_value,opt_noninteraction])}},trackOutboundLink:function(link,category,action,opt_label,opt_value){try{var pageTracker=_gat._createTracker('UA-203518-1');pageTracker._trackEvent(category,action,opt_label,opt_value);setTimeout('document.location = "'+link.href+'"',100)}catch(err){}},trackGTMEvent:function(event,track_raw){if(window['dataLayer']){if(!track_raw){event.event="OWOX";if(event.eventAction==='delete'){event.eventAction='remove'}}dataLayer.push(event);document.fireEvent('dataLayerDataAdded',{event:event})}},passiveTrackEvent:function(category,action,opt_label,opt_value){this.trackEvent(category,action,opt_label,opt_value,true)},trackSocial:function(social_network,social_action,opt_target,opt_page_path){if(typeof(pageTracker)!='undefined'){pageTracker._trackSocial(social_network,social_action,opt_target,opt_page_path)}else if(window._gaq!=undefined){_gaq.push(['_trackSocial',social_network,social_action,opt_target,opt_page_path])}},trackExitPage:function(link){this.trackEvent('Exit page','click by title',link.getText());this.trackEvent('Exit page','click by URL',link.href)},setCustomVar:function(index,name,value,opt_scope){if(typeof(pageTracker)!='undefined'){pageTracker._setCustomVar(index,name,value,opt_scope)}else if(window._gaq!=undefined){_gaq.push(['_setCustomVar',index,name,value,opt_scope])}else{this.log('Warning! Custom var "'+name+' '+value+'" does not set.')}},deleteCustomVar:function(index){if(typeof(pageTracker)!='undefined'){pageTracker._deleteCustomVar(index)}else if(window._gaq!=undefined){_gaq.push(['_deleteCustomVar',index])}},getAjaxPoint:function(params){if(!$defined(params.r))params.r=escape(location.pathname);return'/cgi-bin/form.php?'+Object.toQueryString(params)},tpl_cache:{},getHTML:function(tpl,data){var t=this.tpl_cache[tpl],proccessed;if(t===undefined){t=TrimPath.parseTemplate(tpl);this.tpl_cache[tpl]=t}proccessed=t.process(data);if(proccessed['exception']){this.err(proccessed['exception'])}return proccessed},'session_already':0,'session_json':{},domIsReady:false,onDomReady:function(){this.domIsReady=true;App.fireEvent('domready')},addOnDomReady:function(fn){this.domIsReady?fn():this.addEvent('domready',fn)},enrolMsgBlock:function(msg){if(!$defined(msg.clear)){msg.clear=function(){this.setHTML('')};App.addEvent('newmessage',msg.clear.bind(msg))}return msg},showMessage:function(Message,from_elem){this.showMessages([Message],from_elem)},showMessages:function(Messages,from_elem){this.addOnDomReady.delay(80,this,function(){var msg_block=App.msg_block,messages_content='';if(from_elem&&from_elem.getElementMessageBlock()){msg_block=from_elem.getElementMessageBlock()}Messages.each(function(Message){messages_content+=Message.getContentTpl()});if(!$defined(msg_block)){var elem='';if(elem=$E('div[name=app-message]')){App.setMessageBlock(elem)}else if(elem=$E('h1')){App.setMessageBlock(new Element('div').injectAfter(elem))}else{alert(messages_content)}msg_block=App.msg_block}if(msg_block)msg_block.setHTML(messages_content)})},setMessageBlock:function(elem){return App.enrolMsgBlock(App.msg_block=elem)},log:function(){if(this.isDebug()&&window.console!==undefined&&console.log!==undefined){console.log.apply(console,arguments)}},err:function(){if(this.isDebug()&&window.console!==undefined&&console.error!==undefined){console.error.apply(console,arguments)}},debug:function(key){key?Cookie.set('debug',key,{duration:183,domain:'rozetka.com.ua',path:'/'}):Cookie.remove('debug',{domain:'rozetka.com.ua',path:'/'})},isDebug:function(){return!!Cookie.get('debug')},onUserSignChangeReload:function(){var reloader=function(){User.addEvent('signChange',function(){location.reload()})};S.checkup?reloader():S.addEvent('loadS',reloader)},getConstructorByClassName:function(class_name){var constructor=window[class_name];return constructor},getSelectorByTemplate:function(tpl,data){return App.getHTML(tpl,data)},getSessionJSON:function(callback){if(this.session_already){callback(this.session_json)}document.addEvent('loadS',callback)},getSessionJSONOnce:function(callback){this.session_already?callback(this.session_json):S.addEventOnce('loadS',callback)},sessionReady:function(session_json){this.session_json=session_json;this.session_already=1},escape:function(str){var translate=[],ret=[],i;for(i=0x410;i<=0x44F;i++){translate[i]=i-0x350}translate[0x401]=0xA8;translate[0x451]=0xB8;translate[0x404]=0xAA;translate[0x454]=0xBA;translate[0x406]=0xB2;translate[0x456]=0xB3;translate[0x407]=0xAF;translate[0x457]=0xBF;translate[0x490]=0xA5;translate[0x491]=0xB4;for(i=0;i<str.length;i++){var n=str.charCodeAt(i);if(translate[n]!==undefined){n=translate[n]}if(n<=0xFF){ret.push(n)}}console.error('deprecated window.escape');return window.escape(String.fromCharCode.apply(null,ret))},unescape:function(str){var untranslate=[],str=window.unescape(str),ret=[],i,n=null;for(i=0x44F;i>=0x410;i--){untranslate[i-0x350]=i}untranslate[0xA8]=0x401;untranslate[0xB8]=0x451;untranslate[0xAA]=0x404;untranslate[0xBA]=0x454;untranslate[0xB2]=0x406;untranslate[0xB3]=0x456;untranslate[0xAF]=0x407;untranslate[0xBF]=0x457;untranslate[0xA5]=0x490;untranslate[0xB4]=0x491;for(i=0;i<str.length;i++){n=str.charCodeAt(i);if(untranslate[n]!=undefined){n=untranslate[n]}ret.push(n)}console.error('deprecated window.unescape');return String.fromCharCode.apply(null,ret)},onPageLoad:function(){this.pageIsLoad=true;App.fireEvent('pageLoad')},addOnPageLoad:function(fn){this.pageIsLoad?fn():this.addEvent('pageLoad',fn)},htmlSpecialChars:function(string,flag,charset,double_encode){var flag_temp=0,i=0,noquotes=false,flag_options,replaceSpecialFunc;if(string!==undefined&&string!==null){string=String(string);flag_options={'ENT_NOQUOTES':0,'ENT_HTML_QUOTE_SINGLE':1,'ENT_HTML_QUOTE_DOUBLE':2,'ENT_COMPAT':2,'ENT_QUOTES':3,'ENT_IGNORE':4};replaceSpecialFunc=function(string,sign){var special_chars_map={'&':"&amp;",'<':"&lt;",'>':"&gt;",'"':"&quot;",'\'':"&#039;"};return string.replace(new RegExp(sign,'g'),special_chars_map[sign])};if(flag===undefined||flag===null){flag=2}if(double_encode!==false){string=replaceSpecialFunc(string,'&')}string=replaceSpecialFunc(string,'<');string=replaceSpecialFunc(string,'>');if(flag===0){noquotes=true}if(typeof flag!=='number'){flag=[].concat(flag);for(i=0;i<flag.length;i++){if(flag_options[flag[i]]===0){noquotes=true}else if(flag[flag[i]]){flag_temp=flag_temp|flag[flag[i]]}}flag=flag_temp}if(flag&flag_options.ENT_HTML_QUOTE_SINGLE){string=replaceSpecialFunc(string,'\'')}if(!noquotes){string=replaceSpecialFunc(string,'"')}}return string},tagFilter:function(string,clear_all_tag,white_list){var reg_teg,reg_attr,teg_name,teg_data,attr_data,true_attr,for_replace=[];clear_all_tag=clear_all_tag||false;reg_teg=new RegExp('<([^/^>^ ]+)(\\s+)?([^>]+)?>?([^>]*<\/[^>]+>)?','g');reg_attr=new RegExp('(\\w+)\\s*=\\s*"[^"]*"','g');if(!white_list){white_list={'img':{'src':true,'alt':true}}}if(clear_all_tag){string=string.replace(reg_teg,'')}else{while((teg_data=reg_teg.exec(string))!=null){teg_name=teg_data[1].toLowerCase();if(white_list[teg_name]){true_attr=[];while((attr_data=reg_attr.exec(teg_data[0]))!=null){if(white_list[teg_name][attr_data[1].toLowerCase()]){true_attr.push(attr_data[0])}}if(true_attr.length){for_replace.push({'from':teg_data[0],'to':'<'+teg_data[1]+' '+true_attr.join(' ')+'>'})}else{for_replace.push({'from':teg_data[0],'to':''})}}else{for_replace.push({'from':teg_data[0],'to':''})}}for_replace.each(function(obj){string=string.replace(obj.from,obj.to)})}return string},preloadImages:function(tpl,data){if(window.gecko||window.ff4AndGreater){new Element('div').setHTML(this.getHTML(tpl,data)).getElements('img').each(function(el){var src=el.getProperty('src');if(!this._images_src[src]){this._images_src[src]=new Image();this._images_src[src].src=src;new Element('link',{rel:'prefetch',href:src}).injectInside($(document.head))}}.bind(this))}},isRozetkaDomain:function(){return(typeof is_rozetka_domain!=='undefined')&&is_rozetka_domain===true||window.location.origin+'/'===App.getSettings('menu.www.href')}});App_class.implement(new Events());App=new App_class();App.attachToObserver([]);if(window.ie){domReadyForIe(App.onDomReady.bind(App))}else{window.addEvent('domready',App.onDomReady.bind(App))}document.addEvent('loadS',App.sessionReady.bind(App));function domReadyForIe(fn){var testElement=document.createElement('div');(function testIeDoScroll(){var isDomReady=false;try{testElement.doScroll();isDomReady=true}catch(e){setTimeout(testIeDoScroll,20)}if(isDomReady)fn()})()};var RequestsManager_class=new Class({_requests_pool:[],_is_requesting:false,addRequestToPool:function(request){if(!request instanceof Ajax){throw new Error('Передан не объект класса Ajax')}this._requests_pool.push(request);if(!this._is_requesting){this._handlePool()}},_handlePool:function(){this._is_requesting=true;var request=this._requests_pool.shift();if(request){request.addEvent('onSuccess',this._handlePoolAfterResponse.bind(this));request.addEvent('onFailure',this._handlePoolAfterResponse.bind(this));request.addEvent('onCancel',this._handlePoolAfterResponse.bind(this));request.request()}else{this._is_requesting=false}},_handlePoolAfterResponse:function(){setTimeout(this._handlePool.bind(this),500)}});App.addService('RequestsManager',new RequestsManager_class());var S={data:{},checkup:0,expire:'1380'*1000,is_renew_sended:false,tagname_last_server_update:'session_update_from_server',tagname_session_json:'session_json',tagname_last_prolonged:'session_prolonged',cookie_update_session:'session_update_from_server',cookie_disable_ls:'disable_session_ls',disabled_zones:[],last_updated:0,_update_storage_event_added:false,_time_delay_set:null,_min_interval:10*1000,last_prolonged:0,is_last_update_forced:false,setForceCookie:function(){Cookie.set(this.cookie_update_session,1,{duration:1,domain:'.rozetka.com.ua',path:'/'})},removeForceCookie:function(){Cookie.remove(this.cookie_update_session,{domain:'.rozetka.com.ua',path:'/'})},issetForceCookie:function(){return Cookie.get(this.cookie_update_session)},getHash:function(){var processed_objects=[];return md5(JSON.stringify(this.data,function(name,value){if(typeof value=='object'){if(processed_objects.indexOf(value)>-1){return undefined}processed_objects.push(value)}return value}))},isNeedLoadFromServer:function(forced){var need_update,storage,cookie_force,is_disabled_zone=null;if(!forced){storage=App.getStorage();cookie_force=this.issetForceCookie();is_disabled_zone=this.checkDisabledZones();if(cookie_force&&!is_disabled_zone){this.removeForceCookie()}if(Cookie.get(this.cookie_disable_ls)){Cookie.remove(this.cookie_disable_ls,{domain:'rozetka.com.ua',path:'/'});this.disable_localstorage=true}if(is_disabled_zone){if(!cookie_force){this.setForceCookie()}this.disable_localstorage=true}this.last_updated=storage?storage.get(this.tagname_last_server_update):null;need_update=(this.last_updated!=null&&storage.get(this.tagname_session_json)&&!cookie_force&&!this.disable_localstorage)?this.last_updated+this.expire<new Date().getTime():true}else{need_update=true}return need_update},load:function(forced,is_auto){var xhr,sid,httpOnly_sid,session_prefix;var prolongation_required=this.isProlongationRequired();if(this.isNeedLoadFromServer(forced)||prolongation_required){httpOnly_sid=Cookie.get("ho_sid");sid=Cookie.get("sid");if(sid||httpOnly_sid){session_prefix=(sid)?sid:"get_session";this.is_last_update_forced=(forced||is_auto||prolongation_required)?true:false;xhr=new Ajax("/s/"+(this.is_last_update_forced?'session':session_prefix)+".json?"+Math.random());xhr.setOptions({method:'get',onComplete:function(text){try{var data=eval('('+text+')')}catch(e){App.err('Ошибка при загрузке S файла',arguments[0])}this.last_updated=new Date(xhr.getHeader('Date')).valueOf();this.load.delay(this.calculateDelay(),this,[false,true]);this._time_delay_set=new Date().getTime();if(typeof data!=='undefined'){this.onLoad(data)}}.bind(this),onFailure:function(){this.last_updated=1;this.load.delay(this.calculateDelay(),this,[false,true]);this._time_delay_set=new Date().getTime()}.bind(this)}).request()}else{this.fireEventLoadS({},true);if(this._time_delay_set<new Date().getTime()-this._min_interval){this.load.delay(this.calculateDelay(),this,[false,true]);this._time_delay_set=new Date().getTime()}}}else{this.loadFromStorage();if(this._time_delay_set<new Date().getTime()-this._min_interval){this.load.delay(this.calculateDelay(),this,[false,true]);this._time_delay_set=new Date().getTime()}}},get:function(name){return this.data[name]},calculateDelay:function(){var delay;if(this.last_updated){delay=this.expire-(new Date().getTime()-this.last_updated)}else{delay=this.expire}if(delay<0){delay=this._min_interval}return delay},syncStorages:function(force){App.getServiceDelay('CrossDomainLocalStorage').then(function(service){if(!this.disable_localstorage){if(force){this._doSyncStorages(service)}else if(!this._update_storage_event_added){document.addEvent('initializedlocalstorage',function(){this._doSyncStorages(service)}.bind(this));this._update_storage_event_added=true}}else{this.removeStorageSession()}}.bind(this))},_doSyncStorages:function(storage){var old_value=this.tagname_last_server_update;storage.syncronize(this.tagname_last_server_update,[this.tagname_session_json,this.tagname_last_prolonged]);if(old_value!=storage.get(this.tagname_last_server_update)){this.loadFromStorage()}},onLoad:function(data){this.fireEvent('BeforeSetMessage',data);if(data.message){App.showMessage(new Message_class(data.message));delete data.message}if(!this.disable_localstorage){this.setStorageSession(data)}this.data=data;this.fireEventLoadS(this.data,false)},getData:function(){return new Promise(function(resolve){if(this.checkup){resolve(this.data)}else{this.addEvent('loadS',function(data){resolve(data)})}}.bind(this))},setStorageSession:function(data){var storage=App.getStorage();if(storage){storage.set(this.tagname_session_json,data);storage.set(this.tagname_last_server_update,new Date().getTime());if(this.is_last_update_forced||!storage.get(this.tagname_last_prolonged)){storage.set(this.tagname_last_prolonged,new Date().getTime())}}},removeStorageSession:function(){var storage=App.getStorage();if(storage){storage.remove(this.tagname_last_server_update);storage.remove(this.tagname_session_json);storage.remove(this.tagname_last_prolonged)}},disableZones:function(zones){for(var zone in zones){if(zones.hasOwnProperty(zone)){this.disabled_zones.push(App.parseURL(zones[zone]).hostname)}}},checkDisabledZones:function(){var result=false;for(var zone in this.disabled_zones){if(this.disabled_zones.hasOwnProperty(zone)&&window.location.hostname===this.disabled_zones[zone]){result=true;break}}return result},loadFromStorage:function(){var data,storage=App.getStorage();data=storage?storage.get(this.tagname_session_json):null;if(data){if(data.message){App.showMessage(new Message_class(data.message));delete data.message;storage.set(this.tagname_session_json,data)}this.data=data;this.fireEventLoadS(this.data,false)}else{this.load(true)}},fireEventLoadS:function(data,is_sid){this.fireEvent('loadS',[data,this]);document.fireEvent('loadS',[data,this]);if(is_sid){this.fireEvent('noSID')}this.checkup=1},renew:function(url){var options={};if(!this.is_renew_sended){if(!url){url='/cgi-bin/form.php'}options={onComplete:function(resp){S.load(true);if(typeof TokenManager!='undefined'){TokenManager.updateProtect()}},headers:{'ajaxAction':'https://my.rozetka.com.ua/ua/session/#renew'}};new Ajax(url,options).request();this.is_renew_sended=true}},isProlongationRequired:function(){storage=App.getStorage();this.last_prolonged=storage?storage.get(this.tagname_last_prolonged):null;return(this.last_prolonged!=null&&storage.get(this.tagname_last_prolonged))?(this.last_prolonged+this.expire<new Date().getTime()):!this.checkDisabledZones()},clearLastProlonged:function(){storage=App.getStorage();if(storage){storage.remove(this.tagname_last_prolonged)}}};$extend(S,new Events());window['App']!==undefined&&App.addService('S',S);var InitElements=new Class({initElements:function(selector,container){var elems=null;if($type(selector)=='string'){elems=selector.length?$E(selector,container):null}else if(['element','collection',false].contains($type(selector))||$type(selector.initialize)=='function'){elems=selector}else if($type(selector)=='array'){elems=$$();selector.each(function(item){elems=$$(elems,($type(item)=='string'?$ES(item,container):item))},this)}else if($type(selector)=='object'){elems={};Object.each(selector,function(item,key){elems[key]=this.initElements(item,container)},this)}else{App.log('illegal type',$type(selector),'of',selector)}return elems}});var ActiveSelect=new Class({activeSelect:function(container){$ES('select[id$=_select]',container).each(function(el){el.field=$E('#'+el.id.substr(0,el.id.length-7)+'_field',container);el.onChange=function(){if(this.value=='new'){this.field.show().getFormElements().every(function(field){return field.getValue()||field.focus()})}else{this.field.hide()}this.field.getFormElements().each(function(el){el.blocked=this.value=='new'?0:1},this)};el.addEvent('change',el.onChange.bind(el));el.addEvent('openField',el.onChange.bind(el));el.onChange()})}});var AnimationFrame=new Class({ticking:false,_requestTick:function(callback){if(!this.ticking){requestAnimationFrame(callback)}this.ticking=true}});var UTAAbstract_class=new Class({Class:'UTAAbstract_class',_object:null,_default_fields:{'hitType':'timing'},initialize:function(object,fields){this._object=object;if(fields){$extend(this._default_fields,fields)}if(window.ga){this.initEvents()}else{App.addOnDomReady(this.initEvents.bind(this))}if(this._default_fields.eventForm&&this._object.form&&!this._object.form.getProperty('data-title')){this._object.form.setProperty('data-title',this._default_fields.eventForm)}},initEvents:function(){},trackEvent:function(data){var convert_data=[];$extend(data,this._default_fields);Object.keys(data).each(function(key){convert_data.push({name:key,value:data[key]})});document.fireEvent('uta',{extend_event:convert_data})},getTime:function(){return new Date().getTime()},reset:function(){}});var FormHandlerAbstract_class=new Class({_form:null,initialize:function(form){this._form=form},init:function(){throw new Error('Method not implemented')}});FormHandlerAbstract_class.implement(new Options(),new Events());var FormSubmitByAjaxHandler_class=FormHandlerAbstract_class.extend({_form:null,initialize:function(form){this.parent(form);this._onSubmitForm.bind(this._form)},init:function(){this._form.removeEvent('submit',this._onSubmitForm);this._form.addEvent('submit',this._onSubmitForm)},_onSubmitForm:function(e){new Event(e).stop();this.trySend()}});var JSLogger_class=new Class({error_count:0,options:{handlers:['toAnalytics']},initialize:function(options){this.setOptions(options);this._attachOwnHandlers()},_attachOwnHandlers:function(){this.options.handlers.each(function(handler_name){if(this[handler_name]){this.addEvent('javaScriptError',this[handler_name])}},this)},attachErrorHandler:function(handler,scope){var error_handler=scope?handler.bind(scope):handler;this.addEvent('javaScriptError',error_handler)},toAnalytics:function(msg,url,line,index,trace){if(window.dataLayer!==undefined){App.trackGTMEvent({'eventCategory':'JS Error','eventAction':msg,'eventLabel':navigator.userAgent,'eventLocation':url,'eventPosition':line,'eventNoninteraction':true,'eventContent':trace})}else{App.trackEvent('JS Error',msg,navigator.userAgent+' -> '+url+" : "+line+" stacktrace: "+trace,index,true)}},handleError:function(msg,url,line,error){this.error_count++;var trace='';if(error instanceof Error&&typeof(printStackTrace)==="function"){trace=printStackTrace({e:error}).join('\n')}this.fireEvent('javaScriptError',[msg,url,line,this.error_count,trace]);App.err("["+this.error_count+"]Ошибка Javascript на строке "+line+" в "+url+": "+msg);return true}});JSLogger_class.implement(new Options(),new Events());var LazyLoad_class=new Class({_axis:null,_images:null,_boundScroll:null,options:{range:200,axis:"y",useFade:true,fadeDuration:80},_images_selector:"img[data_src]",_realSrcAttribute:"data_src",initialize:function(options){this.setOptions(options);this._boundScroll=this.onScroll.bind(this);this._axis=this.options.axis;this.renewImages();App.addEvent('timedResize',this._onTimedResize.bind(this));App.addEvent('renewImages',this.renewImages.bind(this))},setAxis:function(axis){this._axis=axis;this.renewImages()},_bindScrollEvent:function(){window.addEvent("scroll",this._boundScroll)},_unbindScrollEvent:function(){window.removeEvent("scroll",this._boundScroll)},renewImages:function(){this._images=$(document.body).getElements(this._images_selector);this._showImagesInRange();if(this._images.length>0){this._bindScrollEvent()}},onScroll:function(){this._showImagesInRange()},_onTimedResize:function(){this._showImagesInRange()},_showImagesInRange:function(){var window_size=window.getSize(),scroll_size=window_size.scroll[this._axis],show_range_top=scroll_size-this.options.range,show_range_bottom=scroll_size+window_size.size[this._axis]+this.options.range,retained_images=[],position,i,image;for(i=0;i<this._images.length;i++){image=this._images[i];position=this.getPosition(image)[this._axis];if(position<show_range_bottom&&position>show_range_top){this.loadImage(image)}else{retained_images.push(image)}}this._images=retained_images;if(!this._images.length){this._unbindScrollEvent()}},loadImage:function(image){var src=image.getAttribute(this._realSrcAttribute),duration;if(src){image.removeAttribute(this._realSrcAttribute);if(this.options.useFade){duration=this.options.fadeDuration;image.addEventOnce("load",function(){var fx=new Fx.Style(image,'opacity',{'duration':duration});fx.start(0,1)});image.setStyle("opacity",0)}image.src=src;this.fireEvent("imageLoaded",[image])}},getPosition:function(image){var position,parent;position=image.getPosition();if(!image.isVisible()){parent=image.getVisibleParent();if(parent){position=parent.getPosition()}}return position},loadImageQuick:function(image){var src=image.getAttribute('data-src');if(src){image.removeAttribute('data-src');image.src=src}}});LazyLoad_class.implement(new Options(),new Events());var Response_class=new Class({Class:'Response_class',error_tpl:'Помилка на сервері. Повідомте, будь ласка, про&nbsp;це адміністратору',initialize:function(resp){try{resp=eval('('+resp+')');if(!$defined(resp.code))throw'err'}catch(e){App.err('Сервер в ответе вернул ошибку: ',resp);resp={message:{},code:this.CODE.ERROR};resp.message.content=App.getHTML(this.error_tpl,this);resp.message.code=parseInt('5')}if($defined(resp.message)){this.Message=new Message_class(resp.message);delete resp.message}$extend(this,resp);return this},isError:function(){return this.code&this.CODE.ERROR},isDone:function(){return this.code&this.CODE.DONE},isVoid:function(){return this.code==this.CODE.VOID},doAction:function(){if($defined(this.action)){if(this.action&this.ACTION.LOCATION){location.href=this.location;App.fireEvent('sessionUpdate')}else if(this.action&this.ACTION.RELOAD){location.reload()}else{if(this.action&this.ACTION.USER_AUTH){User.SignIn(this.Message)}else if(this.action&this.ACTION.USER_SIGNUP_CONFIRM){User.confirmSignUp(this.content)}if(this.action&this.ACTION.S_LOAD){$defined(this.S)?S.onLoad(this.S):S.load(true)}}}},CODE:{VOID:'0'.toInt(),DONE:'1'.toInt(),ERROR:'2'.toInt()},ACTION:{S_LOAD:'1'.toInt(),USER_AUTH:'2'.toInt(),LOCATION:'4'.toInt(),RELOAD:'16'.toInt(),MENU_LOAD:'8'.toInt(),USER_SIGNUP_CONFIRM:'32'.toInt(),USER_CHECK_CONTACTS:'64'.toInt()}});var Message_class=new Class({CODE:{NOTIFY:2,DONE:1,CONFIRM:3,ALERT:4,ERROR:5,REQUIRED_AUTHORIZE:6},options:{tpl:'<div class="message code${code}">${content}</div>'},initialize:function(message){$extend(this,message);this.isShown=0},getContent:function(){if(this.isShown){return''}else{App.fireEvent('newmessage');this.isShown=1;return this.content}},getContentTpl:function(tpl){return this.getContent()?App.getHTML(tpl?tpl:this.options.tpl,this):''},isError:function(){return this.code==this.CODE.ERROR},isDone:function(){return this.code==this.CODE.DONE}});Message_class.implement(new Options);(function(){var ua=navigator.userAgent.toLowerCase(),UA=ua.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,'unknown',0],mode=UA[1]=='ie'&&document.documentMode;var Browser=this.Browser=$merge({Engine:{name:'unknown',version:0},Platform:{name:(window.orientation!=undefined)?'ipod':(navigator.platform.match(/mac|win|linux/i)||['other'])[0].toLowerCase()},Features:{xpath:!!(document.evaluate),air:!!(window.runtime),query:!!(document.querySelector)},Plugins:{},Engines:{presto:function(){return(!window.opera)?false:((arguments.callee.caller)?960:((document.getElementsByClassName)?950:925))},trident:function(){return(!window.ActiveXObject)?false:((window.XMLHttpRequest)?((document.querySelectorAll)?6:5):4)},webkit:function(){return(navigator.taintEnabled)?false:((Browser.Features.xpath)?((Browser.Features.query)?525:420):419)},gecko:function(){return(!document.getBoxObjectFor&&window.mozInnerScreenX==null)?false:((document.getElementsByClassName)?19:18)}},name:(UA[1]=='version')?UA[3]:UA[1],version:mode||parseFloat((UA[1]=='opera'&&UA[4])?UA[4]:UA[2])},Browser||{});Browser.Platform[Browser.Platform.name]=true;Browser.detect=function(){for(var engine in this.Engines){var version=this.Engines[engine]();if(version){this.Engine={name:engine,version:version};this.Engine[engine]=this.Engine[engine+version]=true;break}}return{name:engine,version:version}};Browser.detect()}).call(this);var Menu_class=new Class({Class:'Menu_class',options:{tpl:'',S:[],xhrNodes:{},nodes_data:{}},_menuExtenders:[],_session:null,init:function(id){if(!id){id='menu'+$random(0,100000);document.write("<div id='"+id+"'></div>")}this.elem=$(id);this._session=App.getService('S');this._session.addEvent('loadS',this.update.bind(this));this.attachToObserver(['needUpdateUserMenu']);if(this._session.checkup)this.update()},update:function(){var menu_data=this._session.get('menu')||this.options.S;if($defined(this.elem)){var nodes=[];menu_data.forEach(function(menu_node){nodes.push(this._getExtendedMenuNode(menu_node))}.bind(this));this.elem.setHTML(App.getHTML(this.options.tpl,{nodes:nodes,isActive:this.isActive,isMediate:this.isMediate,extend:this.options.extend,nodes_data:this.options.nodes_data}));for(var name in this.options.xhrNodes){var elem=this.elem.getElement('[name='+name+']');if(elem){elem.addClass('xhr');var menu=this;elem.addEvent('click',function(e){new Event(e).stop();menu.options.xhrNodes[this.name]()})}}}},isActive:function(node){var url=App.parseURL(node.href);return(url.host?url.host===location.host:true)&&location.pathname.replace(/\/$/g,"")===url.pathname.replace(/\/$/g,"")},isMediate:function(node){var url=App.parseURL(node.href);return(url.host?url.host===location.host:true)&&location.pathname.search(url.pathname.replace(/\/$/g,""))===0},addMenuExtender:function(menu_extender){if(this._menuExtenders.indexOf(menu_extender)<0){this._menuExtenders.push(menu_extender)}},_getExtendedMenuNode:function(menu_node){var result=Object.clone(menu_node);this._menuExtenders.forEach(function(extender){extender.extendMenuNode(result)});return result},onNeedUpdateUserMenu:function(){this.update(this.S)}});Menu_class.implement(new Options,new Events());var Popup_class=new Class({_isOpened:false,_overlay:null,_popups:[],closeIgnoreElements:[],_positions_calculator:null,options:{floatingX:true,floatingY:true,single:true,closeOnCOS:true,closeOnEsc:true,holdon:false,form_autofocus:true},initialize:function(tpl,pElem){this.elem=new Element('div');this.tpl=tpl;if(pElem){this.pElem=pElem}else{if(document.body){this._setAsMoadal()}else{App.addOnDomReady(this._setAsMoadal.bind(this))}}document.addEvent('closeOtherPopups',this._onCloseOtherPopups.bind(this));this.attachToObserver(['contentUpdate']);return this},_onCloseOtherPopups:function(){if(!this.options.holdon&&this.isOpened()){this.close()}},overlayON:function(property){if(!this._overlay){this._overlay=new Overlay_class(property)}},setElemStyle:function(style){this.elem.setStyles(style)},_getPositionCalculator:function(){if(!this._position_calculator){this.setPositionCalculator(new StandardPositionCalculator_class())}return this._position_calculator},setPositionCalculator:function(position_calculator){this._position_calculator=position_calculator;this._position_calculator.setParentElem(window);this._position_calculator.setElement(this.elem);this._position_calculator.setOptions({parent_options:this.options})},setContent:function(tpl,data){this._updateBody();this.content.setHTML(App.getHTML(tpl,data));this.form=this.getElement('form');this.msg=this.getElement('[name=msg]');if(this.msg)this.msg=App.enrolMsgBlock(this.msg);this.getElements(".xhr").each(function(el){el.addEvent('click',function(e){new Event(e).stop();this.fireEvent(el.name)}.bind(this))}.bind(this));this._setCloseControls();this.fireEvent('contentUpdate',this)},open:function(){if(!this._isOpened){if(this.options.single){document.fireEvent('closeOtherPopups')}this._injectElem();this._isOpened=true;this._onOpen();this.fireEvent('open')}return this},_injectElem:function(){this.elem.injectTop($(this.pElem))},close:function(){if(this._isOpened){this.fireEvent('beforeClose');this.elem.remove();this._isOpened=false;this._onClose();this.fireEvent('close')}return this},getElement:function(sel){return this.elem.getElement(sel)},getElements:function(sel){return this.elem.getElements(sel)},_updateBody:function(){this.elem.setHTML(App.getHTML(this.tpl,this));this._setCloseControls();this.content=this.getElement('[name=content]');if(this.options.closeOnEsc){window.addEvent('keydown',this._onCloseOnEsc.bind(this))}if(!this._closePopup){this._closePopup=(function(e){var target=new Event(e).target;var ignore=this.closeIgnoreElements.some(function(elem){return elem.hasChild(target)});if(!this.elem.hasChild(target)&&!ignore){this.close()}}).bind(this)}},_onCloseOnEsc:function(event){if((new Event(event).key)==='esc'){this.close()}},_setCloseControls:function(){this.getElements('[name=close]').each(function(elem){elem.removeEvents();elem.addEvent('click',function(e){new Event(e).stop();this.close()}.bind(this))}.bind(this))},_setAsMoadal:function(){this.pElem=document.body;this.elem.setStyles({position:'absolute','z-index':1000});this.CheckPos=new CheckPos_class(window,this._posUpdate.bind(this,1));this.addEvent('open',this._posUpdate)},_posUpdate:function(soft){var top=this._getPositionCalculator().getTop();var left=this._getPositionCalculator().getLeft();if(soft){new Fx.Styles(this.elem,{duration:250}).start({top:top,left:left})}else{this.elem.setStyles({top:top,left:left})}},_onOpen:function(){var position_calculator=this._getPositionCalculator(),top=position_calculator.getInitTop(),left=position_calculator.getInitLeft();this.elem.setStyles({top:top,left:left});setTimeout(function(){if(this.form&&this.options.form_autofocus){this.form.setFocus()}else{this._scrollToPopup(left,top)}}.bind(this),0);if(this._overlay)this._overlay.show();if(this.CheckPos)this.CheckPos.start();if(this.options.closeOnCOS)$(document.body).addEvent('click',this._closePopup)},_scrollToPopup:function(left,top){var el=this.elem.getCoordinates(null,true),is_large_then_viewport=this._isLargeThenViewport(el);if(is_large_then_viewport.x&&is_large_then_viewport.y){window.scrollTo(parseInt(left),parseInt(top))}else if(is_large_then_viewport.x){window.scrollTo(parseInt(left),window.scrollY)}else if(is_large_then_viewport.y){window.scrollTo(window.scrollX,parseInt(top))}},_onClose:function(){if(this.form)this.form.reset();if(this.msg)this.msg.innerHTML='';if(this._overlay)this._overlay.hide();if(this.CheckPos)this.CheckPos.stop();if(this.options.closeOnCOS)$(document.body).removeEvent('click',this._closePopup)},_isLargeThenViewport:function(){var el=this.elem.getCoordinates();return{x:el.width>window.innerWidth,y:el.height>window.innerHeight}},isOpened:function(){return this._isOpened}});Popup_class.implement(new Events,new Options);var CheckPos_class=new Class({initialize:function(el,fn){this.el=el;this.change=fn;this.value=0},_check:function(){var xy=this.el.getSize();with(this.xy){var result=(size.x==xy.size.x&&size.y==xy.size.y&&scroll.x==xy.scroll.x&&scroll.y==xy.scroll.y)}this.xy=xy;!result?this.value=4:this.value|=!(this.value&1)?1:2;if(this.value==7){this.change();this.value=0}},start:function(){this.xy=this.el.getSize();this._check();this._checker=this._check.periodical(80,this)},stop:function(){$clear(this._checker)}});CheckPos_class.implement(new Events);var Overlay_class=new Class({_elem:null,initialize:function(props){props=$merge({styles:{'background-color':'#000000',opacity:0.7,width:'100%',height:'100%',position:'fixed','z-index':70,visibility:'hidden'}},props);this._elem=new Element('div',props).injectTop(document.body)},show:function(){this._elem.setStyle('visibility','visible')},hide:function(){this._elem.setStyle('visibility','hidden')}});var StandardPositionCalculator_class=new Class({parent_elem:null,elem:null,mobile_detector:null,scroll_y:null,options:{top_margin:20,parent_options:null},initialize:function(){this.mobile_detector=App.getService('mobileDetector')},setParentElem:function(parent_elem){this.parent_elem=parent_elem},setElement:function(elem){this.elem=elem},getInitTop:function(){var el=this.elem.getCoordinates(null,true),win=this.parent_elem.getSize();return(win.size.y<el.height?win.scroll.y+this.options.top_margin:parseInt(win.scroll.y+(this.parent_elem.innerHeight-el.height)/2))+'px'},getInitLeft:function(){var el=this.elem.getCoordinates(null,true),win=this.parent_elem.getSize();return(win.scrollSize.x<el.width?this.options.top_margin:parseInt((win.scrollSize.x-el.width)/2))+'px'},getTop:function(){var el=this.elem.getCoordinates(null,true),win=this.parent_elem.getSize(),parent_height=this.parent_elem.innerHeight,position=parseInt(el.top);if(parent_height>el.height&&this.options.parent_options.floatingY){position=parseInt(win.scroll.y+(parent_height-el.height)/2)}else if(parent_height<el.height){if(this.scroll_y&&this.scroll_y<win.scroll.y&&el.bottom<win.scroll.y+parent_height){position=parseInt(win.scroll.y+parent_height-this.options.top_margin-el.height)}else if(this.scroll_y&&this.scroll_y>win.scroll.y&&el.top>win.scroll.y){position=parseInt(win.scroll.y+this.options.top_margin)}}this.scroll_y=win.scroll.y;return position+'px'},getLeft:function(){var el=this.elem.getCoordinates(null,true),parent_width=this.parent_elem.innerWidth,win=this.parent_elem.getSize();return(parent_width>el.width&&this.options.parent_options.floatingX?parseInt(win.scroll.x+(parent_width-el.width)/2):el.left)+'px'}});StandardPositionCalculator_class.implement(new Options);var FixingPositionCalculator_class=StandardPositionCalculator_class.extend({options:{top_margin:0},getTop:function(){var el=this.elem.getCoordinates(),win=this.parent_elem.getSize(),top=el.top;if(win.size.y>el.height){top=parseInt(win.scroll.y+(win.size.y-el.height)/2)}else{if(win.scroll.y<el.top){top=win.scroll.y}else if((win.scroll.y+win.size.y)>(el.top+el.height)){top=win.scroll.y-el.height+win.size.y}}return parseInt(top)+'px'},getLeft:function(){var not_count_bound=(this.mobile_detector&&this.mobile_detector.phone()),el=this.elem.getCoordinates(null,not_count_bound),left=el.left;return parseInt(left)+'px'}});var LanguageDeterminer_class=new Class({options:{cookie_domain:'',language_prefer:'',available_languages:'',current_lang:'',tpl_popup:'',tpl_popup_content:'',popup_container_id:'language-switcher',show_popup_cookie:'pplg',show_popup_cookie_duration:365},cookie_saved_language:'slang',cookie_detected_language:'slang_detected',available_languages:[],initialize:function(options){this.setOptions(options);this.available_languages=JSON.parse(this.options.available_languages);if(this.options.current_lang&&window.dataLayer!==undefined){dataLayer.push({'UILanguage':this.options.current_lang})}this.determineLanguage();document.addEventOnce('languageChoose',this._removeShowPopupLangCookie.bind(this))},determineLanguage:function(){var language;if(this.useLanguages()&&!this.issetDetectedLangCookie()){language=this.getLangCookie();if(language){this.gtmSetAutoLang(language);if(this.options.primary&&language!=this.options.primary){this._addShowPopupLangCookie()}this.setDetectedLangCookie(true)}else{this.gtmSetAutoLang('(not set)')}}if(this.options.primary&&this.options.current_lang!=this.options.primary&&!!Cookie.get(this.options.show_popup_cookie)){App.addOnDomReady(this._openPopup.bind(this))}},_addShowPopupLangCookie:function(){Cookie.set(this.options.show_popup_cookie,1,{duration:this.options.show_popup_cookie_duration,domain:this.options.cookie_domain,path:'/'})},_removeShowPopupLangCookie:function(){Cookie.remove(this.options.show_popup_cookie)},_openPopup:function(){var container=$(this.options.popup_container_id),popup;if(container){popup=new Popup_class(this.options.tpl_popup,container);popup.setOptions({single:false,closeOnCOS:false,closeOnEsc:false,holdon:true});popup.setContent(this.options.tpl_popup_content,{});popup.addEvent('close',function(){this._removeShowPopupLangCookie()}.bind(this));popup.open();document.fireEvent('showPopupLanguage')}},getDeterminedLanguage:function(){var result=null,browser_language=this.getBrowserLanguage();if(this.options.language_prefer!==''&&this.available_languages[this.options.language_prefer]){result=this.available_languages[this.options.language_prefer]}else if(browser_language!==''&&this.available_languages[browser_language]){result=this.available_languages[browser_language]}return result},getBrowserLanguage:function(){var result='',lang;if(navigator){lang=(navigator.language||navigator.systemLanguage||navigator.userLanguage||navigator.browserLanguage);if(lang!==undefined){result=lang.substr(0,2).toLowerCase()}}return result},useLanguages:function(){return Boolean(App.getSettings('menu.active.multilang'))},setDetectedLangCookie:function(value){Cookie.set(this.cookie_detected_language,value,{duration:30,domain:this.options.cookie_domain,path:'/'})},getLangCookie:function(){return Cookie.get(this.cookie_saved_language)},getDetectedLangCookie:function(){Cookie.get(this.cookie_detected_language)},issetLangCookie:function(){return!!Cookie.get(this.cookie_saved_language)},issetDetectedLangCookie:function(){return!!Cookie.get(this.cookie_detected_language)},gtmSetAutoLang:function(value){if(window.dataLayer!==undefined){dataLayer.push({'autoLanguage':value})}}});LanguageDeterminer_class.implement(new Options());var LanguageSwitcher_class=new Class({options:{ajax_action:'',user_ajax_action:'',cookie_domain:'',language_prefer:'',available_languages:'',current_lang:'',disable_multilang:false},cookie_renew_session:'srfs',cookie_lang_changed:'lngch',cookie_lang_force_renewed:'lngfr',available_languages:[],langs:[],initialize:function(container){this.setOptions(App.getSettings('languages'));this.container=$(container);this.attachToObserver(['LanguageChange'])},init:function(){this.showSwitcher();this.container&&this.container.getElements('a').each(function(elem){elem.addEvent('click',this.handle.bind(this))}.bind(this));this.isSetLangChangedCookie()&&this._setUserLang(function(){this._removeLangChangedCookie()}.bind(this));document.addEvents({renewHash:this._renewSwitchersHash.bind(this),hashchange:this._renewSwitchersHash.bind(this)});if(this.isDisabledMultilang()&&!this.isSetLangForceRenewCookie()&&this._isLanguagesNotMatch()){this.setRenewCookie();this.setLangForceRenewCookie()}if(!this.isDisabledMultilang()&&this.isSetLangForceRenewCookie()){this.removeLangForceRenewCookie();this.setRenewCookie()}this.doRenewCart();if(App.getService('User')){App.getService('User').addEvent('signIn',this._onSignIn.bind(this))}if(this._isLanguagesNotMatch()&&!this.isDisabledMultilang()){document.addEvent('loadS',function(){!this.issetRenewCookie()&&this.setRenewCookie()}.bind(this))}},doRenewCart:function(){if(this.issetRenewCookie()){this.removeRenewCookie();this.renewCart()}},_onSignIn:function(){if(this._isLanguagesNotMatch()&&!this.isDisabledMultilang()){if(this._needRenewCart()){this.process_renew_cart=true;document.fireEvent('HideCartBlock')}this.setRenewCookie();if(location.href!=this.langs[this.getLangFromCookie()].href){window.location=this.langs[this.getLangFromCookie()].href}}},isDisabledMultilang:function(){return!!(+this.options.disable_multilang)},_isLanguagesMatchFromSession:function(){var S=App.getService('S'),lang_from_session=S&&S.get('lang'),lang_from_cookie=this.getLangFromCookie();return!lang_from_session||(lang_from_session===lang_from_cookie&&this._isLangExist(lang_from_session)&&this._isLangExist(lang_from_cookie))},_isLanguagesNotMatch:function(){var current_lang=this.options.current,lang_from_cookie=this.getLangFromCookie();return(this.options.languages&&this.options.languages.length&&this._isLangExist(current_lang)&&this._isLangExist(lang_from_cookie)&&current_lang!==lang_from_cookie)},_isLangExist:function(lang_check){return this.options.languages.filter(function(lang){return lang_check===lang.title}).length},_renewSwitchersHash:function(event_data){var hash=this._extractHashFromEvent(event_data);if(this.container){this.container.getElements('a').each(function(switcher){var current_href=switcher.getAttribute('href'),old_hash_position=current_href.indexOf('#'),new_href=current_href.substring(0);if(old_hash_position!=-1){new_href=new_href.substring(0,old_hash_position)}if(hash){new_href+='#'+hash}if(new_href!==current_href){switcher.setAttribute('href',new_href)}}.bind(this))}},_extractHashFromEvent:function(event_data){return event_data&&event_data.hash?event_data.hash:(typeof event_data==='string'?event_data:null)},_setUserLang:function(callback){new Ajax('/cgi-bin/form.php',{'method':'post',data:{lang:this.getLangFromCookie()},headers:{'ajaxAction':this.options.user_ajax_action},onComplete:callback,use_language:true}).request()},handle:function(e){var lang=e.target.getProperty('data-lang'),href=e.target.href;new Event(e).stop();this.setLangCookie(lang);document.fireEvent('languageChoose',{extend_event:[{name:'eventContent',value:lang}]});this._setLangChangedCookie();this.setRenewCookie();window.location=href},fillHref:function(elem){var href,prefix_not_primary_lang=elem.getProperty('data-langnp'),pathname=window.location.pathname;if(prefix_not_primary_lang!==""){if(pathname.indexOf('/'+prefix_not_primary_lang)<0){pathname='/'+prefix_not_primary_lang+pathname}}else{pathname=pathname.substring(3)}href=window.location.protocol+'//'+window.location.hostname+pathname+window.location.search;elem.setProperty('href',href)},_isUserAuth:function(){var user=App.getService('User');return!!(user&&user.isAuth())},_needRenewCart:function(){return(window['Cart']!==undefined&&(!Cart.empty()||this._isUserAuth())&&!this._isLanguagesMatchFromSession())},processUpdate:function(){return this.process_renew_cart},renewCart:function(){if(this._needRenewCart()){this.process_renew_cart=true;document.fireEvent('HideCartBlock');setTimeout(function(){if(this._needRenewCart()){new Ajax('/cgi-bin/form.php',{'method':'post',headers:{'ajaxAction':this.options.ajax_action},onComplete:function(resp){var response=new Response_class(resp);response.doAction();this._afterRenew();this.fireEvent('AfterRenewCart')}.bind(this),use_language:true}).request()}else{this._afterRenew()}}.bind(this),500)}else{this._afterRenew()}},_afterRenew:function(){this.process_renew_cart=false;document.fireEvent('ShowCartBlock')},useLanguages:function(){return Boolean(App.getSettings('menu.active.multilang'))},showSwitcher:function(){if(this.useLanguages()&&this.options.languages){var current_uri=new URI_class(),prepared_data=this.options.languages.map(function(lang){var lang_uri=new URI_class(undefined,{current:lang.language.name});this.langs[lang.language.name]={is_current:current_uri.toString()==lang_uri.toString(),title:lang.title,href:lang_uri.toString(),is_primary:lang.language.is_primary,name:lang.language.name};return this.langs[lang.language.name]}.bind(this));if(this.container){this.container.setHTML(App.getHTML(this.options.tpl,{languages:prepared_data}));this.container.show()}}},setRenewCookie:function(){Cookie.set(this.cookie_renew_session,1,{duration:1,domain:this.options.cookie_domain,path:'/'})},removeRenewCookie:function(){Cookie.remove(this.cookie_renew_session,{domain:this.options.cookie_domain,path:'/'})},issetRenewCookie:function(){return!!Cookie.get(this.cookie_renew_session)},_setLangChangedCookie:function(){Cookie.set(this.cookie_lang_changed,1,{duration:1,domain:this.options.cookie_domain,path:'/'})},_removeLangChangedCookie:function(){Cookie.remove(this.cookie_lang_changed,{domain:this.options.cookie_domain,path:'/'})},isSetLangChangedCookie:function(){return!!Cookie.get(this.cookie_lang_changed)},isSetLangForceRenewCookie:function(){return!!Cookie.get(this.cookie_lang_force_renewed)},setLangForceRenewCookie:function(){Cookie.set(this.cookie_lang_force_renewed,1,{duration:30,domain:this.options.cookie_domain,path:'/'})},removeLangForceRenewCookie:function(){Cookie.remove(this.cookie_lang_force_renewed,{domain:this.options.cookie_domain,path:'/'})},_getLangCookieName:function(){return LanguageDeterminer_class.prototype.cookie_saved_language},setLangCookie:function(value){var cookie_name=this._getLangCookieName();Cookie.set(cookie_name,value,{duration:30,domain:this.options.cookie_domain,path:'/'})},getLangFromCookie:function(){var cookie_name=this._getLangCookieName();return Cookie.get(cookie_name)},onLanguageChange:function(){this.container.getElements('a').each(function(elem){this.fillHref(elem)}.bind(this))}});LanguageSwitcher_class.implement(new Options(),new Events());var RZFetch_class=new Class({_extendOptions:function(options,additionalOptions){if(!options||typeof options!=='object'){options=additionalOptions}else{options=Object.merge(options,additionalOptions)}return options},fetch:function(url,options){return new Promise(function(resolve,reject){options=this._extendOptions(options,{onComplete:function(response){resolve(response)},onFailure:function(err){reject(err)}});new Ajax(url,options).request()}.bind(this))},get:function(url,options){options=this._extendOptions(options,{method:'get'});return this.fetch(url,options)},post:function(url,data,options){options=this._extendOptions(options,{method:'post',data:data});return this.fetch(url,options)}});window.RZFetch=new RZFetch_class();var SimpleTabItem_class=new Class({_toggler:null,_content:null,_name:null,_click_callback:null,initialize:function(toggler,content,name){this._toggler=$(toggler);this._content=$(content);this._name=name;if(this.isActive()){this._showAsActive()}else{this._showAsUnActive()}this._click_callback=this.onTogglerClick.bind(this);this._toggler.addEvent('click',this._click_callback)},getName:function(){return this._name},setUnactive:function(){if(this.isActive()){this._showAsUnActive();this.fireEvent('unactivate',this)}},setActive:function(){if(!this.isActive()&&this.isAvailable()){this._showAsActive();this.fireEvent('activate',this)}},getContent:function(){return this._content},onTogglerClick:function(e){new Event(e).stop();this.setActive()},_showAsActive:function(){this._toggler.addClass('active');this._content.show()},_showAsUnActive:function(){this._content.hide();this._toggler.removeClass('active')},isActive:function(){return this._toggler.hasClass('active')},isAvailable:function(){return this.isEnabled()},show:function(){this._toggler.show();this._content.show();return this},hide:function(){this._toggler.hide();this._content.hide();return this},disable:function(){this._enabled=false;this._toggler.disable();this._content.hide();this.fireEvent('disabled');return this},enable:function(){this._toggler.enable();if(this.isActive()){this._content.show()}this.fireEvent('enabled');return this},isEnabled:function(){return this._toggler.isEnabled()}});SimpleTabItem_class.implement(new Options(),new Events());var Seller_class=new Class({_user:null,_gaUTypeName:'gautype',_session:null,initialize:function(user){this._user=user;App.getSessionJSON(this.onLoadS.bind(this));this._session=App.getService('S')},onLoadS:function(){if(this.isActive()){App.getService('cookieStorage').set(this._gaUTypeName,'Seller')}else if(this._user.isAuth()){App.getService('cookieStorage').set(this._gaUTypeName,'Buyer')}else{App.getService('cookieStorage').remove(this._gaUTypeName)}this.fireEvent('update')},isActive:function(){return this.getData('status')=='confirmed'},getData:function(key){var data=this._session.get('seller')||{};return key?data[key]:data}});Seller_class.implement(new Events());var MarketSellerMenuDataSource_class=new Class({options:{request:{uri:'https://rozetka.com.ua/ua/market/seller/menu_json/'},menu_href_suffix:'https://my.rozetka.com.ua/ua/profile/market'},_data:null,initialize:function(options){this.setOptions(options)},init:function(){new Ajax(this.options.request.uri,{use_language:true,method:'get',onComplete:this.onRequestComplete.bind(this)}).request();return this},onDataReady:function(fn){this.addEvent('dataReady',fn);if(this._data!==null){fn(this)}},onRequestComplete:function(resp_text){this._data=[];try{var json=JSON.parse(resp_text);if(this._validateResponseData(json)){json.forEach(function(item){item['href']=this._getNodeHrefFromUri(item['uri'])}.bind(this));this._data=json;this.fireEvent('dataReady',this)}}catch(e){}},_validateResponseData:function(data){var is_valid=Boolean(Array.isArray(data)&&data.length);data.some(function(item){is_valid&=$defined(item['title'])&&$defined(item['name'])&&$defined(item['uri']);return!Boolean(is_valid)});return is_valid},_getNodeHrefFromUri:function(node_uri){return this.options.menu_href_suffix+node_uri},getData:function(){return this._data}});MarketSellerMenuDataSource_class.implement(new Options(),new Events());var MarketSellerUserMenuExtender_class=new Class({_data_source:null,_user:null,initialize:function(menu_data_source,user){this._data_source=menu_data_source;this._user=user},extendMenuNode:function(node){var data=this._data_source.getData()||[];if(node&&node.name=='profile'&&data&&data.length&&this._user.isSeller()){node.children=node.children||[];node.children=node.children.merge(data)}}});var User_class=new Class({Class:'User_class',auth:0,S:{},gaUidName:'gauid',signInSource:null,options:{popup:{tpl:'',parent:false,activeElements:[],hasOverlay:false},signin:{tpl:''},signup_confirm:{container_tpl:'',tpl:'',need_wait_next_try_msg_tpl:'',selectors:{confirm_signup_submit:'[name="confirm_signup_submit"]',resend_code_link:'[name="resend_code"]',resend_code_msg:'[name="resend_code_msg"]'},tpl_data:{},verify_code_action:'https://my.rozetka.com.ua/ua/signup/#checkVerifyPhoneCode',resend_code_action:'https://my.rozetka.com.ua/ua/signup/#sendVerifyPhoneCode',confirm_by_popup:true},is_signup:false,remind:{tpl:''},remind_success:{tpl:''},process:{tpl:''},message:{tpl:'${content}'},user_host_href:'https://my.rozetka.com.ua/ua/',email_pattern:'^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$',phone_pattern:'^\\s*((\\+?\\s*(\\(\\s*)?3)?[\\s-]*(\\(\\s*)?8[\\s-]*)?(\\(\\s*)?0[\\s-\\(]*[1-9][\\s-]*\\d(\\s*\\))?([\\s-]*\\d){7}\\s*$',login_pattern:'^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$|^\\s*((\\+?\\s*(\\(\\s*)?3)?[\\s-]*(\\(\\s*)?8[\\s-]*)?(\\(\\s*)?0[\\s-\\(]*[1-9][\\s-]*\\d(\\s*\\))?([\\s-]*\\d){7}\\s*$',block_ads_property:'block_ads',block_ads_cookie:'blads'},initialize:function(){S.addEvent('loadS4user',this.onLoadS.bind(this));S.addEvent('loadS',function(S){this.onLoadS($defined(S.user)?S.user:null);this.autoSignIn()}.bind(this));S.addEvent('noSID',this.autoSignIn.bind(this));this.addEvent('signIn',this.onSignInCompleted.bind(this));this.addEvent('signIn',this.setLoginCookie.bind(this));this.addEvent('signIn',this.updateAdvertisingCookie.bind(this));this.addEvent('signOut',this.deleteAdvertisingCookie.bind(this));this.addEvent('signInFailed',this.onSignInFailed.bind(this))},isAuth:function(){return!!this.auth},isAuthInSocial:function(name){return this.S.accounts!==undefined&&this.S.accounts[name]!==undefined},hasSocialAccount:function(){var account,has_account=false;if(this.S.accounts!=='undefined'){for(account in this.S.accounts){if(this.S.accounts.hasOwnProperty(account)){has_account=true;break}}}return has_account},getProperty:function(name){return $defined(this.S[name])?this.S[name]:''},getEmail:function(){return this.getProperty('email')||Cookie.get("email")||''},getTitle:function(){return this.getProperty('title')},setPopupParent:function(id){if(!id){id='user-popup-parent'+$random(0,100000);document.write("<div id='"+id+"'></div>")}this.options.popup.parent=$(id)},getPopup:function(){if(!this.popup){with(this.options.popup){this.popup=new Popup_class(tpl,parent);if(this.options.popup.hasOverlay)this.popup.overlayON();for(var name in activeElements){if($defined(this[activeElements[name]]))this.popup.addEvent(name,this[activeElements[name]].bind(this))}}};return this.popup},checkSignIn:function(onSignedIn,text){var Response=new Response_class(text);Response.doAction();if(Response.isError()){this.fireEvent('signInFailed',{response:Response.Message,eventSource:this.signInSource})}else{this.fireEvent('signIn',this.S);onSignedIn&&onSignedIn()}},onSignInCompleted:function(e){if(this.popup){this.getPopup().close()}Cookie.set(this.gaUidName,this.getProperty('id'),{domain:'rozetka.com.ua',path:'/'})},onSignInFailed:function(e){console.error('Должен вызываться метод наследника')},trySignIn:function(data,signInSource,onSignedIn){this.signInSource=signInSource;this._sendAjax(data,'signin#SignIn',this.checkSignIn.bind(this,onSignedIn))},checkExists:function(login){this._sendAjax({login:login},'signup#checkExists',function(resp){var Response=new Response_class(resp);this.fireEvent('checkExists',Response)}.bind(this))},_sendAjax:function(data,ajax_action,on_complete_handler){var options={method:'post',onComplete:on_complete_handler,headers:{ajaxAction:this.options.user_host_href+ajax_action}};new Ajax('/cgi-bin/form.php',options).request(data)},Remind:function(Msg){var options={process:this.options.process.tpl,headers:{'ajaxAction':this.options.user_host_href+'remind-password/#remindPassword'},onComplete:function(resp){popup.form.processStop();var Response=new Response_class(resp);Response.doAction();if(!Response.isError()){popup.setContent(this.options.remind_success.tpl,this);App.trackGTMEvent({'eventCategory':'Interactions','eventAction':'remind','eventLabel':'User'})}popup.msg.setHTML(Response.Message.getContentTpl(this.options.message.tpl))}.bind(this)};var popup=this.getPopup();popup.setContent(this.options.remind.tpl,this);popup.form.addEvent('submit',function(e){new Event(e).stop();this.trySend(options)});if(Cookie.get("login")){popup.form.login.value=Cookie.get("login")};popup.open().msg.setHTML(Msg?Msg.getContent():'')},SignOut:function(){console.error('Должен вызываться метод наследника')},onLoadS:function(S){this.S=S||{};if(this.auth!==this.S.auth){this.auth=this.S.auth;this.fireEvent('signChange');if(this.auth){this.fireEvent('signIn',this.S);$(document).fireEvent('signIn',this.S)}else{this.fireEvent('signOut')}}this.fireEvent('loadSession')},autoSignIn:function(){if((Cookie.get("p")||Cookie.get("ho_p"))&&Cookie.get("login")&&!this.isAuth()){S.renew()}},switchSignInPopup:function(tpl,popup){this.saved_signin_pcontent=this.options.signin.tpl;this.saved_signin_popup=this.popup;this.options.signin.tpl=tpl;this.popup=popup;with(this.options.popup){for(var name in activeElements){if($defined(this[activeElements[name]]))this.popup.addEvent(name,this[activeElements[name]].bind(this))}}},restoreSignInPopup:function(){this.options.signin.tpl=this.saved_signin_pcontent;this.popup=this.saved_signin_popup;this.saved_signin_pcontent=null;this.saved_signin_pparent=null},setLoginCookie:function(){Cookie.set('login',this.getProperty('login'),{duration:183,domain:'rozetka.com.ua',path:'/'})},updateAdvertisingCookie:function(){if(User.getProperty(this.options.block_ads_property)==1){if(!Cookie.get(this.options.block_ads_cookie)){Cookie.set(this.options.block_ads_cookie,User.getProperty(this.options.block_ads_property),{duration:183,domain:'rozetka.com.ua',path:'/'})}}else{this.deleteAdvertisingCookie()}},deleteAdvertisingCookie:function(){if(Cookie.get(this.options.block_ads_cookie)){Cookie.remove(this.options.block_ads_cookie,{duration:183,domain:'rozetka.com.ua',path:'/'})}},getEmailHash:function(){var email=this.getEmail();return email!==''?md5(email):email},getPhoneHash:function(){var userPhoneHash='',phones=this.getProperty('phones');if(Object.getLength(phones)>0){Object.each(phones,function(phone){userPhoneHash=md5(phone.phone)})}return userPhoneHash},getLoginType:function(login){var result=null;if(login&&login.test(new RegExp(this.options.email_pattern,'g'))){result='email'}else if(login&&login.test(new RegExp(this.options.phone_pattern,'g'))){result='phone'}return result}});User_class.implement(new Options,new Events);var TriesManager_class=new Class({_timer_delay:200,_check_next_try_timer:null,_next_try_times_by_keys:[],initialize:function(){this.attachToObserver([])},updateData:function(key,content){if(content.next_try_after){var time_obj=new Date();time_obj.setSeconds(time_obj.getSeconds()+content.next_try_after);this._next_try_times_by_keys[key]=time_obj}else if($defined(content.tries_left)&&!content.tries_left){this._next_try_times_by_keys[key]=false}},_getNextTryTime:function(key){var result=null;if(this._next_try_times_by_keys[key]===false){result=false}else if(this._next_try_times_by_keys[key]&&this._next_try_times_by_keys[key].getTime()>Date.now()){result=this._next_try_times_by_keys[key].getTime()}return result},checkNextTryTime:function(element){this._clearTimer();var key=element&&element.getValue(),next_try_time=this._getNextTryTime(key);if(next_try_time===false){this.fireEvent('triesLimitExceeded',{element:element})}else if(next_try_time){this.fireEvent('needWaitForNextTry',{seconds_left:(next_try_time-Date.now())/1000,element:element});this._check_next_try_timer=setTimeout(this.checkNextTryTime.bind(this,element),this._timer_delay)}else{this.fireEvent('triesSuccessful',{element:element})}},_clearTimer:function(){if(this._check_next_try_timer){clearTimeout(this._check_next_try_timer);this._check_next_try_timer=null}},canTrySuccessfully:function(key){return this._getNextTryTime(key)===null}});TriesManager_class.implement(new Events());var RozetkaUser_class=User_class.extend({need_oauth_update:true,default_auth_type:'popup',_auth_blocks:null,_auth_attempts:0,_auth_attempts_cookie_name:"lock_auth_count",_auth_blocks_options:{blocks:{simple_auth:'<div name=\"simple_auth\" class=\"hidden\"> <div class=\"auth-f-i\"> <div class=\"auth-f-i-title\">Пароль<\/div> <input type=\"password\" class=\"input-text auth-input-text\" name=\"password\" _required=\"required\"> <div class=\"auth-message hidden\" name=\"wrong_password_block\"> <h5 class=\"auth-forgot-pass-tooltip-title\" name=\"password_hint\"><\/h5> <p class=\"auth-forgot-pass-tooltip-note\">Перевірте розкладку клавіатури і&nbsp;Caps Lock<\/p> <span name=\"send_me_temp_pass\"><\/span> <\/div> <div class=\"auth-f-remind-pass\"> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/remind-password\/\" name=\"forgot_button\" class=\"auth-f-remind-pass-link novisited xhr\">Нагадати пароль<\/a> <\/div> <label class=\"checkbox auth-f-i-remember\"> <input class=\"hidden checkbox-input\" type=\"checkbox\" name=\"remember\" checked=\"checked\" value=\"1\"> <span class=\"checkbox-label sprite-side auth-f-i-remember-text\">Запам\'ятати мене<\/span> <\/label> <div name=\"recaptcha_placeholder\"> <div name=\"recaptcha\" class=\"recaptcha recaptcha-indent\" data-sitekey=\"6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU\"><\/div> <\/div> <div class=\"auth-message recaptcha-tooltip hidden\" name=\"wrong_captcha_signin_block\"> Необхiдно пiдтвердити, що ви не робот <\/div> <\/div> <div class=\"clearfix f-i auth-f-submit\"> <div class=\"auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <button type=\"submit\" class=\"btn-link-i\" name=\"auth_submit\">Увійти<\/button> <\/span> <a href=\"#\" class=\"novisited auth-f-cancel\" name=\"close\">Скасувати<\/a> <\/div> <\/div> <\/div>'},blocks_type:'popup'},_saved_auth_blocks_options:null,is_send_pl_request:false,has_valid_phones:false,_spy_fields:{request:{url:'/users_unregistered',method:'get',delay:3000,timeout:null},selectors:{email:'[name=login]',user_title:''},required:['email']},_seller_class_name:'Seller_class',_confirm_code_resends_manager:null,sign_up_confirm_phone_requesting:false,_is_reloaded_premium:false,initialize:function(){this.addEvent('signIn',this.fireEvent.bind(this,'beforeSignIn'));this.attachToObserver(['triesLimitExceeded','needWaitForNextTry','triesSuccessful']);this.parent();this.notifications=new Notifications_class(this);this._seller=new(App.getConstructorByClassName(this._seller_class_name))(this);this.auth_type=this.default_auth_type;if(S.checkup){this.addEvent('signIn',this.setAuthorizedCustomVar)}else{S.addEvent('loadS',function(){this.addEvent('signIn',this.setAuthorizedCustomVar)}.bind(this))}this.addEvent('signIn',this.sendPostMessage.bind(this))},isAbleToSkipFirstStep:function(){return Boolean(this.isAuth()&&this.has_valid_phones&&Number(this.getVisitorCity()))},getSeller:function(){return this._seller},isSeller:function(){return this.getSeller().isActive()},sendPostMessage:function(){var message={"type":"UserAuthorize","customerID":this.S.id};window.postMessage(message,window.location.protocol+'//'+window.location.hostname)},initSpyFields:function(options){Object.merge(this._spy_fields,options);Object.values(this._spy_fields.selectors).each(function(elem){elem&&document.getElement(elem)&&document.getElement(elem).addEvent('keyup',this._onSpyFieldsChange.bind(this))}.bind(this))},_isRequiredSpyFieldsValid:function(){var result=true;this._spy_fields.required.each(function(elem){if(document.getElement(this._spy_fields.selectors[elem]).isValid&&!document.getElement(this._spy_fields.selectors[elem]).isValid()){result=false}}.bind(this));return result},_onSpyFieldsChange:function(){if(this._isRequiredSpyFieldsValid()){if(this._spy_fields.request.timeout){clearTimeout(this._spy_fields.request.timeout)}this._spy_fields.request.timeout=setTimeout(this._sendSpyFieldsRequest.bind(this),this._spy_fields.request.delay)}},_sendSpyFieldsRequest:function(){var data={};Object.each(this._spy_fields.selectors,function(elem,key){if(elem&&document.getElement(elem)&&document.getElement(elem).value){data[key]=document.getElement(elem).value}}.bind(this));new Ajax(this._spy_fields.request.url,{method:this._spy_fields.request.method}).request({data:btoa(unescape(encodeURIComponent(JSON.stringify(data))))})},getVerifiedPhones:function(){var elem,phones=[];if($defined(this.S.phones)){for(elem in this.S.phones){if($defined(this.S.phones)&&$defined(this.S.phones[elem])&&$defined(this.S.phones[elem].confirm_status)&&$defined(this.S.phones[elem].status)&&this.S.phones[elem].status!='removed'&&this.S.phones[elem].status!='system'&&this.S.phones[elem].confirm_status==='confirmed'){phones.push(this.S.phones[elem])}}}return phones},getNotVerifiedPhones:function(){var elem,phones=[];if($defined(this.S.phones)){for(elem in this.S.phones){if($defined(this.S.phones)&&$defined(this.S.phones[elem])&&$defined(this.S.phones[elem].confirm_status)&&$defined(this.S.phones[elem].status)&&this.S.phones[elem].status!='removed'&&this.S.phones[elem].status!='system'&&this.S.phones[elem].confirm_status==='not_confirmed'){phones.push(this.S.phones[elem])}}}return phones},getPhones:function(){var elem,phones=[];if($defined(this.S.phones)){for(elem in this.S.phones){if($defined(this.S.phones)&&$defined(this.S.phones[elem])&&$defined(this.S.phones[elem].status)&&this.S.phones[elem].status!='removed'&&this.S.phones[elem].status!='system'){phones.push(this.S.phones[elem])}}}return phones},getLoginPhoneData:function(){var elem,phones,login,result=null;if((phones=this.getProperty('phones'))&&(login=this.getProperty('login_phone'))){for(elem in phones){if($defined(phones[elem])&&phones[elem].phone==login){result=phones[elem];break}}}return result},SignIn:function(Msg,custom_auth_options){var popup=this.getPopup(),auth_options=Object.clone(this._auth_blocks_options);popup.setContent(this.options.signin.tpl,this);if(Cookie.get('login')&&popup.form.login!==undefined&&!popup.form.login.value){popup.form.login.value=Cookie.get('login')}popup.open();if(custom_auth_options){auth_options=Object.merge(auth_options,custom_auth_options)}this._auth_blocks=new AuthorizationBlocks_class(popup.form,auth_options);popup.getElements('[name="close"]').each(function(elem){elem.addEvent('click',function(e){new Event(e).stop();popup.close()})});this._auth_blocks.needAuth(Msg);this.updateOAuth();this.fireEvent('formPopupOpen',{form:popup.form})},_sendAjax:function(){try{this.popup.form.processStart(this.options.process.tpl);this.addEvent('signInFailed',function(data){this.popup.form.processStop(this.options.process.tpl)}.bind(this))}catch(e){}this.parent.apply(this,arguments)},switchSignInPopup:function(tpl,popup,auth_block_options){if(auth_block_options){this._saved_auth_blocks_options=this._auth_blocks_options;this._auth_blocks_options=auth_block_options}this.parent(tpl,popup)},restoreSignInPopup:function(){if(this._saved_auth_blocks_options){this._auth_blocks_options=this._saved_auth_blocks_options}this._saved_auth_blocks_options=null;this.parent()},confirmSignUp:function(confirm_data){var confirm_signup_block=this.getConfirmSignupBlock(),data={tpl_data:this.options.signup_confirm.tpl_data,confirm_data:confirm_data},event_location,extend_event_data;if(this.options.signup_confirm.confirm_by_popup){confirm_signup_block.setContent(this.options.signup_confirm.tpl,data);confirm_signup_block.open();confirm_signup_block.addEventOnce('close',function(){this.fireEvent('confirmSignupPopupClose')}.bind(this))}else if(this.options.signup_confirm.tpl!==null){confirm_signup_block.setHTML(App.getHTML(this.options.signup_confirm.tpl,data)).show()}this._on_confirm_sign_up_submit=this._onConfirmSignUpSubmit.bind(this);confirm_signup_block.getElement(this.options.signup_confirm.selectors.confirm_signup_submit).addEvent('click',this._on_confirm_sign_up_submit);confirm_signup_block.getElement(this.options.signup_confirm.selectors.resend_code_link).addEvent('click',this._onResendCodeClick.bind(this));if(event_location=this.getConfirmSignupBlockForm().getAttribute('data-event-location')){extend_event_data={extend_event:[{name:'eventLocation',value:event_location}]}}document.fireEvent('showPhoneConfirmBlock',extend_event_data)},getConfirmSignupBlock:function(){if(!this._confirm_signup_block){this._confirm_signup_block=new Popup_class(this.options.signup_confirm.container_tpl)}return this._confirm_signup_block},getConfirmSignupBlockForm:function(){var confirm_signup_block=this.getConfirmSignupBlock();return(confirm_signup_block.getTag&&confirm_signup_block.getTag()==='form')?confirm_signup_block:confirm_signup_block.getElement('form')},_onConfirmSignUpSubmit:function(e){new Event(e).stop();var form=this.getConfirmSignupBlockForm(),event_location,extend_event_data;if(form.checkFields()){if(event_location=form.getAttribute('data-event-location')){extend_event_data={extend_event:[{name:'eventLocation',value:event_location}]}}document.fireEvent('signUpConfirmPhone',extend_event_data);this.sign_up_confirm_phone_requesting=true;form.processStart(this.options.process.tpl);new Ajax('/cgi-bin/form.php',{headers:{ajaxAction:this.options.signup_confirm.verify_code_action},data:form.getFormData(['user_id','phone_id','verify_code','need_redirect']),onComplete:function(resp){var response=new Response_class(resp);response.doAction();this.sign_up_confirm_phone_requesting=false;if(response.isError()&&response.Message){form.processStop();App.showMessage(response.Message,form)}else if(response.isDone()){form.getElement(this.options.signup_confirm.selectors.confirm_signup_submit).removeEvent('click',this._on_confirm_sign_up_submit);if(this.options.signup_confirm.confirm_by_popup){this.getConfirmSignupBlock().close()}this.fireSignInEvent('phone')}}.bind(this)}).request()}},_onResendCodeClick:function(e){new Event(e).stop();var form=this.getConfirmSignupBlockForm(),form_data=form.getFormData(['user_id','phone_id']),user_id_input=form.getElement('[name=user_id]');this._getConfirmCodeResendsManager().checkNextTryTime(user_id_input);form.processStart(this.options.process.tpl);new Ajax('/cgi-bin/form.php',{data:form_data,method:'post',headers:{'ajaxAction':this.options.signup_confirm.resend_code_action},onComplete:function(resp){form.processStop();var response=new Response_class(resp);if(response.isDone()){this.getConfirmSignupBlock().getElement(this.options.signup_confirm.selectors.resend_code_msg).show().setHTML(response.Message.getContent())}else{this._getConfirmCodeResendsManager().updateData(form_data.user_id,response.content);this._getConfirmCodeResendsManager().checkNextTryTime(user_id_input)}}.bind(this)}).request()},_getConfirmCodeResendsManager:function(){if(this._confirm_code_resends_manager===null){this._confirm_code_resends_manager=new TriesManager_class()}return this._confirm_code_resends_manager},onTriesLimitExceeded:function(e){var event_data=e[0],confirm_signup_block=this.getConfirmSignupBlock(),form=this.getConfirmSignupBlockForm(),event_element=form&&form.getElement('[name=user_id]'),msg_block;if(event_data.element===event_element){msg_block=confirm_signup_block.getElement(this.options.signup_confirm.selectors.resend_code_msg);confirm_signup_block.getElement(this.options.signup_confirm.selectors.resend_code_link).hide();msg_block.show().setHTML(App.getHTML(this.options.signup_confirm.need_wait_next_try_msg_tpl))}},onNeedWaitForNextTry:function(e){var event_data=e[0],confirm_signup_block=this.getConfirmSignupBlock(),form=this.getConfirmSignupBlockForm(),event_element=form&&form.getElement('[name=user_id]'),msg_block;if(event_data.element===event_element){msg_block=confirm_signup_block.getElement(this.options.signup_confirm.selectors.resend_code_msg);confirm_signup_block.getElement(this.options.signup_confirm.selectors.resend_code_link).hide();msg_block.show().setHTML(App.getHTML(this.options.signup_confirm.need_wait_next_try_msg_tpl,{seconds_left:event_data.seconds_left}))}},onTriesSuccessful:function(e){var event_data=e[0],confirm_signup_block=this.getConfirmSignupBlock(),form=this.getConfirmSignupBlockForm(),event_element=form&&form.getElement('[name=user_id]');if(event_data.element===event_element){confirm_signup_block.getElement(this.options.signup_confirm.selectors.resend_code_link).show();confirm_signup_block.getElement(this.options.signup_confirm.selectors.resend_code_msg).hide()}},switchSignUpConfirmBlock:function(block,tpl,tpl_data){this.saved_signup_confirm_content=this.options.signup_confirm.tpl;this.saved_signup_confirm_block=this._confirm_signup_block;this.options.signup_confirm.tpl=tpl;this.options.signup_confirm.tpl_data=tpl_data;this._confirm_signup_block=block},restoreSignUpConfirmBlock:function(){this.options.signup_confirm.tpl=this.saved_signup_confirm_content;this._confirm_signup_block=this.saved_signup_confirm_block;this.saved_signup_confirm_content=null;this.saved_signup_confirm_block=null},onSignInFailed:function(data){Cookie.remove('login',{domain:'rozetka.com.ua',path:'/'});Cookie.remove(this.gaUidName,{domain:'rozetka.com.ua',path:'/'});var event_data={eventError:data.response.name,eventLabel:data.eventSource};if(data.response.name=="SignInUserLockedByPhone"){this.increaseAuthAttemptsCount();event_data["eventError"]="BlackList";event_data["eventContext"]=this.getAuthAttemptsCount();event_data["userPhoneNumberHash"]=data.response.blocked_phone_hash}document.fireEvent('signInFailed',event_data)},initAuthAttempts:function(){this._auth_attempts=parseInt(Cookie.get(this._auth_attempts_cookie_name))||0},getAuthAttemptsCount:function(){if(!this._auth_attempts){this.initAuthAttempts()}return this._auth_attempts},increaseAuthAttemptsCount:function(){if(!this._auth_attempts){this.initAuthAttempts()}this._auth_attempts++;Cookie.set(this._auth_attempts_cookie_name,this._auth_attempts,{domain:'rozetka.com.ua',path:'/',duration:'182'});return this.getAuthAttemptsCount()},authorize:function(data,onComplete){new Ajax('/cgi-bin/form.php',{data:data,method:'post',headers:{'ajaxAction':this.options.user_host_href+'signin/#SignIn'},onComplete:onComplete}).request()},setAuthorizedCustomVar:function(e){window['CustomVars']&&CustomVars.set('userId',this.S.id);this.setVisitorCustomVar();if(S.is_renew_sended){rozetkaEvents.trackEvent('authorization','success','permanent');App.trackGTMEvent({'eventCategory':'Interactions','eventAction':'signin','eventLabel':'permanent'})}},setVisitorCustomVar:function(city){var visitor_city=city||this.getVisitorCity();if(visitor_city){Cookie.set('visitor_city',visitor_city,{duration:365,domain:'.rozetka.com.ua',path:'/'});window['CustomVars']&&CustomVars.set('VisitorCity',visitor_city)}},getVisitorCity:function(){return Cookie.get('visitor_city')||this.getProperty('visitor_city')},getVisitorCityRecord:function(){var record=Cookie.get('visitor_city_record');if(record){record=App.getService('JSON').parse(record)}return record},isCityAskedBefore:function(){return Cookie.get('is_city_asked')},checkSignIn:function(onSignedIn,text){if(this.getPopup().form){this.getPopup().form.processStop()}this.parent(onSignedIn,text);var Response=new Response_class(text);Response.doAction();if(!Response.isError()){this.fireEvent('signInPopup',this.S);rozetkaEvents.trackEvent('authorization','success',this.auth_type)}this.fireEvent('currentlySignedIn')},SignOut:function(){var options={data:{title:'OWOX goodbye:)'},onComplete:function(resp){(new Response_class(resp)).doAction();OAuth2.setOptions({binding:false});CustomVars.remove('userId');App.trackGTMEvent({'eventCategory':'Interactions','eventAction':'signout','eventLabel':'User','eventLocation':'Head'});Cookie.remove(User.gaUidName,{domain:'rozetka.com.ua',path:'/'});S.clearLastProlonged();this.notifications.stop();document.fireEvent('signOut')}.bind(this),headers:{'ajaxAction':this.options.user_host_href+'signout/#SignOut'}};new Ajax('/cgi-bin/form.php',options).request()},changeAuthType:function(type){this.auth_type=type},restoreAuthType:function(){this.auth_type=this.default_auth_type},sendTemporaryPassword:function(login,form,onComplete){var captcha_resp=ReCaptchaRemindPassword.getResponseElem(form),params={login:login};if(captcha_resp){params['g-recaptcha-response']=captcha_resp.value}this._sendAjax(params,'remind-password#sendTemporaryPassword',onComplete)},updateOAuth:function(){if(this.need_oauth_update){OAuth2.update({});OAuth2.addEvent('login_start',function(e){if(this.popup&&this.popup.form){this.popup.form.processStart(this.options.process.tpl)}}.bind(this));OAuth2.addEvent('login_success',function(e){if(this.popup){this.popup.close()}}.bind(this));OAuth2.addEvent('login_complete',function(e){if(this.popup&&this.popup.form){this.popup.form.processStop()}document.fireEvent('oauth2_login_complete')}.bind(this));OAuth2.addEvent('login_failed',function(params){if(this.popup&&this.popup.msg&&params&&params.value){this.popup.msg.innerHTML=params.value}else if(this.popup&&this.popup.msg){this.popup.msg.innerHTML=''}}.bind(this))}},_loginSuccessSocialPopup:function(){var popup=this.notifications.getPopup('social_popup');if(popup&&popup.isOpened()){document.fireEvent('loginSuccessSocialPopup',{extend_event:[{name:'eventContent',value:OAuth2['type']}]});popup.close()}},bindSocialErrorHandler:function(){if(!this.handler_is_binded){OAuth2.addEvent('login_failed',this.showSocialBindError.bind(this));this.handler_is_binded=true}},showSocialBindError:function(params){if(params&&params.value){var popup=new Popup_class('<div class=\"popup-css popup-viewed-auth\"> <a href=\"#\" class=\"popup-close-medium-delivery\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"×\" class=\"popup-close-medium-icon sprite\"><\/a> <div name=\"content\"><\/div> <\/div>');popup.setContent('<div style=\"color:#f00;margin-top:.5em\">${value}<\/div>',params);popup.open()}},getEmail:function(escape){var cookie_login=Cookie.get("login"),email=this.parent()||(this.getLoginType(cookie_login)==='email'?cookie_login:null)||'';return(escape!==undefined&&escape===true)?App.htmlSpecialChars(email,null,null,false):email},setNeedOAuthUpdate:function(value){this.need_oauth_update=!!value},reLogin:function(data){this._sendAjax(data,'signout/#reLogin',this.checkSignIn.bind(this,null))},isEmailConfirmed:function(){return!this.getProperty('email')||this.getProperty('confirmed')},isCreatedAfterDoubleOptIn:function(){return!!this.getProperty('created_after_douple_optin')},showPopupNotifications:function(){this.notifications.run()},isPremiumActive:function(){var sub=this.getProperty('premium_sub');if(!this._is_reloaded_premium&&sub&&sub.status==='unpaid'){this._is_reloaded_premium=true;S.disable_localstorage=true;S.load()}return Boolean(sub)&&(sub.status==='active')},toggleSignIn:function(){!this.getPopup().isOpened()?this.SignIn():this.getPopup().close()},popupIsOpened:function(){return this.getPopup().isOpened()},fireSignInEvent:function(login_type){var is_sign_up=(this.S.signUp&&this.S.signUp==='registrationSuccess');document.fireEvent('authBlocksSignIn',{extend_event:[{name:'eventAction',value:is_sign_up?'signup':'signin'},{name:'eventLabel',value:this.auth_type},{name:'eventContext',value:login_type}]})},signInPromise:function(message){var callback=function(resolve,reject){this.addEventOnce('beforeSignIn',resolve);this.getPopup().addEventOnce('close',reject);this.SignIn(message)};return new Promise(callback.bind(this))},signUpPromise:function(content){var callback=function(resolve,reject){this.addEventOnce('beforeSignIn',resolve);this.addEventOnce('confirmSignupPopupClose',reject);this.confirmSignUp(content)};return new Promise(callback.bind(this))}});var ProgramLoyalty_class=new Class({Class:'ProgramLoyalty_class',options:{selectors:{container_id:'program-loyalty-header',header_btn:'program-loyalty-header_btn',pl_popup:'program-loyalty-popup',use_bonuses_button:'[name=use_bonuses_button]',bonuses_block:'[name=bonuses_block]'},tpl:{pl_header:'',pl_content:'',container:'',content:''},cookie:{name:'pl_cookie',options:{domain:'rozetka.com.ua',duration:0}},data_update_ajax_action:'',default_pl_data:{is_header:true},domain:'https://rozetka.com.ua/ua/'},_container:undefined,_user:null,_is_pl_active:false,_pl_data:{},_header_btn:null,_pl_popup:null,_popup:null,_use_bonus_popup:false,_last_user_id:null,_blocks:[],_callbacks:[],rozetkaClubStatus:'analyticsRozetkaClubStatus',rozetkaClubBonuses:'analyticsRozetkaClubBonuses',initialize:function(user,use_bonus_popup,pl_active){this._user=user;this._use_bonus_popup=use_bonus_popup;this._is_pl_active=pl_active;this._pl_data=Object.clone(this.options.default_pl_data);this.attachToObserver(['ExitProgramLoyalty','SuccessConfirmPhone','PLConfirm']);document.addEvent('updateBlockContent',function(updated_block){var bonuses_blocks=updated_block&&updated_block.getElements(this.options.selectors.bonuses_block);this.addOnPLVisibilityChange(bonuses_blocks)}.bind(this))},init:function(){App.addOnDomReady(function(){this._user.addEvent('signChange',this.showProgramLoyalty.bind(this));App.getSessionJSONOnce(this.showProgramLoyalty.bind(this))}.bind(this));return this},onExitProgramLoyalty:function(){this.showProgramLoyalty()},onSuccessConfirmPhone:function(){this.showProgramLoyalty()},onPLConfirm:function(){this.showProgramLoyalty()},toPriceFormat:function(number){return number.toString().toPriceFormat()},showProgramLoyalty:function(){App.addOnDomReady(this._domReadyHandler.bind(this))},getData:function(){return this._pl_data},_showAdvertising:function(){if(!window.location.hostname.test(/^my\..*$/)&&this._user.isAuth()&&this.isPLActive()&&!this.isParticipantPL()&&!Cookie.get(this.options.cookie.name)&&!this._popup&&this._use_bonus_popup&&App.isRozetkaDomain()){this._popup=new Popup_class(this.options.tpl.container);this._popup.overlayON({'class':'pl-promo-popup-overlay'});this._popup.setContent(this.options.tpl.content);this._popup.open();this._popup.getElements(this.options.selectors.use_bonuses_button).each(function(elem){elem.addEvent('click',function(event){new Event(event).stop();this._setAdsCookie();window.location=elem.href}.bind(this))}.bind(this));document.fireEvent('openBonusesPopup',{extend_event:[{name:'eventNoninteraction',value:1}]});this._popup.addEvent('close',this._setAdsCookie.bind(this))}},_setAdsCookie:function(){Cookie.set(this.options.cookie.name,true,this.options.cookie.options)},isParticipantPL:function(){return this._pl_data['pl_is_activated']},_domReadyHandler:function(){if(this._user.isAuth()&&this._user.getProperty('id')){this._last_user_id!=this._user.getProperty('id')&&new Ajax(this.options.domain+'program_loyalty/user=pl_user_data:'+this._user.getProperty('id')+'/',{method:'get',onComplete:this._getBonusesHandler.bind(this),withCredentials:true}).request()}else if(this._is_pl_active){this._getContainer()&&this._getContainer().show();this._pl_data=Object.clone(this.options.default_pl_data);this._pl_data.not_authorized=true;this._pl_data.pl_is_activated=null;this._updateContent();this.fireEvent('GetPLData',this._pl_data);this._showAdvertising();this._showBlocks(this._blocks);this._executeCallbacks(this._callbacks);this._updateCookies()}else{this._pl_data['pl_active']=0;this._getContainer()&&this._getContainer().hide();this._showBlocks(this._blocks);this._executeCallbacks(this._callbacks);this._updateCookies()}},_getContainer:function(){if(this._container===undefined){this._container=$(this.options.selectors.container_id)}return this._container},_getBonusesHandler:function(resp){var response=App.getService('JSON').parse(resp);if(response){this._pl_data.not_authorized=false;this._pl_data['pl_active']=response['pl_active'];if(!response['in_black_list']){response.loyalty_accepted=!!response.loyalty_accepted;this._pl_data.count_bonus=response.contact_bonus_amount;this._pl_data.bonus_charge=this.toPriceFormat(response.contact_bonus_charge);this._pl_data.all_bonus=this.toPriceFormat(response.contact_bonus_charge+response.contact_bonus_amount);this._pl_data.exist_phone=response['exist_verify_phones'];this._pl_data.loyalty_accepted=response.loyalty_accepted;this._pl_data.pl_is_activated=this._pl_data.exist_phone&&this._pl_data.loyalty_accepted}this._pl_data['in_black_list']=response['in_black_list'];this._updateContent();this.fireEvent('GetPLData',this._pl_data);this._showAdvertising()}this.fireEvent('needUpdateUserMenu');this.isPLActive()&&this._getContainer()&&this._getContainer().show();this._showBlocks(this._blocks);this._executeCallbacks(this._callbacks);this._updateCookies()},_updateContent:function(){if(!this._header_btn){this._header_btn=$(this.options.selectors.header_btn)}if(!this._pl_popup){this._pl_popup=$(this.options.selectors.pl_popup)}this._header_btn&&this._header_btn.setHTML(App.getHTML(this.options.tpl.pl_header,{program_loyalty:this._pl_data}));this._pl_popup&&this._pl_popup.setHTML(App.getHTML(this.options.tpl.pl_content,{program_loyalty:this._pl_data}))},isPLActive:function(){return(this._is_pl_active||this._pl_data['pl_active'])&&!this._pl_data['in_black_list']},addOnPLVisibilityChange:function(blocks){if(!Array.isArray(blocks)){blocks=[blocks]}blocks.each(function(block){this._blocks.push(block)}.bind(this));this._showBlocks(blocks)},_showBlocks:function(blocks){blocks.each(function(block){if(block){this.isPLActive()?block.show():block.hide()}}.bind(this))},addCallbacksOnPLVisibilityChange:function(callbacks){if(!Array.isArray(callbacks)){callbacks=[callbacks]}callbacks.each(function(callback){this._callbacks.push(callback)}.bind(this));if(this.isPLActive()||!this._user.isAuth()){this._executeCallbacks(callbacks)}else{}},_executeCallbacks:function(callbacks){callbacks.each(function(callback){if(callback){callback(this.isPLActive())}}.bind(this))},getClubStatus:function(){var result='Unconfirm';if(this._pl_data['in_black_list']){result='Blocked'}else if(this._pl_data['loyalty_accepted']&&this._pl_data['exist_phone']){result='Active'}else if(this._pl_data['loyalty_accepted']&&!this._pl_data['exist_phone']){result='Unverified'}else if(this._pl_data['exist_phone']&&!this._pl_data['loyalty_accepted']){result='Verified'}return result},getClubBonuses:function(){var result=0;if(this._pl_data['count_bonus']){result+=parseInt(this._pl_data['count_bonus'])}if(this._pl_data['bonus_charge']){result+=parseInt(this._pl_data['bonus_charge'])}return result},_updateCookies:function(){var options={domain:'rozetka.com.ua',path:'/'};if(this._user.isAuth()){Cookie.set(this.rozetkaClubStatus,this.getClubStatus(),options);Cookie.set(this.rozetkaClubBonuses,this.getClubBonuses(),options)}else{Cookie.remove(this.rozetkaClubStatus,options);Cookie.remove(this.rozetkaClubBonuses,options)}}});ProgramLoyalty_class.implement(new Options(),new Events());var Notifications_class=new Class({user:null,popup:null,queue:[{name:'confirm_email',"action":function(obj){obj.showConfirmEmailPopup()},order_index:3,popup:{tpl_popup:'<div class=\"confirm-email-popup\"> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/profile\/personal-information\/?action=sendEmailConfirmation\" class=\"confirm-email-popup-i sprite-side novisited\"> Підтвердьте свою&nbsp;ел.&nbsp;пошту <\/a> <div class=\"social-bind-tiny-buttons-box\" name=\"content\"><\/div> <a href=\"#\" class=\"confirm-email-popup-i-close novisited\" name=\"close\"> Закрити <\/a> <\/div>',tpl_content:'',parent:'social_popup'},cookie:{name:'confirm_email',params:{domain:'rozetka.com.ua',path:'/'}},urls:{},data:{}},{name:'social_popup',"action":function(obj){obj.showSocialPopup()},order_index:4,popup:{tpl_popup:'<div class=\"social-bind social-bind-tiny\"> <p class=\"social-bind-tiny-header\">Зв\'яжіть обліковий запис із соцмережами<\/p> <div class=\"social-bind-tiny-buttons-box\" name=\"content\"><\/div> <p class=\"social-bind-tiny-text\">Ми&nbsp;не&nbsp;передаємо жодних даних соцмережам і&nbsp;не&nbsp;постимо нічого у&nbsp;вас на&nbsp;стіні<\/p> <a href=\"#\" class=\"social-bind-tiny-close novisited\" name=\"close\">Закрити<\/a> <\/div>',tpl_content:'<span class=\"btn-auth-fb-small btn-link sprite-side\" name=\"social_button_auth_panel\" type=\"facebook\"><\/span> {if use_vk} <span class=\"btn-auth-vk-small btn-link sprite-side\" name=\"social_button_auth_panel\" type=\"vkontakte\"><\/span> {\/if} <span class=\"btn-auth-g-small btn-link sprite-side\" name=\"social_button_auth_panel\" type=\"google\"><\/span> ',parent:'social_popup'},cookie:{name:'social_popup',params:{domain:'rozetka.com.ua',path:'/',duration:'356'}},urls:{},data:{}},{name:'club_invitation',"action":function(obj){obj.showClubInvitationPopup()},order_index:2,popup:{tpl_popup:'<div class=\"club-invitation-popup\"> <div name=\"content\"><\/div> <\/div>',tpl_content:'{if club} {if club.src} <a {if club.link}href=\"${club.link}\"{else}onlick=\"return false;\"{\/if} class=\"club-invitation-img responsive-img\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"_\" style=\"background-image: url(\'${club.src}\');\"> <\/a> {\/if} <div class=\"club-invitation-custom-wrap\"> <div class=\"club-invitation-custom\">${club.text}<\/div> <\/div> <div class=\"club-invitation-tools\"> <span class=\"btn-link btn-link-green {if !is_joined}club-invitation-tools-add-btn sprite-side{else}club-invitation-tools-go-btn{\/if}\"> {if !is_joined} <a href=\"#\" class=\"btn-link-i\" onclick=\"User.notifications.fireEvent(\'onClubInvitationJoin\', {\'club_id\': ${club.id}});return false;\">Вступить в&nbsp;клуб<\/a> {\/if} {if is_joined && club.link} <a href=\"${club.link}\" class=\"btn-link-i\">Перейти до&nbsp;клубу<\/a> {\/if} <\/span> <a href=\"#\" class=\"novisited club-invitation-tools-link\" name=\"close\"> {if !is_joined} Нагадати пізніше {else} Закрити {\/if} <\/a> <\/div> {\/if}',parent:'social_popup'},cookie:{name:'club_invitation',params:{domain:'rozetka.com.ua',path:'/'}},urls:{remind_later:'https://my.rozetka.com.ua/ua/profile/clubs/#updateClubInvitationRemindDateAjax',join_club:'https://my.rozetka.com.ua/ua/profile/clubs/#joinClubAjax',check_club_invitation:'https://my.rozetka.com.ua/ua/profile/clubs/#checkClubInvitationAjax'},data:{}},{name:'unpaid_invoices',"action":function(obj){obj.showUnpaidInvoicesPopup()},order_index:1,popup:{tpl_popup:'<div class=\"account-message-popup\"> <div name=\"content\"><\/div> <\/div>',tpl_content:'<div class=\"account-message-l-wrap\"> <ul class=\"account-message-l\"> {for order in orders} <li class=\"account-message-l-i\"> <div class=\"unpaid-order-num\"> Чекає оплати замовлення <a href=\"https:\/\/my.rozetka.com.ua\/ua\/profile\/account\" class=\"unpaid-order-num-link\">&#8470; ${order.order_id}<\/a> <\/div> <div class=\"unpaid-order-sum\"> {var word_forms = [\'товар\', \'товару\', \'товарів\']} {var plural_form = plural(order.purchases_count)} ${order.purchases_count}&nbsp;${word_forms[plural_form]} на&nbsp;суму ${order.cost} <\/div> <ul class=\"clearfix unpaid-order-g\"> {for purchase in order.purchases} <li class=\"unpaid-order-g-i\"> <a href=\"${purchase.href}\" class=\"responsive-img unpaid-order-g-link\"> <img src=\"${purchase.image}\" alt=\"${purchase.title}\" title=\"${purchase.title}\"> <\/a> <\/li> {\/for} <\/ul> <div class=\"unpaid-order-valid-until\"> Дійсний до&nbsp;оплати до${order.expire_date} <\/div> <\/li> {\/for} <\/ul> <\/div> <div class=\"clearfix account-message-bottom-b\"> {if orders.length == 1} <form action=\"https:\/\/my.rozetka.com.ua\/ua\/checkout\/pay\/\" method=\"post\" target=\"_blank\"> <input type=\"hidden\" name=\"order\" value=\"${orders[0].order_id}\"> <input type=\"hidden\" name=\"h\" value=\"${orders[0].hash}\"> <span class=\"btn-link btn-link-green account-message-pay-btn\"> <button onclick=\"User.notifications.fireEvent(\'onUnpaidInvoicesPay\');\" class=\"btn-link-i\" type=\"submit\" name=\"pay_order\" amount=\"${orders[0].amount}\">Перейти до&nbsp;оплати<\/button> <\/span> <\/form> {else} <span class=\"btn-link btn-link-green account-message-pay-btn\"> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/profile\/account\" class=\"btn-link-i\" onclick=\"User.notifications.fireEvent(\'onUnpaidInvoicesPay\');\"> Перейти до&nbsp;оплати <\/a> <\/span> {\/if} <a href=\"#\" class=\"novisited account-message-remind-later\" name=\"close\"> Нагадати пізніше <\/a> <\/div>',parent:'social_popup'},cookie:{name:'unpaid_invoices',params:{domain:'rozetka.com.ua',path:'/'}},urls:{remind_later:'https://my.rozetka.com.ua/ua/profile/account/#updateUnpaidInvoicesRemindDateAjax',check:'https://my.rozetka.com.ua/ua/profile/account/#checkUnpaidInvoicesAjax'},data:{}}],_queue_keys:{},_run_started:0,_run_processesed:0,_popup_opened:false,_run_in_process:false,_order_index_in_process:0,initialize:function(user_object,options){this.user=user_object;this.setOptions(options);this.attachToObserver([]);this.queue.sort(function(obj1,obj2){return obj1.order_index-obj2.order_index});this.queue.each(function(item,index){this._queue_keys[item.name]=index}.bind(this))},run:function(options){this._run_started++;if(!this._popup_opened&&!this._run_in_process){this._processQueue()}},_processQueue:function(){if(this._run_processesed<=this._run_started){this._run_in_process=true;if(this.queue[this._order_index_in_process]){this.queue[this._order_index_in_process]['action'](this)}else{this._order_index_in_process=0;this._run_processesed++;this._processQueue()}}else{this._run_in_process=false}},_getParamQueue:function(notification_name,parameter_name){var result;if(this.queue[this._queue_keys[notification_name]]&&this.queue[this._queue_keys[notification_name]][parameter_name]){result=this.queue[this._queue_keys[notification_name]][parameter_name]}return result},_setParamQueue:function(notification_name,parameter_name,data){if(this.queue[this._queue_keys[notification_name]]){this.queue[this._queue_keys[notification_name]][parameter_name]=data}},_cookieGet:function(notification_name){var cookie=this._getParamQueue(notification_name,'cookie'),result;if(cookie&&cookie.name){result=Cookie.get(cookie.name)}return result},_cookieSet:function(notification_name,value){var cookie=this._getParamQueue(notification_name,'cookie');if(cookie&&cookie.name){Cookie.set(cookie.name,value,cookie.params)}},_cookieUnset:function(notification_name){var cookie=this._getParamQueue(notification_name,'cookie');if(cookie&&cookie.name){Cookie.remove(cookie.name,cookie.params)}},_getTime:function(shift){var date=new Date(),time=Math.round(date.getTime()/1000);time=shift?time+shift:time;return time},stop:function(){if(this.popup&&this.popup.isOpened()){this.popup.close()}this.popup=null;this.queue.each(function(item,index){this._cookieUnset(item.name)}.bind(this));this._run_started=0;this._run_processesed=0;this._popup_opened=false;this._run_in_process=false;this._order_index_in_process=0},getPopup:function(notification_name,data){var popup_options=this._getParamQueue(notification_name,'popup');if((!this.popup||this.popup.name!=notification_name)&&$(popup_options.parent)){this.popup=new Popup_class(popup_options.tpl_popup,$(popup_options.parent));this.popup.setOptions({closeOnCOS:false,closeOnEsc:false,holdon:true,single:false});this.popup.name=notification_name;this.popup.addEvent('open',function(){this.fireEvent('onNotificationPopupOpen',{'notification_name':notification_name})}.bind(this));this.popup.addEvent('close',function(){this.fireEvent('onNotificationPopupClose',{'notification_name':notification_name})}.bind(this))}if(this.popup){this.popup.setContent(popup_options.tpl_content||'',data)}return this.popup},onNotificationPopupOpen:function(params){this._popup_opened=true},onNotificationPopupClose:function(params){if(params&&params.notification_name){this._cookieSet(params.notification_name,1);if(params.notification_name=='club_invitation'){this.fireEvent('onClubInvitationClose',{'club_id':this._getClubInvitationData().club.id})}if(params.notification_name=='unpaid_invoices'){this.fireEvent('onUnpaidInvoicesClose')}}this._popup_opened=false},onNotificationPopupSkip:function(params){if(this.popup&&this.popup.isOpened()){this.popup.close()}this.popup=null;this._popup_opened=false;this._order_index_in_process++;this._processQueue()},showConfirmEmailPopup:function(){var notification_name='confirm_email',is_my_mediate=!!'',popup;if(!is_my_mediate&&this.user.isAuth()&&this.user.getProperty('email')&&!this.user.isEmailConfirmed()&&this.user.isCreatedAfterDoubleOptIn()&&!this._cookieGet(notification_name)&&$(this._getParamQueue(notification_name,'popup').parent)){popup=this.getPopup(notification_name);if(popup&&!popup.isOpened()){popup.open()}}else{this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}},showSocialPopup:function(){var notification_name='social_popup',popup;if(location.href!='https://my.rozetka.com.ua/ua/checkout/success/'&&this.user.isAuth()&&!this.user.hasSocialAccount()&&!this._cookieGet(notification_name)&&$(this._getParamQueue(notification_name,'popup').parent)){popup=this.getPopup(notification_name);if(popup&&!popup.isOpened()){popup.open();OAuth2.setOptions({binding:true});OAuth2.update();this.user.bindSocialErrorHandler();document.fireEvent('showHeaderSocialPopup')}}else{this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}if(!this.user.has_event){OAuth2.addEvent('login_success',function(){this.user._loginSuccessSocialPopup()}.bind(this));OAuth2.addEvent('social_unbind',function(){this._cookieUnset(notification_name);if(popup&&popup.isOpened()){popup.close()}}.bind(this));this.user.has_event=true}},showClubInvitationPopup:function(){var notification_name='club_invitation',data=this._getClubInvitationData(),time=this._getTime(),showNotification=false,next_ajax_request_time=0,do_ajax=false,cookie_data=this._cookieGet(notification_name),popup;if(this.user.isAuth()&&this.user.isEmailConfirmed()&&location.href.replace(location.hash,'')!=='https://my.rozetka.com.ua/ua/profile/clubs/'&&$(this._getParamQueue(notification_name,'popup').parent)){showNotification=true}else{this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}if(showNotification){if(cookie_data){switch(cookie_data){case'0':do_ajax=true;break;case'1':if(data.club&&!data.is_joined){this._showPopup(notification_name,{'club':data.club,'is_joined':data.is_joined})}else{do_ajax=true}break;case'2':if(data.club&&data.is_joined){this._showPopup(notification_name,{'club':data.club,'is_joined':data.is_joined})}else{do_ajax=true}break;default:next_ajax_request_time=Math.max(cookie_data,data.next_ajax_request_time);if(!next_ajax_request_time||time>next_ajax_request_time){do_ajax=true}else{this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}}}else{do_ajax=true}}if(do_ajax){new Ajax('/cgi-bin/form.php',{method:'post',headers:{'ajaxAction':this._getParamQueue(notification_name,'urls').check_club_invitation},onComplete:function(resp){var response=new Response_class(resp);if(response.isDone()&&response.content&&(!response.content.remind_after_time||time>response.content.remind_after_time)){this._setParamQueue(notification_name,'data',response.content);this._showPopup(notification_name,{'club':response.content.club,'is_joined':false});this._cookieSet(notification_name,1)}else{this.fireEvent('onClubInvitationClose');this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}response.doAction()}.bind(this),onFailure:function(){this.fireEvent('onClubInvitationClose');this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}.bind(this)}).request()}},_getClubInvitationData:function(){var notification_name='club_invitation',data;if(this.user.S.clubs_data!==undefined){this._setParamQueue(notification_name,'data',this.user.S.clubs_data)}data=this._getParamQueue(notification_name,'data');if(typeof data!=='object'||Object.getLength(data)==0){data={'next_ajax_request_time':0,'remind_interval':86400,'club':null,'is_joined':false}}return data},onClubInvitationClose:function(params){var notification_name='club_invitation',data=this._getClubInvitationData(),next_request_time=this._getTime(data.remind_interval);if(params&&params.club_id){new Ajax('/cgi-bin/form.php',{data:{'club_id':params.club_id,'without_reload':1},method:'post',headers:{'ajaxAction':this._getParamQueue(notification_name,'urls').remind_later},onComplete:function(resp){var response=new Response_class(resp);response.doAction()}.bind(this)}).request()}if(params&&params.next_ajax_request_time){next_request_time=params.next_ajax_request_time}this._cookieSet(notification_name,next_request_time)},onClubInvitationJoin:function(params){var notification_name='club_invitation';if(params&&params.club_id){new Ajax('/cgi-bin/form.php',{method:'post',headers:{'ajaxAction':this._getParamQueue(notification_name,'urls').join_club},data:{'club_id':params.club_id,'without_reload':1},onComplete:function(resp){var response=new Response_class(resp),data=this._getClubInvitationData();if(response.isDone()){if(this.popup&&this.popup.isOpened()){this.popup.close()}if(response.content&&response.content.club){data=response.content;this._showPopup(notification_name,{'club':data.club,'is_joined':true});this._cookieSet(notification_name,2)}response.doAction()}}.bind(this)}).request()}},showUnpaidInvoicesPopup:function(reject_callback){var notification_name='unpaid_invoices',data=this._getUnpaidInvoicesData(),time=this._getTime(),showNotification=false,next_ajax_request_time=0,do_ajax=false,cookie_data=this._cookieGet(notification_name);if(this.user.isAuth()&&location.href.replace(location.hash,'')!=='https://my.rozetka.com.ua/ua/profile/account/'&&location.pathname!=='/checkout/'&&$(this._getParamQueue(notification_name,'popup').parent)){showNotification=true}if(showNotification&&data.orders&&data.orders.length>0){data.orders.each(function(order,order_index){if(order===null||order.expire_time<time){delete data.orders[order_index]}});if(data.orders.length==0){showNotification=false}}if(showNotification){if(cookie_data){switch(cookie_data){case'0':do_ajax=true;break;case'10':if(data.orders&&data.orders.length>0){this._showPopup(notification_name,data)}else{do_ajax=true}break;default:next_ajax_request_time=Math.max(cookie_data,data.options.remind_after_time);if(!next_ajax_request_time||time>next_ajax_request_time){do_ajax=true}else{this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}}}else{do_ajax=true}}else{this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}if(do_ajax){var ajax=new Ajax('/cgi-bin/form.php',{method:'post',headers:{'ajaxAction':this._getParamQueue(notification_name,'urls').check},onComplete:function(resp){var response=new Response_class(resp);if(response.isDone()&&response.content){this._setParamQueue(notification_name,'data',response.content);if(response.content.orders&&response.content.orders.length>0){this._showPopup(notification_name,response.content);this._cookieSet(notification_name,10)}else if(response.content.options&&response.content.options.remind_after_time){this._cookieSet(notification_name,response.content.options.remind_after_time>0?response.content.options.remind_after_time:this._getTime(86400));this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}}if(response.isError()){this._cookieSet(notification_name,this._getTime(86400));this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}response.doAction()}.bind(this),onFailure:function(){this._cookieSet(notification_name,this._getTime(86400));this.fireEvent('onNotificationPopupSkip',{'notification_name':notification_name})}.bind(this)});App.getService('RequestsManager').addRequestToPool(ajax)}},_showPopup:function(notification_name,data){var popup=this.getPopup(notification_name,data);if(popup){popup.open()}},_getUnpaidInvoicesData:function(){var notification_name='unpaid_invoices',data;if(this.user.S.unpaid_orders!==undefined){this._setParamQueue(notification_name,'data',this.user.S.unpaid_orders)}data=this._getParamQueue(notification_name,'data');if(typeof data!=='object'||Object.getLength(data)==0){data={'orders':[],'options':{'remind_after_time':this._getTime(),'remind_interval':86400}}}return data},onUnpaidInvoicesClose:function(){App.trackGTMEvent({'eventCategory':'Interactions','eventAction':'click','eventLabel':'remindLater','eventLocation':'tooltipPayOrder'});var notification_name='unpaid_invoices',data=this._getUnpaidInvoicesData(),next_request_time=this._getTime(data.options.remind_interval);this._cookieSet(notification_name,next_request_time);new Ajax('/cgi-bin/form.php',{method:'post',headers:{'ajaxAction':this._getParamQueue(notification_name,'urls').remind_later},onComplete:function(resp){var response=new Response_class(resp);response.doAction()}.bind(this)}).request()},onUnpaidInvoicesPay:function(){App.trackGTMEvent({'eventCategory':'Interactions','eventAction':'click','eventLabel':'payOrder','eventLocation':'tooltipPayOrder'});var notification_name='unpaid_invoices';this._cookieSet(notification_name,0)}});Notifications_class.implement(new Options,new Events);var RozetkaEvents_class=new Class({Class:'RozetkaEvents_class',events:{'Profile':/^(cart|wishlist|waitlist|personal_info|personal-information\/(popup|comment_block)\/(add|close)|change-password|subscribes|review-request)$/,'Credit':/^(open|click|order)$/,'similar_goods':/.*/,'goods_actions_3d':/.*/,'goods_actions_comment':/^(comment|reply|comment\sfull|rating)$/,'goods_actions_compare':/^(add|delete|\d+)$/,'goods_actions_waitlist':/^add-waitlist$/,'goods_actions_wishlist':/^add-wishlist$/,'goods_actions_video':/^(Closed|Quality|Error|Start|Pause|Resume|VideoEnded|Buffering|Scrub|LeftPage)$/,'goods_actions_overview':/^(open|click)$/,'to_cart':/^(catalog-add|page-add|popup-add|delete|kit-from-cart-add|kit-page-add|kit-delete|promotion-add|not-added)$/,'authorization':/^success$/,'banners_bigpromo':/^(switch|click)$/,'comment_voting':/^(positive|negative)$/,'series':/^(open|click)$/,'social':/^(Вконтакте|Twitter|Facebook|Отправить\sписьмом|vkontakte_paid|review-motivation)$/,'click-list':/.*/,'click-tile':/.*/,'click-new_tile':/.*/,'open-list':/^(open|load)$/,'open-tile':/^(open|load)$/,'open-new_tile':/^(open|load)$/,'Checkout':/^(click|fill|select-type|checkbox|focus|error|color\/product\/order|cart-save)$/,'Success':/^(click|fill|select-type|checkbox|focus|error|color\/product\/order|cart-save)$/,'Coupons':/^(show|try-apply|fail|success|cancel)$/,'Forms':/^(feedback|order-problem)$/,'Special clubs':/^.*$/,'Shop-review':/^(convenience-vote|manager-vote|delivery-vote|payment-vote|submit)$/,'Main':/^.*$/,'Product page':/^.*$/,'Catalog':/^.*$/,'Article':/^.*$/,'News':/^.*$/,'Cart':/^.*$/,'Promotion page':/^.*$/,'Compare':/^.*$/,'SSC':/^.*$/,'Promo birthday':/^.*$/,'Custom page':/^.*$/},section:null,_storage_data:{goods:{},GTM_events:{}},_params:{place:null,category:null,cart_category:null},_checkEvent:function(category,action){if(this.events[category]&&this.events[category].test(action)){var registred=true}else{var registred=false;if(window.console){console.log('Event \''+action+'\' in category \''+category+'\' not registred')}}return registred},trackEvent:function(category,action,opt_label,opt_value,opt_noninteraction){category=category||this.getParam('category');if(this._checkEvent(category,action)){action=action?String(action):null;opt_label=opt_label?String(opt_label):null;opt_value=opt_value?parseInt(opt_value):null;App.trackEvent(category,action,opt_label,opt_value,opt_noninteraction)}},passiveTrackEvent:function(category,action,opt_label,opt_value){this.trackEvent(category,action,opt_label,opt_value,true)},getData:function(type,name){if($defined(this._storage_data[type])){return this._storage_data[type][name]}},setData:function(type,name,value){if($defined(this._storage_data[type])&&name){this._storage_data[type][name]=value}},getGoodsData:function(goods_id){var data;goods_id=goods_id||this.getGoodsId();data=this.getData('goods',goods_id);return data?data.section+'/'+(data.producer||'')+'/'+data.id:goods_id},setGoodsData:function(data){var value={};if(data&&data.id){value.id=data.id;value.section=data.section||data.parent||data.parent_id;value.producer=data.producer||data.producer_id;value.top_section=data.top_section;value.price=data.price;this.setData('goods',value.id,value)}},setSection:function(section){this.section=section},getSection:function(){return this.section},setGoodsId:function(goods_id){this.goods_id=goods_id},getGoodsId:function(){return this.goods_id},setParam:function(name,value){if(this._params[name]!==undefined){this._params[name]=value}else if(window.console){console.log('Events param \''+name+'\' not registred')}},getParam:function(name){return this._params[name]},addTrackingEvent:function(element,event,category,action,opt_label,opt_value,opt_noninteraction){if(this._checkEvent(category,action)){element.addEvent(event,function(e){new Event(e).stop();this.trackEvent(category,action,opt_label,opt_value,opt_noninteraction)}.bind(this))}},trackSocial:function(long_title,short_title){App.trackSocial(long_title,'share');this.trackEvent('social','review-motivation',short_title)}});var RozetkaGTMEvents_class=new Class({Class:'GTMEvents_class',initDataBlocks:function(data_blocks){data_blocks.each(this._setGTMEvents.bind(this))},_setGTMEvents:function(block){var index,action,event_element,event_elements=block.getEventElements();for(index in event_elements){event_element=event_elements[index];action=event_element.action||block.default_action;if(event_element.event_name){this._AddEventToListen(event_element,action,block)}else if(event_element.selector||event_element.object){this._addGTMEvent(event_element,action,block)}}},_addGTMEvent:function(event_object,action,block){var elements=[];if(event_object.object){elements=[event_object.object]}else if(event_object.container&&$(event_object.container)){elements=$(event_object.container).getElements(event_object.selector)}else if(event_object.container&&Array.isArray(event_object.container)){event_object.container.forEach(function(item){elements=elements.concat($(item).getElements(event_object.selector))})}else{elements=$$(event_object.selector)}elements.each(function(elem){elem.addEvent(action,function(e){this._trackGTMEvent(event_object,block,e,elem)}.bind(this))}.bind(this))},_extendGTMEvent:function(block,extender,e,elem){var event=Object.clone(block.base_GTM_event),data_id,type,i;for(i in extender){if((extender.hasOwnProperty(i)&&extender[i].name=='goods_id')||extender[i].name=='kit_id'){data_id=extender[i].value;type=extender[i].name.replace('_id','');delete extender[i];break}}extender.each(function(item){var value;if(this._isValidValue(item.value)){value=item.value}else{value=(item.handler&&typeof item.handler==='function'?item.handler(elem):false)||(item.handler&&(e||window.event)?block[item.handler](e,elem):false)||(typeof item.handlerCallback==='function'?item.handlerCallback(e,elem):false)||(item.handlerID?block[item.handlerID](data_id,type):false)||(e||window.event?block.getDefaultValueByName(item.name,e):false)}if(this._isValidValue(value)){event[item.name]=value}}.bind(this));return event},_isValidValue:function(value){return value||typeof value==='number'},_trackGTMEvent:function(event_object,block,event,elem){event_object=this._extendGTMEvent(block,event_object.extend_event,event,elem);App.trackGTMEvent(event_object,event_object.event?true:false)},_AddEventToListen:function(event_object,action,block){$(document).addEvent(event_object.event_name,function(data){var new_event_object=Object.clone(event_object);if(data&&data.extend_event){data.extend_event.each(function(extender){new_event_object.extend_event.push(extender)})}if(new_event_object.selector){this._addGTMEvent(new_event_object,action,block)}else{this._trackGTMEvent(new_event_object,block,data)}}.bind(this))},trackSocial:function(longName,shortName){document.fireEvent("trackSocial",{extend_event:[{name:"eventContent",value:longName}]})}});var GTMData_BaseAbstract_class=new Class({Class:'GTMData_BaseAbstract_class',options:{GTM:{events:{}},additional:{}},base_GTM_event:{},default_action:'click',default_handler_by_name:{},getDefaultValueByName:function(name,data){var value=null;if(this.default_handler_by_name[name]){value=this[this.default_handler_by_name[name]](name,data)}return value},getEventElements:function(){return this.options.GTM.events},extendBaseEvent:function(event){if(event&&$type(event)=='object'){Object.merge(this.base_GTM_event,event)}},_getDataTitleAttribute:function(target){return(target&&target.nodeName=='IMG'?'title':'data-title')},_getEventTargetText:function(e){var target=(e&&e.target)?e.target:new Event().target;return target.getText().trim()||target.getAttribute(this._getDataTitleAttribute(target))}});GTMData_BaseAbstract_class.implement(new Options());var Cart_class=new Class({Class:'Cart_class',options:{xhrNodes:{},cartURL:'https://my.rozetka.com.ua/ua/cart/'},is_updated:0,initialize:function(options){this.setOptions(options);if(S.checkup)this.onLoadS(S);S.addEvent('loadS4cart',this.onLoadS.bind(this));S.addEvent('loadS',function(S){this.onLoadS(S)}.bind(this))},init:function(id){if(!id){id='cart_block'+$random(0,100000);document.write("<div id='"+id+"'></div>")}this.elem=$(id);if(S.checkup)this.update()},onLoadS:function(S){this.S=$defined(S.cart)?S.cart:{purchases:{},total:0};this._prepareS(S);this.update()},_prepareS:function(S){this.S.quantity=0;this.goods={};var goods_id=null;with(this.S)for(var id in purchases){goods_id=purchases[id].goods.id;if(!$defined(this.goods[goods_id]))this.goods[goods_id]=[];this.goods[goods_id][this.goods[goods_id].length]=purchases[id];this.S.quantity+=purchases[id].quantity}},update:function(){if($defined(this.elem)){this.elem.setHTML(App.getHTML(this.options.tpl,this));for(var name in this.options.activeElements){var elem=this.elem.getElement('[name='+name+']');if(elem){elem.addClass('xhr');var cart=this;elem.addEvent('click',function(e){new Event(e).stop();cart.options.activeElements[this.name]()})}}}this.fireEvent('update');this.is_updated=1},doAction:function(action,catalog_item_or_id,goods_id,quantity,kit_id,unit_goods_ids){if(typeof catalog_item_or_id!='object'){var id_purchase=catalog_item_or_id;var data={};if(id_purchase)data.id=id_purchase;if(goods_id)data.goods_id=goods_id;if(quantity)data.quantity=quantity;if(kit_id)data.kit_id=kit_id;if(unit_goods_ids)data.unit_ids=unit_goods_ids}else{var catalog_item=catalog_item_or_id;data=catalog_item.getDataFromSource()}this._sendRequest(action,data)},_sendRequest:function(action,data){var request=new Ajax('/cgi-bin/form.php');var options={data:data,onComplete:this.onActionComplete.bindAsEventListener(request,action),headers:{ajaxAction:this.options.cartURL+'#'+action}};request.setOptions(options).request()},onActionComplete:function(event,action){var Response=new Response_class(this.response.text);var goods_id=this.options.data.goods_id?this.options.data.goods_id:Cart.getPurchase(this.options.data.id).goods.id;Response.doAction();Cart.fireEvent('actionCompleteForGoods'+goods_id);Cart.fireEvent('actionCompleteForPurchase'+this.options.data.id);App.trackGTMEvent({'eventCategory':'Interactions','eventAction':action,'eventLabel':'Cart','eventProductId':goods_id})},empty:function(){return $defined(this.S)?!this.S.quantity:null},getQuantity:function(id){var result=id?($defined(this.goods[id])?this.goods[id][0].quantity:0):($defined(this.S)?this.S.quantity:0);return parseInt(result)},getCost:function(id){return parseFloat(id?($defined(this.goods[id])?this.goods[id][0].cost:0):this.S.total)},inPurchases:function(id){return $defined(this.goods)&&$defined(this.goods[id])?this.goods[id].length:0},getPurchase:function(id){return this.S.purchases[id]?this.S.purchases[id]:null},addGoods:function(goods_id){this.doAction('add','',goods_id)},deleteGoods:function(goods_id){this.doAction('delete','',goods_id)},clear:function(){this.doAction('clear')},'delete':function(id){this.doAction('delete',id)},edit:function(id,quantity){this.doAction('edit',id,'',quantity)}});Cart_class.implement(new Options,new Events);var CartPopup_class=Popup_class.extend({options:{tpl:'',content:{tpl:''},selectors:{cost:'[name=cost]',submit:'[name=submit]'},form_autofocus:false,process:preloaders.green_process_tpl,level:900,overlay_level:101},_events:['CartRecountCost','CartProcessStart','CartProcessStop'],is_updated:null,_is_locked:false,there_just_added:false,initialize:function(cart_obj){this.cart_obj=cart_obj;this.elem=new Element('div');this._setAsMoadal();document.addEvent('closeOtherPopups',this._onCloseOtherPopups.bind(this));$(document).addEvent('CartActionComplete',function(params){if(/^.*add.*$/i.exec(params.action)){Object.each(Cart.S.purchases,function(purchase){if(purchase.goods.id==params.goods_id&&!purchase.kit_id&&!params.data.kit_id||purchase.kit_id==params.data.kit_id&&purchase.kit_id&&params.data.kit_id){purchase.just_added=true}})}});this.cart_obj.addEvent('update',function(){if(this.isOpened()){this.is_updated=true;this.cart_obj.openCart()}}.bind(this));this.addEvent('open',function(){this.is_updated=false}.bind(this));this.attachToObserver(this._events);return this},init:function(){this.tpl=this.options.tpl;return this},onCartProcessStart:function(){if(this.isOpened()){this.content.processStart(this.options.process)}},onCartProcessStop:function(){if(this.isOpened()){this.content.processStop()}},onCartRecountCost:function(data){var cost=Math.round(data[0]),cost_element=null,submit_element=null;if(this.isOpened()){cost_element=this.content.getElement(this.options.selectors.cost);if(this.form){submit_element=this.content.getElement(this.options.selectors.submit);if(cost!=0){submit_element&&submit_element.removeProperty('disabled')}else{submit_element&&submit_element.setProperty('disabled','disabled')}}cost_element&&cost_element.setText(cost.toString().toPriceFormat())}},getPromotionsData:function(){var promotions=[];this.cart_obj.getVisiblePurchases().each(function(purchase){if(purchase.promotion){promotions[purchase.id]=purchase.promotion}});return promotions},setContent:function(tpl,data){var name,promo=this.getPromotionsData();this.promotion=promo.getLast();if(this.cart_obj.options.show_dark){this.overlayON({styles:{'z-index':this.options.overlay_level}})}this.parent(this.options.content.tpl,this.cart_obj);for(name in this.cart_obj.options.activeElements){var elem=this.content.getElement('[name='+name+']');if(elem){elem.addEvent('click',function(name,e){new Event(e).stop();this.cart_obj[this.cart_obj.options.activeElements[name]]()}.bind(this,name))}}this.form=this.elem.getElement('form');this.form&&this.form.addEvent('submit',this.onSubmit.bind(this));this.there_just_added=this.cart_obj.getJustAddedPurchases().length?true:false},onSubmit:function(e){this.content.processStart(this.options.process);document.fireEvent('goToCheckoutFromCart')},close:function(){if(this._isOpened&&!this.isLocked()){rozetkaEvents.trackEvent(rozetkaEvents.getParam('cart_category'),'proceed/cart/close');document.fireEvent('closeCart');this.parent();this.cart_obj.fireEvent('closeCartPopup',{is_updated:this.is_updated});this.is_updated=false}return this},setLocked:function(flag){this._is_locked=flag},isLocked:function(){return this._is_locked},_updateBody:function(){this.elem.setHTML(App.getHTML(this.tpl,this));this._setCloseControls();this.content=this.getElement('[name=content]');window.addEvent('keydown',function(e){if((new Event(e).key)==='esc'&&this._isOpened&&!this.isLocked()){this.close()}}.bind(this));if(!this._closePopup){this._closePopup=(function(e){if(!this.elem.hasChild(new Event(e).target)&&!this.isLocked())this.close()}).bind(this)}},_setAsMoadal:function(){this.pElem=document.body;this.elem.setStyles({position:'absolute','z-index':this.options.level});this.CheckPos=new CheckPos_class(window,this._posUpdate.bind(this,1));this.addEvent('open',this._posUpdate)}});var RozetkaCartUpdater_class=new Class({options:{check_url:'/cart/action=isActual/',update_url:'https://my.rozetka.com.ua/ua/cart/'+'update/#updateCart',dont_send_request:0},_cart:null,_resp:null,_last_checked_ids:'',_checking_ids:false,_is_cart_actual:true,_stack:{},initialize:function(cart,dont_check_cart){this._cart=cart;this.options.dont_send_request=dont_check_cart},getHigherPrice:function(id){var price=null;if(this._resp&&this._resp.purchases&&this._resp.purchases[id]&&this._resp.purchases[id].higher_price){price=this._resp.purchases[id].higher_price}return price},getCatalogHref:function(){return this._resp&&this._resp.catalog_href},getUnavailablePurchases:function(){var purchases=[];if(this._resp&&this._resp.purchases){Object.each(this._resp.purchases,function(value){if(value&&value.goods){purchases.push(value)}})}return purchases},isCartActual:function(){return this._is_cart_actual},getSimpleUnavailablePurchases:function(){return this.getUnavailablePurchases().filter(function(elem){return!elem.kit})},getSimilarGoods:function(){return this._resp&&this._resp.similar},getSimilarTitle:function(){var title=null;if(this._resp.similar_to){title=this._resp.purchases[this._resp.similar_to].goods.title}return title},updateCart:function(onComplete){var ids=[];this._cart.getPurchases().each(function(purchase){ids.push(purchase.goods.id)});ids.sort();ids=ids.join(',');if(!this.options.dont_send_request&&ids.length&&ids!=this._last_checked_ids){if(!this._stack[ids]){this._stack[ids]=[onComplete]}else{this._stack[ids].push(onComplete)}if(ids!=this._checking_ids){this._checking_ids=ids;this.isActual(this._updateCart.bind(this,ids),this._onFailCheckActual.bind(this,ids))}}else if(!this._checking_ids){onComplete&&onComplete()}},isActual:function(onCompleteCallback,onFailCallback){new Ajax(this.options.check_url,{method:'get',onComplete:onCompleteCallback,onFailure:onFailCallback}).request()},_onFailCheckActual:function(ids,resp){this._checking_ids=false;this._last_checked_ids=ids;this._clearStack(ids)},_updateCart:function(ids,resp){resp=resp&&new Response_class(resp);this._checking_ids=false;this._last_checked_ids=ids;this._is_cart_actual=true;if(resp&&!resp.isDone()){this._is_cart_actual=false;new Ajax('/cgi-bin/form.php',{headers:{ajaxAction:this.options.update_url},onComplete:function(resp){resp=new Response_class(resp);if(resp.isDone()){this._resp=resp.content;resp.doAction();document.fireEvent('cartChecked')}this._clearStack(ids)}.bind(this)}).request()}else{document.fireEvent('cartChecked');this._clearStack(ids)}},clearResponse:function(){this._resp=null},_clearStack:function(ids){while(this._stack[ids]&&this._stack[ids].length){var fn=this._stack[ids].pop();if('function'==typeof fn){fn()}}}});var RozetkaCart_class=Cart_class.extend({Class:'RozetkaCart_class',_kitsScrollerClass:null,options:{in_popup:true,open_in_catalog:'',show_seller:true,xhrNodes:{},cartURL:'',checkoutURL:'',is_buy_from_catalog:false,is_buy_from_credit_popup:false,credit_id:null,message:'',show_dark:false,goods_limit:3,cart_payment_info_id:'cart_payment_info',popups:{goods:'',no_goods:''},scrollers:{kits:{is_optimized:true,container:'[name=kits_scroller_cart]',elemsContainer:'[name=kits_container]',elems:'[name=kits_item]',controls:'[name=kits_control]',circular:true,catalogItemSelector:'td[name=catalog_item]',paginator_elems:'[name="cart_kit_page"]',vector:'horizontal',inject_controls:false,allow_swipe:true},accessories:{container:'[name=accessories_scroller_cart]',elemsContainer:'[name=accessories-container]',elems:'[name=accessories_item]',controls:'[name=accessories_control]',catalogItemSelector:'td[name=catalog_item]',vector:'horizontal',inject_controls:true},similar:{container:'[name=cart_similar_scroller]',controls:'[name=cart_similar_controls]',vector:'horizontal',inject_controls:true},promotions:{container:'[name=promotions_scroller_cart]',elemsContainer:'[name=promotions-container]',elems:'[name=promotions_item]',controls:'[name=promotions_control]',catalogItemSelector:'td[name=catalog_item]',paginator_elems:'[name="cart_promotions_page"]',vector:'horizontal',inject_controls:false}},header_popup:'cart-popup',resize:{width:1024},selectors:{cost:'[name=cost]',cart_best_offer:'[name="cart_best_offer"]'},scroller_class:'RozetkaElementsScroller_class',popup_class:'CartPopup_class',popup_options:{},show_popup:true,allow_show_best_offer:true,tpl:{cart:'',process:'',green_process:'',popup_recaptcha:'<div id=\'captcha\'> <div class=\"protect-capcha-popup popup-css\"> <div name=\"content\"><\/div> <\/div> <\/div>',popup_recaptcha_content:'<form id=\"captcha-form\" data-app-message-block=\"[name=re-captcha-error-msg]\"> <div class=\"protect-capcha-text\"> Натисніть сюди для роботи з сайтом <\/div> <div class=\"protect-capcha-b sprite-side\"> <div class=\"recaptcha\" name=\"recaptcha\" data-sitekey=\"6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU\"><\/div> <\/div> <\/form>'}},_header_popup:null,popup:null,_updater:null,_need_update_cart_after_signin:true,request_queue:{},_promotions:[],_request_delay:1500,_kits_catalog_items:{},http_status_locked:423,_popup_view_mode_available:[1,2],_popup_view_mode:1,initialize:function(options){var cart_view=App.getStorage().get('cart_view');this._updater=new RozetkaCartUpdater_class(this,options.dont_check_cart);this.parent(options);this.addEvent('closeCartPopup',this._restoreKits.bind(this));document.addEvent('showAccessories',function(){var accessories_data=this.getAccessoriesData();if(accessories_data.length){document.fireEvent('sendAccessoriesGTM',{extend_event:[{name:'products',value:accessories_data}]})}}.bind(this));this.attachToObserver(['goodsAddedToCart']);this._popup_view_mode=this.getPopupViewMode()},processStart:function(){this.fireEvent('CartProcessStart')},processStop:function(){this.fireEvent('CartProcessStop')},init:function(id){this.parent(id);this._header_popup=$('cart-popup-block')},opencartByHash:function(){this.openCart();document.fireEvent('openCart')},update:function(){var name=null,elem=null;this.parseRawData();this.initPromotionData();if($defined(this.elem)){this.elem.setHTML(App.getHTML(this.options.tpl.cart,this));for(name in this.options.activeElements){elem=this.elem.getElement('[name='+name+']');elem&&elem.addEvent('click',function(name,e){var fn_name=this.options.activeElements[name];new Event(e).stop();this[fn_name](e)}.bind(this,name))}}this.fireEvent('update');this.is_updated=1;if($defined(this._header_popup)){if(this.getVisiblePurchases().length){this._header_popup.setHTML(App.getHTML(this.options.popups.goods,this))}else{this._header_popup.setHTML(App.getHTML(this.options.popups.no_goods,{auth:User.isAuth()}))}}this.fireEvent('UpdateCartContent',this)},parseRawData:function(){if(this.S.discounts){Object.each(this.S.discounts,function(discount){if(typeof discount.raw_data=='string'){if(discount.raw_data[0]=='{'){discount.raw_data=App.getService('JSON').parse(discount.raw_data)}else{discount.raw_data={price_name:discount.raw_data}}}})}},initPromotionData:function(){if($defined(PricesPromotions)){if(PricesPromotions.isDataInit()){this._onInitPromotionData()}else{PricesPromotions.addEvent("LoadPromotionsData",this._onInitPromotionData.bind(this))}}},_onInitPromotionData:function(){var data=null,cart=this;data=Object.values(PricesPromotions.getPromotionsData());this.getPricesDiscounts().each(function(discount){var promotion=data.filter(function(promotion){return promotion.special_price==discount.raw_data.price_name}).pop();if(promotion){cart.getPurchase(discount.purchase_id).promotion=promotion}})},onActionComplete:function(resp,action,data,onComplete){var Response=new Response_class(resp),goods_ids={},goods_id=data.goods_id,url='',last_purchase=null,dont_open=false,item=null,cart_payment_info=$(this.options.cart_payment_info_id);if(action=='add'){this.options.allow_show_best_offer=false}if(cart_payment_info){cart_payment_info.processStop()}if(!data.goods_id&&Cart.getPurchase(data.id)){goods_id=Cart.getPurchase(data.id).goods.id}if(goods_id){goods_ids[data.id]=goods_id}Object.keys(data.purchases).each(function(id){var goods_id=null;if(Cart.getPurchase(id)){goods_id=Cart.getPurchase(id).goods.id}if(goods_id){goods_ids[id]=goods_id}});if(action=='addAccessories'){for(index in Cart.S.purchases){if(Cart.S.purchases[index].goods.id==goods_id){Response.S.cart.purchases[index].just_added=true}};this.options.allow_show_best_offer=true}Response.doAction();if(onComplete){onComplete(Response,data)}if(!this.isNeedOpenCart()){dont_open=true}if((!this.options.open_in_catalog||window.location.pathname.indexOf("landing-pages")>=0||window.location.pathname.indexOf("news-articles-promotions/promotions")>=0)&&!dont_open){if(Response.isDone()&&goods_id&&data.is_buy_from_catalog&&action=="addAccessories"){for(item in Response.S.cart.purchases){if(Response.S.cart.purchases[item].goods.id==goods_id){url=Response.S.cart.purchases[item].goods.href;break}}location.assign(url+'#cart')}}if(data.is_buy_from_credit_popup&&data.credit_id){location.href=Cart.options.checkoutURL}if(Response.Message&&Response.Message.content){if(Response.content&&Response.content.reason&&(Response.content.reason=='pickupPointRequired'||Response.content.reason=='pickupPointNotAvailable')){document.fireEvent(Response.content.reason,{data:data,content:Response.content,message:Response.Message});dont_open=true}else{this.options.message=Response.Message;if(this.getPopup().isOpened()){this.showMessage(this.options.message)}else{App.showMessage(this.options.message)}}}else{this.options.message=null;if(this.getPopup().isOpened()){this.getPopup().msg.setHTML('')}else{App.fireEvent('newmessage')}}Object.each(goods_ids,function(goods_id,id){Cart.fireEvent('actionCompleteForGoods'+goods_id);Cart.fireEvent('actionCompleteForPurchase'+id);$(document).fireEvent('CartActionComplete',{action:action,goods_id:goods_id,data:data})});if((!data.is_buy_from_catalog||!Response.isDone())&&!data.is_buy_from_credit_popup&&!dont_open){var in_checkout=location.origin+location.pathname==this.options.checkoutURL;if(!data.to_checkout&&!Cart.getPopup().isOpened()&&!in_checkout){Cart.openCart(!Cart.options.in_popup||Cart.getPopup().isOpened())}}if(Response.isDone()&&goods_id&&action=="add"){this.doAction('addAccessories',data.goods_id,data.goods_id)}if(Cart._updateCartList){CartList.options.onActionComplete().bind(CartList)}if(Response.code==Response.CODE.VOID||Response.code==Response.CODE.ERROR){rozetkaEvents.trackEvent('Product page','goods/cart/notadd',rozetkaEvents.getGoodsData())}else{if(action=='add'){if(Cart.goods[goods_id]&&Cart.goods[goods_id][0].promotion&&Cart.goods[goods_id][0].promotion.type.indexOf('special_price')!=-1){for(item in Response.S.cart.purchases){if(Response.S.cart.purchases[item].goods.id==goods_id){last_purchase=Response.S.cart.purchases[item];break}}rozetkaEvents.trackEvent('Special clubs',Cart.goods[goods_id][0].promotion.name,'add/'+(rozetkaEvents.getParam('category')|'')+'/'+last_purchase.section_name)}}}},showMessage:function(message){this.getPopup().msg.setHTML(message.getContentTpl())},getPurchase:function(id){var result=null;if(this.S){result=this.parent(id)}return result},getSellerByPurchaseId:function(id){var purchase=this.getPurchase(id),seller=null;if(purchase&&purchase.seller_id){seller=this.getSeller(purchase.seller_id)}return seller},getSeller:function(seller_id){var seller=null;if(this.options.show_seller&&seller_id&&this.options.show_seller!='0'&&this.S.sellers&&Object.getLength(this.S.sellers)){seller=Object.values(this.S.sellers).filter(function(elem){return parseInt(seller_id,10)===parseInt(elem.seller_id,10)}).pop()}return seller},getPurchases:function(){return this.S?Object.values(this.S.purchases):[]},getExpiredPurchases:function(){return this.getPurchases().filter(this.isPurchaseExpired.bind(this))},isPurchaseExpired:function(purchase){var time_for_paying='5'.toInt()*60;return purchase.expires&&(purchase.expires.toInt()-time_for_paying)<$time()/1000},getVisiblePurchases:function(){return this.getPurchases().filter(function(purchase){return!purchase.service_raw_data})},getPurchasesGroupedByKit:function(){var purchases=this.getPurchases();for(var i=0;i<purchases.length;i++){purchases[i].kit_purchases=[];if(purchases[i].kit_id&&!purchases[i].parent_id){for(var j=0;j<purchases.length;j++){if(i===j||(purchases[i].kit_id==purchases[j].kit_id&&purchases[j].parent_id==purchases[i].id)){purchases[i].kit_purchases.push(purchases[j])}}}}return purchases},getUnitGoodsIdsByKitId:function(kit_id){var purchases=this.getPurchases(),kit_purchases={};for(var i=0;i<purchases.length;i++){if(purchases[i].kit_id&&purchases[i].kit_id==kit_id&&purchases[i].parent_id){kit_purchases[purchases[i].unit_id]=purchases[i].goods.id}}return kit_purchases},isInPopup:function(){return this.options&&this.options.in_popup&&this.getPopup().isOpened()},_getContext:function(){return this.isInPopup()&&this.popup?this.popup.content:document},updateServicesContent:function(){var services={},services_offered,context=this._getContext();this.getVisiblePurchases().each(function(purchase){services=this.getPurchaseServicesFromS(purchase);if(purchase.kit==null&&Object.getLength(services)){if(services_offered=ServicesOffered.getItem('cart',purchase.goods.id)){services_offered.updatePurchaseId(purchase.id);services_offered.updateServicesSelected();services_offered.updateContext(context)}else{services_offered=this.createServicesOfferedItem(purchase,services)}}}.bind(this))},createServicesOfferedItem:function(purchase,services){var data,services_offered,context=this._getContext();if(!(services_offered=ServicesOffered.getItem('cart',purchase.goods.id))&&Object.getLength(services)){data={goods_id:purchase.goods.id,services:services};services_offered=ServicesOffered.createItem(data,context,'cart')}return services_offered},getPurchaseServicesFromS:function(purchase){return Object.values(Object.clone(S.data.services)).filter(function(service){return service.purchase_id==purchase.id})},isPurchasesHasAllowedQuantityServices:function(purchases){var allowed_count=0;if(purchases&&purchases.length){purchases.forEach(function(purchase){var allowed,services_offered=ServicesOffered.getItem('cart',purchase.goods.id),services_item=services_offered&&services_offered.getInitData();if(services_item&&services_item.services&&services_item.services.length){allowed=services_item.services.filter(function(service){return service.allow_select_quantity});allowed_count+=allowed?allowed.length:0}})}return(allowed_count>0)},getJustAddedPurchases:function(added_purchases){var purchases=(added_purchases||this.getVisiblePurchases());return(purchases)?purchases.filter(function(purchase){return purchase&&purchase.just_added}):[]},getOtherPurchases:function(other_purchases){var purchases=(other_purchases||this.getVisiblePurchases());return(purchases)?purchases.filter(function(purchase){return purchase&&!purchase.just_added}):[]},getBasePurchases:function(purchases){return(purchases||this.getVisiblePurchases()).filter(function(purchase){return purchase&&!purchase.unit_id})},getUnitsPurchases:function(parent_purchase_id,purchases){return(purchases||this.getVisiblePurchases()).filter(function(purchase){return purchase&&purchase.unit_id&&(!parent_purchase_id||purchase.parent_id==parent_purchase_id)})},getPopup:function(){var constructor;if(!this.popup){constructor=App.getConstructorByClassName(this.options.popup_class);this.popup=new constructor(this).setOptions(this.options.popup_options).init()}return this.popup},getConvertDataToGTMFormat:function(goods){return{id:goods.id,price_usd:goods.price_usd,title:goods.title,parent_id:goods.parent_id,top_parent_id:goods.top_parent_id,producer_id:goods.producer,tag:$defined(goods.tag)&&$defined(goods.tag.name)?goods.tag.name:null,merchant_id:goods.merchant_id,seller_id:goods.seller_id}},openCart:function(is_open_popup){this.updateCartGoods(function(){this._openCart(is_open_popup)}.bind(this));this.updateCartAccessoryAndKits()},updateCartGoods:function(onComplete){this._updater.updateCart(onComplete)},getHigherPrice:function(id){return this._updater.getHigherPrice(id)},getUnavailablePurchases:function(){return this._updater.getUnavailablePurchases()},isActual:function(){return this._updater.isCartActual()},getUnavailableCatalogHref:function(){return this.empty()&&this._updater.getCatalogHref()},getSimpleUnavailablePurchases:function(){return this._updater.getSimpleUnavailablePurchases()},initUnavailableGoods:function(){var purchases=this.getSimpleUnavailablePurchases();purchases.each(function(purchase){GoodsCatalog.add(purchase.goods.id,'cart_unavailable')})},getSimilar:function(){return this._updater.getSimilarGoods()},getSimilarTitle:function(){return this._updater.getSimilarTitle()},_openCart:function(is_open_popup){this.prepareKits();this.getAccessories().each(function(goods){GTMEventsData.setGoodsData(goods.id,this.getConvertDataToGTMFormat(goods))}.bind(this));this.getVisiblePurchases().each(function(puchase){GTMEventsData.setGoodsData(puchase.goods.id,this.getConvertDataToGTMFormat(puchase.goods));this.createServicesOfferedItem(puchase,this.getPurchaseServicesFromS(puchase))}.bind(this));!is_open_popup&&this.openPopup();this.updateServicesContent();if(this.options.message&&this.getPopup().isOpened()){this.getPopup().msg.setHTML(this.options.message.getContentTpl());this.options.message=null}this.fireEvent('UpdateCartContent',this);document.fireEvent('updateSellerInfoHandlers')},openPopup:function(){if(this.options.show_popup){var popup=this.getPopup();CartList.clearQueue();popup.setContent();popup.open();CartList.delayedAdd();this.initUnavailableGoods();this.initScrollers(popup.content);popup._posUpdate();if(this.empty()){this.fireEvent('InsertRecentGoods')}this.fireEvent('openCart',this)}this.setBestOffer(popup.content)},initScrollers:function(container){this.setKits(container);this.setAccessories(container);this.setPromotions(container);this.setSimilar(container)},getCountAccessories:function(){return this.getAccessories().length},getAccessories:function(){var result=[];if(this.S&&this.S.accessories){result=Object.values(this.S.accessories);var sources=[];Object.each(S.data.accessories,function(item){Object.append(sources,item)});Object.each(result,function(item){item['source']=sources[item.id]['source']})}return result},getCountPromotions:function(){return this.getPromotions().length},getPromotions:function(){return Object.values(this._promotions)},closeCart:function(){if(this.popup){this.popup.close()}},doAction:function(action,catalog_item_or_id,goods_id,quantity,kit_id,unit_goods_ids,unique_request_name,send_delay){var data={},services_data={},options,on_complete_args,cart_payment_info=null;if(typeof catalog_item_or_id!='object'){if(catalog_item_or_id){data.id=catalog_item_or_id}if(goods_id){data.goods_id=goods_id}if(quantity){data.quantity=quantity}if(kit_id){data.kit_id=kit_id}if(unit_goods_ids){data.unit_ids=unit_goods_ids}}else{data=catalog_item_or_id.getDataFromSource()}if(action=='add'&&data.goods_id&&!kit_id){services_data=ServicesOffered.getServicesDataForCart(data.goods_id);data=Object.merge(Object.clone(data),Object.clone(services_data))}if(this.options.is_buy_from_catalog){data.is_buy_from_catalog=this.options.is_buy_from_catalog}if(this.options.is_buy_from_credit_popup&&this.options.credit_id){data.is_buy_from_credit_popup=this.options.is_buy_from_credit_popup;data.credit_id=this.options.credit_id}on_complete_args=[action,data,$defined(catalog_item_or_id.getOnCompleteFn)&&catalog_item_or_id.getOnCompleteFn()];options={data:data,onComplete:this.onActionComplete.bindAsEventListener(this,on_complete_args),headers:{ajaxAction:this.options.cartURL+'#'+action}};var request=new Ajax('/cgi-bin/form.php',options);if(unique_request_name){if(this.request_queue[unique_request_name]&&this.request_queue[unique_request_name]['request']){this.request_queue[unique_request_name]['request'].cancel()}else{this.request_queue[unique_request_name]={};this.request_queue[unique_request_name]['num']=0}this.request_queue[unique_request_name]['request']=request;this.request_queue[unique_request_name]['num']=this.request_queue[unique_request_name]['num']+1}if(send_delay){if(cart_payment_info=$(this.options.cart_payment_info_id)){cart_payment_info.processStart(this.options.tpl.process)}this.submitRequest.delay(send_delay,this,[unique_request_name,this.request_queue[unique_request_name]['num']])}else{request.request();this._updater.clearResponse()}},submitRequest:function(unique_request_name,num){if(this.request_queue[unique_request_name]&&this.request_queue[unique_request_name]['num']==num){this.request_queue[unique_request_name]['request'].request();this._updater.clearResponse()}},addKitGoods:function(goods_id,kit_id,unit_goods_ids){this.doAction('add','',goods_id,'',kit_id,unit_goods_ids)},addKitGoodsFromCart:function(goods_id,kit_id,unit_goods_ids){this._old_kits=this.S.kits;this.doAction('addFromCart','',goods_id,'',kit_id,unit_goods_ids)},addKitGoodsFromPageCart:function(goods_id,kit_id,unit_goods_ids){this._updateCartList=true;this.addKitGoodsFromCart(goods_id,kit_id,unit_goods_ids)},'delete':function(id){var purchase,goods_id=0;this.parent(id);purchase=this.getPurchase(id);if(purchase){goods_id=purchase.goods.id;waitlistElem=this.getWaitlistElemByGoodsId(goods_id);if(waitlistElem){waitlistElem.setStyle('display','block')}}this.fireEvent('deletePurchase',purchase)},'edit':function(id,goods_id,quantity,kit_id,unit_goods_ids,unique_request_name,send_delay){this.doAction('edit',id,goods_id,quantity,kit_id,unit_goods_ids,unique_request_name,send_delay)},getWaitlistElemByGoodsId:function(goods_id){var waitlist_elem=null;GoodsCatalog._catalog.each(function(item){if(item.id==goods_id){waitlist_elem=item.elem.waitlist_details_available}});return waitlist_elem},_prepareS:function(S){this._switchKits(S);this.parent()},_restoreKits:function(){if(this._restore_kits){this.S.kits=this._restore_kits;this._restore_kits=null}},_switchKits:function(S){if(this._old_kits){this.S.kits=this._old_kits;this._old_kits=null;this._restore_kits={};if($defined(S.kits)&&$type(S.kits)!='array'){this._restore_kits=this.groupedKits(S.kits)}}else{this.S.kits={};if($defined(S.kits)&&$type(S.kits)!='array'){this.S.kits=this.groupedKits(S.kits)}}},prepareKits:function(){this._switchKits(S.data)},groupedKits:function(kits_by_base_goods){var kits=[],kit=null,kit_id=0,unit_id,groupedKits={},disabled_purchase_ids=[],accessories={},free_purchases;CartList._catalog.each(function(item){item.is_active||disabled_purchase_ids.push(item.id)});free_purchases=Object.values(this.S.purchases).filter(function(purchase){return!purchase.kit&&$defined(kits_by_base_goods[purchase.goods.id])&&!disabled_purchase_ids.contains(purchase.id)}.bind(this));if(free_purchases.length){free_purchases.sort(function(a,b){var a_just=0,b_just=0;if(a.just_added){a_just=1}if(b.just_added){b_just=1}return(a_just-b_just)||a.price.primary.raw-b.price.primary.raw});kits=kits_by_base_goods[free_purchases.pop().goods.id]}if($defined(Object.values(kits_by_base_goods).pop().id)){kits=kits_by_base_goods}if(!Object.getLength(kits)){return null}for(kit in kits){kit_id=kits[kit]['kit_id'];unit_id=kits[kit]['unit_id'];if(!$defined(groupedKits[kit_id])){accessories={};accessories[unit_id]=this._getAccessoriesForKit(kits[kit]);groupedKits[kit_id]={"id":kit_id,"base_goods_id":kits[kit]['base_goods_id'],"cost_without_kit":kits[kit]['cost_without_kit'],"cost":kits[kit]['cost'],"percent_discount":Math.round(100-kits[kit]['cost']/kits[kit]['cost_without_kit']*100),"is_show_full_discount":kits[kit]['is_show_full_discount'],"kit_percent_discount":kits[kit]['kit_percent_discount'],"kit_discount":kits[kit]['kit_discount'],"accessories":accessories,"count_accessories":1,"base_goods_discount_price":kits[kit]['base_goods_discount_price'],"tag":kits[kit]['tag'],"name_for_block":kits[kit]['name_for_block']}}else{groupedKits[kit_id]["accessories"][unit_id]=this._getAccessoriesForKit(kits[kit]);groupedKits[kit_id]["count_accessories"]++}}return groupedKits},_getAccessoriesForKit:function(kit){var accessories;if(kit.unit_accessories&&Object.keys(kit.unit_accessories).length){accessories=[];Object.each(kit.unit_accessories,function(goods){accessories.push(Object.merge(this._getAccessoryFields(goods),{'unit_id':kit['unit_id'],'goods_discount_price':goods['goods_discount_price'],'goods_percent_discount':goods['goods_percent_discount'],'unit_quantity':goods['unit_quantity'],'similar_kit_id':(goods['similar_kit_id'])?goods['similar_kit_id']:false,'similar_unit_id':(goods['similar_unit_id'])?goods['similar_unit_id']:false,}))}.bind(this))}else{accessories=[Object.merge(this._getAccessoryFields(kit.goods),{"unit_id":kit['unit_id'],"goods_discount_price":kit['goods_discount_price'],"goods_percent_discount":kit['goods_percent_discount'],"unit_quantity":kit['unit_quantity']})];rozetkaEvents.setGoodsData(kit.goods)}return accessories},_getAccessoryFields:function(goods){return{"id":goods['id'],"href":goods['href'],"title":goods['title'],"price":goods['price'],"price_unit":goods['price_unit'],"price_usd":goods['price_usd'],"attachments":goods["attachments"],"sell_status":goods['sell_status']}},setGoodsCatalogForCart:function(goodsCatalog){this._goodsCatalog=goodsCatalog},addKits:function(){var kit_id=null,units=null,kit_number=0;for(kit_id in this.S.kits){units=this.getUnits(kit_id);if($(this._goodsCatalog._id_preff+this.S.kits[kit_id]['base_goods_id'])){kit_number=$(this._goodsCatalog._id_preff+this.S.kits[kit_id]['base_goods_id']).getProperty('_number');if(kit_number!=null){this._goodsCatalog.addKit(this.S.kits[kit_id]['base_goods_id'],kit_id,units,kit_number)}else{this._goodsCatalog.addKit(this.S.kits[kit_id]['base_goods_id'],kit_id,units)}}}},getKitsForGoodsCatalog:function(){var result=[];Object.values(this.S.kits).each(function(kit){var data=Object.clone(kit);data['units']=this.getUnits(data['id']);result.push(data)}.bind(this));return result},checkKits:function(){Object.values(this.S.kits).each(function(kit){if(this.isPricesDiscountApplied(kit['base_goods_id'])){delete this.S.kits[kit['id']]}}.bind(this))},isPricesDiscountApplied:function(base_goods_id){var is_applied=false,purchase,discount;for(purchase in this.S.purchases){if(this.S.purchases[purchase].goods.id==base_goods_id){for(discount in this.S.discounts){if(this.S.discounts[discount].purchase_id==this.S.purchases[purchase].id&&this.S.discounts[discount].discount_module=="Goods.Prices"){is_applied=true}}}}return is_applied},getDiscounts:function(purchase_id,discount_module){return this.S&&Object.values(this.S.discounts).filter(function(discount){return(!discount_module||discount.discount_module==discount_module)&&(!purchase_id||discount.purchase_id==purchase_id)})},getPricesDiscounts:function(purchase_id){return this.getDiscounts(purchase_id,'Goods.Prices')},getNotParentDiscounts:function(purchase_id,discount_module){return Cart.getDiscounts(purchase_id,discount_module).filter(function(discount){return!discount.parent_id})},getUnits:function(kit_id){var accessories=this.S.kits[kit_id]['accessories'],units={},goods;Object.each(accessories,function(unit){goods=unit[0];units[goods.unit_id]=goods.id});return units},getCost:function(id){var cost=0;if(id&&$defined(this.goods[id])){cost=this.goods[id][0].cost_with_discount.primary.decimals}else if(this.S&&this.S.cost_with_discount){cost=this.S.cost_with_discount.primary.decimals}return parseFloat(cost.replace(/\s+/g,''))},getCountKits:function(){return Object.getLength(this.S.kits)},getTitleBaseGoodsByKit:function(){var title='',kit_id=null,base_goods_id=0,purchase=null;for(kit_id in this.S.kits){base_goods_id=this.S.kits[kit_id].base_goods_id;break}for(purchase in this.S.purchases){if(base_goods_id==this.S.purchases[purchase]['goods']['id']){title=this.S.purchases[purchase]['goods']['title']}}return title},isShowFullDiscount:function(purchase_id){var is_show_discount=false;if(this.S.purchases[purchase_id]['parent_id']!=''&&this.S.purchases[this.S.purchases[purchase_id]['parent_id']]['kit']['is_show_full_discount']){is_show_discount=true}return is_show_discount},loadPromotions:function(data){this._promotions=data},getCartListItem:function(id){return CartList._catalog.filter(function(item){return item.id==id}).pop()},setKits:function(container){var scroller_container=container.getElement(this.options.scrollers.kits.container);if(scroller_container){this.addKitsForGoodsCatalog(this.getKitsForGoodsCatalog());scroller_container&&this.setScroll(scroller_container,this.options.scrollers.kits);this._updateKitAccessories(container)}},_updateKitAccessories:function(container){var kit_carousel={},block_position,unit_carousels,unit_goods,unit_id;Object.each(this.S.kits,function(kit){unit_goods={};unit_carousels={};Object.each(kit.accessories,function(unit){block_position++;if(Object.keys(unit).length>1){unit_id=unit[0].unit_id;unit_carousels[unit_id]=new KitCarousel_class(container.getElement('#cart_units_carousel'+unit_id));unit_carousels[unit_id].setOptions({control_size:0,controls_css:{prev:'hidden',next:'hidden'},is_single:true,is_vertical:true,scroll_count:1,container:'[name=carousel_container'+unit_id+']',element:'[name=carousel_element'+unit_id+']'});unit_carousels[unit_id].run();Object.each(unit,function(value,unit_key){var unit_id=(value.similar_unit_id)?value.similar_unit_id:value.unit_id,kit_id=(value.similar_kit_id)?value.similar_kit_id:kit.id;if(!unit_goods[value.unit_id]){unit_goods[value.unit_id]={}}if(!unit_goods[value.unit_id][unit_key]){unit_goods[value.unit_id][unit_key]={}}unit_goods[value.unit_id][unit_key]['id']=value.id;unit_goods[value.unit_id][unit_key]['unit_id']=unit_id;unit_goods[value.unit_id][unit_key]['kit_id']=kit_id})}}.bind(this));kit_carousel[kit.id]=new KitsConstructor_class(this._kits_catalog_items[kit.id],{goods_ids:unit_goods,price_block_id_prefix:'cart_kit_price',code_block_id_prefix:false,from_cart:1});Object.each(unit_carousels,function(carousel,unit_id){carousel.addEvent('slide',function(index,block_position,position,direction){kit_carousel[kit.id].changeCurrentState(index,position);document.fireEvent('carousel_scroll',{extend_event:[{name:'eventPosition',value:block_position},{name:'eventContext',value:((direction=='next')?'down':'up')},{name:'eventLabel',value:'kitCart'},{name:'eventLocation',value:'cart'}]})}.bind(this,unit_id,block_position))})}.bind(this))},addKitsForGoodsCatalog:function(data){window['GoodsCatalog']&&data.forEach(function(kit){var kit_id=kit['id'],base_goods_id=kit['base_goods_id'],units=kit['units'],element=$(GoodsCatalog._id_preff+base_goods_id);if(element){this._kits_catalog_items[kit_id]=GoodsCatalog.addKit(base_goods_id,kit_id,units,element.getProperty('_number'),'cart_kit')}}.bind(this))},setAccessories:function(container){var scroller_container=container.getElement(this.options.scrollers.accessories.container);if(scroller_container){this.addAccessories(this.getAccessories());scroller_container&&this.setScroll(scroller_container,this.options.scrollers.accessories)}},setSimilar:function(container){var similar=this.getSimilar(),scroller_container=container.getElement(this.options.scrollers.similar.container);if(scroller_container&&similar.length){similar.each(function(goods){GoodsCatalog.add(goods.id,'cart_similar_scroll')});this.setScroll(scroller_container,this.options.scrollers.similar)}},addAccessories:function(data){window['GoodsCatalog']&&data.each(function(accessory){GoodsCatalog.add(accessory['id'],'cart_accessories')}.bind(this))},setPromotions:function(container){var scroller_container=container.getElement(this.options.scrollers.promotions.container);scroller_container&&this.setScroll(scroller_container,this.options.scrollers.promotions)},setScroll:function(container,options){var scroller=App.getConstructorByClassName(this.options.scroller_class);scroller&&new scroller(container).setOptions(options).run()},sendChangeServicesOffered:function(service_offered){var data,services_offered_in_cart=ServicesOffered.getItem('cart',service_offered.getGoodsId()),is_need_send_request=services_offered_in_cart?!!this.getPurchase(services_offered_in_cart.getPurchaseId()):false;if(is_need_send_request){data={getDataFromSource:function(){return Object.merge({purchase_id:services_offered_in_cart.getPurchaseId(),in_background:true,to_checkout:false},services_offered_in_cart.getDataForCart())}};this.doAction('editServices',data,null,null,null,null,'ChangeServicesOffered',this._request_delay)}return is_need_send_request},getAccessoriesData:function(){var data=[];if(this.S.accessories){var local_storage_accessories=App.getService('JSON').parse(App.getStorage().get('cart_accessories'))||[];Object.each(this.S.accessories,function(item,position){if(!local_storage_accessories||!local_storage_accessories.contains(item.id)){data.push({productName:item.title_only||item.title,productID:item.id,productCategoryID:item.parent_id,productVendorID:item.producer,productPrice:item.price,productPosition:position,productLocation:'accessories',productSource:item.source,eventProductCategoryGroupId:item.top_parent_id});local_storage_accessories.push(item.id)}});if(data){App.getStorage().set('cart_accessories',JSON.stringify(local_storage_accessories))}}return data},onGoodsAddedToCart:function(data){if(data&&data[0]&&data[0].goods_id){var showCart=function(){S.removeEvent('loadS',showCart);var goods_id=data[0].goods_id,last_added;Object.every(Cart.S.purchases,function(purchase){if(purchase.goods.id==goods_id){last_added=purchase}return true});if(last_added){last_added.just_added=true;Cart.openPopup()}};S.addEvent('loadS',showCart);S.is_renew_sended=false;S.renew()}},isPromoCodeAllowed:function(){return!this.S.is_promo_code_disallowed},getBestOffer:function(){var result;if(this.options.allow_show_best_offer&&S&&S.data.cart&&S.data.cart.best_offer){result=S.data.cart.best_offer}return result},setBestOffer:function(container){var data=this.getBestOffer(),block=container.getElement(this.options.selectors.cart_best_offer);if(window['GoodsCatalog']&&data&&block){GoodsCatalog.add(data.id,'cart_best_offer')}},changePopupMode:function(){var cart_variant;this._popup_view_mode=(this._popup_view_mode===1)?2:1;App.getStorage().set('cart_view',this._popup_view_mode);cart_variant=(this._popup_view_mode===2?'new':'old')+'CartView';if(this._popup_view_mode)document.fireEvent('changePopupView',{extend_event:[{name:'eventLabel',value:cart_variant}]});this._openCart(!this.getPopup().isOpened())},getPopupViewMode:function(without_storage){var cart_view;if(!without_storage){cart_view=App.getStorage().get('cart_view');if(cart_view!==null&&this._popup_view_mode_available.contains(cart_view)&&this._popup_view_mode!==cart_view){this._popup_view_mode=cart_view}}return this._popup_view_mode},isShortViewPopupMode:function(without_storage){return this.getPopupViewMode(without_storage)===2},getKitCodeByKitId:function(kit_id){var i,purchases=this.getVisiblePurchases(),kit_code=[],result='';if(kit_id){kit_code.push(String(kit_id));for(i=0;i<purchases.length;i++){if(purchases[i].kit_id&&purchases[i].kit_id==kit_id){kit_code.push(purchases[i].goods.id)}}if(kit_code.length>2){result=kit_code.join('-')}}return result},isKitFirst:function(purchases){var items;if(purchases===undefined){purchases=this.getVisiblePurchases()}items=this.getBasePurchases(purchases).reverse();return!!(items&&items[0]&&items[0].kit&&this.getUnitsPurchases(items[0].id,purchases).length>0)},updateCartAccessoryAndKits:function(){if(this._need_update_cart_after_signin&&User.auth===1&&Object.keys(this.goods).length>0){this.doAction('addAccessories','');this._need_update_cart_after_signin=false}},isNeedOpenCart:function(){var need_open_cart=true;if(SplitTests.isTestEnabled('ab_opca')&&SplitTests.getVariant('ab_opca')==='new'&&this.getVisiblePurchases().length>this.options.goods_limit){need_open_cart=false}return need_open_cart}});RozetkaCart_class.implement(new Events());var GTMData_BaseProduct_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_BaseProduct_class',options:{GTM:{events:{openWishlistPopup:{event_name:'openWishlistPopup',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'popupWishlist'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},open_profile:{event_name:'clickOpenProfile',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProfile'},{name:'eventLocation',value:'cart'}]},social:{event_name:'clickSocial',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'social'},{name:'eventLocation',value:'cart'}]},openCityPopup:{event_name:'clickToPopupCity',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'cityPopup'},{name:'eventLocation',value:'Head'}]},changeCity:{event_name:'changeCity',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'cityChoose'},{name:'eventLocation',value:'head'}]},check_service:{event_name:'checkService',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'service'},{name:'eventAction',value:'click'},{name:'eventContent',value:'check'}]},uncheck_service:{event_name:'uncheckService',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'service'},{name:'eventAction',value:'click'},{name:'eventContent',value:'uncheck'}]},add_to_comparison:{event_name:'clickAddToCompare',extend_event:[{name:'eventLabel',value:'addToCompare'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventContext',handlerID:'getProductCountComments'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},scroller:{event_name:'scrollerUse',extend_event:[{name:'eventAction',value:'scroll'}]},suggest:{event_name:'suggestShow',extend_event:[{name:'eventAction',value:'show'},{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'suggest'},{name:'eventNoninteraction',value:1}]},goods_title_click:{event_name:'goodsTitleClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProductPage'},{name:'eventContext',value:'title'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventContent',handlerID:'getContent'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},goods_click_goods_in_other_offers_block:{event_name:'goodsOtherOffersGoodsClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProductPage'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},goods_image_click:{event_name:'goodsImageClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openProductPage'},{name:'eventContext',value:'photo'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventContent',handlerID:'getContent'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},toggleVarDetailsDropDown:{event_name:'toggleVarDetailsDropDown',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLocation',value:'ProductPage'},{name:'eventLabel',value:'variantOpen'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},variant_image_click:{event_name:'variantImageClick',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLocation',value:'OtherColorPopUpCatalog'},{name:'eventLabel',value:'openProductPage'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventContext',value:'photo'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventPosition',handlerID:'getPosition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},to_checkout_from_head:{event_name:'goToCheckoutFromHead',extend_event:[{name:'eventLabel',value:'checkout'},{name:'eventLocation',value:'Head'}]},recent_save:{event_name:'clickSaveRecent',extend_event:[{name:'eventLabel',value:'saveRecentHistory'}]},show_recent:{event_name:'showAllRecentGoods',extend_event:[{name:'eventLabel',value:'openRecentHistory'}]},open_category_search:{event_name:'openCategorySearch',extend_event:[{name:'eventLabel',value:'openCategory'},{name:'eventLocation',value:'SearchBar'}]},show_category_search:{event_name:'showCategorySearch',extend_event:[{name:'eventLabel',value:'showCategory'},{name:'eventAction',value:'show'},{name:'eventLocation',value:'SearchBar'}]},search_button:{event_name:'searchButton',extend_event:[{name:'eventLabel',value:'searchButton'},{name:'eventLocation',value:'searchResults'}]},comparison_header:{selector:'[id=comparison]',extend_event:[{name:'eventLabel',value:'comparison'}]},wishlist_header:{event_name:'clickWishlistHeader',extend_event:[{name:'eventLabel',value:'wishlist'}]},enter_profile:{event_name:'enterProfile',extend_event:[{name:'eventLabel',value:'enterProfile'},{name:'eventContext',value:'permanent'}]},choose_compare:{event_name:'chooseCompare',extend_event:[{name:'eventLabel',value:'chooseCompare'}]},profile_menu:{event_name:'profileMenu',extend_event:[{name:'eventLabel',value:'profileMenu'}]},profile:{event_name:'profile',extend_event:[{name:'eventLabel',value:'profile'}]},openBonusesPopup:{event_name:'openBonusesPopup',extend_event:[{name:'eventLabel',value:'openBonusesPopup'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'},{name:'eventNoninteraction',value:1}]},openFlashBonusesPopup:{event_name:'openFlashBonusesPopup',extend_event:[{name:'eventLabel',value:'flashBonuses'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLocation',value:'rozetkaClub ProductPage'}]},useBonuses:{event_name:'useBonuses',extend_event:[{name:'eventLabel',value:'useBonuses'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},enterProfile:{event_name:'enterProfile',extend_event:[{name:'eventLabel',value:'enterProfile'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},openRozetkaClubPage:{event_name:'openRozetkaClubPage',extend_event:[{name:'eventLabel',value:'openRozetkaClubPage'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},wantConfirmPhone:{event_name:'wantConfirmPhone',extend_event:[{name:'eventLabel',value:'wantConfirmPhone'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventContent',handlerID:'getUserPLStatus'},{name:'eventLocation',handlerID:'getPLEventLocation'}]},registration:{event_name:'registration',extend_event:[{name:'eventLabel',value:'registration'},{name:'eventCategory',value:'Conversions'}]},remove:{event_name:'removeFromComparison',extend_event:[{name:'eventLabel',value:'product'},{name:'eventAction',value:'remove'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventLocation',value:'compare'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},closeAuthPopup:{event_name:'closeAuthPopup',extend_event:[{name:'eventLabel',value:'closeAuthPopup'}]},social_signup_success:{event_name:'social_signup_success',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'signup'},{name:'eventLabel',value:'social'}]},more20productCompare:{event_name:'more20productCompare',extend_event:[{name:'eventLabel',value:'more20productCompare'},{name:'eventAction',value:'show'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'}]},carousel_scroll:{event_name:'carousel_scroll',extend_event:[{name:'eventLabel',value:'kit'},{name:'eventAction',value:'scroll'},{name:'eventLocation',value:'ProductPage'},{name:'eventContent',value:'complement'}]},productsImpressions:{event_name:'productsImpressions',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'goods'}]},track_order:{event_name:'trackOrder',extend_event:[{name:'eventLabel',value:'trackOrder'},{name:'eventLocation',value:'head'}]},registrationSuccess:{event_name:'registrationSuccess',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'signup'},{name:'eventLabel',value:'registrationSuccess'}]},sellThisProductClick:{event_name:'sellThisProductClick',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'sellThisProduct'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getAuthorizedUserSellerId'}]},choose_language:{event_name:'languageChoose',extend_event:[{name:'eventLabel',value:'languageChoose'},{name:'eventLocation',value:'Head'}]},goods_click_catalog_review:{event_name:'reviewGoodsClick',extend_event:[{name:'eventLabel',value:'openProductPage'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'},{name:'eventLocation',value:'review'}]},click_catalog_review:{event_name:'reviewClick',extend_event:[{name:'eventLabel',value:'viewReview'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'},{name:'eventLocation',value:'review'}]}}}},base_GTM_event:{eventCategory:'Interactions',eventAction:'click'},storage:null,initialize:function(events_storage_object,options){this.storage=events_storage_object;if(options!==undefined){this.setOptions(options)}if(this.options.additional.base_GTM_event){Object.merge(this.base_GTM_event,this.options.additional.base_GTM_event)}},getProductId:function(id){return parseInt(id,10)},getProductPrice:function(id,type){return this._getPrice(id,type,'price_usd')},getProductRawPrice:function(id,type){var price=this._getPrice(id,type,'price_usd_raw');return(price==null)?this.getProductPrice(id,type):price},getProductSource:function(id,type){var result=this.storage.getGoodsDataField(id,'source',type);return result},getProductTag:function(id,type){return this.storage.getGoodsDataField(id,'tag',type)},getProductTitle:function(id,type){var title_only=this.storage.getGoodsDataField(id,'title_only',type);return title_only?title_only:this.storage.getGoodsDataField(id,'title',type)},getProductCategoryId:function(id,type){var result=this.storage.getGoodsDataField(id,'parent_id',type);if(result){result=parseInt(result,10)}return result},getProducerId:function(id,type){var result=this.storage.getGoodsDataField(id,'producer_id',type);if(result){result=parseInt(result,10)}return result},getProductCondition:function(id,type){return this.storage.getGoodsDataField(id,'state',type)},getProductGroupContextByState:function(id,type){return this.storage.getGoodsDataField(id,'state_group_context',type)},getTopParentId:function(id,type){var result=this.storage.getGoodsDataField(id,'top_parent_id',type);if(result){result=parseInt(result,10)}return result},getPosition:function(id){var position=$E('[name=position_number'+id+']')||$E('[name=slider_pos_number'+id+']'),result=null;if(position&&position.value){result=parseInt(position.value,10)}return result},getTitle:function(e){var target=(e.target||e.srcElement);return target.getText().trim()},getProductCategoryName:function(id,type){return this.storage.getGoodsDataField(id,'parent',type)},getProductCountComments:function(id,type){return this.storage.getGoodsDataField(id,'count_comments',type)},getKitProducts:function(e){var products=[],ids=[],position=1,object,bug_names=['productCategoryId','productCategoryGroupId'],addIds=function(iterable){Object.each(iterable,function(elem){if('object'==typeof elem){addIds(elem)}else if(elem&&parseInt(elem,10)){ids.push(elem)}})};if(e.goods_ids){addIds(e.goods_ids);ids.each(function(id){object={productId:this.getProductId(id),productName:this.getProductTitle(id),productVendorId:this.getProducerId(id),productQuantity:1,position:position++,productMerchantId:this.getMerchantId(id),productSellerId:this.getSellerId(id)};object[bug_names[0]]=this.getProductCategoryId(id);object[bug_names[1]]=this.getTopParentId(id);if(this.getProductRawPrice(id)){object.productPrice=this.getProductRawPrice(id)}products.push(object)}.bind(this))}return products},getContent:function(goods_id){var result=null,content=$$('[name=content_gtm'+goods_id+']')[0];if(content&&content.value){result=content.value}return result},getContext:function(){return User.isAuth()?'existingUser':'newUser'},getSellerId:function(id,type){var result=this.storage.getGoodsDataField(id,'seller_id',type);if(result){result=parseInt(result,10)}return result},getPLEventLocation:function(){var service=App.getService('ProgramLoyalty'),pl_data=null,result;if(service){pl_data=service.getData();result=pl_data['is_header']?'rozetkaClub Head':'rozetkaClub ProductPage'}return result},getUserPLStatus:function(){var service=App.getService('ProgramLoyalty'),result='notAuthorized',pl_data=null;if(service&&User.isAuth()){pl_data=service.getData();if(pl_data){result='Unconfirm';if(pl_data.loyalty_accepted){result=!pl_data.exist_phone?'Unverified':'Active'}}}return result},getMerchantId:function(id,type){var result=this.storage.getGoodsDataField(id,'merchant_id',type);if(result){result=parseInt(result,10)}return result},_getCurrentTargetData:function(data_name){var event=new Event();return event&&event.event.currentTarget&&event.event.currentTarget.data(data_name)},_getPrice:function(id,type,price_field){var result=this.storage.getGoodsDataField(id,price_field,type);if(result){result=parseFloat(result)}return result},getAuthorizedUserSellerId:function(){var seller_id=null;if($defined(User)&&User.getProperty('seller_id')){seller_id=User.getProperty('seller_id')}return seller_id}});var GTMData_Cart_class=GTMData_BaseProduct_class.extend({Class:'GTMData_Cart_class',_internal_options:{GTM:{events:{add_to_wishlist_in_cart:{event_name:'clickToWishlistInCart',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'addToWishlist'},{name:'eventLocation',value:'cart'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getWishlistProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},add_to_order_in_cart:{event_name:'clickAddToOrderInCart',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'buyButton'},{name:'eventLocation',value:'recommendedCart'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductPromo',handlerID:'getProductTag'},{name:'eventContent',handlerID:'getContent'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventProductVendorId',handlerID:'getProducerId'}]},cancel_delete_from_cart:{event_name:'clickCancelDeleteFromCart',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'cancel'},{name:'eventLocation',value:'cart'}]},open_wishlist:{event_name:'clickOpenWishlist',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openWishlist'},{name:'eventContext',handlerID:'getContext'}]},close_wishlist_in_cart:{event_name:'closeWishlistInCart',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'closeWishlist'}]},save_wishlist:{event_name:'clickSaveWishlist',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'saveWishlist'},{name:'eventLocation',value:'cart'}]},show_accessories:{event_name:'sendAccessoriesGTM',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'goods'}]},open_cart:{event_name:'openCart',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openCart'}]},close_cart:{event_name:'closeCart',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'closeCart'}]},add_to_cart:{event_name:'clickToPurchases',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'buyButton'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventProductPromo',handlerID:'getProductTag'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'},{name:'eventContent',handlerID:'getProductSource'}]},add_service_from_cart:{event_name:'addServiceToPurchases',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'buyButton'},{name:'eventAction',value:'click'}]},remove_service_from_cart:{event_name:'removeServiceFromPurchases',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'service'},{name:'eventAction',value:'remove'}]},change_quantity:{event_name:'changeQuantityPurchases',extend_event:[{name:'eventLabel',value:'changeQuantity'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventProductName',handlerID:'getProductTitle'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},delete_from_cart:{event_name:'deleteFromPurchases',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'remove'},{name:'eventLabel',value:'product'},{name:'eventLocation',value:'cart'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'},{name:'products',handler:'getKitProducts'}]},before_delete_from_cart:{event_name:'beforeDeleteFromPurchases',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'remove'},{name:'eventContent',value:location.href},{name:'eventLocation',value:'cart'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'},{name:'eventProductCategoryGroupId',handlerID:'getTopParentId'},{name:'eventProductVendorId',handlerID:'getProducerId'},{name:'eventProductCondition',handlerID:'getProductCondition'},{name:'eventMerchantId',handlerID:'getMerchantId'},{name:'eventSellerId',handlerID:'getSellerId'}]},add_kit_to_cart:{event_name:'clickKitToPurchases',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'buyKit'},{name:'eventLocation',value:'kitCart'},{name:'eventProductId',handlerID:'getProductId'},{name:'eventValue',handlerID:'getProductPrice'},{name:'eventContent',value:'set'},{name:'products',handler:'getKitProducts'}]},to_checkout_from_cart:{event_name:'goToCheckoutFromCart',extend_event:[{name:'eventLabel',value:'checkout'}]},not_added_to_cart:{event_name:'not_added_to_cart',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventLabel',value:'notAdd'},{name:'eventAction',value:'error'},{name:'eventNoninteraction',value:1},{name:'eventProductId',handlerID:'getProductId'},{name:'eventProductCategoryId',handlerID:'getProductCategoryId'}]},continue_shopping:{event_name:'clickContinueShopping',extend_event:[{name:'eventAction',value:'click'},{name:'eventLabel',value:'continueShopping'}]},change_popup_view:{event_name:'changePopupView',extend_event:[{name:'eventAction',value:'switch'},{name:'eventLocation',value:'cartPoup'}]}}}},getWishlistProductPrice:function(id,type){return this._getPrice(id,type,'price_usd_raw')},initialize:function(events_storage_object,options){this.setOptions({GTM:{events:null}});this.setOptions(this._internal_options);this.parent(events_storage_object,options)}});App.addOnDomReady(function(){window['GTMEvents']&&GTMEvents.initDataBlocks([new GTMData_Cart_class(GTMEventsData)])});var ServicesOfferedController_class=new Class({_items:{product_page:{},cart:{}},getItem:function(location,goods_id){return this._items[location][goods_id]?this._items[location][goods_id]:null},createItem:function(data,context,location,options){var services_offered=new ServicesOffered_class(data,context,location,options);this._items[location][services_offered.getGoodsId()]=services_offered;return services_offered},getServicesDataForCart:function(goods_id){return this.getItem('product_page',goods_id)?this.getItem('product_page',goods_id).getDataForCart():{}},getServicesGTMData:function(location,goods_id){return this.getItem(location,goods_id)?this.getItem(location,goods_id).getTotalDataForGTM():{}},clear:function(goods_id){var item=this.getItem('product_page',goods_id);if(item){item.getContainer().getElements(item.options.selectors.service_on).each(function(element){element.removeProperty('checked')})}}});var SourceGoodsStub_class=new Class({data:null,initialize:function(data){this.data=data},getId:function(){return this.data.goods_id},getData:function(){return this.data},getSourceId:function(){return $uid(this)},sourceChange:function(e){this.data=e}});var SourceGoods_class=SourceGoodsStub_class.extend({_events:{'changeServiceFields':'sourceChange'},source_element:null,'id':null,initialize:function(form_id){var parent_construct=this.parent.bind(this);this.source_element=$(form_id);this.source_element.removeProperty('id');this.id=form_id;parent_construct(this._getDataFromSource());for(var event_name in this._events){var callback=this[this._events[event_name]];document.addEvent(event_name+'_'+this.getSourceId(),callback.bind(this))}},getSourceElement:function(){return this.source_element},getId:function(){return this.data.goods_id},getSourceId:function(){return this.id},sourceChange:function(e){this.data=this._getDataFromSource()},_getDataFromSource:function(){var query_string=this.source_element.toQueryString();return App.parseGET(query_string)}});var SourceKit_class=SourceGoods_class.extend({getId:function(){return this.data.goods_id}});var SourceSolution_class=SourceGoods_class.extend({getId:function(){return this.data.goods_id}});var SourcePurchase_class=SourceGoods_class.extend({getId:function(){return this.data.id}});var Catalog_class=new Class({_class:null,_catalog:null,_queueAdd:null,_id_preff:'',checkup:false,is_updated:false,options:{},initialize:function(item_class,id_preff){this._catalog=[];this._queueAdd=[];this._class=item_class;if(id_preff)this._id_preff=id_preff},addEntity:function(entity_type,data_source){var constructor=App.getConstructorByClassName('Source'+entity_type+'_class');var source=new constructor(data_source);var id=source.getId();var i=this._catalog.push(new this._class(id,this._id_preff+id))-1;this._catalog[i].init(this,source);return this._catalog[i]},add:function(id){return this.addEntity('GoodsStub',{'goods_id':id})},addKit:function(id,kit_id,units_ids){return this.addEntity('GoodsStub',{'goods_id':id,'kit_id':kit_id,'unit_ids':units_ids})},update:function(){this._catalog=this._catalog.filter(function(item){return item.isValid()});this._catalog.each(function(item){item.update()});this.is_updated=1},clean:function(){this._catalog=[]},'delete':function(id){var i=0;var len=this._catalog.length;while(i<len){if(this._catalog[i].id===id){this._catalog.splice(i,1);len--}else{i++}}},toQueueAdd:function(id){this._queueAdd.push(id)},delayedAdd:function(){this.is_updated=1;while(this._queueAdd.length>0)this.add(this._queueAdd.shift())},updateBind:function(obj){this.is_updated=obj.is_updated;obj.addEvent('update',this.update.bind(this));return this}});Catalog_class.implement(new Options);var CatalogItem_class=new Class({options:{dynamicElements:{},activeElements:{},onActionStart:Class.empty,onActionComplete:Class.empty,additionalControllers:{}},initialize:function(id,elem){var domElem;this.id=id;if($type(elem)==='string'){domElem=$(elem)}if(domElem){domElem.removeProperty('id');this.elem=domElem}else{App.err('Не найден элемент:',elem)}},isValid:function(){return document.body['contains']?document.body.contains(this.elem):true},init:function(catalog,data_source){if(this.elem){this.setSource(data_source);this.addEvent('delete',catalog['delete'].bind(catalog,this.id));this.setOptions(catalog.options);if(this.options.additionalControllers){this.createControllers()}if(catalog.is_updated){this.update()}}},onActionComplete:function(e){this.process=0;this.fireEvent('onActionComplete')},setSource:function(source){this.source=source},getSource:function(){return this.source},getDataFromSource:function(){return this.source.getData()},'delete':function(){this.elem.remove();this.fireEvent('delete')},update:function(){if(this.elem){this.collectionElements(this.options.dynamicElements,'setDynamic');this.collectionElements(this.options.activeElements,'setActive')}},collectionElements:function(collection,fnName){for(var name in collection){this.elem[name]=this.elem.getElement('[name='+name+']');if($type(this.elem[name])==='element'){if(fnName==='setActive'){this.elem[name].removeEvents()}this[fnName](this.elem[name],collection[name])}}},setDynamic:function(elem,tpl){var html=App.getHTML(tpl,this);if(html.trim().length>0){elem.setHTML(html)}},setActive:function(elem,param){elem.addEvent(param.event?param.event:'click',function(e){e=new Event(e);if(e.type==='click'){e.stop()}if(!this.process&&(!$defined(param.confirm_tpl)||confirm(App.getHTML(param.confirm_tpl,this)))){if(!param.without_request){this.process=1;this.fireEvent('onActionStart',{action:param.action,initiator:elem})}this[param.action](elem)}}.bind(this))},createControllers:function(){Object.each(this.options.additionalControllers,function(data,key){var class_name=data['class'];var constructor=App.getConstructorByClassName(class_name);this.options.additionalControllers[key]=new constructor(this.getSource().getSourceId(),data.options)}.bind(this))}});CatalogItem_class.implement(new Options(),new Events());var Goods_class=CatalogItem_class.extend({Class:'Goods_class',id:null,_flagAddToCart:false,_popupAddToCart:null,options:{open_popup:false,popup_tpl:'',popup_content_tpl:'',overlayON:false,popup_floatingY:true},initialize:function(id,elem){this.parent(id,elem);if(typeof Cart!='undefined'){Cart.addEvent('actionCompleteForGoods'+this.id,this.onActionComplete.bind(this))}if(typeof Comparison!='undefined'){Comparison.addEvent('actionCompleteForGoods'+this.id,this.onActionComplete.bind(this))}if(typeof Waitlist!='undefined'){Waitlist.addEvent('actionCompleteForGoods',this.onActionComplete.bind(this))}if(typeof Wishlists!='undefined'){Wishlists.addEvent('actionCompleteForGoods',this.onActionComplete.bind(this))}},addToComparison:function(){Comparison.addGoods(this.id)},addToWaitlist:function(){Waitlist.addGoods(this.id)},addToWishlist:function(){Wishlists.addGoods(this.id)},deleteFromComparison:function(){Comparison.deleteGoods(this.id)},addToCart:function(){this._flagAddToCart=true;Cart.doAction('add',this)},deleteFromCart:function(){Cart.deleteGoods(this.id)},inCart:function(){return Cart.inPurchases(this.id)},inWaitlist:function(){return Waitlist.inWaitlist(this.id)},inWishlist:function(){return Wishlists.inWishlist(this.id)},deleteFromWishlist:function(){Wishlists.deleteGoods(this.id)},deleteFromWaitlist:function(){Waitlist.deleteGoods(this.id)},inComparison:function(){return Comparison.getGoods(this.id)},isPossibilityToCompare:function(){return Comparison.isPossibilityToCompare(this.id)},onActionComplete:function(e){this.parent();if(this.options.open_popup&&this._flagAddToCart){this._popupAddToCart=new Popup_class(this.options.popup_tpl);this._popupAddToCart.setContent(this.options.popup_content_tpl,{newGoods:Cart.goods[this.id][0],cart:Cart});if(this.options.overlayON){this._popupAddToCart.overlayON()}this._popupAddToCart.setOptions({floatingY:this.options.popup_floatingY});this._popupAddToCart.open()}if(this._flagAddToCart){Cart.fireEvent('goodsAdded');document.fireEvent('goodsAdded')}this._flagAddToCart=false}});var RozetkaGoods_class=Goods_class.extend({_kitid:null,_kit_number:null,unit_goods_ids:{},table_popup:null,hide_wrapper_class:null,options:{tpl_promotion_popup:'<div class=\"popup-css cat-promo-popup\"> <a href=\"#\" class=\"popup-close\" name=\"close\"> <img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"> <\/a> <div name=\"content\"><\/div> <\/div>',tpl_promotion_content:'<h2 class=\"cat-promo-title\">${data.title}<\/h2> <div class=\"cat-promo-g-i-wrapper clearfix\"> <div class=\"cat-promo-i clearfix{if (data.special_price && data.image_for_details) || data.image} cat-promo-mod{\/if}\"> {if data.special_price && data.image_for_details} <div class=\"cat-promo-img\">${data.image_for_details}<\/div> {elseif data.image} <div class=\"cat-promo-img\">${data.image}<\/div> {\/if} <div class=\"cat-promo-desc\">${data.summary}<\/div> <\/div> <\/div> {if data.goods} <h4 class=\"cat-promo-title-small\">В акції беруть участь:<\/h4> {if data.href} <a href=\"${data.href}#promotion_goods\" rel=\"nofollow\" class=\"arrow-link cat-promo-link\"> <span class=\"cat-promo-link-text arrow-link-inner\">Переглянути всі<\/span>&nbsp;&rarr; <\/a> {\/if} <div class=\"cat-promo-g-i-wrapper clearfix\"> {var i=1} {for good in data.goods} <div class=\"cat-promo-g-i\"> <div class=\"cat-promo-g-i-img\"> <a class=\"cat-promo-g-i-img-link\" href=\"${good.url}\"> ${good.image} <\/a> <\/div> <div class=\"cat-promo-g-i-description ${good.sell_status}\"> <div class=\"g-title\"><a href=\"${good.url}\">${good.title}<\/a><\/div> {if good.price} <div class=\"g-price cat-promo-g-i-price\"> <div class=\"g-price-uah\">${good.price.toString().toPriceFormat()}<span class=\"g-price-uah-sign\">&thinsp;${good.unit}<\/span><\/div> <\/div> {\/if} <\/div> <\/div> {var i=i+1} {\/for} <\/div> {\/if} {if data.href} <div class=\"cat-promo-more\"> <a href=\"${data.href}\" class=\"arrow-link novisited\"><span class=\"arrow-link-inner\">Перейти на сторінку акцій<\/span>&nbsp;&rarr;<\/a> <\/div> {\/if}',tpl_variants_content:'{var var_detail = data.var_detail} <div class=\"pp-variants-popup-goods-wrap\"> <div class=\"pp-variants-popup-goods-inner\"> {if data.matched_variants && data.matched_variants.length} {if data.other_fields && data.other_fields.length} <h2 class=\"pp-variants-popup-goods-header\"> ${var_detail.field.title} для варіанта ${data.getVariantsValues(data.active_variant, data.other_fields, \' - \')} <\/h2> {\/if} <div class=\"g-i-table\"> {var i = 0} <div class=\"g-i-tr g-i-tr-fourth\"> {for variant in data.matched_variants} {var i = i + 1} {var field = variant[var_detail.field.name]} {var is_color = Boolean(var_detail.block_type == \'color\' && (field.color || field.image))} {var title = (is_color && field.color == field.value ? variant.ga_goods_data.title : field.value)} ${rozetkaEvents.setGoodsData(variant.ga_goods_data)} <div class=\"g-i-td cat-promo-g-i ${variant.sell_status}\"> {if is_color} <span class=\"g-i-tile-i-variants detail-color-g-i-tile-i-variants\"> {if variant.id != id} <a href=\"${variant.href}\" onclick=\"document.fireEvent(\'preFireVariantClick\', [${var_detail.id}, ${variant.id}, ${i}])\" > {if field.image} <span class=\"pop-up-variants-colors-l-i-link-icon responsive-img\"> ${field.image} <\/span> {else} <span class=\"pop-up-variants-colors-l-i-link-icon{if field.color === \'#FFF\'} variants-gray-icon{\/if}\" style=\"background-color: ${field.color}\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" alt=\"_\"> <\/span> {\/if} <\/a> {else} {if field.image} <span class=\"pop-up-variants-colors-l-i-link-icon responsive-img\"> ${field.image} <\/span> {else} <span class=\"pop-up-variants-colors-l-i-link-icon{if field.color === \'#FFF\'} variants-gray-icon{\/if}\" style=\"background-color: ${field.color}\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" alt=\"_\"> <\/span> {\/if} {\/if} <\/span> {\/if} <div class=\"cat-promo-g-i-img {if field.color}cat-promo-g-i-img-variants{\/if}\"> {if variant.id != id} <a class=\"variants-g-i-img-link responsive-img\" onclick=\"document.fireEvent(\'preFireVariantClick\', [${var_detail.id}, ${variant.id}, ${i}])\" href=\"${variant.href}\" > ${variant.image} <\/a> {else} <span class=\"variants-g-i-img-link responsive-img\">${variant.image}<\/span> {\/if} <\/div> <div class=\"cat-promo-g-i-description\"> {if variant.id != id} <div class=\"g-title\"> <a onclick=\"document.fireEvent(\'preFireVariantClick\', [${var_detail.id}, ${variant.id}, ${i}])\" href=\"${variant.href}\"> ${title} <\/a> <\/div> {else} <div class=\"g-title\"> ${title} <\/div> {\/if} {if variant.price && parseInt(variant.price) !== 0} <div class=\"g-price cat-promo-g-i-price\"> <div class=\"g-price-uah\">${variant.price.toString().toPriceFormat()}<span class=\"g-price-uah-sign\">&thinsp;${variant.unit}<\/span><\/div> <\/div> {\/if} <\/div> <\/div> {if i == 4} <\/div><div class=\"g-i-tr g-i-tr-fourth\"> {var i = 0} {\/if} {\/for} <\/div> <div class=\"g-i-tr g-i-tr-psevdo g-i-tr-fourth\"> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <\/div> <\/div> {if data.other_variants && data.other_variants.length} <h2 class=\"pp-variants-popup-goods-header\"> ${var_detail.field.title} для інших варіантів <\/h2> {\/if} {\/if} {if data.other_variants && data.other_variants.length} <div class=\"g-i-table\"> {var i = 0} <div class=\"g-i-tr g-i-tr-fourth\"> {for variant in data.other_variants} {var i = i + 1} {var field = variant[var_detail.field.name]} {var is_color = Boolean(var_detail.block_type == \'color\' && (field.color || field.image))} {var title = (is_color && field.color != field.value ? field.value : variant.ga_goods_data.title )} <div class=\"g-i-td cat-promo-g-i ${variant.sell_status}\"> {if is_color} <span class=\"g-i-tile-i-variants detail-color-g-i-tile-i-variants\"> <a href=\"${variant.href}\" onclick=\"document.fireEvent(\'preFireVariantClick\', [${var_detail.id}, ${variant.id}, ${i}])\"> {if field.image} <span class=\"pop-up-variants-colors-l-i-link-icon responsive-img\"> ${field.image} <\/span> {else} <span class=\"pop-up-variants-colors-l-i-link-icon{if field.color === \'#FFF\'} variants-gray-icon{\/if}\" style=\"background-color: ${field.color}\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" alt=\"_\"> <\/span> {\/if} <\/a> <\/span> {\/if} <div class=\"cat-promo-g-i-img {if field.color}cat-promo-g-i-img-variants{\/if}\"> <a class=\"variants-g-i-img-link responsive-img\" onclick=\"document.fireEvent(\'preFireVariantClick\', [${var_detail.id}, ${variant.id}, ${i}])\" href=\"${variant.href}\" > ${variant.image} <\/a> <\/div> <div class=\"cat-promo-g-i-description\"> <div class=\"g-title\"> <a href=\"${variant.href}\" onclick=\"document.fireEvent(\'preFireVariantClick\', [${var_detail.id}, ${variant.id}, ${i}])\"> ${data.getVariantsValues(variant, data.all_fields, \' \/ \')} <\/a> <\/div> {if variant.price} <div class=\"g-price cat-promo-g-i-price\"> <div class=\"g-price-uah\">${variant.price.toString().toPriceFormat()}<span class=\"g-price-uah-sign\">&thinsp;${variant.unit}<\/span><\/div> <\/div> {\/if} <\/div> <\/div> {if i == 4} <\/div><div class=\"g-i-tr g-i-tr-fourth\"> {var i = 0} {\/if} {\/for} <\/div> <div class=\"g-i-tr g-i-tr-psevdo g-i-tr-fourth\"> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <div class=\"g-i-td\">&nbsp;<\/div> <\/div> <\/div> {\/if} <\/div> <\/div>',tpl_variants_table_content:'{var var_detail = data.var_detail} {var complex_detail = data.complexdetails[var_detail.field.name]} <h2 class=\"match-t-caption\">${var_detail.text_after_group}<\/h2> <div class=\"match-t-head\"> <div class=\"match-t-head-row\"> <div class=\"match-t-head-cell\">${var_detail.field.title}<\/div> <div class=\"match-t-head-cell\">${complex_detail.title}<\/div> <\/div> <\/div> <div class=\"match-t-b\"> <div class=\"match-t-wrap\"> <div class=\"match-t\"> {for variant in data.matched_variants} {var field = variant[var_detail.field.name]} <a href=\"${variant.href}\" class=\"match-t-row blacklink\" onclick=\"document.fireEvent(\'openProductPage\', {extend_event: [{name: \'goods_id\', value: ${variant.id}}, {name: \'eventContext\', value: \'${field.value}\'}, {name: \'eventContent\', value: \'${var_detail.field.title}\'}, {name: \'eventPosition\', value: ${++variant_index}}]});\"> <div class=\"match-t-cell\"> ${field.value}&thinsp;<span class=\"match-t-cell-sign\">ukr<\/span> <\/div> {if variant[complex_detail.name] && variant[complex_detail.name].value} <div class=\"match-t-cell\"> ${variant[complex_detail.name].value}{if variant[complex_detail.name].unit}&thinsp;<span class=\"match-t-cell-sign\">${variant[complex_detail.name].unit}<\/span>{\/if} <\/div> {else} <div class=\"match-t-cell-empty\"> &nbsp; <\/div> {\/if} <\/a> {\/for} <\/div> <\/div> <\/div> <a href=\"${var_detail.link_after_group}\" target=\"_blank\" class=\"match-t-full-link sprite-both novisited\" name=\"size_table\"> ${var_detail.text_after_group} <\/a>',tpl_variants_table_popup:'<div class=\"popup-css match-t-popup\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div name=\"content\"><\/div> <\/div>',tpl_variants_popup:'<div class=\"popup-css pp-variants-popup-goods\"> <a href=\"#\" class=\"popup-close\" name=\"close\"> <img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"> <\/a> <div name=\"content\"><\/div> <\/div>',variants_data_source:null,variants_target:'Catalog',series_data:false,dynamic_tpl:{},elements:{},container_name:'slider-inner',parent_search_depth:15},initialize:function(id,elem){this.parent(id,elem);this._initEvents();this.table_popup=null},_initEvents:function(){App.addOnDomReady(function(){window.Cart&&Cart.addEvent('closeCartPopup',this.update.bind(this))}.bind(this))},init:function(catalog,source,type){var source_data=source.getData();this.type=type;if(source_data.kit_number){this._kit_number=source_data.kit_number}if(source_data.hide_wrapper_class){this.hide_wrapper_class=source_data.hide_wrapper_class}this.parent(catalog,source)},setDynamic:function(elem,tpl){var name=elem.getProperty('name');this.dynamic_data={};if(name&&typeof this.options.elements[this.type].dynamic[name]=='object'){tpl=this.options.dynamic_tpl[this.options.elements[this.type].dynamic[name].tpl_name];if(this.options.elements[this.type].dynamic[name].additional_data){this.dynamic_data=this.options.elements[this.type].dynamic[name].additional_data;if(this.dynamic_data.is_tile&&this.elem.getProperty('data-view_type')){this.dynamic_data.view_type=this.elem.getProperty('data-view_type')}if(this.dynamic_data.is_tile&&this.elem.getProperty('data-buy_button_type')){this.dynamic_data.buy_button_type=this.elem.getProperty('data-buy_button_type')}}}this.parent(elem,tpl);if(this.dynamic_data.callback){this.dynamic_data.callback(elem)}},getActiveTabName:function(){var tab_to_gtm={characteristics:'specifications'},tab_name='';if(window.rozetkaTabs){tab_name=window.rozetkaTabs.getTabNameForGTM()}return(tab_name&&tab_to_gtm[tab_name])?tab_to_gtm[tab_name]:tab_name},addToComparison:function(e){var gtmData=this.getGTMOptions(e),extend_event={extend_event:[{name:'goods_id',value:this.id}]};if(e.checked==false){Comparison.deleteGoods(this.id)}else{this.parent();if(gtmData['location']){extend_event.extend_event.push({name:'eventLocation',value:gtmData['location']})}this.addGTMPosition(extend_event,this.id,'position_number');extend_event.extend_event.push({name:'eventContent',value:this._getContentGTM()});if(this.elem.hasAttribute('data-position')){extend_event.extend_event.push({name:'eventPosition',value:parseInt(this.elem.getAttribute('data-position'),10)})}extend_event.extend_event.push({name:'eventContext',value:this.getCatalogContext()});this.addGTMField(extend_event,this.id);document.fireEvent('clickAddToCompare',extend_event);rozetkaEvents.trackEvent(null,'goods/compare/add',rozetkaEvents.getGoodsData(this.id))}},togglePromotionPopup:function(){var parent,promotions,prices_promotion;if(this.popup&&this.popup.isOpened()){this.popup.close()}else{promotions=Promotions.getPromotionsData();prices_promotion=this.getCurrentPricesPromotion();this.popup=new Popup_class(this.options.tpl_promotion_popup);if(prices_promotion){this.popup.setContent(App.getHTML(this.options.tpl_promotion_content,{data:prices_promotion}),{})}else{this.popup.setContent(App.getHTML(this.options.tpl_promotion_content,{data:promotions[this.id]}),{})}this.popup.open();this.firePluginEvent('loadContentComplete')}this.onActionComplete();App.fireEvent('renewImages')},openQuickView:function(){this._toggleQuickView();document.fireEvent('QuickViewClick',{extend_event:[{name:'goods_id',value:this.id}]})},openQuickVariants:function(){this._toggleQuickView();document.fireEvent('QuickVariantsClick',{extend_event:[{name:'goods_id',value:this.id}]})},_toggleQuickView:function(){App.getService('QuickView').toggleQuickView(this.id,this.elem.getProperty('data-active-id'));App.getService('QuickView').addEvent('completeToggle',function(){this.onActionComplete()}.bind(this))},hasPromotion:function(){var promotions=Promotions.getPromotionsData(),info=Promotions.getAdditionalText(),info_delivery=Promotions.getAdditionalTextDelivery(),to_return=false;if(!(promotions[this.id]&&promotions[this.id].is_private)&&(promotions[this.id]||info[this.id]||info_delivery[this.id])){to_return=true}return to_return},getGTMOptions:function(elem){var action=elem.getProperty('_action'),gtmLocation,gtmBlock,result={};gtmBlock={'accessories-add':'scroller_accessory','accessories-add-tile':'scroller_accessory','related-add':'scroller_related_products','related-add-vertical':'vertical_scroll','recent-goods-add':'new_recent_goods','software-add':'scroller_software','similar-add':elem.getParentByName('similar_goods_block',15)};gtmLocation={'popup-add':'photo','accessories-add':'accessories','accessories-add-all':'accessories1','accessories-add-tile':'accessories2','related-add':this.getCatalogLocation(),'recent-goods-add':'recent','comparison-add':'compare','specifications':'specifications','software-add':'software','sticky_block_action':this.getActiveTabName(),'portal-popular-add':'popular','lightbox':'photoPopUp','comments_lightbox':'commentPopup','search':'searchResults','similar-add':'similar','recent':'recent','listing':'ProductListing','recommended_recent':'recommendedRecent','accessories_last_purchase':'accessoriesLastPurchase','promo-recent':'recentPromo','best_offer-add':'bestOffer'};result['block']=gtmBlock[action]||null;result['location']=gtmLocation[action]||this.getCatalogLocation();return result},setOnCompleteFn:function(fn){this._on_complete_fn=fn},getOnCompleteFn:function(){var on_complete_fn=this._on_complete_fn;delete this._on_complete_fn;return on_complete_fn},addToCart:function(elem){var goods_id=this.id,gtmOptions=this.getGTMOptions(elem);this.setOnCompleteFn(function(Response,data){var event_data={extend_event:[]},products_data=ServicesOffered.getServicesGTMData('product_page',goods_id);Object.values(products_data).each(function(data,i){products_data[i]=Object.merge(data,{eventLocation:'Service'})});event_data.extend_event.push({name:'goods_id',value:goods_id});products_data.length&&event_data.extend_event.push({name:'eventProducts',value:products_data});if(gtmOptions['location']){event_data.extend_event.push({name:'eventLocation',value:gtmOptions['location']})}else if(this.getCatalogLocation()){event_data.extend_event.push({name:'eventLocation',value:this.getCatalogLocation()})}if(Response.isDone()){if(gtmOptions['block']){this.addGTMPosition(event_data,goods_id,'slider_pos_number',gtmOptions['block'])}this.addGTMField(event_data,goods_id);if(this.elem.hasAttribute('data-position')){event_data.extend_event.push({name:'eventPosition',value:parseInt(this.elem.getAttribute('data-position'),10)})}event_data.extend_event.push({name:'eventContent',value:this._getContentGTM()});event_data.extend_event.push({name:'eventContext',value:this.getCatalogContext()});document.fireEvent('clickToPurchases',event_data)}else{document.fireEvent('not_added_to_cart',event_data)}}.bind(this));App.tryUrchinTracker('/added-to-cart/');this.parent();document.fireEvent('openCart')},addToCartFromCart:function(){var extend_event=[];this.fireEvent('onActionStart');extend_event.push({name:"goods_id",value:this.id});if(this.elem.hasAttribute('_position')!=null){extend_event.push({name:'eventPosition',value:this.elem.getAttribute('_position').toInt()})}if(this.elem.hasAttribute('_source')!=null){extend_event.push({name:'eventContent',value:this.elem.getAttribute('_source')})}document.fireEvent('clickAddToOrderInCart',{extend_event:extend_event});this._flagAddToCart=true;Cart.doAction('add',this)},addKitToCart:function(){var event_data={extend_event:[]},data=this.getSource().getData();if(this._kit_number!=null){event_data.extend_event.push({name:'eventPosition',value:this._kit_number})}event_data.extend_event.push({name:'kit_id',value:data.kit_id},{name:'eventLocation',value:'kit'},{name:'eventContent',value:data['complex']?data['complex']:'complement'});event_data.goods_ids=[this.id,data.unit_ids];document.fireEvent('clickKitToPurchases',event_data);Cart.addKitGoods(this.id,data.kit_id,data.unit_ids);document.fireEvent('openCart')},addToCartByCredit:function(){Cart.options.is_buy_from_credit_popup=true;Cart.options.credit_id=this.elem.getElement('input[name=credit_id]').value;Cart.addGoods(this.id)},addKitFromCart:function(){var event_data={extend_event:[]},source_data=this.getSource().getData();if(this._kit_number!=null){event_data.extend_event.push({name:'eventPosition',value:this._kit_number});rozetkaEvents.trackEvent('Cart','kit/cart/add/'+this._kit_number,rozetkaEvents.getGoodsData())}event_data.extend_event.push({name:'eventLocation',value:'kitCart'},{name:'kit_id',value:source_data.kit_id});event_data.goods_ids=[this.id,source_data.unit_ids];document.fireEvent('clickKitToPurchases',event_data);Cart.addKitGoodsFromCart(this.id,source_data.kit_id,source_data.unit_ids)},addToCartFromCatalog:function(elem){if(Cart.options.open_in_catalog&&window.location.pathname.indexOf("landing-pages")===-1&&window.location.pathname.indexOf("news-articles-promotions/promotions")===-1){this.addToCart(elem);return}var goods_id=this.id;App.tryUrchinTracker('/added-to-cart/');Cart.options.is_buy_from_catalog=true;this.setOnCompleteFn(function(Response){var event_data={extend_event:[]},location=this.getCatalogLocation();event_data.extend_event.push({name:'goods_id',value:goods_id});if(location){event_data.extend_event.push({name:'eventLocation',value:location})}if(Response.isDone()){this.addGTMPosition(event_data,goods_id,'position_number');document.fireEvent('clickToPurchases',event_data)}else{document.fireEvent('not_added_to_cart',event_data)}}.bind(this));Cart.doAction('add',this)},addToCartFromProfileWishlist:function(){var goods_id=this.id;this.setOnCompleteFn(function(Response){var event_data={extend_event:[]};if(Response.isDone()){event_data.extend_event.push({name:'goods_id',value:goods_id});event_data.extend_event.push({name:'eventLocation',value:'wishlist'});document.fireEvent('clickToPurchases',event_data)}});Cart.doAction('add',this)},openCart:function(e){Cart.openCart();document.fireEvent('openCart');this.onActionComplete()},toggleVariants:function(event){if($defined(this.popup)&&this.popup.isOpened()){this.popup.close()}else{this.popup=new Popup_class(this.options.tpl_variants_popup);this.popup.setContent(App.getHTML(this.options.tpl_variants_content,{data:this._getVariantsData(event),target:this.options.variants_target,id:this.id}));this.popup.open();$(document).addEvent('preFireVariantClick',this._fireGtmEventVariantClick.bind(this));App.fireEvent('renewImages');this.firePluginEvent('loadGoodsByPopupColors');rozetkaEvents.trackEvent(rozetkaEvents.getParam('category'),'color/popup/open',rozetkaEvents.getGoodsData(this.id))}this.onActionComplete()},toggleVariantsTable:function(event){var size_table=null,data_for_popup=this.options.variants_data_source.getPopupVariantTableData(this.getFieldFromEvent(event),this.id);if(!this.table_popup){this.table_popup=new Popup_class(this.options.tpl_variants_table_popup,this.elem.getElement('[name=variants-popup-parent]'));this.table_popup.addEvent('open',function(){document.fireEvent('toogleTableSize',{extend_event:[{name:'goods_id',value:this.id},{name:'eventContext',value:'open'},{name:'eventContent',value:data_for_popup.var_detail.field.title}]})}.bind(this));this.table_popup.addEvent('close',function(){document.fireEvent('toogleTableSize',{extend_event:[{name:'goods_id',value:this.id},{name:'eventContext',value:'close'},{name:'eventContent',value:data_for_popup.var_detail.field.title}]})}.bind(this))}this.table_popup.setContent(App.getHTML(this.options.tpl_variants_table_content,{data:data_for_popup,target:this.options.variants_target,id:this.id}));this.table_popup.open();size_table=this.table_popup.content.getElement("a[name=size_table]");size_table&&size_table.addEvent('click',function(event){document.fireEvent('clickSizeTable',{extend_event:[{name:'goods_id',value:this.id},{name:'eventContent',value:data_for_popup.var_detail.field.title}]})}.bind(this));this.onActionComplete()},_getContentGTM:function(){var parent=this.elem.getParentByName(this.options.container_name,this.options.parent_search_depth);return parent&&parent.getElement("[name=content_gtm"+this.id+"]")?parent.getElement("[name=content_gtm"+this.id+"]").value:null},_fireGtmEventVariantClick:function(var_detail_id,variant_id,position){var var_details=this.options.variants_data_source.getVarDetails().findOne('id',var_detail_id),variant=this.options.variants_data_source.getVariants().findOne('id',variant_id),field=variant.hasOwnProperty(var_details.field.name)&&variant[var_details.field.name],gtm={extend_event:[{name:'eventLocation',value:'OtherVariantPopUpProductPage'},{name:'eventPosition',value:parseInt(position)},{name:'eventContent',value:var_details.field.title},{name:'eventContext',value:field&&field.value},{name:'goods_id',value:parseInt(variant.id)}]};document.fireEvent('goodsImageClick',gtm)},getFieldFromEvent:function(event){var target=event&&event.currentTarget;return target&&target.data('field')},_getVariantsData:function(event){return this.options.variants_data_source.getPopupVariantData(this.getFieldFromEvent(event),this.id)},inCart:function(){var key,inCart=false;if($defined(Cart.goods[this.id])){for(key in Cart.goods[this.id]){if(Cart.goods[this.id][key].parent_id==""&&Cart.goods[this.id][key].kit==null){inCart=true}}}return inCart},isEnablePluginClass:function(){return!this.hide_wrapper_class},inCartKit:function(){var inCart=false,source_data=this.getSource().getData(),source_goods_ids=[];if($defined(Cart.goods[this.id])&&source_data['unit_ids']){source_goods_ids=Object.values(source_data['unit_ids']);Object.values(Cart.goods[this.id]).filter(function(item){return(item.kit&&item.kit_id==source_data.kit_id)}.bind(this)).forEach(function(purchase){var count_units=this.getUnitsPurchasesForKit(purchase.id).filter(function(unit_purchase){return(unit_purchase['goods']&&source_goods_ids.contains(unit_purchase['goods']['id'].toInt()))}).length;if(source_goods_ids.length==count_units){inCart=true}}.bind(this))}return inCart},getUnitsPurchasesForKit:function(parent_id){var result=[];Object.values(Cart.goods).each(function(item){Object.values(item).each(function(purchase){if(purchase.parent_id==parent_id){result.push(purchase)}})});return result},getCurrentPricesPromotion:function(){var promotions=null,curent_promotion=null,curentTime=new Date();if(typeof PricesPromotions!="undefined"){promotions=PricesPromotions.getPromotionsData();for(var promotion in promotions){if(S&&S.data.user&&promotions[promotion].special_price&&promotions[promotion].special_price==S.data.user.price_type&&promotions[promotion].end_date>curentTime.getTime()&&promotions[promotion].promo_goods&&promotions[promotion].promo_goods.indexOf(this.id)){curent_promotion=promotions[promotion];break}}}return curent_promotion},update:function(){var promotions=window['Promotions']?Promotions.getPromotionsData():null,CountdownTimer,prices_promotion=this.getCurrentPricesPromotion(),end_date;this.collectionElements(this.options.elements[this.type].dynamic,'setDynamic');this.collectionElements(this.options.elements[this.type].active,'setActive');if(prices_promotion&&!prices_promotion.is_termless){end_date=prices_promotion.end_date}else if(this.elem.promotions_detail&&this.hasPromotion()){if(promotions[this.id]&&!promotions[this.id].is_termless){end_date=promotions[this.id].end_date}}if($('promotion_countdown_timer')&&end_date){CountdownTimer=new CountdownTimer_class('promotion_countdown_timer',end_date,CountdownTimer_class.project_options);CountdownTimer.run()}if(this.elem.promotions_detail&&this.elem.promotions_detail.hasClass('hidden')&&((this.hasPromotion()&&promotions[this.id])||prices_promotion)){this.elem.promotions_detail.removeClass('hidden')}},addToWishlist:function(elem){var location=this.getCatalogLocation(),context=this.getCatalogContext()||'icon',extend=[],eventData;if(location){extend.push({name:'eventLocation',value:location})}if(context){extend.push({name:'eventContext',value:context})}eventData=this.setGTMinfo('gtm_wishlist',elem,extend);if(!App.getService('User').isAuth()){document.fireEvent('openWishlistPopup',eventData)}this.parent()},addToWaitlist:function(elem){var location=this.getCatalogLocation(),extend=[];if(location){extend.push({name:'eventLocation',value:location})}if(Waitlist.isChangePrice(this.id)){extend.push({name:'eventLabel',value:'addToWaitlist'})}this.setGTMinfo('gtm_waitlist',elem,extend);this.parent()},setGTMinfo:function(key,elem,extend){var event_data=App.getStorage().get(key),new_event_data={extend_event:[]},eventLocation=elem.getProperty('_action');if(eventLocation){new_event_data.extend_event.push({name:'eventLocation',value:eventLocation})}new_event_data.extend_event.push({name:'goods_id',value:this.id});this.addGTMPosition(new_event_data,this.id,'position_number');if(key=='gtm_wishlist'){this.addGTMField(new_event_data,this.id);this.addGTMForElem(new_event_data,this.id,'eventContent','content_gtm');this.addGTMForElem(new_event_data,this.id,'eventPosition','slider_pos_number')}if(extend){extend.each(function(item){new_event_data.extend_event.push(item)})}if(event_data!=null&&typeof event_data=='object'){event_data[this.id]=new_event_data}else{event_data={};event_data[this.id]=new_event_data}App.getStorage().set(key,event_data);return new_event_data},addGTMPosition:function(event_data,goods_id,prefix,block){var position;if(block){block=$(block);position=block?block.getElement('[name='+prefix+goods_id+']'):null}else{position=$E('[name='+prefix+goods_id+']')}if(position&&position.value){event_data.extend_event.push({name:'eventPosition',value:parseInt(position.value,10)})}if(block&&block.getProperty('orientation')){event_data.extend_event.push({name:'eventContext',value:block.getProperty('orientation')})}},getCatalogLocation:function(){return this.elem.hasAttribute('data-location')?this.elem.getAttribute('data-location'):null},getCatalogContext:function(){return this.elem.hasAttribute('data-context')?this.elem.getAttribute('data-context'):null},addGTMField:function(event_data,goods_id){var content=this.elem.getElement('[name=num_block'+goods_id+']');if(content&&content.value){event_data.extend_event.push({name:'eventField',value:content.value+' block'})}},addGTMForElem:function(event_data,goods_id,field,name){var content=this.elem.getElement('[name='+name+goods_id+']');if(content&&content.value){event_data.extend_event.push({name:field,value:(field=='eventPosition'?parseInt(content.value,10):content.value)})}},isActive:function(){return this.getDataFromSource().not_active!==undefined?!this.getDataFromSource().not_active:true}});RozetkaGoods_class.implement(new PluginEvents_class());var Purchase_class=CatalogItem_class.extend({id:null,initialize:function(id,elem){this.parent(id,elem);Cart.addEvent('actionCompleteForPurchase'+this.id,this.onActionComplete.bind(this))},onActionComplete:function(e){this.parent(e);if(Cart.getPurchase(this.id)){Cart.fireEvent('purchaseUpdated',this);document.fireEvent('purchaseUpdated',this)}else{Cart.fireEvent('purchaseDeleted',this);document.fireEvent('purchaseDeleted',this)}},Delete:function(){Cart.doAction('delete',this)},Edit:function(initiator){var data=this.source.getData();if(initiator){data.quantity=initiator.value}this.source.sourceChange(data);Cart.doAction('edit',this)},getProperty:function(name){if((Cart.getPurchase(this.id))){return Cart.getPurchase(this.id)[name]}else{this.elem.addClass('hidden')}},getDataFromSource:function(){var data=this.source.getData();if(!data.id&&data.goods_id){data.id=data.goods_id}return data},setActive:function(elem,param){if(!$defined(param.event))param.event='click';switch(param.event){case'change_quantity':{var old_value=elem.value;elem.old_value=elem.value;elem.addEvent('keydown',function(){elem.old_value=elem.value});elem.addEvent('keyup',function(){if(/^(0|[1-9][0-9]{0,}|[1-9]*)$/.exec(elem.value)==null){elem.value=old_value}else if(elem.old_value!=elem.value&&elem.value!=''){if(elem.value!=0||!$defined(param.confirm_tpl)||confirm(App.getHTML(param.confirm_tpl,this))){this.fireEvent('onActionStart',{action:param.action,initiator:elem});this[param.action](elem)}else{elem.value=elem.old_value}}}.bind(this));break}default:{this.parent(elem,param)}}}});var QuantityChanger=new Class({quantity_plus_func:null,quantity_minus_func:null,recount_cost_func:null,on_zero_func:null,restore_quantity_func:null,initialize:function(quantity_plus_func,quantity_minus_func,recount_cost_func,on_zero_func,restore_quantity_func){this.quantity_plus_func=quantity_plus_func;this.quantity_minus_func=quantity_minus_func;this.recount_cost_func=recount_cost_func;this.on_zero_func=on_zero_func;this.restore_quantity_func=restore_quantity_func},onChangeQuantity:function(elem,param){var special_codes={delete_code:46,backspace_code:8,left_code:37,right_code:39},onNotValid=function(el){var fx=new Fx.Styles(el,{duration:400});fx.start({'background-color':'#ffa6a6'}).chain(function(){fx.start({'background-color':'#ffffff'})})},pressed_special_code=false,checkZero=function(){if((/^\d*$/).test(elem.value)&&parseInt(elem.value)==0){this.on_zero_func()}}.bind(this);elem.addEvent('blur',function(){checkZero();this.recount_cost_func()}.bind(this));elem.addEvent('keydown',function(e){var event=new Event(e);pressed_special_code=false;if(event.code==27||event.key=='esc'){event.stop();elem.value=this.restore_quantity_func();elem.blur()}else if(event.code==13||event.key=='enter'){checkZero();event.stop();this.recount_cost_func()}else if(event.code==107||event.code==187||event.key=='+'||event.code==38||event.key=='up'){event.stop();this.quantity_plus_func()}else if(event.code==109||event.code==189||event.key=='-'||event.code==40||event.key=='down'){event.stop();this.quantity_minus_func()}else if(Object.values(special_codes).contains(event.code)){pressed_special_code=true}}.bind(this));elem.addEvent('keypress',function(e){var event=new Event(e);if(!pressed_special_code){if(isNaN(event.key)||(document.getSelection().type!="Range"&&/^(\d){0,3}$/.exec(elem.value+event.key)==null)){event.stop();onNotValid(elem)}}})}});var RozetkaPurchase_class=CatalogItem_class.extend({options:{selectors:{popup_move:'[name=popup-move]',elem_minus:'[name=minus]'},templates:{deleting_coupons:'<div class=\"cart-i-actions-code-alert\"> {if Object.getLength(canceling_coupons) > 1} Прибравши товар з&nbsp;кошика, ви&nbsp;скасуєте знижку <div class=\"cart-i-actions-code-alert-text\"> до <a href=\"#\" name=\"canceling_coupons_link\" class=\"cart-i-actions-code-alert-link close sprite-side novisited\"> <span class=\"xhr\">${Object.getLength(canceling_coupons)} промокодам<\/span><\/a> <div class=\"flex\"> <ul name=\"canceling_coupons_div\" class=\"cart-i-actions-code-alert-l hidden\"> {for coupon in canceling_coupons} <li class=\"cart-i-actions-code-alert-i\">${coupon.title}<\/li> {\/for} <\/ul> <\/div> <\/div> {else} Прибравши товар з&nbsp;кошика, ви&nbsp;скасуєте знижку <div class=\"cart-i-actions-code-alert-text\"> за&nbsp;промокодом {for coupon in canceling_coupons} ${coupon.title} {\/for} <\/div> {\/if} <\/div>'},cartURL:'https://my.rozetka.com.ua/ua/cart/'},id:null,class_name:'RozetkaPurchase_class',is_profile:false,quantity_elem:null,sum_elem:null,old_sum_elem:null,is_active:true,purchase_type:'',_popup_move:null,initialize:function(id,elem){this.parent(id,elem);Cart.addEvent('actionCompleteForPurchase'+this.id,this.onActionComplete.bind(this));Cart.getPopup().addEvent('close',function(){if(Cart.getPurchase(this.id))Cart.getPurchase(this.id).just_added=false}.bind(this))},init:function(catalog,data_source){var _controller=this;this.parent(catalog,data_source);if(this.getProperty('goods').deny_quantity_editing_at_cart!='1'){this.quantity_elem=this.elem.getElement('input[name=quantity]')}else{this.quantity_elem={value:this.getProperty('quantity')}}this.sum_elem=this.getElement().getElement('[name="sum"]');this.old_sum_elem=this.getElement().getElement('[name="old_sum"]');this.absolute_discount_elem=this.getElement().getElement('[name="absolute_discount"]');this.purchase_type=Cart.popup.there_just_added?(this.getProperty('just_added')?'last-goods':'another-goods'):'goods';this.elem.getElements('[name=goods-link]').addEvent('click',function(){var target=this.getElement('img')?'photo':'title';rozetkaEvents.trackEvent(rozetkaEvents.getParam('cart_category'),_controller.purchase_type+'/'+target+'/click',rozetkaEvents.getGoodsData(_controller.getProperty('goods').id))});this._popup_move=this.elem.getElement(this.options.selectors.popup_move)},getElement:function(){return!this.getProperty('kit')?this.elem:this.elem.getParent()},enable:function(){this.is_active=true;var elem=!this.getProperty('kit')?this.elem:this.elem.getParent();elem.addClass('active');this.RecountCost()},RecountCost:function(){var quantity,unrecounted_quantity,catalog_item;quantity=this.getQuantity();if(quantity>=1){this._setActiveElementMinus();if(!this.getProperty('parent_id')){unrecounted_quantity=this.getProperty('quantity');if(this.is_active&&unrecounted_quantity!=quantity){catalog_item={getDataFromSource:function(){return{id:this.id,quantity:quantity,to_checkout:0}}.bind(this)};Cart.edit(catalog_item,null,null,null,null,'sendChangedQuantity',1500)}}}},recountOldSum:function(){var old_sum,kit_price_without_discount,discount;if(!this.getProperty("kit")){kit_price_without_discount=this.getProperty("price").primary.raw}else{if(this.getProperty("kit").price_without_discount){kit_price_without_discount=this.getProperty("kit").price_without_discount}else{discount=Cart.getNotParentDiscounts(this.id,'Goods.Kits').pop();if(discount){kit_price_without_discount=discount.raw_data.cost_without_discount}}}if(kit_price_without_discount){old_sum=Math.round(kit_price_without_discount*this.getQuantity());this.old_sum_elem.setText(old_sum.toString().toPriceFormat());if(this.absolute_discount_elem){this.absolute_discount_elem.setText(Math.round(old_sum-this.getSum()).toString().toPriceFormat())}}},getSum:function(){var sum,kit_price_with_discount;if(!this.getProperty("kit")){sum=this.getProperty("price_with_discount").primary.raw*this.getQuantity()}else{if(!this.getProperty("kit").price_with_discount||this.getProperty("kit").price_with_discount==this.getProperty("price_with_discount").primary.raw){kit_price_with_discount=this.getProperty("kit").costKit/this.getProperty("quantity")}else{kit_price_with_discount=this.getProperty("kit").price_with_discount}sum=kit_price_with_discount*this.getQuantity()}return sum},setSumText:function(text){this.sum_elem.setText(text);this.old_sum_elem&&this.recountOldSum()},QuantityPlus:function(target){var old_is_active=this.is_active;this.is_active&&this.quantity_elem.value++;this.enable();this._setActiveElementMinus();rozetkaEvents.trackEvent(rozetkaEvents.getParam('cart_category'),this.purchase_type+'/quantity/up/'+this.getQuantity()+(old_is_active?'':'-on'),rozetkaEvents.getGoodsData(this.getProperty('goods').id));this.fireQuantityChangedEvent()},_getMinusElement:function(){return this.elem.getElement(this.options.selectors.elem_minus)},_setActiveElementMinus:function(){var quantity=this.getQuantity(),css_class='active',elem=this._getMinusElement();if(quantity>1){!elem.hasClass(css_class)&&elem.addClass(css_class)}else{elem.hasClass(css_class)&&elem.removeClass(css_class)}},QuantityMinus:function(target,flag){var old_is_active=this.is_active;if(this.quantity_elem.value>1){this.quantity_elem.value--}this.enable();this._setActiveElementMinus();rozetkaEvents.trackEvent(rozetkaEvents.getParam('cart_category'),this.purchase_type+'/quantity/down/'+this.getQuantity()+(this.is_active?(old_is_active?'':'-on'):'-off'),rozetkaEvents.getGoodsData(this.getProperty('goods').id));this.fireQuantityChangedEvent()},fireQuantityChangedEvent:function(){var purchase=Cart.S.purchases[this.id],goods_id=purchase.goods.id,quantity=this.getQuantity(),event_data={extend_event:[]};if(purchase.kit_id){event_data.extend_event.push({name:'kit_id',value:purchase.kit_id});event_data.extend_event.push({name:'eventLocation',value:'kit'})}else{event_data.extend_event.push({name:'goods_id',value:goods_id});event_data.extend_event.push({name:'eventLocation',value:'cart'})}event_data.extend_event.push({name:'eventContext',value:quantity});document.fireEvent('changeQuantityPurchases',event_data)},Delete:function(){var purchase=Cart.getPurchase(this.id),event_data={extend_event:[]};if(purchase){if(purchase.kit_id){var unit_goods_ids=Cart.getUnitGoodsIdsByKitId(purchase.kit_id);event_data.extend_event.push({name:'eventLabel',value:'kit'});event_data.extend_event.push({name:'kit_id',value:purchase.kit_id});event_data.goods_ids=[purchase.goods.id,unit_goods_ids]}else{event_data.extend_event.push({name:'eventLabel',value:'product'});event_data.extend_event.push({name:'goods_id',value:purchase.goods.id});event_data.extend_event.push({name:'eventValue',handlerID:'getProductPrice'})}document.fireEvent('deleteFromPurchases',event_data);Cart['delete'](this.id)}},getProperty:function(name){return Cart.getPurchase(this.id)?Cart.getPurchase(this.id)[name]:null},getHigherPrice:function(){return Cart.getHigherPrice(this.getProperty('goods').id)},getUnitsPurchases:function(){return Cart.getUnitsPurchases(this.id)},getSeller:function(){return Cart.getSellerByPurchaseId(this.id)},inWishlist:function(){return Wishlists.inWishlist(this.getProperty('goods').id)},update:function(){if(Cart.getPurchase(this.id)){this.elem.setHTML(App.getHTML(this.options.dynamicElements.content,this));this.collectionElements(this.options.activeElements,'setActive')}},isShowDiscount:function(){return Cart.isShowFullDiscount(this.id)},getQuantity:function(){return $defined(this.quantity_elem)?this.quantity_elem.value:0},setActive:function(elem,param){if(!$defined(param.event))param.event='click';switch(param.event){case'change_quantity':{var quantity_changer=new QuantityChanger(this.QuantityPlus.bind(this),this.QuantityMinus.bind(this),this.RecountCost.bind(this),this.onZeroQuantity.bind(this),this.restoreQuantity.bind(this));quantity_changer.onChangeQuantity(elem,param);break}default:{this.parent(elem,param)}}},onZeroQuantity:function(){this.fireEvent('onActionStart');this.Delete()},restoreQuantity:function(){return Cart.getPurchase(this.id).quantity},beforeDelete:function(){document.fireEvent('beforeDeleteFromPurchases',{extend_event:[{name:'goods_id',value:this.getProperty('goods').id}]});CartList._catalog.each(function(elem){if(elem!==this&&elem._popup_move&&elem._popup_move.isVisible()){elem._popup_move.hide()}}.bind(this));this._popup_move.show();var promo_block=this._popup_move.getElement('div[name=promocode_state]');if(promo_block){promo_block.addClass('cart-i-actions-preloader');promo_block.innerHTML='';promo_block.processStart(preloaders.process_tpl);new Ajax('/cgi-bin/form.php',{data:{"goods_id":this.getProperty('goods').id},method:'POST',onComplete:this._onPromotionComplite.bind(this),headers:{ajaxAction:this.options.cartURL+'#checkRemovingCoupons'}}).request()}this.onActionComplete()},_onPromotionComplite:function(e){var response=new Response_class(e);var promocode_state=this._popup_move.getElement('div[name=promocode_state]');promocode_state.removeClass('cart-i-actions-preloader');promocode_state.processStop();if($defined(response.content.canceling_coupons)&&Object.getLength(response.content.canceling_coupons)>0){promocode_state.innerHTML=App.getHTML(this.options.templates.deleting_coupons,response.content);promocode_state.getElements('[name=canceling_coupons_link]').addEvent('click',function(e){new Event(e).stop();var elem=promocode_state.getElement('[name=canceling_coupons_div]');if(elem){this.toggleClass('close');elem.toggle()}})}},_hideCartOverlay:function(){if(Cart.getPopup()._overlay){Cart.getPopup()._overlay._elem.setStyle('z-index',Cart.getPopup().options.level+1)}},_showCartOverlay:function(){if(Cart.getPopup()._overlay){Cart.getPopup()._overlay._elem.setStyle('z-index',Cart.getPopup().options.overlay_level)}},_updateCart:function(){Cart.getPopup().setLocked(true);this._hideCartOverlay()},move:function(){var wishlists=App.getService('Wishlists'),goodsId=this.getProperty('goods').id;if(!wishlists){throw new Error('Wishlists not loaded')}Cart.getPopup().setLocked(true);wishlists.addGoodsPromise(goodsId).then(function(){Cart.deleteGoods(goodsId);this.restoreCart()}.bind(this)).catch(this.restoreCart.bind(this))},restoreCart:function(){Cart.getPopup().setLocked(false);this.onActionComplete()},cancel:function(){this._popup_move.hide();document.fireEvent('clickCancelDeleteFromCart');this.onActionComplete()},isShortViewPopupMode:function(){return Cart.getPopupViewMode(true)===2}});var Suggest_class=new Class({options:{source:null,tpl:'',styles:{},url:'/cgi-bin/form.php'},_is_opened:false,initialize:function(){this._currentValue='';this._history={};this._suggest=null;this.elem=new Element('div')},init:function(input){this.input=$(input).addEvent('focus',this.onFocus.bind(this)).addEvent('keydown',this.onKeyDown.bind(this)).addEvent('keyup',this.onKeyUp.bind(this));this.input.getParent().addEvent('click',function(e){new Event(e).stop()});$E('body').addEvent('click',this.onBlur.bind(this));this.elem.setStyles({position:'absolute','margin-top':this.input.getSize().size.y});if(this.options.styles){this.elem.setStyles(this.options.styles)};this.elem.injectBefore(this.input)},onFocus:function(e){this._currentValue=this.input.value;if(this._suggest)this._show()},onBlur:function(e){this._hide()},onKeyDown:function(e){e=new Event(e);if(e.key=='up'||e.key=='down'){e.stop();this._moveActive(e.key=='up'?-1:1)}else if(e.key=='enter'&&this._suggest&&this._suggest.key!==null){e.stop();this._enterActive(this._suggest.key)}else if(e.key=='esc'){this.input.value='';this._checkChanges(false)}else if(e.key=='tab'){this._hide()}},onKeyUp:function(e){if(this.input.value!==this._currentValue){this._currentValue=this.input.value;this._checkChanges.delay(333,this,[this.input.value])}},_scroll:function(){var current_min,current_max,key=this._suggest.key+1,ul=this.elem.getElement('ul'),length=this._suggest.elems.length;current_min=Math.round(ul.scrollTop/this.options.scroll_settings.height_by_step);current_max=current_min+this.options.scroll_settings.count_elements_in_block;if(key===1){ul.scrollTo(0,0)}else if(key===length){ul.scrollTo(0,this.options.scroll_settings.height_by_step*(key-this.options.scroll_settings.count_elements_in_block))}else if(key>current_max){ul.scrollTo(0,ul.scrollTop+this.options.scroll_settings.height_by_step)}else if(key<=current_min){ul.scrollTo(0,ul.scrollTop-this.options.scroll_settings.height_by_step)}},_markupSuggestion:function(el){var et_regex=new RegExp('(^'+this.input.value+')','i');return el.setHTML(el.getText().replace(et_regex,'<span class="queriedValue">$1</span>'))},_moveActive:function(shift){with(this._suggest){this._setActive(key==null?(shift<0?elems.length-1:0):(0<=key+shift&&key+shift<=elems.length-1?key+shift:null))}},_setActive:function(k){this._suggest.key=k;with(this._suggest){if(active)active.removeClass('active');active=key!==null?elems[key].addClass('active'):null}},_enterActive:function(k){window.location=this._suggest.records[k].href},_show:function(){this.elem.setStyle('display','');this._is_opened=true},_hide:function(){this.elem.setStyle('display','none');this._is_opened=false},isOpened:function(){return this._is_opened},_checkChanges:function(value){if(!$type(value)&&this.input.value==''){this._hide()}else if(value==this.input.value){$defined(this._history[this.input.value])?this._suggestion(this.input.value):this._getSuggest(this.input.value)}},_suggestion:function(test){this._suggest=$extend({elems:[],key:null,active:null},this._history[test]);this.elem.setHTML(this._suggest.html);this._show();if(this._suggest.count){this._suggest.records.each(function(item,key){this._suggest.elems.include(this.elem.getElement('[name='+key+']').addEvent('mousemove',this._setActive.bind(this,key)).addEvent('click',this._enterActive.bind(this,key)))}.bind(this));var show_all=this.elem.getElement('[name=show-all]');if(show_all){show_all.form=this.input.form;show_all.addEvent('click',function(e){new Event(e).stop();show_all.form.submit()})}}},_getSuggest:function(test){var options={headers:{ajaxAction:this.options.source},data:{},onSuccess:this._setSuggest.bind(this),onComplete:this._suggestion.bind(this,test)};options.data[this.input.name]=test;options.data['suggest']=1;new Ajax(this.options.url,options).request()},_setSuggest:function(resp){var Response=new Response_class(resp);Response.doAction();if(!Response.isError()){this._history[Response.content.text]=$extend({html:App.getHTML(this.options.tpl,Response.content)},Response.content)}},_compareStrings:function(a,b){if(a>b){return 1}else if(a<b){return-1}else{return 0}}});Suggest_class.implement(new Options);var RozetkaSuggest_class=Suggest_class.extend({initialize:function(){this.parent();this.attachToObserver([])},_setSuggest:function(resp){this.parent(resp);var Response=new Response_class(resp);this.pushToGA(Response.content.records);this.pushToGTM(Response.content.records)},pushToGA:function(goods_records){var goods_gtm_data=[];for(var i=0;i<goods_records.length;i++){goods_gtm_data.push({test:goods_records[i].test,eventProductName:goods_records[i].title_only||goods_records[i].title,eventProductId:goods_records[i].id,eventProductPrice:goods_records[i].price_usd_clear,eventProductVendorName:goods_records[i].producer,eventCategoryName:goods_records[i].parent,eventList:goods_records[i].list,eventPosition:goods_records[i].position})}document.fireEvent('suggestShow',{extend_event:[{name:'suggestImpressions',value:goods_gtm_data}]})},pushToGTM:function(goods_records){var gtmdata=[];Object.values(goods_records).each(function(record){gtmdata.push({id:parseInt(record.id),parent_id:parseInt(record.parent_id),top_parent_id:parseInt(record.top_parent_id),producer_id:parseInt(record.producer_id),price_usd:parseInt(record.price_usd_clear),rank:record.rank,type:record.type,part:record.part})});this.fireEvent('LoadGTMData',gtmdata)}});RozetkaSuggest_class.implement(new Events());var SearchSuggest_class=RozetkaSuggest_class.extend({options:{source:'',catalog:'',default_source:'https://rozetka.com.ua/ua/search/',default_catalog:'',tpl:'',url:'/cgi-bin/search-form.php',selectors:{button:'[name=search-button]',text:'input[name=text]',form:'form[name=search-form]',suggest_container:'[name=header-search-suggest-container]',category:{element:'input[name=section_id]',value:'[name=search-category-value]',link:'[name=search-category]'},list:{container:'[name=search-category-list]',item:'[name=search-category-list-item]'}},cssClasses:{classHidden:'hidden',classActive:'active'},attributes:{section_id:'section_id'},styles:{position:'absolute',width:'100%'}},_textWrap:null,_container:null,_button:null,input:null,_form:null,_list:null,_category_element:null,_category_value:null,_categories:[],initialize:function(container){if(container){this._container=container}this.parent()},init:function(input){var suggest_container;this._form=this._container.getElement(this.options.selectors.form);this._category_element=this._container.getElement(this.options.selectors.category.element);this._category_value=this._container.getElement(this.options.selectors.category.value);this.input=this._form.getElement(this.options.selectors.text).addEvent('focus',this.onFocus.bind(this)).addEvent('keydown',this.onKeyDown.bind(this)).addEvent('keyup',this.onKeyUp.bind(this));this.input.getParent().addEvent('click',function(e){new Event(e).stop()});$E('body').addEvent('click',this.onBlur.bind(this));if(this.options.styles){this.elem.setStyles(this.options.styles)}suggest_container=this._form.getElement(this.options.selectors.suggest_container);if(suggest_container){this.elem.inject(suggest_container)}this._button=this._form.getElement(this.options.selectors.button);this._form.getElement(this.options.selectors.category.link).addEvent('click',this._showCategoryList.bind(this));this._list=this._container.getElement(this.options.selectors.list.container);this._categories=this._list.getElements(this.options.selectors.list.item);this._categories.each(function(element){element.addEvent('click',this._setActiveCategory.bind(this))}.bind(this))},_setActiveCategory:function(e){var item=e.target.getParent(),text=e.target.innerHTML,gtm_events=[];new Event(e).stop();this._categories.each(function(elem){if(elem.hasClass(this.options.cssClasses.classActive)){elem.removeClass(this.options.cssClasses.classActive)}}.bind(this));item.addClass(this.options.cssClasses.classActive);if(item.hasAttribute(this.options.attributes.section_id)){this._category_element.disabled=false;this._category_element.value=item.getAttribute(this.options.attributes.section_id);this._form.action=this.options.catalog!='null'?this.options.catalog:this.options.default_catalog;gtm_events.push({name:'eventProductCategoryId',value:this._category_element.value})}else{this._form.action=this.options.source;this._category_element.disabled=true}this._category_value.innerHTML=text;this._hideCategoryList();if(this.input.value!=this.input.getAttribute('hint')){this._getSuggest(this.input.value)}this._moveCursorToEnd(this.input);gtm_events.push({name:'eventPosition',value:this._categories.indexOf(item)+1});document.fireEvent('openCategorySeach',{extend_event:gtm_events})},_moveCursorToEnd:function(el){if(!el.focus){el.focus()}el.selectionStart=el.selectionEnd=el.value.length},_showCategoryList:function(e){new Event(e).stop();if(this._list.hasClass(this.options.cssClasses.classHidden)){this._hide();this._list.show()}else{this._list.hide()}document.fireEvent('showCategorySearch')},_hideCategoryList:function(){this._list.hide()},onFocus:function(e){this.parent();this._hideCategoryList();this._form.addClass(this.options.cssClasses.classActive)},onBlur:function(e){this.parent();this._hideCategoryList();if(this._form.hasClass(this.options.cssClasses.classActive)&&!this.input.value){this._form.removeClass(this.options.cssClasses.classActive)}},_getSuggest:function(test){var options={headers:{ajaxAction:this.options.source!='null'?this.options.source:this.options.default_source},data:{},onSuccess:this._setSuggest.bind(this),onComplete:this._suggestion.bind(this,test)};options.data[this.input.name]=test;if(!this._category_element.disabled){options.data[this._category_element.name]=this._category_element.value}options.data['suggest']=1;new Ajax(this.options.url,options).request()},_suggestion:function(test){this.parent(test.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;'));var show_all=this.elem.getElement('[name=show-all]');if(show_all){show_all.form=this.input.form;show_all.addEvent('click',function(e){document.fireEvent('showAll',{extend_event:[{name:'eventContext',value:test}]})})}App.fireEvent('renewImages')}});var Comparison_class=new Class({is_updated:0,_goods:null,_session:null,_session_fingerprint:null,options:{list_head_active_class:'c-list-head-active',list_head_name:'list_head',list_body_name:'list_body',list_sections_min_count:2,comparison_href:''},initialize:function(options){this._session=App.getService('S');this.setOptions(options)},_prepare:function(){return this._session.getData().then(function(data){this.onLoadS(data);this._session.addEvent('loadS4comparison',this.onLoadS.bind(this));this._session.addEvent('loadS',function(S){this.onLoadS(S)}.bind(this));this.addEvent('update',this.onUpdate.bind(this))}.bind(this))},init:function(){return this._prepare()},initCatalogWidget:function(id){if(!id){id='comparison'+$random(0,100000);document.write("<div id='"+id+"'></div>")}this.elem=$(id);if(this._session.checkup)this.update()},update:function(){if($defined(this.elem)){this.elem.setHTML(App.getHTML(this.options.tpl,this))}this.fireEvent('update');this.is_updated=1},getGoods:function(goods_id){return this.getData()[goods_id]},getQuantity:function(){return Object.getLength(this.getData())},getData:function(){if(!this._goods||this._session.getHash()!==this._session_fingerprint){this._session_fingerprint=this._session.getHash();this.S=$defined(this._session.data.comparison)?this._session.data.comparison:{sections:{}};this._goods={};if('object'==$type(this.S.sections)){for(var id in this.S.sections){this.S.sections[id].count=0;with(this.S.sections[id])for(var c_id in comparisons){this._goods[comparisons[c_id].goods.id]=comparisons[c_id];this._goods[comparisons[c_id].goods.id].section=this._getSectionData(this.S.sections[id]);this._goods[comparisons[c_id].goods.id].section.id=id;count++}}}}return this._goods},_getSectionData:function(comparisons_section){var section_data={};for(key in comparisons_section){if(key!=='comparisons'&&key!=='count'){section_data[key]=comparisons_section[key]}}section_data['count']=Object.keys(comparisons_section.comparisons).length;return section_data},onLoadS:function(){this.update()},doAction:function(action,id,goods_id){var data={};if(id)data.id=id;if(goods_id)data.goods_id=goods_id;var request=new Ajax('/cgi-bin/form.php');var options={data:data,onComplete:this.onActionComplete.bindAsEventListener(request,action),headers:{ajaxAction:this.options.comparison_href+'#'+action}};request.setOptions(options).request()},onActionComplete:function(event,action){var Response=new Response_class(this.response.text);var goods_id=this.options.data.goods_id?this.options.data.goods_id:'';Response.doAction();Comparison.fireEvent('actionCompleteForGoods'+goods_id);App.trackGTMEvent({'eventCategory':'Interactions','eventAction':action,'eventLabel':'Comparison','eventProductId':goods_id})},isPossibilityToCompare:function(goods_id){var result=false;this.getData().some(function(item){if(item.section.count>1){result=true}return result});return result},addGoods:function(goods_id){this.doAction('add','',goods_id)},deleteGoods:function(goods_id){this.doAction('delete','',goods_id)},clear:function(section_id){this.doAction('clear','',section_id)},empty:function(){return $defined(this.S)?!this.getQuantity():null},onUpdate:function(){var sections_count=Object.getLength(this.S.sections);var parent=this.elem;if(parent&&sections_count>=this.options.list_sections_min_count){var list_head=parent.getElement('[name="'+this.options.list_head_name+'"]');var list_body=parent.getElement('[name="'+this.options.list_body_name+'"]');list_head.addEvent('click',function(e){new Event(e).stop();list_head.toggleClass(this.options.list_head_active_class);list_body.toggleClass('hidden')}.bind(this));document.addEvent('click',function(event){if(!list_body.hasClass('hidden')){list_head.removeClass(this.options.list_head_active_class);list_body.addClass('hidden')}}.bind(this))}}});Comparison_class.implement(new Options,new Events);var RozetkaComparison_class=Comparison_class.extend({options:{process:preloaders.green_process_tpl,popups:{empty:'<div class=\"header-popup header-popup-comparison-empty sprite-side \"> <h3 class=\"header-popup-info-title\">Немає товарів у&nbsp;порівнянні<\/h3> <p class=\"header-popup-info-title-under\">Додавайте товари до&nbsp;порівняння характеристик<\/br> та&nbsp;обирайте товар, який вам підійде найкраще<\/p> <\/div>',no_empty:'<div class=\"header-popup-comparison-b\"> <ul class=\"header-popup header-popup-comparison-full\"> {var index=1} {for section in getSections()} <li class=\"header-popup-comparison-full-i\" name=\"comparison_section\"> <a class=\"header-popup-comparison-full-i-link novisited pos-fix\" href=\"${section.href}\" onclick=\"document.fireEvent(\'chooseCompare\', {extend_event: [{name:\'eventContent\', value:\'${section.title}\'},{name:\'eventPosition\', value:${index}}]});\" > ${section.title}<span class=\"header-popup-comparison-full-i-link-text\">&nbsp;(${section.count})<\/span> <span class=\"comparison-list-i-clear\" name=\"clear_goods\" data-section=\"${section_index}\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"15\" height=\"15\" alt=\"&times;\" class=\"list-compare-l-i-icon sprite\"> <\/span> <\/a> <\/li> {var index=index+1} {\/for} <\/ul> <\/div> ',container:'<div class=\"popup-css popup-comparison-full\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div name=\"content\"><\/div> <\/div>',content:'{var word_forms = [\'товар\', \'товару\', \'товарів\']} {var plural_form = plural(_limit)} <div class=\"popup-comparison-full-head\">Ви можете порівняти не&nbsp;більш ніж ${_limit} ${word_forms[plural_form]} одночасно<\/div> <p class=\"popup-comparison-full-text\">Щоб продовжити додавати товари, видаліть найменш цікаві для&nbsp;вас моделі на&nbsp;сторінці порівняння<\/p> {var comparison_href = \"https:\/\/rozetka.com.ua\/ua\/comparison\/\"} {if section_id && S.sections && S.sections[section_id]} {var comparison_href=S.sections[section_id][\'href\']} {\/if} <a href=\"${comparison_href}\" class=\"popup-comparison-full-link\">Перейти до&nbsp;порівняння<\/a> '},header_button_content:'{var comparison_title = \'Порівняння\'} {var quantity=getQuantity()} {if quantity} <a href=\"{if quantity == 1}${getFirstSectionHref()}{else}https:\/\/rozetka.com.ua\/ua\/comparison\/{\/if}\" class=\"hub-i-link hub-i-comparison-link-count sprite-side whitelink\"> <span class=\"underline-hover\">${comparison_title}<\/span> <span class=\"hub-i-count\">${quantity}<\/span> <\/a> {else} <a href=\"#\" class=\"hub-i-link hub-i-link-empty hub-i-comparison-link sprite-side whitelink\" onclick=\"return false;\"> <span class=\"underline-hover\">${comparison_title}<\/span> <\/a> {\/if} ',header_button:'comparison',header_popup:'comparison-popup',selectors:{clear:'[name=clear_goods]',section:'[name=comparison_section]'},properties:{clear:'data-section'},comparison_href:''},_header_button:null,_header_popup:null,_popup:null,_limit:20,_sections:[],initialize:function(options){this.parent(options)},_prepare:function(){this._header_button=$(this.options.header_button);this._header_popup=$(this.options.header_popup);return this.parent()},getPopup:function(){if(this._popup==null){this._popup=new Popup_class(this.options.popups.container)}return this._popup},deleteGoods:function(goods_id){if($defined(this.elem)){this.elem.processStart(this.options.process)}var current_section_id=this.getData()[goods_id].section.id;this.doAction('deleteGoods','',goods_id);document.addEvent('loadS',function(){if(location.href==this.options.comparison_href){location.reload()}else if(location.href.contains('comparison')){location.href=this.S.sections[current_section_id].href}}.bind(this))},onActionComplete:function(response,action_name){var Response=new Response_class(response),goods_id=this.options.data.goods_id||'',location=window.location.protocol+'//'+window.location.hostname+window.location.pathname;Response.doAction();if(action_name=='delete'){document.fireEvent('removeFromComparison',{extend_event:[{name:'goods_id',value:goods_id}]})}Comparison.fireEvent('actionCompleteForGoods'+goods_id);Comparison.fireEvent('onAddForceComplete');if($defined(Comparison.elem)){Comparison.elem.process=0;Comparison.elem.fireEvent('onActionComplete')}if(action_name=='clear'&&location==this.options.comparison_href){window.location.reload(true)}},update:function(){this.parent();if($defined(this._header_button)){this._header_button.setHTML(App.getHTML(this.options.header_button_content,this))}if($defined(this._header_popup)){this._changeContent();this._header_popup.getElements(this.options.selectors.section).each(function(section){var elem=section.getElement(this.options.selectors.clear);elem&&elem.addEvent('click',this._handlerClickByClearButtonInHead.bind(this,elem,section))}.bind(this))}this.fireEvent('ComparisonUpdate')},_handlerClickByClearButtonInHead:function(elem,section,event){var section_id=parseInt(elem.getAttribute(this.options.properties.clear));new Event(event).stop();if(section_id){new Ajax('/cgi-bin/form.php').setOptions({data:{section_id:section_id},onComplete:this.onActionCompleteForClear.bind(this,section),onFailure:this.onActionCompleteForClear.bind(this,section),headers:{ajaxAction:this.options.comparison_href+'#clearComparisonBySection'}}).request();section.addClass('frozen')}},onActionCompleteForClear:function(section,response){var Response=new Response_class(response);if(Response.isError()){section.removeClass('frozen')}else{document.fireEvent('clearComparisonBySection',Response.content)}Response.doAction()},addForce:function(section_id,goods_ids){this.doAction('addForce',section_id,goods_ids)},_changeContent:function(){var content=this.options.popups.empty;if(this.getQuantity()){content=this.options.popups.no_empty}this._header_popup.setHTML(App.getHTML(content,this))},getSections:function(){return(this.S&&this.S.sections)||{}},addGoods:function(goods_id){var popup=null;if(this.section_id&&this.S.sections&&Object.keys(this.S.sections).contains(this.section_id.toString())&&this.S.sections[this.section_id].count>=this._limit){this.getPopup().setContent(this.options.popups.content,this);this.getPopup().open();document.fireEvent('more20productCompare',{extend_event:[{name:'goods_id',value:goods_id}]})}else{this.parent(goods_id)}},getFirstSectionHref:function(){var result="#",keys=Object.keys(this.S.sections),section={};if(keys.length){section=this.S.sections[keys.shift()];result=section['href']}return result},onUpdate:function(){var hidden_class='hidden';if($defined(this.elem)){if(!this.empty()&&this.isNeedShow()){this.elem.removeClass(hidden_class)}else{this.elem.addClass(hidden_class)}}},isNeedShow:function(){return Object.keys(this.getSections()).filter(function(item){return this._sections.indexOf(item.toInt())>-1}.bind(this)).length},getComparisons:function(){var result=[],sections=this.getSections();this._sections.forEach(function(key){if(sections.hasOwnProperty(key)){Object.values(sections[key]['comparisons']).each(function(comparison){result.push(comparison)})}});return result},setSections:function(sections){this._sections=sections},getSectionHref:function(){var result=this.options.comparison_href,sections=this.getSections();if(this._sections.length==1&&sections&&sections[this._sections[0]]){result=sections[this._sections[0]]['href']}return result}});var RozetkaPopupParentSetterInterface=new Class({_setPopupParent:function(id,tpl,container){this.addToDocument(tpl,container);this.options.parent=this._getPopupParentById(id,container);this.signChangeBind();if($(container)){$(container).removeProperty('id')}},addToDocument:function(elem,container){container=$(container);if(container){container.setHTML(container.innerHTML+elem)}else{document.write(elem)}},_getPopupParentById:function(id,container){if(!id){id='wishlists-popup-'+$random(0,100000);this.addToDocument("<div id='"+id+"'></div>",container)}return $(id)}});var RozetkaWaitlist_class=new Class({Class:'RozetkaWaitlist_class',actor:null,options:{id:'',parent:false,tpl_menu:'',tpl_init_catalog:'',tpl_init_details:'',tpl_init_details_available:'',tpl_form:'',tpl_confirm_phone_popup_content:'',tpl_form_price:'',tpl_process:'',tpl_message:'',tpl_init_profile:'',tpl_init_profile_available:'',tpl_completed:'',_auth_blocks_options:{signin_special_event:'',blocks_type:'waitlist'},_user_auth_event_name:'signChange',auth_type:'waitlist'},data:[],change_price_goods_ids:[],initialize:function(options){if(S.checkup)this.onLoadS(S);S.addEvent('loadS',function(S){this.onLoadS(S)}.bind(this));App.preloadImages(this.options.tpl_process)},init:function(id){if(!id){id='waitlist-menu-'+$random(0,100000);document.write("<div id='"+id+"'></div>")}this.elem=$(id);if(S.checkup)this.update()},setActor:function(actor){this.actor=actor},setCatalogPopupParent:function(id){this.options.parent=this._getPopupParentById(id);this.options.parent.setHTML(this.options.tpl_init_catalog);this.signChangeBind()},setProfilePopupParent:function(id,container){this._setPopupParent(id,this.options.tpl_init_profile,container)},setDetailsPopupParent:function(id,container){this._setPopupParent(id,this.options.tpl_init_details,container)},setProfileChangePricePopupParent:function(id,goods_id,container){if(goods_id){this.change_price_goods_ids.push(goods_id)}this._setPopupParent(id,this.options.tpl_init_profile_available,container)},setDetailsChangePricePopupParent:function(id,goods_id,container){if(goods_id){this.change_price_goods_ids.push(goods_id)}this._setPopupParent(id,this.options.tpl_init_details_available,container)},onLoadS:function(S){var S_waitlist;S_waitlist=$defined(S.waitlist)&&User.isAuth()?S.waitlist:{};this.goods=new Array();this.data=$defined(S.waitlist_for_block)&&User.isAuth()?S.waitlist_for_block:[];for(i=0;i<S_waitlist.length;i++){this.goods[i]=parseInt(S_waitlist[i]['goods_id'])}this.update()},update:function(){if($defined(this.elem)){this.elem.setHTML(App.getHTML(this.options.tpl_menu,this))};this.fireEvent('update')},getPopup:function(without_parent){if(!this.popup){this.popup=new Popup_class(this.options.tpl,!without_parent?this.options.parent:null)}return this.popup},_initUserAgreement:function(popup){var userAgreementPopup=new UserAgreementPopup_class(popup);userAgreementPopup.init()},addGoods:function(goods_id){if(this.isChangePrice(goods_id)){this.options._auth_blocks_options.blocks_type='waitlist'}if(this.actor.isAuth()){this.ajaxRequest(goods_id,this.actor.getTitle(),this.actor.getEmail(true))}else{var popup=this.getPopup();if(this.isChangePrice(goods_id)){popup.setContent(this.options.tpl_form_price,this)}else{popup.setContent(this.options.tpl_form,this)}popup.form.addEvent('submit',function(e){new Event(e).stop();this.sendInformation(goods_id)}.bind(this));popup._setAsMoadal();popup.open();this._initUserAgreement(popup);this.sendToGTM(goods_id,'openWaitlistPopup',true);this.fireEvent('actionCompleteForGoods')}},deleteGoods:function(goods_id){var options={};options.onComplete=function(response){var Response=new Response_class(response);if(Response.isDone()){if($defined(this.goods)){this.goods.remove(goods_id)}location.reload()}App.showMessage(Response.Message);Response.doAction()}.bind(this);options.headers={'ajaxAction':'https://my.rozetka.com.ua/ua/waitlist#delete'};options.data={'goods_id':goods_id};new Ajax('/cgi-bin/form.php',options).request();this.fireEvent('actionCompleteForGoods')},sendInformation:function(goods_id){var popup=this.getPopup();if(popup.form.checkFields()){this.goods_id=goods_id;var email=popup.form.login.value.trim();popup.form.processStart(this.options.tpl_process);if($defined(popup.form.title.value)){this.ajaxRequest(goods_id,popup.form.title.value,email)}else{var split_email=email.split('@',1);this.ajaxRequest(goods_id,split_email[0],email)}}},ajaxRequest:function(goods_id,title,email){var options={};options.onComplete=function(resp){var popup=this.getPopup(true);popup.open();popup._setAsMoadal();if(!email&&this.actor.isAuth()){email=this.actor.getEmail(true)||this.actor.getLoginPhoneData().title}var Response=new Response_class(resp),old_auth=this.actor.isAuth(),current_auth;if(popup.form)popup.form.processStop();if(!Response.isError()){Response.doAction();if((current_auth=this.actor.isAuth())&&current_auth!==old_auth){this.actor.changeAuthType(this.options.auth_type);this.actor.fireSignInEvent('email')}popup.isOpened()&&popup.close();popup.setContent(App.getHTML(this.options.tpl_completed,{email:email,isChangePrice:this.isChangePrice(goods_id)}));popup.open();this.sendToGTM(goods_id,null,true);document.fireEvent('userSignedIn')}else{if(Response.action&Response.ACTION.USER_AUTH){popup.close();this.signInBind(this.isChangePrice(goods_id),{login:email})}else if(Response.action&Response.ACTION.USER_SIGNUP_CONFIRM){popup.close();this._prepareSignUpConfirmPopup({isChangePrice:this.isChangePrice(goods_id)})}else{var msg=(popup.form)&&(popup.form.msg)?msg:(popup.msg?popup.msg:null);if(msg){msg.setHTML(Response.Message.getContentTpl(this.options.tpl_message))}}Response.doAction()}this.fireEvent('actionCompleteForGoods')}.bind(this);options.onRequest=function(){}.bind(this);options.headers={'ajaxAction':'https://my.rozetka.com.ua/ua/waitlist#Waitlist'};options.data={'goods_id':goods_id};if(title!==undefined)options.data['title']=title;if(email!==undefined)options.data['email']=email;options.data['isChangePrice']=(this.isChangePrice(goods_id))?'1':'';App.getService('RequestsManager').addRequestToPool(new Ajax('/cgi-bin/form.php',options))},_prepareSignUpConfirmPopup:function(tpl_data){this.handlerUserSignUp=this._onUserSignUpByPhone.bind(this);this.actor.changeAuthType(this.options.auth_type);this.actor.addEventOnce('signIn',this.handlerUserSignUp);this.actor.addEventOnce('confirmSignupPopupClose',this._onUserSignUpPopupClose.bind(this));this.actor.setOptions({signup_confirm:{confirm_by_popup:true}}).switchSignUpConfirmBlock(this._getSignUpConfirmPopup(),this.options.tpl_confirm_phone_popup_content,tpl_data)},_onUserSignUpByPhone:function(){if(this.goods_id){this.ajaxRequest(this.goods_id)}},_getSignUpConfirmPopup:function(){if(!this.signup_confirm_popup){this.signup_confirm_popup=new Popup_class(this.options.tpl_signin_popup,this.options.parent);this.signup_confirm_popup._setAsMoadal()}return this.signup_confirm_popup},_onUserSignUpPopupClose:function(){this.actor.removeEvent('signIn',this.handlerUserSignUp);this.actor.restoreSignUpConfirmBlock()},count:function(){return this.goods.length},inWaitlist:function(id){if($defined(this.goods))for(var i=0;i<this.goods.length;i++){if(this.goods[i]==id){return true}}return false},isChangePrice:function(goods_id){return this.change_price_goods_ids.contains(goods_id)},onUserSignIn:function(){if(this.actor.auth){this.ajaxRequest(this.goods_id,this.actor.getTitle(),this.actor.getEmail(true))}},onUserSignChange:function(){var popup=this.getPopup();if(popup._isOpened)popup.close()},onUserPopupClose:function(e){this.signInRemove()},signChangeBind:function(){this.actor.addEvent('signChange',this.onUserSignChange.bind(this))},signInBind:function(is_change_price,tpl_data){this.handlerUserSignIn=this.onUserSignIn.bind(this);this.handlerUserPopupClose=this.onUserPopupClose.bind(this);tpl_data=tpl_data||{};tpl_data.isChangePrice=is_change_price;this.actor.switchSignInPopup(App.getHTML(this.options.tpl_signin_popup_content,tpl_data),this.getSignInPopup(),this.options._auth_blocks_options);this.actor.addEvent(this.options._user_auth_event_name,this.handlerUserSignIn);this.actor.getPopup().addEvent('close',this.handlerUserPopupClose);this.actor.changeAuthType(this.options.auth_type)},getSignInPopup:function(){if(!this.signin_popup){with(this.options){this.signin_popup=new Popup_class(tpl_signin_popup);this.signin_popup._setAsMoadal()}}return this.signin_popup},signInRemove:function(){this.actor.removeEvent(this.options._user_auth_event_name,this.handlerUserSignIn);this.actor.getPopup().removeEvent('close',this.handlerUserPopupClose);this.actor.restoreSignInPopup();this.actor.restoreAuthType()},_getGTMData:function(goods_id){var data=App.getStorage().get('gtm_waitlist'),event_data=null;if(data!=null&&$type(data)=='object'){event_data=data[goods_id]}if(!event_data){event_data={extend_event:[{name:"goods_id",value:goods_id}]}}return event_data},sendToGTM:function(goods_id,event,hold_goods_data){var event_data=this._getGTMData(goods_id);if(!event){event=this.isChangePrice(goods_id)?'followPrice':'addToWaitlist';event_data.extend_event.push({name:'eventLabel',value:event})}if(!hold_goods_data){App.getStorage().remove('gtm_waitlist')}document.fireEvent(event,event_data)}});RozetkaWaitlist_class.implement(new Options,new Events,new RozetkaPopupParentSetterInterface);var Wishlists_class=new Class({Class:'Wishlists_class',actor:null,_session:null,wishlist:undefined,wishlists:undefined,show_after_loads_popup:false,options:{id:'',parent:false,tpl:'',tpl_init:'',tpl_form:'',tpl_process:'',tpl_message:'',tpl_signin_popup:'',tpl_signin_popup_content:'',tpl_confirm_phone_popup_content:'',tpl_success_popup_content:'',social_buttons_title:'',social_buttons_description:'',social_buttons_image:'',social_buttons_params:{}},initialize:function(options){this.setOptions(options);this._session=App.getService('S')},init:function(){this._prepare()},_prepare:function(){return this._session.getData().then(function(data){this.onLoadS(data);this._session.addEvent('loadS',this.onLoadS.bind(this));this.update()}.bind(this))},getData:function(){return(this._session.data&&this._session.data.wishlists?this._session.data.wishlists:{})},setPopupParent:function(id){if(!id){id='wishlists-popup-'+$random(0,100000);document.write("<div id='"+id+"'></div>")}this.options.parent=$(id);document.write(this.options.tpl_init);this.signChangeBind()},setCatalogTilePopupParent:function(id){if(!id){id='waitlist-popup-'+$random(0,100000);document.write("<div id='"+id+"'></div>")}this.options.parent=$(id);if(this.options.parent){this.options.parent.setHTML(this.options.tpl_catalog_tile_init)}this.signChangeBind()},onLoadS:function(){this.update();if(this.show_after_loads_popup){this.show_after_loads_popup=false}},update:function(){this.fireEvent('update')},getPopup:function(){if(!this.popup){with(this.options){this.popup=new Popup_class(tpl,parent)}}return this.popup},getSignInPopup:function(){if(!this.signin_popup){with(this.options){this.signin_popup=new Popup_class(tpl_signin_popup,parent);this.signin_popup._setAsMoadal()}}return this.signin_popup},count:function(){var count=0,wishlist,data=this.getData();for(wishlist in data){if($defined(data[wishlist].title)){count++}}return count},inWishlist:function(id){var data=this.getData(),j;for(j in data){if($defined(data[j].goods)){for(var i=0;i<data[j].goods.length;i++){if(data[j].goods[i]==id){return true}}}}return false},onUserSignIn:function(){this.show_after_loads_popup=true},onUserSignChange:function(){var popup=this.getSignInPopup()},onUserPopupClose:function(e){this.signInRemove()},signChangeBind:function(){this.actor.addEvent('signChange',this.onUserSignChange.bind(this))},signInRemove:function(){this.actor.removeEvent('signIn',this.handlerUserSignIn);this.getSignInPopup().removeEvent('close',this.handlerUserPopupClose);this.actor.restoreSignInPopup()},createSocialButtons:function(wishlist_id){var params=this.options.social_buttons_params,data=this.getData();params.url=data[wishlist_id].href;params.twitter_link=1;params.selector='wishlist_share_buttons';params.params={title:this.options.social_buttons_title.replace('{$title}',data[wishlist_id].title),description:this.options.social_buttons_description,image:this.options.social_buttons_image.replace('{$image}',data[wishlist_id].image)};$(document.body).fireEvent('createSocialButtons',params);$(document).fireEvent('createSocialButtons',params)}});Wishlists_class.implement(new Options,new Events);var RozetkaPopupParentSetterInterface=new Class({_setPopupParent:function(id,tpl,container){this.addToDocument(tpl,container);this.options.parent=this._getPopupParentById(id,container);this.signChangeBind();if($(container)){$(container).removeProperty('id')}},addToDocument:function(elem,container){container=$(container);if(container){container.setHTML(container.innerHTML+elem)}else{document.write(elem)}},_getPopupParentById:function(id,container){if(!id){id='wishlists-popup-'+$random(0,100000);this.addToDocument("<div id='"+id+"'></div>",container)}return $(id)}});var RozetkaWishlists_class=Wishlists_class.extend({_is_cart_action:false,_is_opened_auth_popap:false,_fio:null,_is_fio_popup:false,_is_fio_popup_submit:false,_fio_popup:null,_resend_tries:0,options:{header_button_content:'',header_popup_content:'',header_button:'wishlist',header_popup:'wishlist-popup',_auth_blocks_options:{signin_special_event:'',blocks_type:'wishlist'},tpl_process:preloaders.green_process_tpl,auth_type:'wishlist',ajaxAction:'https://my.rozetka.com.ua/ua/wishlists#addGoods',tpl_request_fio:'<form class=\"wishlists-content\" data-app-message-block=\"[name=wishlist-app-msg]\" data-event-location=\"wishListPopup\"> <h2 class=\"wishlists-title\">Додавання до&nbsp;списку бажань<\/h2> <div class=\"auth-msg\" name=\"wishlist-app-msg\"><\/div> <div class=\"clearfix pos-fix\"> <div class=\"wishlists-auth-i\"> <div class=\"wishlists-i-wrap\"> <div class=\"wishlists-i-title\">Ел.&nbsp;пошта або телефон<\/div> <input name=\"login\" class=\"input-text wishlists-i-input\" disabled=\"disabled\" type=\"text\" value=\"${login}\"> <\/div> <\/div> {if need_confirm_phone} <div class=\"wishlists-auth-title\"> На&nbsp;ваш номер відправлено SMS з&nbsp;кодом підтвердження <\/div> <div class=\"double-auth-num\"> Код підтвердження <\/div> <div class=\"wishlists-i-wrap\"> <input class=\"input-text double-auth-input\" name=\"verify_code\" _pattern=\"^[0-9]+$\" _required=\"required\" type=\"text\"> <a href=\"#\" name=\"resend_code\" class=\"xhr novisited double-auth-link\" onclick=\"document.fireEvent(\'getAnotherConfirmCode\',{extend_event:[{name:\'eventLocation\',value:\'${event_location}\' }]});\"> Запитати код ще раз <\/a> <\/div> <div class=\"wishlists-auth-i\"> <div class=\"wishlists-i-wrap\"> <div class=\"wishlists-i-title\"> Вкажіть ім\'я та прізвище <\/div> <input name=\"fio\" _required=\"required\" class=\"input-text wishlists-i-input\" type=\"text\" _pattern=\"^\\s*[A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50}([\\&#039;-][A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50})?(\\s+[A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50}([\\&#039;-][A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50})?\\s*)+$\"> <div class=\"wishlists-i-title-bottom\"> наприклад: Тарас Шевченко <\/div> <\/div> <\/div> <span class=\"btn-link btn-link-blue double-auth-submit\"> <button type=\"submit\" name=\"confirm_signup_submit\" class=\"btn-link-i\"> Зберегти <\/button> <\/span> {else} <div class=\"wishlists-auth-title\"> Для завершення реєстрації введіть ваше ім\'я і&nbsp;прізвище <\/div> <div class=\"wishlists-auth-i\"> <div class=\"wishlists-i-wrap\"> <div class=\"wishlists-i-title\"> Ім\'я та прізвище <\/div> <input name=\"fio\" class=\"input-text wishlists-i-input\" required=\"required\" type=\"text\" _pattern=\"^\\s*[A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50}([\\&#039;-][A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50})?(\\s+[A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50}([\\&#039;-][A-Za-zА-Яа-яіїёєІЇЁЄ]{2,50})?\\s*)+$\"> <div class=\"wishlists-i-title-bottom\"> наприклад: Тарас Шевченко <\/div> <\/div> <\/div> <span class=\"btn-link btn-link-blue double-auth-submit\"> <button type=\"submit\" name=\"confirm_signup_submit\" class=\"btn-link-i\"> Зберегти <\/button> <\/span> {\/if} <\/div> <\/form>'},_header_popup:null,_header_button:null,_close_event_set:false,_prepare:function(){OAuth2.addEvent('login_success',function(){this.update()}.bind(this));App.preloadImages(this.options.tpl_process);return this.parent()},setActor:function(actor){this.actor=actor},setPopupParent:function(id,tpl,container){if(!tpl){tpl=this.options.tpl_init}this._setPopupParent(id,tpl,container)},update:function(){if(!$defined(this._header_popup)||!$defined(this._header_button)){this._header_button=$(this.options.header_button);this._header_popup=$(this.options.header_popup)}this.parent();if($defined(this._header_popup)){this.getGoodsCount()?this._header_popup.setHTML(''):this._header_popup.setHTML(App.getHTML(this.options.header_popup_content,this))}if($defined(this._header_button)){this._header_button.setHTML(App.getHTML(this.options.header_button_content,this))}},getGoodsCount:function(){var result=0,data=this.getData();Object.values(data).each(function(wishlist){result+=wishlist.goods.length});return result},ajaxRequest:function(goods_id,login,wishlist,data){var options={};options.onComplete=function(resp){var popup=this.getPopup();var Response=new Response_class(resp);popup._setAsMoadal();if(popup&&popup.form)popup.form.processStop();if(!Response.isError()){var is_fio_popup=false;if(this._is_fio_popup_submit){document.fireEvent('successRegistration',{extend_event:[{name:'eventContext',value:this._is_fio_popup}]});is_fio_popup=this._is_fio_popup}if(this._is_fio_popup==='phone'){var extend_event_data={extend_event:[{name:'eventLocation',value:popup.form.getAttribute('data-event-location')}]};document.fireEvent('signUpConfirmPhone',extend_event_data)}if(popup){popup.close()}this.sendToGTM(goods_id);rozetkaEvents.trackEvent(null,'goods/wishlist/add',rozetkaEvents.getGoodsData(goods_id));var old_auth=this.actor.isAuth(),current_auth;Response.doAction();if((current_auth=this.actor.isAuth())&&current_auth!==old_auth){this.actor.changeAuthType(this.options.auth_type);if(is_fio_popup){this.actor.fireSignInEvent(is_fio_popup)}else{this.actor.fireSignInEvent('email')}}document.fireEvent('userSignedIn')}else{if(this._is_fio_popup_submit){var error_message='';if($defined(Response.Message)&&Response.Message){error_message=Response.Message.content}document.fireEvent('errorRegisterPopup',{extend_event:[{name:'eventContext',value:this._is_fio_popup},{name:'eventContent',value:error_message}]})}if(Response&&$defined(Response.content)&&$defined(Response.content.action_type)){this._prepareFIOPopup(Response.content,Response.Message)}else if(Response.action&Response.ACTION.USER_AUTH){this._is_opened_auth_popap=true;if(popup){popup.close()}this.signInBind({login:login})}else if(Response.action&Response.ACTION.USER_SIGNUP_CONFIRM){popup.close();this._prepareSignUpConfirmPopup()}else{if((popup.msg)){popup.msg.setHTML(Response.Message.getContentTpl(this.options.tpl_message))}else{App.showMessage(Response.Message)}}Response.doAction()}this.fireEvent('actionCompleteForGoods');this.fireEvent('addGoodsToWishlistComplete');this._is_fio_popup_submit=false}.bind(this);options.onRequest=function(){}.bind(this);options.headers={'ajaxAction':'https://my.rozetka.com.ua/ua/wishlists#addGoods'};options.data={'goods_id':goods_id};if(login!==undefined)options.data['login']=login;if(wishlist&&wishlist.title!==undefined){options.data['wishlist_title']=wishlist.title}if(data){for(var key in data){if(data.hasOwnProperty(key)){options.data[key]=data[key]}}}App.getService('RequestsManager').addRequestToPool(new Ajax('/cgi-bin/form.php',options))},_onSubmitFIOForm:function(e){new Event(e).stop();var popup=this.getPopup();if(popup.form.checkFields()){var data={fio:popup.form.fio.value};this._fio=popup.form.fio.value;var login=popup.form.login.value.trim();if(popup.form.hasOwnProperty('verify_code')){data.verify_code=popup.form.verify_code.value.trim()}this._is_fio_popup_submit=true;this.ajaxRequest(this.goods_id,login,this.wishlist,data)}else{document.fireEvent('errorRegisterPopup',{extend_event:[{name:'eventContext',value:this._is_fio_popup},{name:'eventContent',value:'JS validation error. Not valid popup form.'}]})}},_getFIOPopup:function(){if(!this._fio_popup){this._fio_popup=this.getPopup();this._fio_popup.addEvent('close',function(){this._is_fio_popup='';if(!this._is_fio_popup_submit){document.fireEvent('closeRegisterPopup',{extend_event:[{name:'eventContext',value:this._is_fio_popup}]})}}.bind(this))}return this._fio_popup},_prepareFIOPopup:function(content,message){var first_open=(this._is_fio_popup!='email'&&this._is_fio_popup!='phone');if(content.action_type==1){this._is_fio_popup='email'}else{this._is_fio_popup='phone'}if(first_open){document.fireEvent('registerPopup',{extend_event:[{name:'eventContext',value:this._is_fio_popup}]})}var popup=this._getFIOPopup();if(this._fio_popup.form.hasOwnProperty('fio')){this._fio_popup.form.fio.value=this._fio}content.event_location='wishlist';if(!$defined(content.need_confirm_phone)){content.need_confirm_phone=false}if(message){App.showMessage(message,popup.form)}popup.setContent(this.options.tpl_request_fio,content);var resend_link=popup.form.getElement('a[name="resend_code"]');if(resend_link){resend_link.addEvent('click',function(e){new Event(e).stop();this._resend_tries+=1;var popup=this.getPopup();if(popup.form.hasOwnProperty('fio')){this._fio=popup.form.fio.value}var login=popup.form.login.value.trim();this.ajaxRequest(this.goods_id,login,this.wishlist,{resend:true,count_try:this._resend_tries})}.bind(this))}popup.form.addEvent('submit',this._onSubmitFIOForm.bind(this));if(!popup.isOpened()){popup.open()}},_prepareSignUpConfirmPopup:function(){this.handlerUserSignUp=this._onUserSignUpByPhone.bind(this);this.actor.changeAuthType(this.options.auth_type);this.actor.addEventOnce('signIn',this.handlerUserSignUp);this.actor.addEventOnce('confirmSignupPopupClose',this._onUserSignUpPopupClose.bind(this));this.actor.setOptions({signup_confirm:{confirm_by_popup:true}}).switchSignUpConfirmBlock(this._getSignUpConfirmPopup(),this.options.tpl_confirm_phone_popup_content,{wishlist:this.wishlist})},_onUserSignUpByPhone:function(){if(this.goods_id&&this.wishlist){this.ajaxRequest(this.goods_id,this.actor.getEmail(),this.wishlist)}},_getSignUpConfirmPopup:function(){if(!this.signup_confirm_popup){this.signup_confirm_popup=new Popup_class(this.options.tpl_signin_popup,this.options.parent);this.signup_confirm_popup._setAsMoadal()}return this.signup_confirm_popup},_onUserSignUpPopupClose:function(){this.actor.removeEvent('signIn',this.handlerUserSignUp);this.actor.restoreSignUpConfirmBlock()},signInBind:function(tpl_data){tpl_data=tpl_data||{};this.handlerUserSignIn=this.onUserSignIn.bind(this);this.handlerUserPopupClose=this.onUserPopupClose.bind(this);this.actor.addEvent('signIn',this.handlerUserSignIn);this.actor.switchSignInPopup(App.getHTML(this.options.tpl_signin_popup_content,tpl_data),this.getSignInPopup(),this.options._auth_blocks_options);this.getSignInPopup().addEvent('close',this.handlerUserPopupClose);this.actor.changeAuthType(this.options.auth_type)},signInRemove:function(){this.parent();if(this._is_cart_action){this._is_opened_auth_popap=false;this._addGoodsFromCartEnd()}this.actor.restoreAuthType()},sendToGTM:function(goods_id){var data=App.getStorage().get('gtm_wishlist'),event_data={};if(data!=null&&$type(data)=='object'){event_data=data[goods_id]}App.getStorage().remove('gtm_wishlist');if(!this._is_cart_action){document.fireEvent('clickToWishlist',event_data)}else{document.fireEvent('clickToWishlistInCart',{extend_event:[{name:"goods_id",value:goods_id}]})}},getSignInPopup:function(){var is_single=!this._is_cart_action;return this.parent().setOptions({single:is_single})},getPopup:function(){var is_single=!this._is_cart_action;return this.parent().setOptions({single:is_single})},addGoods:function(goods_id){this.goods_id=goods_id;if(this.actor.isAuth()){this.ajaxRequest(this.goods_id,this.actor.getEmail())}else{var popup=this.getPopup();popup.setContent(this.options.tpl_form,this);popup.form.addEvent('submit',function(e){new Event(e).stop();var popup=this.getPopup();if(popup.form.checkFields()){var login=popup.form.login.value.trim();this.wishlist={"title":popup.form.wishlist_title.value};this.ajaxRequest(goods_id,login,this.wishlist)}}.bind(this));popup._setAsMoadal();popup.open();this._initUserAgreement(popup);this.fireEvent('actionCompleteForGoods')}},move:function(record_id,wishlist_id){var popup=this.getPopup();popup.setContent(this.options.tpl_move_content,{wishlists:this.getData(),goods_data:[{record_id:record_id}],wishlist_id:wishlist_id});popup.open()},onUserSignIn:function(){this.ajaxRequest(this.goods_id,this.actor.getEmail(),this.wishlist);this.show_after_loads_popup=true},addGoodsPromise:function(goodsId){return this.stepOne(goodsId).then(this.stepTwo.bind(this,goodsId)).then(this.stepThree.bind(this,goodsId)).then(function(){document.fireEvent('clickToWishlistInCart',{extend_event:[{name:"goods_id",value:goodsId}]})})},_initUserAgreement:function(popup){var user_agreement_popup=new UserAgreementPopup_class(popup);user_agreement_popup.init()},stepOne:function(goodsId){var callback=function(resolve,reject){var popup=this.getPopup(),restore=function(command,message){command(message);popup.close()};if(this.actor.isAuth()||this.inWishlist(goodsId)){resolve()}else{popup.setContent(this.options.tpl_form,this);popup._setAsMoadal();popup.addEventOnce('close',reject);popup.form.addEvent('submit',function(event){var form=popup.form;new Event(event).stop();if(form.checkFields()){this.login=form.login.value.trim();this.sendRequest(goodsId,this.login,form.wishlist_title.value).then(this.parseResponseStepOne.bind(this)).then(restore.bind(this,resolve)).catch(restore.bind(this,reject))}}.bind(this));this.actor.addEventOnce('signIn',restore.bind(this,resolve));popup.open();this._initUserAgreement(popup);this.fireEvent('actionCompleteForGoods')}};return new Promise(callback.bind(this))},sendRequest:function(goodsId,login,wishlistTitle){var callback=function(resolve,reject){var headers={ajaxAction:this.options.ajaxAction};new Ajax('/cgi-bin/form.php',{headers:headers}).addEvent('onComplete',resolve).addEvent('onFailure',reject).request({goods_id:goodsId,login:login,wishlist_title:wishlistTitle,source:"cart"})};return new Promise(callback.bind(this))},parseResponseStepOne:function(resp){var callback=function(resolve,reject){var response=new Response_class(resp),checkAuthUser=(this.isSignInResponseCode(response)||this.isSignUpResponseCode(response));(!response.isError()||checkAuthUser)?resolve(response):this.getPopup().msg.setHTML(response.Message.getContentTpl(this.options.tpl_message));if(!checkAuthUser){response.doAction()}};return new Promise(callback.bind(this))},stepTwo:function(goodsId,response){var callback=function(resolve,reject){if(this.inWishlist(goodsId)||this.actor.isAuth()){resolve()}else if(this.isSignUpResponseCode(response)){this.actor.changeAuthType(this.options.auth_type);this.actor.setOptions({signup_confirm:{confirm_by_popup:true}}).switchSignUpConfirmBlock(this._getSignUpConfirmPopup(),this.options.tpl_confirm_phone_popup_content,{wishlist:this.wishlist});this.actor.signUpPromise(response.content).then(function(){this.actor.restoreSignUpConfirmBlock();resolve()}.bind(this)).catch(function(){this.actor.restoreSignUpConfirmBlock();reject()}.bind(this));this.fireEvent('actionCompleteForGoods')}else{this.actor.changeAuthType(this.options.auth_type);this.actor.switchSignInPopup(App.getHTML(this.options.tpl_signin_popup_content,{login:this.login}),this.getSignInPopup(),this.options._auth_blocks_options);this.actor.signInPromise(response.Message).then(function(){this.actor.restoreAuthType();resolve()}.bind(this)).catch(function(){this.actor.restoreAuthType();reject()}.bind(this));this.fireEvent('actionCompleteForGoods')}};return new Promise(callback.bind(this))},stepThree:function(goodsId){var callback=function(resolve,reject){if(this.inWishlist(goodsId)){resolve()}else{this.sendRequest(goodsId,this.actor.getEmail()).then(this.parseResponseStepThree.bind(this)).then(resolve).catch(reject)}};return new Promise(callback.bind(this))},parseResponseStepThree:function(resp){var callback=function(resolve,reject){var response=new Response_class(resp);response.isError()?reject():resolve();if(!(this.isSignInResponseCode(response)||this.isSignUpResponseCode(response))){response.doAction()}};return new Promise(callback.bind(this))},isSignInResponseCode:function(response){return response['action']&&(response['action']&response.ACTION.USER_AUTH)},isSignUpResponseCode:function(response){return response['action']&&(response['action']&response.ACTION.USER_SIGNUP_CONFIRM)}});RozetkaWishlists_class.implement(new RozetkaPopupParentSetterInterface);var RozetkaDropDownMenu=new Class({_actionElementsCount:0,_current_element:{},options:{actionZone:'[name=action-zone]',parent_name:'[name=main-menu-popup-parent]',action_elements:'a[name=active-elem]',drop_elements:'div[name=drop-elem]',styles:{},action_zone_elem:null,delay:500},_dropElements:[],getActionElements:function(){return(this.getParent())?this.getParent().getElements(this.options.action_elements):[]},getDropElements:function(){return(this.getParent())?this.getParent().getElements(this.options.drop_elements):[]},getDropElement:function(el){return(el.getParent())?el.getParent().getElement(this.options.drop_elements):null},getParent:function(){return typeof(this.options.parent_name)=='object'?this.options.parent_name:$E(this.options.parent_name)},setActive:function(el){el.getParent().addClass('hover')},removeActive:function(el){el.getParent().removeClass('hover')},show:function(el){this.setActive(el);this.fastHideOpenedElements(el);if(this.options.action_zone_elem){this.options.action_zone_elem.fireEvent('showed')}},fastHideOpenedElements:function(el){this.getOpenedElements(el).each(function(elem){this.fastHide(elem)}.bind(this))},hide:function(el){if(!el.lock){this.fastHide(el)}},fastHide:function(el){this.removeActive(el)},getOpenedElements:function(el){var els=[];this.getDropElements().each(function(elem){if(elem!=el){els.push(elem)}});return els},run:function(){var resizeTimeout;this._actionElementsCount=this.getActionElements().length;this.getDropElements().each(function(el){this._parent=this.getParent();el.setStyles(this.options.styles);el.lock=false;this._dropElements.push(el);el.addEvents({mouseenter:function(){el.lock=true}.bind(this),mouseleave:function(){el.lock=false;this.hide.delay(500,this,[el])}.bind(this),show:function(){el.lock=true;this.show(el)}.bind(this),hide:function(){el.lock=false;this.hide.delay(500,this,[el])}.bind(this)})}.bind(this));this.getActionElements().each(function(el,index){var dropElement=this.getDropElement(el);if(dropElement){el.addEvents({mouseenter:function(e){el.lock=false;this.fireEventDelay=function(el){if(!el.lock){dropElement.fireEvent('show')}};this.fireEventDelay.delay(this.options.delay,this,[el])}.bind(this),mouseleave:function(){el.lock=true;dropElement.fireEvent('hide')}})}}.bind(this));this._setDropElementsIndent();App.addEvent('timedResize',this._setDropElementsIndent().bind(this))},_getActionElementWidth:function(){return Math.ceil(this.getParent().getCoordinates().width/this._actionElementsCount)},_getDropElementIndent:function(index,width){return-(index*width)},_setDropElementsIndent:function(){var count=this._actionElementsCount,indentDirection="left";this.getDropElements().each(function(el,index){if(index>=(count/2)){indentDirection="right";index=count-index-1}el.setStyle(indentDirection,this._getDropElementIndent(index,this._getActionElementWidth()))}.bind(this))}});RozetkaDropDownMenu.implement(new Options);var RozetkaMenuDelayChecker_class=new Class({options:{log_locations_count:3,tolerance:10,delay:300},mouse_locations:[],last_delay_location:{},initialize:function(options){this.setOptions(options);document.addEvent('mousemove',this._onMouseMove.bind(this))},getActivationDelay:function(parent_menu,drop_menu,use_drop_menu_point){var elem_size={x:0,y:0},result=0,name=parent_menu.getAttribute('menu_name'),location=this.mouse_locations[this.mouse_locations.length-1],previous=this.mouse_locations[0],menu_size,coordinates;if(drop_menu){elem_size=drop_menu.getSize().size}if(use_drop_menu_point&&elem_size.x&&location.y>(drop_menu.getPosition().y+elem_size.y)&&drop_menu.getPosition().x){coordinates=this._getBlockCoordinates(drop_menu)}else{menu_size=parent_menu.getSize().size;coordinates=this._getBlockCoordinates(parent_menu);coordinates.top.x+=menu_size.x;coordinates.top.y-=this.options.tolerance;coordinates.bottom.y+=this.options.tolerance;if(elem_size.y>menu_size.y){coordinates.bottom.y+=elem_size.y-menu_size.y}}if(location&&!this._isMenuFirstTimeActivated(previous,location,parent_menu)&&!this._isMouseNotMoved(name,location)&&this._relativity(location,previous,coordinates.bottom)>=0&&this._relativity(location,coordinates.bottom,coordinates.top)>=0&&this._relativity(location,coordinates.top,previous)>=0){this.last_delay_location[name]=location;result=this.options.delay}else{this.last_delay_location[name]=null}return result},_relativity:function(loc,a,b){return loc.x*(b.y-a.y)+loc.y*(a.x-b.x)+a.y*b.x-a.x*b.y},_isMenuFirstTimeActivated:function(prev,loc,menu){var block_coordinates=this._getBlockCoordinates(menu);return(prev.x<block_coordinates.top.x+parseInt(menu.getStyle('padding-left'))||prev.x>block_coordinates.bottom.x+parseInt(menu.getStyle('padding-right'))||prev.y<block_coordinates.top.y+parseInt(menu.getStyle('padding-top'))||prev.y>block_coordinates.bottom.y+parseInt(menu.getStyle('padding-bottom')))&&(loc.x>=block_coordinates.top.x&&loc.x<=block_coordinates.bottom.x&&loc.y>=block_coordinates.top.y&&loc.y<=block_coordinates.bottom.y)},_isMouseNotMoved:function(name,location){return this.last_delay_location[name]&&location.x==this.last_delay_location[name].x&&location.y==this.last_delay_location[name].y},_getBlockCoordinates:function(elem){var offset=elem.getPosition(),size=elem.getSize().size;return{top:{x:offset.x,y:offset.y},bottom:{x:offset.x+size.x,y:offset.y+size.y}}},_onMouseMove:function(e){this.mouse_locations.push({x:e.pageX,y:e.pageY});if(this.mouse_locations.length>this.options.log_locations_count){this.mouse_locations.shift()}}});RozetkaMenuDelayChecker_class.implement(new Options());var RozetkaMenuClass=new Class({menu:null,menuItems:[],active_elem:null,hide_timeout:null,check_timeout:null,menu_timeout:null,last_level_show_timeout:null,options:{selectors:{menuItems:'[name="m-main-i"]',drop_menu:'[name="second_level"]',has_submenu:'[has_submenu="1"]',scroller:'[name=scroller]'},submenu:null,cssClasses:{hover:"hover"},use_drop_menu_lower_right_point:false,menu:'main',scroller:{level1:{vector:'vertical',elemsContainer:'[name=drop-elem]',elems:'[name=m-main-i-l]'},level2:{vector:'vertical',elemsContainer:'[name=drop-elem]',controls:'[name=controls1]',screen:'[name=screen1]',elems:'[name=m-main-i-l1]'}},use_scroller:false},_scroller_class:'RozetkaFatMenuScroller_class',submenus:[],submenus_inserted:[],parent:null,checker:null,hide_delay:null,last_level_show_delay:null,_scrollers:[],menu_data:null,sended:false,menu_activated:false,initialize:function(menu_elem,options,parent_menu,menu_data){this.submenus=[];this.last_delay=null;this.active_elem=null;this.menu_timeout=null;this.check_timeout=null;this.menu_data=menu_data;this.menu=$(menu_elem);this.parent=parent_menu;this.setOptions(options);this.hide_delay=this.options.hide_delay;this.last_level_show_delay=this.options.last_level_show_delay;if(!parent_menu){this.checker=new RozetkaMenuDelayChecker_class();this.attachToObserver([])}if(this.menu){this.menuItems=this.menu.getElements(this.options.selectors.menuItems);this._initEvents()}this.parent_main_container=this.menu.getParentByName(options.parent_name)},_initEvents:function(){this.menuItems.each(function(el,key){var submenu=el.getElement(this.options.selectors.drop_menu);if(submenu&&this.options.submenu&&this.options.submenu.options){this.submenus.push(new RozetkaMenuClass(submenu,this.options.submenu.options,this,this.menu_data))}if(!App.isDesktop()&&this._hasSubmenu(el)){el.addEvent('click',this._doTouch.bind(this,el))}else if(App.isDesktop()){el.addEvent('mouseenter',this._addActiveState.bind(this,el))}else{el.addEvent('click',this._addActiveState.bind(this,el))}}.bind(this));this.menu.addEvent('mouseleave',this._onMouseLeaveMenu.bind(this));this.menu.addEvent('mouseenter',function(){clearTimeout(this.menu_timeout)}.bind(this))},_initScrollerElements:function(scroller){var wrapper=scroller._getElementsContainerParent();wrapper.addEvent('scroll',function(){scroller._getElements().each(function(element){var scroll=wrapper['scrollTop'];element.getElements(this.options.selectors.scroller).each(function(node){node.setStyle('margin-top',scroll)})}.bind(this))}.bind(this))},getScroller:function(scroller_conatiner){return new(App.getConstructorByClassName(this._scroller_class))(scroller_conatiner).setOptions(this.getScrollerOptions()).run()},getScrollerOptions:function(){return this.parent?this.options.scroller.level2:this.options.scroller.level1},_doTouch:function(el,e){if(this.active_elem!=el){new Event(e).stop();this._addActiveState(el)}},_hasSubmenu:function(el){return(el.getElement(this.options.selectors.has_submenu))},_onMouseLeaveMenu:function(){clearTimeout(this.menu_timeout);clearTimeout(this.check_timeout);var delay,key;if(this.active_elem){delay=this.getActivationDelay();key=Object.keyOf(this.menuItems,this.active_elem);if(!delay&&this.submenus.length&&this.submenus[key]){delay=this.submenus[key].last_delay}}if(this.last_level_show_delay&&!delay&&!this.last_level_show_timeout){delay=this.options.last_level_show_delay;this.last_level_show_timeout=setTimeout(function(){this.last_level_show_delay=null}.bind(this),this.last_level_show_delay)}if(delay){this.menu_timeout=setTimeout(this._onMouseLeaveMenu.bind(this),delay)}else{this.last_delay=null;clearTimeout(this.hide_timeout);this.hide_delay=this.options.hide_delay;this.hide_timeout=null;this.deactivate(this.active_elem);this.fireEvent('fatMenuLeave');this.toggleParentContainer('remove',this.options.parent_hover_class)}this.menu_activated=false},_addActiveState:function(el){if(!this.options.can_hide){this.toggleParentContainer('add')}clearTimeout(this.check_timeout);this._checkActivation(el)},_checkActivation:function(el){this._getData();var delay=this.getActivationDelay();if(this.options.can_hide===false&&this.hide_delay){delay=this.hide_delay;if(!this.hide_timeout){this.hide_timeout=setTimeout(function(){this.hide_delay=null}.bind(this),this.hide_delay)}}if(delay||!this.menu_data){this.check_timeout=setTimeout(function(){this._checkActivation(el)}.bind(this),delay)}else{this.activate(el)}},getActivationDelay:function(){if(this.active_elem){this.last_delay=this.getDelayChecker().getActivationDelay(this.menu,this._getDropMenu(),this.options.use_drop_menu_lower_right_point)}return this.last_delay},_getDropMenu:function(){return this.active_elem?this.active_elem.getElement(this.options.selectors.drop_menu):null},getDelayChecker:function(){return this.parent?this.parent.getDelayChecker():this.checker},activate:function(el){if(!this.menu_activated){if(!this.options.can_hide){$(document).fireEvent('openFatMenu',{extend_event:[{name:'eventContent',value:'level2'}]})}this.menu_activated=true}var index=this.menuItems.indexOf(el);if(this.active_elem){this.deactivate(this.active_elem)}this.show(el);this.last_delay=null;this.active_elem=el;if(this.options.parent_hover_class&&!this.parent_main_container.hasClass(this.options.parent_hover_class)){this.toggleParentContainer('add',this.options.parent_hover_class)}if(el.getElement(this.options.selectors.drop_menu)){this.fireEvent('fatMenuSubMenuFirstOpened')}else{this.fireEvent('fatMenuHalfVisibility')}if(this.options.last_level_show_delay){clearTimeout(this.last_level_show_timeout);this.last_level_show_timeout=null;this.last_level_show_delay=this.options.last_level_show_delay}el&&this.setupScroller(el)},setupScroller:function(el){var container=el.getElement(this.options.selectors.scroller),top_height=this.getTopHeight(),scroller=this.options.use_scroller&&this.getScrollerByElement(el),elements_container=null;if(!scroller){if(container){elements_container=el.getElement(this.getScrollerOptions()['elemsContainer']);if(elements_container&&elements_container['offsetHeight']>top_height){container.setStyle('height',top_height);scroller=this.getScroller(container);this._scrollers.push({element:el,scroller:scroller});this._initScrollerElements(scroller)}if(elements_container&&App.isDesktop()){elements_container.getParent().setStyles('overflow-y: hidden')}}}else{scroller.scroller._checkControlsStatus()}},getScrollerByElement:function(elem){return this._scrollers.filter(function(obj){return obj.element==elem}).pop()},getTopHeight:function(){var result=0;this.menu.getChildren().each(function(el){result+=el['offsetHeight']});if(this.parent){result=this.parent.getTopHeight()}return result},deactivate:function(el){this.active_elem=null;this.last_delay=null;this.hide(el)},show:function(el){var id=el.getProperty('menu_id'),second_level=el.getElement(this.options.selectors.drop_menu);if(!this.parent&&!this.submenus_inserted[id]&&second_level){second_level.setHTML(App.getHTML(this.options.tpl,{node:this.menu_data[id],node_title:el.getProperty('title'),all_categories_link:el.getElement('a')?el.getElement('a').getProperty('href'):''}));this.submenus_inserted[id]=1}if(el&&this.menu_data[id]){el.addClass(this.options.cssClasses.hover)}if(!second_level){this.toggleParentContainer('remove',this.options.parent_hover_class)}this.fireEvent('showSecondLevel',[el,second_level])},hide:function(el){el&&el.removeClass(this.options.cssClasses.hover)},_getData:function(){if(!this.menu_data&&!this.sended){new Ajax(this.options.menu_url+this._getAction(),{method:'get',onComplete:function(resp){try{this.menu_data=App.getService('JSON').parse(resp)}catch(e){App.err(e)}}.bind(this),withCredentials:true,use_language:true}).request();this.sended=true}},_getAction:function(){var action=this.options.action,protocol=window.location.protocol;if(!this.options.use_redis){action+=(protocol==='https:'?'1':'0')+'/'}return action},toggleParentContainer:function(mode,container_class){var parent_container=this.parent_main_container,toggle_class=!container_class?this.options.parent_hover_position_class:container_class;if(parent_container&&toggle_class){if(mode==='add'){parent_container.addClass(toggle_class)}else if(mode==='remove'){parent_container.removeClass(toggle_class)}else{parent_container.toggleClass(toggle_class)}}}});RozetkaMenuClass.implement(new Options(),new Events());var RozetkaFatmenu_class=new Class({options:{selectors:{menu:'m-main-ul',button:'fat_menu_btn',parent_block:'fat-menu',second_level_menu_block:'[name="second_menu"]'},can_hide:true,main_menu_options:{menu_url:'',tpl:'{if node.banner && node.banner.img} {if node.banner.href} <a href=\"${node.banner.href}\" class=\"f-menu-banner responsive-img\" onclick=\"document.fireEvent(\'fatmenuBigBannerClick\')\"> ${node.banner.img} <\/a> {else} <div class=\"f-menu-banner responsive-img\" onclick=\"document.fireEvent(\'fatmenuBigBannerClick\')\"> ${node.banner.img} <\/div> {\/if} {\/if} {if node.children.popular && node.children.popular.links} <div class=\"f-menu-pop\"> <div class=\"f-menu-pop-b\"> <div class=\"f-menu-pop-title\"> Популярні категорії <\/div> <ul class=\"f-menu-pop-l\"> {for link in node.children.popular.links} <li class=\"f-menu-pop-l-i\"> {if link.href} <a href=\"${link.href}\" class=\"f-menu-pop-l-i-link blacklink\" onclick=\"document.fireEvent(\'fatmenuLinkClick\');\" data-level=\"level3\" data-type=\"popular\" > ${link.title} <\/a> {else} <span class=\"f-menu-pop-l-i-link\" onclick=\"document.fireEvent(\'fatmenuLinkClick\');\" data-level=\"level3\" data-type=\"popular\" > ${link.title} <\/span> {\/if} <\/li> {\/for} <\/ul> <\/div> <\/div> {\/if} {if node.children.columns} <div class=\"f-menu-cols{if !node.children.popular} no-popular{\/if}\"> <div class=\"f-menu-cols-b clearfix\" name=\"second_menu\"> {for column in node.children.columns} <ul class=\"f-menu-cols-b-i\"> {for column_item in column} <li class=\"f-menu-sub\"> {if column_item.title.displaying_mode == \'only_menu\' || column_item.title.displaying_mode == \'page_menu\'} {if column_item.title.href} <a href=\"${column_item.title.href}\" class=\"f-menu-sub-title-link novisited\" onclick=\"document.fireEvent(\'fatmenuLinkClick\');\" data-level=\"level2\" >{if column_item.title.icon}<span class=\"f-menu-sub-title-link-icon responsive-img\">${column_item.title.icon}<\/span>{\/if}${column_item.title.title}<\/a> {else} <span class=\"f-menu-sub-title\" onclick=\"document.fireEvent(\'fatmenuLinkClick\');\" data-level=\"level2\" >{if column_item.title.icon}<span class=\"f-menu-sub-title-icon responsive-img\">${column_item.title.icon}<\/span>{\/if}${column_item.title.title}<\/span> {\/if} <ul class=\"f-menu-sub-l\"> {if column_item.links} {for link in column_item.links} {if link.displaying_mode == \'only_menu\' || link.displaying_mode == \'page_menu\'} <li class=\"f-menu-sub-l-i\"> {if link.href} <a href=\"${link.href}\" class=\"f-menu-sub-l-i-link blacklink\" onclick=\"document.fireEvent(\'fatmenuLinkClick\');\" data-level=\"level3\" > ${link.title} <\/a> {else} <span class=\"f-menu-sub-l-i-link\" onclick=\"document.fireEvent(\'fatmenuLinkClick\');\" data-level=\"level3\" > ${link.title} <\/span> {\/if} <\/li> {\/if} {\/for} {\/if} <\/ul> {\/if} <\/li> {\/for} <\/ul> {\/for} {if all_categories_link} <a href=\"${all_categories_link}\" class=\"f-menu-all-cat-link novisited\">Усі категорії<\/a> {\/if} {if node.children.logos} <ul class=\"f-menu-producers-l\"> {for logo in node.children.logos} <li class=\"f-menu-producers-i\"> {if logo.href} <a href=\"${logo.href}\" class=\"f-menu-producers-link responsive-img\"> ${logo.img} <\/a> {else} <span class=\"f-menu-producers-link responsive-img\"> ${logo.img} <\/span> {\/if} <\/li> {\/for} <\/ul> {\/if} <\/div> <\/div> {\/if}',action:'',use_redis:false,hide_delay:500,parent_name:'nav-m-main',parent_hover_class:'hover-layer',parent_hover_position_class:'m-menu-btn-hover',last_level_show_delay:600,submenu:{options:{selectors:{menuItems:'[name="m-main-i-l"]'},use_drop_menu_lower_right_point:true,menu:'sub',last_level_show_delay:650}}},_show_by_mouseenter:true,_mouseenter_show_timeout:300,_mouseenter_show_timeout_handler:null},menu_height_fixed:false,max_height:0,max_height_items:[],initialize:function(options,children_data){this.setOptions(options);this.options.main_menu_options.can_hide=this.options.can_hide;this.button=$(this.options.selectors.button);this.main_menu=new RozetkaMenuClass(this.options.selectors.menu,this.options.main_menu_options,null,children_data);if(this.button){if(this.options._show_by_mouseenter){this.button.addEvent('mouseenter',function(e){if(!this.options.can_hide){this.main_menu.toggleParentContainer('add')}this.button_mouseenter=true;if(!this.options._mouseenter_show_timeout_handler&&this._isMainMenuHidden()){this.options._mouseenter_show_timeout_handler=this._onButtonClick.delay(this.options._mouseenter_show_timeout,this,e)}this.main_menu._getData()}.bind(this));this.button.addEvent('mouseleave',function(){this.button_mouseenter=false;this._clearMouseEnterTimeout()}.bind(this));this.main_menu.parent_main_container.addEvent('mouseleave',function(){if(!this.main_menu.parent_main_container.hasClass(this.options.main_menu_options.parent_hover_class)&&!this.options.can_hide){this.main_menu.toggleParentContainer('remove')}if(!this._isMainMenuHidden()){this._onButtonClickDelay.delay(this.options.main_menu_options.hide_delay,this)}}.bind(this));this.main_menu.addEvent('fatMenuLeave',function(){if(!this.button_mouseenter&&!this.options.can_hide){this.main_menu.toggleParentContainer('remove')}if(!this.button_mouseenter&&!this._isMainMenuHidden()){this._onButtonClick()}$(this.options.selectors.menu).setStyle('height','auto')}.bind(this))}else{this.button.addEvent('click',this._onButtonClick.bind(this))}}this.options.can_hide&&document.addEvent('click',function(e){var target=new Event(e).target,mouseenter_condition=true;if(this.options._show_by_mouseenter&&(this.button.id!=target.id||this.button.contains(target))){mouseenter_condition=false}if(!this._isMainMenuHidden()&&!this.main_menu.menu.contains(target)&&mouseenter_condition){this._onButtonClick()}}.bind(this));this.main_menu.addEvent('showSecondLevel',function(li,second_level){if(!this.menu_height_fixed&&second_level){this.max_height=this._getMaxHeight();$(this.options.selectors.parent_block).setStyle('height',this.max_height);this.menu_height_fixed=true}if(second_level){if(this.max_height){$(this.options.selectors.menu).setStyle('height',this.max_height)}this._updateMenuHeight(li,li.getProperty('menu_id'))}else{$(this.options.selectors.menu).setStyle('height','auto')}}.bind(this));App.addEvent('timedLastResize',this._afterResize.bind(this));this.max_height=this._getMaxHeight()},_onButtonClickDelay:function(){if(!this._isMainMenuHover()){this._onButtonClick()}},_isMainMenuHidden:function(){return this.main_menu.menu.hasClass('hidden')},_isMainMenuHover:function(){return this.main_menu.menu.hasClass('hover')},_clearMouseEnterTimeout:function(){if(this.options._mouseenter_show_timeout_handler){clearTimeout(this.options._mouseenter_show_timeout_handler);this.options._mouseenter_show_timeout_handler=null}},_onButtonClick:function(e){if(e){new Event(e).stop()}this.main_menu._getData();if(this.options._show_by_mouseenter){this._clearMouseEnterTimeout()}if(this.options.can_hide){if(this._isMainMenuHidden()){$(document).fireEvent('openFatMenu',{extend_event:[{name:'eventContent',value:'level1'}]})}this.toggleMenu();this.main_menu.toggleParentContainer()}},toggleMenu:function(){this.main_menu.menu.toggleClass('hidden');this.button.toggleClass('pressed')},_updateMenuHeight:function(el,id){this.max_height=this._getMaxHeight();if(!this.max_height_items[id]&&el.getElement(this.options.selectors.second_level_menu_block)){this.max_height_items[id]=el.getElement(this.options.selectors.second_level_menu_block).getSize().size.y}if(this.max_height<this.max_height_items[id]){$(this.options.selectors.menu).setStyle('height',this.max_height_items[id]);this.max_height=this.max_height_items[id]}},_getMaxHeight:function(){return this.max_height||$(this.options.selectors.parent_block).getCoordinates().height},_afterResize:function(){this.max_height_items=[];this.max_height=0}});RozetkaFatmenu_class.implement(new Options());var RozetkaStretchBanner=new Class({_banners:[],_actual_banner:null,options:{selectors:{main_block:'stretch_banner',banner_place:'head_banner',close_block:'head_banner_close_block',close_btn:'head_banner_close'},tpl:'{if is_object} <div class=\"banner-object\" style=\"background:${color}\"> <object onmousedown=\"head_banner.fireEvent(\'clickBanner\', [\'${alt}\', \'stretch\', null, \'Stretch\', \'click\'])\" classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" codebase=\"http:\/\/download.macromedia.com\/pub\/shockwave\/cabs\/flash\/swflash.cab#version=5,0,0,0\" width=\"${width}\" height=\"${height}\" align=\"top\"> <param name=\"movie\" value=\"${src}?url=${url}\"> <param name=\"quality\" value=\"high\"> <param name=\"bgcolor\" value=\"#FFFFFF\"> <param name=\"wmode\" value=\"transparent\"> <embed src=\"${src}?url=${url}\" menu=\"false\" quality=\"high\" width=\"${width}\" height=\"${height}\" name=\"intro\" align=\"top\" wmode=\"transparent\" type=\"application\/x-shockwave-flash\" pluginspage=\"http:\/\/www.macromedia.com\/go\/getflashplayer\" bgcolor=\"#FFFFFF\"> <\/embed> <\/object> <\/div> {elseif url==\'\'} <div name=\"head_banner\" style=\"background:${color}\" class=\"responsive-img\"><img src=\"${src}\" width=\"${width}\" height=\"${height}\" alt=\"${alt}\" \/><\/div> {else} <a name=\"head_banner\" href=\"${url}\" target=\"${url_target}\" style=\"background:${color}\" class=\"responsive-img\"> <img src=\"${src}\" width=\"${width}\" height=\"${height}\" alt=\"${alt}\" \/> <\/a> {\/if}',class_name:'',cookie_name:'banners',cookie_options:{duration:10,path:'/'}},initialize:function(banners,options){this.attachToObserver([]);this.setOptions(options);this._banners=banners||[]},append:function(){if(this.hasBanner()&&this._checkCookie()){if(this.getActualBanner().color!='#FFF'&&this.getActualBanner().color!='#fff'){$(this.options.selectors.main_block).setStyle('border-bottom',0)}this._addCloseEvent();this.head_banner=this.getContainer('banner_place');this.head_banner.addClass(this.options.class_name);this.head_banner.setHTML(App.getHTML(this.options.tpl,this.getActualBanner()));this.addEventOnBannerClick();this._setGTMEvents()}},addEventOnBannerClick:function(){var banner=this.head_banner.getElement('[name="head_banner"]');if(banner){banner.addEvent('click',function(e){this._trackEvent('click')}.bind(this))}},_trackEvent:function(action){if(this.head_banner){var content=null,img=this.head_banner.getElement('img');if(img){content=img.getAttribute('alt')}this.fireEvent('clickBanner',[content,'stretch',this.head_banner,'Stretch',action])}},getContainer:function(id){return $(this.options.selectors[id])},removeContainer:function(){this._removeBlock(this.options.selectors.main_block)},getActualBanner:function(){if(this._banners.length&&!this._actual_banner){this._actual_banner=this._banners.getRandom()}return this._actual_banner},_setGTMEvents:function(){GTMData_Banners.setEventDataImpression(this.getActualBanner().alt,'stretch',this.head_banner,'Stretch')},hasBanner:function(){return!!this.getActualBanner()},_addCloseEvent:function(){if(this.getActualBanner().can_be_closed!="0"){$$('[name='+this.options.selectors.close_block+']').forEach(function(el){el.show()});$(this.options.selectors.close_btn).addEvent('click',function(){if(!this.banners_time){this.banners_time={}}this.banners_time[this.getActualBanner().identifier]=new Date().getTime().toInt()+60*60*1000;Cookie.set(this.options.cookie_name,JSON.stringify(this.banners_time),this.options.cookie_options);this._removeBlock(this.options.selectors.main_block)}.bind(this))}},_checkCookie:function(){var result=true,now=new Date().getTime();this.banners_time=App.getService('JSON').parse(Cookie.get(this.options.cookie_name));if(typeof this.banners_time=='object'&&this.banners_time[this.getActualBanner().identifier]&&this.banners_time[this.getActualBanner().identifier]>now){result=false}return result},_removeBlock:function(id){return $(id)&&$(id).remove()}});RozetkaStretchBanner.implement(new Events,new Options);var ToggleBlocks_class=new Class({Class:'ToggleBlocks_class',options:{event:'click',stop_events:true,stop_propagation_events:false,effects:{show:[],hide:[]}},container:null,blocks:null,initialize:function(container){this.blocks=[];this.container=container},setBlock:function(element,handler,name,active){var index=this.blocks.length,block={active:active,handler:$$(this.initElements(handler,this.container)),element:$$(this.initElements(element,this.container)),name:name||this.Class+index};if(!block.element.length&&element&&$type(element.show)=="function"&&$type(element.hide)=="function"){block.element.push(element)}this.blocks.push(block);this._initEvents(this.blocks[index]);active?this._showBlock(this.blocks[index]):this._hideBlock(this.blocks[index]);return this},addBlock:function(element,name){var blocks=this.getBlocks(name);if(blocks.length){blocks.each(function(block){block.element.push(element);block.active?this._showBlock(block):this._hideBlock(block)},this)}else{this.setBlock(element,null,name)}return this},addHandler:function(handler,action,name){this.getBlocks(name).each(function(block){if(!block.handler.push){block.handler=$$(block.handler)}block.handler.push(handler);this._initEvents({name:block.name,handler:handler,action:action})},this);return this},display:function(name,e,get_display_result,display_popup){if('undefined'==typeof display_popup){display_popup=true}var show_blocks,active_blocks,displayed=false;e&&this.options.stop_events&&new Event(e).stop();e&&this.options.stop_propagation_events&&new Event(e).stopPropagation();show_blocks=this.getBlocks(name);if(!display_popup||(display_popup&&this._isDisplayAllowed(show_blocks,e,display_popup))){active_blocks=this.getActiveBlocks();active_blocks.diff(show_blocks).each(this._hideBlock,this);show_blocks.diff(active_blocks).each(this._showBlock,this);displayed=true}return get_display_result?displayed:this},getBlocks:function(name){return name===undefined?[this.blocks.getLast()]:this.blocks.filter(this._condition.bindAsEventListener(this,name))},getActiveBlocks:function(){return this.getBlocks(true).filter(function(block){return block.active})},_initEvents:function(block){block.handler&&block.handler.addEvent(block.action||this.options.event,function(e){this.display(block.name,e)}.bind(this))},_condition:function(block,key){var key_condition=false;if(key===true){key_condition=true}else if(typeof key=='number'||typeof key=='string'){key_condition=key==block.name}else if(typeof key=='object'){key_condition=block.handler.contains(key)}return key_condition},isDisplayAllowed:function(name,e,display_popup){show_blocks=this.getBlocks(name);return this._isDisplayAllowed(show_blocks,e,display_popup)},_isDisplayAllowed:function(show_blocks,e){return!!show_blocks.length},_showBlock:function(block){block.active=true;block.handler&&block.handler.addClass('active');block.element&&block.element.show();this._effectsApply(this.options.effects.show,block)},_hideBlock:function(block){block.active=false;block.handler&&block.handler.removeClass('active');block.element&&block.element.hide();this._effectsApply(this.options.effects.hide,block)},_effectsApply:function(effects,block){if(effects&&block){effects.each(function(effect){effect(block)})}}});ToggleBlocks_class.implement(new Options(),new InitElements());var ActiveBlocks_class=ToggleBlocks_class.extend({Class:'ActiveBlocks_class',addOnFn:function(onShow,onHide,name){this.getBlocks(name).each(function(block){if(onShow){block.onShow=onShow}if(onHide){block.onHide=onHide}},this);return this},addDisplayAllowedFn:function(displayAllowedFn,name){this.getBlocks(name).each(function(block){if(displayAllowedFn){block.displayAllowedFn=displayAllowedFn}},this);return this},_isDisplayAllowed:function(show_blocks,e,display_popup){return this.parent(show_blocks)&&show_blocks.every(function(block){return!block.displayAllowedFn||block.displayAllowedFn(block,e,display_popup)})},_showBlock:function(block){block.onShow&&block.onShow(block);this.parent(block);this.fireEvent('Show',block)},_hideBlock:function(block){block.onHide&&block.onHide(block);this.parent(block);this.fireEvent('Hide',block)},getBlockNames:function(){var block_names=[];this.getBlocks(true,true).each(function(block){block_names.push(block.name)});return block_names}});ActiveBlocks_class.implement(new Events());var DynamicBlocks_class=ActiveBlocks_class.extend({Class:'DynamicBlocks_class',disableBlock:function(name){this.getBlocks(name).each(function(block){block.disabled=true;if(block.active){var first_enable=this.getBlocks(true).shift();first_enable&&this._showBlock(first_enable)}this._hideBlock(block);block.handler&&block.handler.hide()},this)},enableBlock:function(name){this.getBlocks(name,true).each(function(block){block.disabled=false;block.handler&&block.handler.show()},this)},getBlocks:function(name,with_disabled){return with_disabled?this.parent(name):this.parent(name).filter(function(block){return!block.disabled})}});var AuthorizationBlocks_class=new Class({_class:'AuthorizationBlocks_class',options:{blocks:{simple_auth:'<div name=\"simple_auth\" class=\"hidden\"> <div class=\"clearfix auth-f-i\"> <div class=\"f-i-title-vert\">Пароль<\/div> <div class=\"auth-input-text-wrap\"> <input type=\"password\" class=\"input-text auth-input-text\" _required=\"required\" name=\"password\" tabindex=\"2\"> <\/div> <div class=\"auth-message hidden\" name=\"wrong_password_block\"> <h5 class=\"auth-forgot-pass-tooltip-title\" name=\"password_hint\"><\/h5> <p class=\"auth-forgot-pass-tooltip-note\">Перевірте розкладку клавіатури і&nbsp;Caps Lock<\/p> <span name=\"send_me_temp_pass\"><\/span> <\/div> <div name=\"recaptcha_placeholder\"> <div name=\"recaptcha\" class=\"recaptcha recaptcha-indent\" data-sitekey=\"6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU\"><\/div> <\/div> <div class=\"auth-message recaptcha-tooltip hidden\" name=\"wrong_captcha_signin_block\"> Необхiдно пiдтвердити, що ви не робот <\/div> <\/div> <div class=\"clearfix f-i auth-f-submit\"> <div class=\"auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <button class=\"btn-link-i\" id=\"signin\" name=\"auth_submit\" tabindex=\"3\">Увійти<\/button> <\/span> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/remind-password\/\" class=\"xhr novisited auth-forgot-pass-link\" name=\"forgot_button\" tabindex=\"4\">Я забув пароль<\/a> <\/div> <\/div> <\/div>',get_temp_pass:'<div name=\"get_temp_pass\" class=\"hidden\"> <div class=\"clearix f-i\"> <div name=\"recaptcha_placeholder\"> <div name=\"recaptcha-remind-pass\" class=\"recaptcha recaptcha-indent\" data-sitekey=\"6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU\"><\/div> <\/div> <div class=\"auth-message recaptcha-tooltip hidden\" name=\"wrong_captcha_remind_pass_block\"> Необхiдно пiдтвердити, що ви не робот <\/div> <div class=\"auth-remember-pass-submit\"> <span class=\"btn-link btn-link-gray auth-remember-pass-submit-btn\"> <input class=\"btn-link-i\" type=\"submit\" name=\"send_temp_pass_button\" value=\"Отримати тимчасовий пароль\" tabindex=\"2\"> <\/span> <\/div> <div name=\'remind_tries_msg\' class=\"auth-remember-pass-hint lightgray\"><\/div> <div class=\"auth-remember-pass\"> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/checkout\/#signin\" class=\"xhr novisited auth-remember-pass-link\" name=\"remembered_button\" tabindex=\"3\">Я згадав свій пароль<\/a> <\/div> <\/div> <\/div>',temp_pass_sent:'<div class=\"temp-pass-auth clearfix f-i hidden\" name=\"temp_pass_sent\"> <div class=\"auth-f-i clearfix\"> <div class=\"clearfix f-i-title-vert\"> Тимчасовий пароль <\/div> <div class=\"auth-input-text-wrap\"> <input class=\"input-text auth-input-text\" type=\"password\" _required=\"required\" name=\"password\" tabindex=\"2\"> <\/div> <div class=\"auth-message hidden\" name=\"wrong_temp_pass_block\"> <h5 class=\"auth-forgot-pass-tooltip-title\" name=\"temp_pass_hint\"><\/h5> <\/div> <div name=\"recaptcha_placeholder\"> <div name=\"recaptcha\" class=\"recaptcha recaptcha-indent\" data-sitekey=\"6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU\"><\/div> <\/div> <div class=\"auth-message recaptcha-tooltip hidden\" name=\"wrong_captcha_temp_pass_sent_block\"> Необхiдно пiдтвердити, що ви не робот <\/div> <\/div> <div class=\"clearfix auth-f-submit\"> <div class=\"auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <input class=\"btn-link-i\" type=\"submit\" name=\"temp_submit\" value=\"Увійти\" tabindex=\"4\"> <\/span> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/checkout\/#signin\" class=\"xhr novisited auth-remember-pass-link\" name=\"pass_sent_remembered_button\" tabindex=\"3\">Я згадав свій пароль<\/a> <\/div> <\/div> <\/div>'},tpl:{email_hint:'<div class=\"auth-message\"> <p class=\"auth-message-text\" name=\"email_hint\"> {if msg} ${msg} {elseif temp_pass_sent_by_phone} На&nbsp;вказаний телефон надіслано тимчасовий пароль, введіть його {else} На&nbsp;вказану адресу ел.&nbsp;пошти надіслано тимчасовий пароль, введіть його {\/if} <\/p> <\/div>',need_wait_next_try_msg:'{if (defined(\'seconds_left\'))} {var time_left = new Date((seconds_left+1) * 1000)} Ви знову зможете запитати тимчасовий&nbsp;пароль через ${(\'0\' + time_left.getMinutes()).slice(-2)}:${(\'0\' + time_left.getSeconds()).slice(-2)} {else} Перевищено ліміт запитів із&nbsp;тимчасовим паролем {\/if}',send_me_temp_pass_block:'<p class=\"auth-forgot-pass-tooltip-text\"> <a class=\"xhr\" href=\"#\" name=\"send_temp_pass\">Надішліть мені тимчасовий пароль<\/a><br> {if defined(\'login_type\') && login_type == \'phone\'} на&nbsp;вказаний телефон {else} на&nbsp;вказану адресу електронної пошти {\/if} <\/p>',message:'<div class=\"pos-fix sprite-side message code${code}\"> <a href=\"\" class=\"message-close-link\" onclick=\"clearUserMessages(event);\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite message-close-link-img\"> <\/a> ${content} <\/div>',process:preloaders.green_process_tpl},selectors:{msg:'[name="app-message"]',blocks_container:'div[name="auth_blocks"]',login:'input[name="login"]',remember:'input[name="remember"]',send_form_btn_block:'',hint_blocks:{email_hint_block:'[name="email_hint_block"]',wrong_password_block:'[name="wrong_password_block"]',wrong_temp_pass_block:'[name="wrong_temp_pass_block"]',wrong_captcha_signin_block:'[name="wrong_captcha_signin_block"]',wrong_captcha_remind_pass_block:'[name="wrong_captcha_remind_pass_block"]',wrong_captcha_temp_pass_sent_block:'[name="wrong_captcha_temp_pass_sent_block"]'},password_hint:'[name="password_hint"]',temp_pass_hint:'[name="temp_pass_hint"]',simple_auth:'[name="simple_auth"]',get_temp_pass:'[name="get_temp_pass"]',temp_pass_sent:'[name="temp_pass_sent"]',blocks:{auth:'[name="simple_auth"]',get_temp_pass:'[name="get_temp_pass"]',temp_pass_sent:'[name="temp_pass_sent"]'},handlers:{temp_submit:'[name="temp_submit"]',auth:'[name="auth_submit"]',forgot:'[name="forgot_button"]',send_temp_pass:'[name="send_temp_pass"]',get_temp_pass:'[name="send_temp_pass_button"]',remembered_button:'[name="remembered_button"]',pass_sent_remembered_btn:'[name="pass_sent_remembered_button"]',social_button_click:'[name="social_button_auth"]'},popup_source:'input[name="popup_source"]',remind_tries_msg_block:'[name="remind_tries_msg"]',send_me_temp_pass:'[name="send_me_temp_pass"]'},signin_special_event:'userSignedIn',track_email_change:false,fire_block_opening:true,blocks_type:null},form:null,elems:null,active_blocks:null,_user:null,_get_temp_pass_email_onkeyup:null,_signin_login_value:null,_temp_pass_sent_by_phone:false,_remind_password_checker:null,_init_temp_pass_sent_captcha:false,initialize:function(form,options){this.setOptions(options);this.form=form;this._insertBlocks();this._user=window['User'];this.elems=this.initElements(this.options.selectors,this.form);if(!this.form.msg){this.form.msg=this.elems.msg}this._initActiveBlocks();this._addEvents();ReCaptcha.init(this.elems.blocks.auth);ReCaptchaRemindPassword.init(this.elems.blocks.get_temp_pass);this.attachToObserver(['triesLimitExceeded','needWaitForNextTry','triesSuccessful'])},needAuth:function(msg){this.tmp_login=this.elems.login.getValue();this.elems.send_form_btn_block&&this.elems.send_form_btn_block.hide();if(msg){var login_type=this._user.getLoginType(this.tmp_login);document.fireEvent('authBlocksEmailExists',{extend_event:[{name:'eventLabel',value:(login_type==='phone'?'phoneExist':'emailExist')}]});if(!msg.field){msg.field='login'}}if(this.options.blocks_type&&this.options.fire_block_opening){document.fireEvent('authBlocksOpened',{extend_event:[{name:'eventContext',value:this.options.blocks_type}]})}this.showFieldError(msg);this.active_blocks.display('simple_auth')},showEmailHint:function(msg){this.elems.hint_blocks.email_hint_block.setHTML(App.getHTML(this.options.tpl.email_hint,{msg:msg,temp_pass_sent_by_phone:this._temp_pass_sent_by_phone}));this.elems.hint_blocks.email_hint_block.show()},showFieldError:function(msg){if(msg&&msg.content&&msg.field){if(msg.field=='password'){this.showPasswordHint(msg.content);document.fireEvent('authBlocksWrongPassword')}else if(msg.field=='login'){this.showEmailHint(msg.content)}}},showPasswordHint:function(msg){var active_block=this.active_blocks.getActiveBlocks().pop(),password_field=this._getPasswordField(),block,hint;if(msg){if(active_block.name=='simple_auth'){block=this.elems.hint_blocks.wrong_password_block;block.getElement(this.options.selectors.send_me_temp_pass).setHTML(App.getHTML(this.options.tpl.send_me_temp_pass_block,{login_type:this._user.getLoginType(this.elems.login.value)}));block.getElement(this.options.selectors.handlers.send_temp_pass).addEvent('click',this._sendTempPass.bind(this));hint=this.elems.password_hint}else if(active_block.name=='pass_sent'){block=this.elems.hint_blocks.wrong_temp_pass_block;hint=this.elems.temp_pass_hint}hint.setHTML(msg);block.show()}password_field.value='';password_field.focus();password_field.highlightError()},_getPasswordField:function(){var field,active_blocks=this.active_blocks.getActiveBlocks();if(active_blocks.length){field=active_blocks.pop().element.getElement('[name="password"]')[0]}return field},getPassword:function(){var password;if(this._getPasswordField()){password=this._getPasswordField().getValue()}return password},_hideHints:function(){var active_block=this.active_blocks.getActiveBlocks().pop();if(active_block&&active_block.name=='simple_auth'){this.elems.hint_blocks.email_hint_block.hide();this.elems.hint_blocks.wrong_password_block.hide()}else if(active_block&&active_block.name=='pass_sent'){this.elems.hint_blocks.wrong_temp_pass_block.hide()}},checkErrorField:function(e){return e.field=='password'||e.field=='login'},hideAllBlocks:function(){this.active_blocks&&this.active_blocks.getActiveBlocks().each(function(block){this.active_blocks._hideBlock(block)}.bind(this));Object.each(this.elems.hint_blocks,function(elem){elem.hide()});this.elems.send_form_btn_block&&this.elems.send_form_btn_block.show()},_insertBlocks:function(){var container=this.form.getElement(this.options.selectors.blocks_container);container.innerHTML='';Object.each(this.options.blocks,function(tpl){container.innerHTML+=App.getHTML(tpl,{})}.bind(this))},_initActiveBlocks:function(){this._get_temp_pass_email_onkeyup=function(e){e=new Event(e).stop();this.elems.hint_blocks.email_hint_block.hide();if(e.code==13&&this.elems.login.isValid()&&!this.elems.handlers.get_temp_pass.getProperty('disabled')){this._sendTemporaryPassword()}}.bind(this);this.active_blocks=new ActiveBlocks_class(this.form).setBlock(this.elems.blocks.auth,this.elems.handlers.remembered_button,'simple_auth',false).addHandler(this.elems.handlers.pass_sent_remembered_btn).addOnFn(null,function(){this.elems.hint_blocks.email_hint_block.hide();this.elems.hint_blocks.wrong_password_block.hide();this._getPasswordField().highlightReset()}.bind(this)).setBlock(this.elems.blocks.get_temp_pass,this.elems.handlers.forgot,'forgot',false).addOnFn(function(){document.fireEvent('authBlocksForgotPassword',{extend_event:[{name:'eventLocation',value:this.options.blocks_type}]});this.elems.login.addEvent('keyup',this._get_temp_pass_email_onkeyup)}.bind(this),function(){this.elems.hint_blocks.email_hint_block.hide();this.elems.login.removeEvent('keyup',this._get_temp_pass_email_onkeyup)}.bind(this)).setBlock(this.elems.blocks.temp_pass_sent,null,'pass_sent',false).addOnFn(function(){if(!this._init_temp_pass_sent_captcha){ReCaptcha.init(this.elems.blocks.temp_pass_sent);this._init_temp_pass_sent_captcha=true}else{ReCaptcha.tryShowCaptcha(this.elems.blocks.temp_pass_sent)}this.showEmailHint();this.elems.login.setProperty('disabled','disabled')}.bind(this),function(){this.elems.hint_blocks.email_hint_block.hide();this.elems.login.removeProperty('disabled')}.bind(this))},_sendTemporaryPassword:function(){this._hideErrorMessage();this.form.processStart(this.options.tpl.process);this._user.sendTemporaryPassword(this.elems.login.value,this.elems.blocks.get_temp_pass,this._onSendTempPass.bind(this))},_addEvents:function(){var rememberButtonClick=function(){document.fireEvent('authBlocksRememberedPassword')};this._addSubmitEvents();if(this.options.track_email_change){this.elems.login.addEvent('keyup',this._onEmailFieldChange.bind(this))}this.elems.handlers.get_temp_pass.addEvent('click',this._sendTempPass.bind(this));this.elems.handlers.remembered_button.addEvent('click',rememberButtonClick);this.elems.handlers.pass_sent_remembered_btn.addEvent('click',rememberButtonClick);document.addEvent('ShowSocialPopup',this._onShowSocialPopUp.bind(this))},_sendTempPass:function(e){new Event(e).stop();this.elems.login.highlightReset();this.active_blocks.display('forgot');this._checkTempPassErrors();if(this.elems.login.isValid()){if(!ReCaptchaRemindPassword.check(this.elems.blocks.get_temp_pass,true)){this.elems.hint_blocks.wrong_captcha_remind_pass_block.show()}else{this.elems.hint_blocks.wrong_captcha_remind_pass_block.hide();this._sendTemporaryPassword()}}else{this.elems.login.highlightError()}},_onShowSocialPopUp:function(){this._hideHints();this._resetErrorMessage()},_onSendTempPass:function(resp){this.form.processStop();var response=new Response_class(resp);this._temp_pass_sent_by_phone=$defined(response.content)&&$defined(response.content.send_by_phone)&&response.content.send_by_phone.toInt();if(response.isDone()){document.fireEvent('authBlocksGetTempPass',{extend_event:[{name:'eventContext',value:this._temp_pass_sent_by_phone?'phone':'email'}]});this.active_blocks.display('pass_sent');this._hideHints()}else if(this.checkErrorField(response.Message)){ReCaptchaRemindPassword.tryShowCaptcha(this.elems.blocks.get_temp_pass);this._hideHints();this.showFieldError(response.Message)}else if(this._temp_pass_sent_by_phone){var login=this.elems.login.getValue();this._getRemindPasswordChecker().updateData(login,response.content);this._getRemindPasswordChecker().checkNextTryTime(this.elems.login);this.elems.login.addEvent('input',this._checkTempPassErrors.bind(this))}else if(!this._showErrorMessage(response.Message)){App.showMessage(response.Message)}},_checkTempPassErrors:function(){this._getRemindPasswordChecker().checkNextTryTime(this.elems.login)},onTriesLimitExceeded:function(e){var event_data=e[0];if(event_data.element===this.elems.login){this.elems.login.setProperty('blocked',true);this._disableTempPassButton();this.elems.remind_tries_msg_block.show();this.elems.remind_tries_msg_block.setHTML(App.getHTML(this.options.tpl.need_wait_next_try_msg,{}))}},onNeedWaitForNextTry:function(e){var event_data=e[0];if(event_data.element===this.elems.login){this.elems.login.setProperty('blocked',true);this._disableTempPassButton();this.elems.remind_tries_msg_block.show();this.elems.remind_tries_msg_block.setHTML(App.getHTML(this.options.tpl.need_wait_next_try_msg,{seconds_left:event_data.seconds_left}))}},onTriesSuccessful:function(e){var event_data=e[0];if(event_data.element===this.elems.login){this.elems.login.removeProperty('blocked');this._enableTempPassButton();this.elems.remind_tries_msg_block&&this.elems.remind_tries_msg_block.hide()}},_enableTempPassButton:function(){this.elems.handlers.get_temp_pass.removeProperty('disabled');this.elems.handlers.get_temp_pass.getParent().removeClass('disabled')},_disableTempPassButton:function(){this.elems.handlers.get_temp_pass.setProperty('disabled','disabled');this.elems.handlers.get_temp_pass.getParent().addClass('disabled')},_getRemindPasswordChecker:function(){if(this._remind_password_checker===null){this._remind_password_checker=new TriesManager_class()}return this._remind_password_checker},_onEmailFieldChange:function(){var active_block=this.active_blocks.getActiveBlocks().pop();if(active_block&&active_block.name=='simple_auth'&&this.elems.login.isValid()&&this.elems.login.getValue()!=this.tmp_login){this.hideAllBlocks()}},_addSubmitEvents:function(){this._on_sign_in=this._onSignIn.bind(this);this._on_sign_in_failed=this._onSignInFailed.bind(this);this._user.addEvent('signIn',this._on_sign_in);this.elems.handlers.auth.addEvent('click',this._onSubmit.bind(this));this.elems.handlers.temp_submit.addEvent('click',this._onSubmit.bind(this))},_onSignIn:function(S){this.form.processStop();this._user.removeEvent('signIn',this._on_sign_in);this._user.removeEvent('signInFailed',this._on_sign_in_failed);this.hideAllBlocks();if(this.options.blocks_type&&!OAuth2.type&&!Cookie.get('createUserFromSocial')&&!App.getService('User').options.is_signup){document.fireEvent('authBlocksSignIn',{extend_event:[{name:'eventAction',value:'signin'},{name:'eventLabel',value:this.options.blocks_type},{name:'eventContext',value:this._user.getLoginType(this._signin_login_value)}]})}this.fireEvent('authBlocksUserSignIn',S);if(this.options.signin_special_event){document.fireEvent(this.options.signin_special_event)}this._signin_login_value=null},_onSignInFailed:function(data){var active_block=this.active_blocks.getActiveBlocks().pop();var captcha_block=(active_block.name=='pass_sent')?this.elems.blocks.temp_pass_sent:this.elems.blocks.auth;ReCaptcha.tryShowCaptcha(captcha_block);var msg=data.response;this.form.processStop();this._user.removeEvent('signInFailed',this._on_sign_in_failed);if(this.checkErrorField(msg)){this.showFieldError(msg)}else if(!this._showErrorMessage(msg)){App.showMessage(msg)}this._signin_login_value=null},_onSubmit:function(e){var active_block=this.active_blocks.getActiveBlocks().pop(),remember=false;new Event(e).stop();if(this.form.checkFields()&&active_block.name!='forgot'){this._hideHints();var captcha_block,hint_block;if(active_block.name=='pass_sent'){captcha_block=this.elems.blocks.temp_pass_sent;hint_block=this.elems.hint_blocks.wrong_captcha_temp_pass_sent_block}else{captcha_block=this.form;hint_block=this.elems.hint_blocks.wrong_captcha_signin_block}if(!ReCaptcha.check(captcha_block,true)){hint_block.show()}else{hint_block.hide();this.form.processStart(this.options.tpl.process);this._hideErrorMessage();this._user.addEvent('signInFailed',this._on_sign_in_failed);this._user.addEvent('signIn',this._on_sign_in);if(this.elems.remember&&this.elems.remember.getValue()){remember=this.elems.remember.getValue()}var signin_source=this.elems.popup_source?this.elems.popup_source.value:this.options.blocks_type=='commentAnswer'?'comment':'popup';var params={login:this.elems.login.getValue(),password:this.getPassword(),remember:remember,temp_pass_sent:(active_block.name=='pass_sent')?1:0},captcha_resp=ReCaptcha.getResponseElem(captcha_block);if(captcha_resp){params['g-recaptcha-response']=captcha_resp.value}this._signin_login_value=this.elems.login.getValue();this._user.trySignIn(params,signin_source)}}},_showErrorMessage:function(msg){var result=false;if(this.form.msg){this.form.msg.setHTML(msg.getContentTpl(this.options.tpl.message));this.form.msg.show();result=true}return result},_hideErrorMessage:function(){if(this.form.msg){this.form.msg.hide()}},_resetErrorMessage:function(){if(this.form.msg){this.form.msg.setHTML('');this.form.msg.show()}}});AuthorizationBlocks_class.implement(new Options(),new InitElements(),new Events());var Partners_class=new Class({Class:'Partners_class',elem_header:null,elem_footer:null,elem_footer_note:null,elem_contacts:null,elem_contacts_note:null,elem_contacts_managers_block:null,ga_name:'google_analytics',partner_id:null,records:null,cookie_installed:false,options:{id:'',footer_phone_id:'',footer_phone_note_id:'',contacts_phone_id:'',contacts_phone_note_id:'',contacts_managers_block_id:''},initialize:function(records){this.records=records;this.partner_id=this._getPartnerId();if(this.partner_id){this._savePartnerToCookie(this.partner_id)}},init:function(id){this.elem_header=(this.options.id)?$(this.options.id):null;if(this.elem_header){this._updatePhones(this.elem_header)}},initFooter:function(id){this.elem_footer=(this.options.footer_phone_id)?$(this.options.footer_phone_id):null;this.elem_footer_note=(this.options.footer_phone_note_id)?$(this.options.footer_phone_note_id):null;if(this.elem_footer){this._updatePhones(this.elem_footer);if(this.partner_id&&this.records[this.partner_id]&&this.elem_footer_note&&this.records[this.partner_id].need_to_hide_phone){this.elem_footer_note.setHTML("")}}},initContacts:function(id){this.elem_contacts=(this.options.contacts_phone_id)?$(this.options.contacts_phone_id):null;this.elem_contacts_note=(this.options.contacts_phone_note_id)?$(this.options.contacts_phone_note_id):null;this.elem_contacts_managers_block=(this.options.contacts_managers_block_id)?$(this.options.contacts_managers_block_id):null;if(this.elem_contacts){this._updatePhones(this.elem_contacts);if(this.partner_id&&this.records[this.partner_id]){if(this.elem_contacts_note&&this.records[this.partner_id].need_to_hide_phone){this.elem_contacts_note.setHTML("")}if(this.elem_contacts_managers_block&&this.records[this.partner_id].need_to_hide_phones_in_contact){this.elem_contacts_managers_block.setHTML("")}}}},_updatePhones:function(elem){if(this.partner_id&&this.records[this.partner_id]&&elem){if(this.records[this.partner_id].need_to_hide_phone){elem.setHTML("")}else if(this.records[this.partner_id].phone){elem.setHTML(this.records[this.partner_id].phone)}}},_getPartnerId:function(){var partner_id=false;var pr;if(partner_id=this._getPartnerIdByUrl(document.location.href)){}else if(partner_id=Cookie.get('partner_id')){}else if(pr=Cookie.get('pr')){partner_id=this._getPartnerIdByReferrer(pr)}return partner_id},_savePartnerToCookie:function(partner_id){if(!this.cookie_installed){Cookie.set('partner_id',partner_id,{duration:45,domain:'rozetka.com.ua',path:'/'});Cookie.remove('pr',{domain:'rozetka.com.ua',path:'/'});this.cookie_installed=true}},_getPartnerIdByReferrer:function(host){var result;for(var id in this.records){if(this.records[id].patterns){result=this.records[id].patterns.some(function(item){return this._checkHostByPattern(item,host)},this);if(result){result=id;break}}}return result},_getPartnerIdByUrl:function(url){var params=App.parseGET(App.parseURL(url).search);var partner_id=null;var gclid=$defined(params.gclid)?params.gclid:null;var utm_source=$defined(params.utm_source)?params.utm_source:null;if(gclid||utm_source){for(var id in this.records){if(gclid&&this.records[id].name&&this.records[id].name==this.ga_name){return id}if(utm_source&&this.records[id].name&&this.records[id].name==utm_source){partner_id=id}}}return partner_id},_checkHostByPattern:function(pattern,host){pattern=pattern.replace(/\./g,'\\\.').replace(/\*/g,'.+');pattern='^'+pattern+'$';return host.test(pattern)},isAddCode:function(){return this.partner_id&&this.records[this.partner_id]&&this.records[this.partner_id].is_add_id}});Partners_class.implement(new Options,new Events);var RozetkaPartners_class=Partners_class.extend({Class:'RozetkaPartners_class',storage:null,initialize:function(records,storage){this._initStorageService(storage);this.parent(records)},_savePartnerToCookie:function(partner_id){this.storage.set('partner_id',partner_id);this.parent(partner_id)},_initStorageService:function(storage){this.storage=storage;if(!this.partner_id&&storage.exist('partner_id')){this.partner_id=parseInt(storage.get('partner_id'));this._savePartnerToCookie(this.partner_id)}}});var RozetkaCopyText_class=new Class({options:{text:''},copy_el:null,copy_el_id:null,copy_el_class:null,min_length:null,initialize:function(){return this},init:function(name,id,template,min_length){var i,item;if($type(name)=='string'){var item=$$('div.'+name)[0];if(item){item.addEvents({'mousedown':this.removeTextToCopy.bind(this),'mouseup':this.addTextToCopy.bind(this)})}}else if($type(name)=='array'){for(i=0;i<name.length;++i){item=$$('div.'+name[i])[0];if(item){item.addEvents({'mousedown':this.removeTextToCopy.bind(this),'mouseup':this.addTextToCopy.bind(this)})}}}this.min_length=min_length?min_length:30;this.copy_el_id=id?id:'copyinfo';this.copy_el=new Element('span',{'id':this.copy_el_id});this.copy_template=template?template:'<br>'+this.options.text+': <a href="'+location.href+'">'+location.href+'</a>';this.copy_el.innerHTML=this.copy_template},removeTextToCopy:function(){if($(this.copy_el_id)){$(this.copy_el_id).remove()}},addTextToCopy:function(){var sel,selText,newSel;if(window.getSelection){sel=window.getSelection();selText=sel.toString();if(!selText||selText.length<this.min_length){return}newSel=sel.getRangeAt(0);selText=newSel.cloneRange();selText.collapse(false);selText.insertNode(this.copy_el);newSel.setEndAfter(this.copy_el);sel.removeAllRanges();sel.addRange(newSel)}else if(document.selection){sel=document.selection;newSel=sel.createRange();selText=newSel.text;if(!selText||selText.length<this.min_length){return}selText=newSel.duplicate();selText.collapse(false);selText.pasteHTML($(this.copy_el).outerHTML);newSel.setEndPoint("EndToEnd",selText);newSel.select()}}});RozetkaCopyText_class.implement(new Options,new Events);var RozetkaSocialButtons_class=new Class({Class:'RozetkaSocialButtons_class',_elem:null,_ul:null,url:null,encoded_url:null,options:{titles:{vkontakte:'',email:''},params:{title:null,image:null,description:null},css_properties:{ul_class:'social-share-l clearfix',li_class:'social-share-i',counter_css:'social-share-i-link-counter'},counter:false},initialize:function(id,url,twitter_link){this.url=url;this.encoded_url=encodeURIComponent(this.url);this._elem=$(id);var social_links={vkontakte:{href:'https://vkontakte.ru/share.php?url=',title:this.options.titles.vkontakte,css_class:'social-share-i-link social-share-vk clearfix',icon_css_class:'social-share-i-link-icon social-share-vk-icon sprite sprite-side',counter:{url:'https://vk.com/share.php?act=count&index=1&format=json&url=',callback:'SoccialButtonCallbackFunction.vkontakte',name:'vk'},hash:{title:'title',description:'description',image:'image'}},facebook:{href:'https://www.facebook.com/sharer.php?u=',title:'Facebook',css_class:'social-share-i-link social-share-fb clearfix',icon_css_class:'social-share-i-link-icon social-share-fb-icon sprite sprite-side',counter:{url:'https://graph.facebook.com/?id=',callback:'SoccialButtonCallbackFunction.facebook',name:'fb'},hash:{title:'t'}},google:{href:'https://plus.google.com/share?url=',title:'Google',css_class:'social-share-i-link social-share-gp clearfix',icon_css_class:'social-share-i-link-icon social-share-gp-icon sprite sprite-side'},twitter:{href:'https://twitter.com/share?url=',title:'Twitter',css_class:'social-share-i-link social-share-tw clearfix',icon_css_class:'social-share-i-link-icon social-share-tw-icon sprite sprite-side',hash:{title:'text'}},email:{href:'mailto:?body=',title:this.options.titles.email,css_class:'social-share-i-link social-share-email clearfix',icon_css_class:'social-share-i-link-icon social-share-email-icon sprite sprite-side',hash:{title:'subject'}}};if(twitter_link){social_links.twitter.href='https://twitter.com/home?status=';social_links.twitter.simple_link=1}if(!use_vk){delete social_links['vkontakte']}this.setOptions({social_links:social_links})},run:function(){this._ul=new Element('ul',{'class':this.options.css_properties.ul_class});for(var link in this.options.social_links){if(this.options.social_links[link]){this.createElements(link)}}this._ul.inject(this._elem)},getScriptSrc:function(options){var url=options['url']+this.url;if(options['callback']){url+=('&callback='+options['callback'])}return url},addCounter:function(name,a){var counter=new Element('div',{name:name,'class':this.options.css_properties.counter_css});counter.inject(a);a.addEvent('click',function(e){SoccialButtonCallbackFunction.showCounter(counter,counter.innerHTML,1)}.bind(this))},createElements:function(link){var options=this.options;this.createParams(link);var li=new Element('li',{'class':this.options.css_properties.li_class});var a=new Element('a',{href:options.social_links[link]['href'],title:options.social_links[link]['title'],'class':options.social_links[link]['css_class'],target:'_blank'});if(options.social_links[link]['icon_css_class']){var span=new Element('span',{'class':options.social_links[link]['icon_css_class']});span.innerHTML='&nbsp';span.inject(a)}a.inject(li);if(options.social_links[link]['title']=="Twitter"){this.addCounter('counter_tw',a)}if(options.social_links[link]['title']=="Google"){this.addCounter('counter_gp',a)}if(options['counter']&&$defined(options.social_links[link]['counter'])&&$defined(SoccialButtonCallbackFunction)){this.addCounter('counter_'+options.social_links[link]['counter']['name'],a);if(options.social_links[link]['counter']['name']=='vk'&&window.VK==undefined){SoccialButtonCallbackFunction.vkontakte()}App.addOnDomReady(function(){Asset.javascript(this.getScriptSrc(options.social_links[link]['counter']),{'onload':function(){this.getParent().removeChild(this)},async:''})}.bind(this))}li.inject(this._ul);var url=this.options.social_links[link]['encode']?this.encoded_url:this.url;this.addToGoogleAnalitycs(a,options.social_links[link]['title'],url)},createParams:function(link){if(this.options.social_links[link]['encode']){this.options.social_links[link]['href']+=this.encoded_url}else{this.options.social_links[link]['href']+=this.url}if(this.options.social_links[link]['hash']){if(this.options.social_links[link]['simple_link']){this.options.social_links[link]['href']+=' '+encodeURIComponent(this.options.params.title)}else{this.createHash(link)}}},createHash:function(link){for(var hash in this.options.social_links[link]['hash']){if(this.options.params[hash]){this.options.social_links[link]['href']+='&'+this.options.social_links[link]['hash'][hash]+'='+encodeURIComponent(this.options.params[hash])}}},addToGoogleAnalitycs:function(el,title,url){el.addEvent('click',function(e){document.fireEvent("socialButtonShareClick",{extend_event:[{name:'eventContent',value:title}]});App.trackSocial(title,'share',url)})}});RozetkaSocialButtons_class.implement(new Options);var RozetkaSocialButtonsCallbackFunctions_class=new Class({options:{selectors:{vkontakte:'[name=counter_vk]',facebook:'[name=counter_fb]',twitter:'[name=counter_tw]',google:'[name=counter_gp]'},short_char:'k'},showCounter:function(elem,count,inc){var str_value=count.toString(),result="0";if(str_value.indexOf(this.options.short_char)==-1){count=count.toInt()||0;result=inc?(count+inc).toString():str_value;if(result.length>3){result=result.substr(0,result.length-3)+this.options.short_char}}else{result=count}if(parseInt(result)){elem.innerHTML=result}},facebook:function(data){if(data&&data.share&&data.share.share_count){$$(this.options.selectors.facebook).each(function(elem){this.showCounter(elem,data.share.share_count)}.bind(this))}},twitter:function(data){$$(this.options.selectors.twitter).each(function(elem){this.showCounter(elem,data['count'])}.bind(this))},google:function(data){if(data.url){var ajax_request=new Ajax('https://clients6.google.com/rpc',{method:'post',data:JSON.stringify({'method':'pos.plusones.get','id':data['url'],'params':{'nolog':true,'id':data['url'],'source':'widget','userId':'@viewer','groupId':'@self'},'jsonrpc':'2.0','key':'p','apiVersion':'v1'}),onComplete:function(response){var count=0;response=JSON.parse(response);if(response.result&&response.result.metadata&&response.result.metadata.globalCounts&&response.result.metadata.globalCounts.count){count=response.result.metadata.globalCounts.count}$$(this.options.selectors.google).each(function(elem){this.showCounter(elem,count)}.bind(this))}.bind(this)});ajax_request.setHeader('Content-type','application/json');ajax_request.request()}},vkontakte:function(data){window.VK={};window.VK.Share={};window.VK.Share.count=function(index,count){$$(this.options.selectors.vkontakte).each(function(elem){this.showCounter(elem,count)}.bind(this))}.bind(this)}});var Swipe_class=new Class({Class:'Swipe_class',options:{_event_start:'touchstart',_event_end:'touchend',tolerant_step:10,ie_touch_class:'ms-touch-action-none'},_startMove:false,_startX:null,_startY:null,_element:null,initialize:function(element,swipe_callback,options){this.setOptions(options);this._element=$(element);if(window.navigator.pointerEnabled){this.options._event_start='pointerdown';this.options._event_end='pointerup';this._element.addClass(this.options.ie_touch_class)}else if(window.navigator.msPointerEnabled){this.options._event_start='mspointerdown';this.options._event_end='mspointerup';this._element.addClass(this.options.ie_touch_class)}this._element.addEvent(this.options._event_start,this._onTouchStart.bind(this));this._element.addEvent(this.options._event_end,this._onTouchEnd.bind(this));this.addEvent('swipe',swipe_callback)},_onTouchStart:function(event){if(!this._startMove&&this._isTouch(event)){var point=this._getEventPoint(event);this._startX=point.x;this._startY=point.y;this._startMove=true}},_onTouchEnd:function(event){if(this._startMove){var point=this._getEventPoint(event),x=point.x,y=point.y,horizontal=(x>this._startX)?"right":"left",vertical=(y>this._startY)?"down":"up";if(Math.abs(x-this._startX)>this.options.tolerant_step||Math.abs(y-this._startY)>this.options.tolerant_step){this.fireEvent('swipe',{horizontal:horizontal,vertical:vertical})}this._startMove=false}},_getEventPoint:function(event){var touch=this._isIE()?event:event.changedTouches[0];return{x:touch.pageX,y:touch.pageY}},_isTouch:function(event){return(this._isIE()&&event.pointerType=="touch")||(event.touches&&event.touches.length==1)},_isIE:function(){return window.navigator.pointerEnabled||window.navigator.msPointerEnabled}});Swipe_class.implement(new Options(),new Events());var RzEvalScripts_class=new Class({_runScripts:function(container){if(!window.opera){var scripts=container&&container.getElements('script');if(scripts&&scripts.length){scripts.each(this._execScript)}}},_execScript:function(script){try{if(script.innerHTML){eval(script.innerHTML)}}catch(error){App.err(error)}}});RozetkaScroller_class=new Class({options:{cloneProperties:['class','name','style'],elemsContainer:'[name=elems-container]',elems:'[name=scroll-element]',controls:'[name=controls]',screen:'[name=screen]',visibleElementsLength:4,step:3,widthScrollElement:135,width_differense:30,circular:false,catalogItemSelector:'[name=catalog_item]',paginator_elems:null,fx_opacity_duration:300,catalogItemField:'_value',spacing:0,inject_controls:true,enable_change_size:false,vector:'horizontal',cssClasses:{active:"active",hidden:"hidden"},gtm_event_data:{add_review_scroll:[{name:'eventLabel',value:'product'}],kits_scroller:[{name:'eventLabel',value:'kit'},{name:'eventLocation',value:'ProductPage'}],similar_scroller:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'similar'}],section_scroller_accessories:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'accessories'}],section_scroller_software:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'software'}],section_scroller_related:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'related'}],kits_scroller_cart:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'kitCart'},{name:'eventContent',value:'set'}],recent_goods_sroller:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'recent'}],recommend_goods_sroller:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'recommendedRecent'}],recommend_accessories_sroller:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'accessoriesLastPurchase'}],accessories_scroller_cart:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'recommendedCart'},{name:'eventContent',value:'cart'}],suite_vertical:[{name:'eventLabel',value:'product'},{name:'eventLocation',value:'suite'}],suite_horizontal:[{name:'eventLabel',value:'goods'},{name:'eventLocation',value:'suite'}],portal_scroller:[]},allow_swipe:false,num_block:null,size_scroll:0},_swiped:[],_elems:null,_paginator:[],_paginator_active_elem_index:0,_can_change_paginator:true,_sliderBlockContainer:null,_elemsContainer:null,_controls:null,_screen:null,_fx:null,parentElem:null,_count_click:{},initialize:function(parentElem){this.parentElem=parentElem;this._count_click.recent_goods_sroller=0},_setHeightElements:function(){var max_height_kit_slider=0,elements=this.parentElem.getElements(this.options.elems),controls=this.parentElem.getElements(this.options.controls);elements.each(function(elem){if(elem.getSize().size.y>max_height_kit_slider){max_height_kit_slider=elem.getSize().size.y}});elements.each(function(element){element.setStyle('height',max_height_kit_slider)});controls.each(function(elem){elem.setStyle('height',max_height_kit_slider)})},_getElements:function(){if(this._elems==null){this._elems=this.parentElem.getElements(this.options.elems)}return this._elems},_getControls:function(){if(this._controls==null){this._controls=this.parentElem.getElements(this.options.controls)}return this._controls},_getElementsContainerParent:function(){if(this._sliderBlockContainer==null){this._sliderBlockContainer=this._getContainerElement().getParent()}return this._sliderBlockContainer},_scrollToLeft:function(scroll_x_axis){if(this.options.vector=='vertical'){this._getElementsContainerParent().scrollTo(0,scroll_x_axis)}else{this._getElementsContainerParent().scrollTo(scroll_x_axis,0)}},smoothScrollToLeft:function(scroll_x_axis){if(this.options.vector=='vertical'){this._getFx().scrollTo(0,scroll_x_axis)}else{this._getFx().scrollTo(scroll_x_axis,0)}},_getContainerElement:function(){if(this._elemsContainer==null){this._elemsContainer=this.parentElem.getElement(this.options.elemsContainer)}return this._elemsContainer},_getScreen:function(){if(this._screen==null){this._screen=this.parentElem.getElement(this.options.screen)}return this._screen},_controlsClickHandler:function(e){var event=new Event(e).stop(),vector=this._getVectorControl(event.target);if(vector!=undefined&&this._isPossibleScrollByVector(vector)){this._tryScrollingByVector(vector)}},_getVectorControl:function(control){var direction;if(control.dataset){direction=control.dataset.direction}else{direction=control.getAttribute("data-direction")}return direction},_isPossibleScrollByVector:function(vector){var result=false,scroll=this._getContainerScrollLeft();if(this._getElements()&&this._getElements().length&&this._getElements().length>=this.options.visibleElementsLength){switch(vector){case'left':result=this.options.circular||scroll>0;break;case'right':result=this.options.circular||scroll<this._getLimits().right;break}}return result},_getLimits:function(){var parent_container=this._getElementsContainerParent(),result=0;if(this.options.vector=='vertical'){result=parent_container['scrollHeight']-parent_container['clientHeight']-1}else{result=parent_container['scrollWidth']-parent_container['clientWidth']-1}return{left:0,right:result}},_getFx:function(){return this._fx},_setFx:function(fx){this._fx=fx},_tryScrollingByVector:function(vector){if(this.options.circular){this._prepareNextCircularMotion(vector)}var scroll=this._getScrollByStep(vector,this.options.step!='auto'?this.options.step:this._getElementsContainerParent().offsetWidth/this.options.widthScrollElement-1.5);this.smoothScrollToLeft(scroll);if(this._paginator.length){this._changePaginatorIndexByVector(vector)}this._prepareGTMEventData(this.parentElem.getProperty('_action'),scroll);App.fireEvent('renewImages')},_prepareGTMEventData:function(action,scroll){var event_data={extend_event:[]};if(this.options.gtm_event_data.hasOwnProperty(action)){event_data.extend_event.extend(this.options.gtm_event_data[action]);if(this.options.num_block){event_data.extend_event.extend([{name:'eventField',value:this.options.num_block+' block'}])}this._fireEventScrollerUse(event_data);if(action=='kits_scroller_cart'){this._trackEventRewind(rozetkaEvents.getParam('cart_category'),scroll)}}},_fireEventScrollerUse:function(event_data){document.fireEvent('scrollerUse',event_data)},_getScrollByStep:function(vector,step){var scroll_after,limits=this._getLimits(),scroll_before=this._getContainerScrollLeft();switch(vector){case'left':scroll_after=scroll_before-(step*this.options.widthScrollElement);scroll_after=scroll_after<limits.left?limits.left:scroll_after;break;case'right':scroll_after=scroll_before+(step*this.options.widthScrollElement);scroll_after=scroll_after>limits.right?limits.right:scroll_after;break}return scroll_after},_trackEventRewind:function(action,scrollAfter){if(this._getContainerElement()){var elements=this._getContainerElement().getElements('[name=kits_item]'),position=Math.floor(Math.abs(scrollAfter)/parseInt(elements[0].getStyle('width'),10)),current_element=elements[position],kit_id=current_element.getElements('[name=kit_id]')[0],kit_number_before=elements[position].getElements('[name=kit_number]')[0];rozetkaEvents.trackEvent(action,'kit/carousel/rewind/'+kit_number_before.getText(),kit_id.getText())}},_prepareNextCircularMotion:function(vector){var scroll=this._getContainerScrollLeft(),visible_width,i;if(this._getElements().length>1){visible_width=this.options.visibleElementsLength*this.options.widthScrollElement;if(scroll==0&&vector=='left'){for(i=0;i<this.options.visibleElementsLength;++i){this._getContainerElement().getLast().injectTop(this._getContainerElement())}this._scrollToLeft(visible_width)}else if(scroll==this._getElements().length*this.options.widthScrollElement-visible_width&&vector=='right'){for(i=0;i<this.options.visibleElementsLength;++i){this._getContainerElement().getFirst().injectInside(this._getContainerElement())}this._scrollToLeft(this._getElements().length*this.options.widthScrollElement-visible_width*2)}}},_checkControlsStatus:function(){var scroll=this._getContainerScrollLeft(),limits=this._getLimits();this._getControls().each(function(control){var vector=this._getVectorControl(control);if(this.checkFillData()){switch(vector){case'left':if(!this.options.circular&&scroll==0){this._hideControl(control,vector)}else{this._showControl(control,vector)}break;case'right':if(!this.options.circular&&scroll>=limits.right){this._hideControl(control,vector)}else{this._showControl(control,vector)}break}}else{this._hideControl(control,vector)}}.bind(this))},checkFillData:function(){var container_element_size=this._getContainerElement()[this._getChangePropertyName()],parent_container_element_size=this._getBlockSize();return container_element_size>parent_container_element_size},_hideControl:function(control,vector){control.addClass(this.options.cssClasses.hidden)},_showControl:function(control,vector){control.removeClass(this.options.cssClasses.hidden)},run:function(){if(this.options.widthScrollElement=='auto'){this.changeWidthScrollElement();App.addEvent('timedResize',this.changeWidthScrollElement.bind(this))}if(this.options.visibleElementsLength=='auto'){this._computeVisibleElementsLength();App.addEvent('timedResize',this._computeVisibleElementsLength.bind(this))}this._getContainerElement().setStyle(this._getChangeStylePropertyName(),(this.options.size_scroll?this.options.size_scroll:this._getDefaultSize())+'px');this._initPaginator();if(this.options.circular){this._setCircular()}this._setFx(new Fx.Scroll(this._getElementsContainerParent(),{onComplete:this.onAfterScroll.bind(this),wheelStops:false}));this._checkControlsStatus();this._getElementsContainerParent().addEvent('scroll',this._checkControlsStatus.bind(this));if(this._getControls()&&this._getElements()&&this._getContainerElement()){this._getControls().each(function(el){el.addEvents({'click':this._controlsClickHandler.bindWithEvent(this,el)})}.bind(this))}if(this.options.enable_change_size){this._setHeightElements()}if(this.options.allow_swipe&&App.isTouchDevice()){this._addEventOnSwipe()}},_getDefaultSize:function(){return this.options.widthScrollElement*this._getElements().length},onAfterScroll:function(){if(this._paginator.length){this._can_change_paginator=true}},_addEventOnSwipe:function(){this._swiped=[];this._getElements().each(function(element){this._swiped.push(new Swipe_class(element,this._onSwipe.bind(this)))}.bind(this))},_onSwipe:function(direction){if(this.options.vector=='vertical'){this._tryScrollingByVector(direction.vertical=="down"?"up":"down")}else{this._tryScrollingByVector(direction.horizontal=="left"?"right":"left")}},_computeVisibleElementsLength:function(){this.options.visibleElementsLength=Math.ceil(this._getBlockSize()/this.options.widthScrollElement);this._checkControlsStatus()},_initPaginator:function(){var page_elems=null;if(this.options.paginator_elems){page_elems=this.parentElem.getElements(this.options.paginator_elems);this._paginator=[];if(page_elems){page_elems.each(function(elem){this._paginator.push({control:elem});elem.addEvent('click',this._onPaginatorElemClick.bind(this))}.bind(this))}}},_onPaginatorElemClick:function(e){new Event(e).stop();var target=e.target||e.srcElement,previous_key,current_key,previous,current;if(!target.getParent().hasClass('active')&&this._can_change_paginator){previous=this._getActivePaginatorControl();current=this._paginator.filter(function(elem){return elem.control==target}).pop();this._paginator_active_elem_index=Object.keyOf(this._paginator,current);this._replaceActivePaginatorControl(previous,current);this._moveByIndexes(Object.keyOf(this._paginator,previous),this._paginator_active_elem_index)}},_moveByIndexes:function(from_index,to_index){var diff=Math.abs(from_index-to_index)*this.options.visibleElementsLength,vector=diff>0?'left':'right',scroll=this._getScrollByStep(vector,diff);this._can_change_paginator=false;if(diff==this.options.visibleElementsLength){this.smoothScrollToLeft(scroll)}else{this._changeElemsByOpacity(scroll,vector)}},_changeElemsByOpacity:function(scroll,vector){new Fx.Style(this._getContainerElement(),'opacity',{duration:this.options.fx_opacity_duration,onComplete:function(){this._scrollToLeft(scroll);new Fx.Style(this._getContainerElement(),'opacity',{duration:this.options.fx_opacity_duration,onComplete:function(){if(this.options.circular){this._prepareNextCircularMotion(vector)}this._checkControlsStatus();this._can_change_paginator=true}.bind(this)}).start(1)}.bind(this)}).start(0)},_changePaginatorIndexByVector:function(vector){var prev,elem_count=this._paginator.length;if(vector=='right'){this._paginator_active_elem_index++}else if(vector=='left'){this._paginator_active_elem_index--}if(this._paginator_active_elem_index==elem_count){this._paginator_active_elem_index=0}else if(this._paginator_active_elem_index<0){this._paginator_active_elem_index=elem_count-1}prev=this._getActivePaginatorControl();this._replaceActivePaginatorControl(prev,this._paginator[this._paginator_active_elem_index])},_getActivePaginatorControl:function(){return this._paginator.filter(function(elem){return elem.control.getParent().hasClass('active')}).pop()},_replaceActivePaginatorControl:function(from,to){from.control.getParent().removeClass('active');to.control.getParent().addClass('active')},_getContainerScrollLeft:function(){var block=this._getElementsContainerParent();return block?Math.ceil(Math.round(block[this._getScrollPropertyName()]*100)/100):0},_setCircular:function(){var container=this._getContainerElement(),elements=this._getElements(),scroll_count=Math.ceil(elements.length/this.options.visibleElementsLength),rest=elements.length%this.options.visibleElementsLength,clones_for_start=0,clones_for_end=0,width=0,i=0;if(scroll_count==2){clones_for_start=this._getElementsForClone(true,true);clones_for_end=this._getElementsForClone(false,true);clones_for_start.each(function(clone){this._injectCloneElement(false,clone)}.bind(this));clones_for_end.each(function(clone){this._injectCloneElement(true,clone)}.bind(this));this._elems=null;width=this._getElements().length*this.options.widthScrollElement;container.setStyle('width',width+'px')}else if(scroll_count==3&&rest!=0){clone_for_start=this._getElementsForClone(true);clone_for_end=this._getElementsForClone();clone_for_start.each(this._injectCloneElement.bind(this,false));clone_for_end.each(this._injectCloneElement.bind(this,true));width=elements.length*this.options.widthScrollElement;container.setStyle('width',width+'px');this._elems=null}else if(scroll_count>=3){for(i=0;i<this.options.visibleElementsLength;++i){this._getContainerElement().getLast().injectTop(container)}}},_getElementsForClone:function(from_end,all_elements){var cloned_elements=[],elements=this._getElements(),i=0,start,count,rest;if(all_elements){if(from_end){start=elements.length-1}else{start=0}if(from_end){count=0}else{count=elements.length}}else{rest=elements.length%this.options.visibleElementsLength;if(from_end){start=elements.length-1}else{start=0}count=rest}if(from_end){for(i=start;i>=count;--i){cloned_elements.push(this._clone(elements[i]))}}else{for(i=start;i<count;++i){cloned_elements.push(this._clone(elements[i]))}}return cloned_elements},_clone:function(element){var clone=new Element('div');clone.setHTML(element.innerHTML);this.options.cloneProperties.each(function(property){clone.setProperty(property,element.getProperty(property))});return clone},_injectCloneElement:function(to_end,clone){var catalogItem=clone.getElement(this.options.catalogItemSelector);if(catalogItem){catalogItem.setProperty('id',catalogItem.getProperty(this.options.catalogItemField))}if(to_end){clone.injectInside(this._getContainerElement())}else{clone.injectTop(this._getContainerElement())}if(!window.gecko||window.ff4AndGreater){this._runScripts(clone)}},changeWidthScrollElement:function(){var count_left=Math.ceil(this._getContainerScrollLeft()/this.options.widthScrollElement),width=this.options.widthScrollElement=this._getElementsContainerParent().offsetWidth-this.options.width_differense,children=this._getElements(),count=children.length;children.each(function(elem){elem.setStyle('width',width+'px')});this._getContainerElement().setStyle('width',count*width+'px');if(!isNaN(count_left)){this._scrollToLeft(count_left*width)}},scrollTo:function(index){var elements=this._getElements();if(elements.length>index){this.scrollToElement(elements[index])}},isVisibleElement:function(element){var result=false,element_scroll=this.getScrollElement(element),scroll_shift=this._getContainerScrollLeft();if(element_scroll['start']>=scroll_shift&&element_scroll['end']<=(scroll_shift+this._getBlockSize())){result=true}return result},getElementByIndex:function(index){return this._getElements()[index]},_getBlockSize:function(){var block=this._getElementsContainerParent();return block?block[this._getChangePropertyName()]+1:0},getScrollElement:function(element){var elements=this._getElements(),property=this._getChangePropertyName(),flag=true,result={start:0,end:elements[0][property]};elements.each(function(el){if(flag){if(el!=element){result['start']+=el[this._getChangePropertyName()]}else{result['end']=result['start']+el[this._getChangePropertyName()]-1;flag=false}}}.bind(this));return result},scrollToElement:function(element){this._getFx().toElement(element);App.fireEvent('renewImages')},_getChangeStylePropertyName:function(){return this.options.vector=='vertical'?'height':'width'},_getChangePropertyName:function(){return this.options.vector=='vertical'?'offsetHeight':'offsetWidth'},_getScrollPropertyName:function(){return this.options.vector=='vertical'?'scrollTop':'scrollLeft'},getShiftByVector:function(vector){return vector=='left'?this.getShiftLeft():this.getShiftElement(this.getScrollElementRight())},getShiftLeft:function(){var elements=this._getElements(),decrement=false,element=this.getFirstVisibleElement(),index=elements.indexOf(element),result=0;if(!this.options.inject_controls||decrement){index--}element=elements[index];if(index>0){elements.slice(0,index+1).each(function(elem){result+=elem[this._getChangePropertyName()]}.bind(this))}result-=this._getBlockSize();return result>0?result:0},getShiftElement:function(element){var flag=true,result=0;this._getElements().each(function(elem){if(flag){if(elem!=element){result+=elem[this._getChangePropertyName()];result+=this.options.spacing}else{flag=false}}}.bind(this));return result},getScrollElementRight:function(){var elements=this._getElements(),elements_length=elements.length,increment=false,result=this.getLastVisibleElement(),index=elements.indexOf(result);if(!this.options.inject_controls||increment){index++}if(index<elements_length&&index>=0){result=elements[index]}return result},getLastVisibleElement:function(){var elements=this.getVisibleElements();return elements[elements.length-1]},getVisibleElements:function(){return this._getElements().filter(function(el){return this.isVisibleElement(el)}.bind(this))},getFirstVisibleElement:function(){return this.getVisibleElements()[0]}});RozetkaScroller_class.implement(new Options());var RozetkaSegments_Class=new Class({url:'',tpl:'',count:0,segments:null,slider:null,activeKey:null,tabLabel:null,scrollTab:null,slideElemId:null,unit_id:null,disallow_low_priority_records:'',flag:null,options:{parent:'scroll_container',ajaxAction:'getSegmentGoodsAJAX',slideElemId:'scroll',tabLabel:'tab_name',tabTitle:'',show_site_parameter:false,scroll_elem_width:175,goods_type:'scroll'},initialize:function(url,tpl,tabTitle,show_site_parameter,disallow_low_priority_records){this.segments=[];this.url=url;this.tpl=tpl;if(tabTitle){this.options.tabTitle=tabTitle}if(show_site_parameter){this.options.show_site_parameter=show_site_parameter}if(disallow_low_priority_records){this.disallow_low_priority_records=disallow_low_priority_records}},init:function(){this.slideElemId='scroll';if(this.unit_id){this.slideElemId+=this.unit_id}this.scrollTab='scroll_tab';if(this.unit_id){this.scrollTab+=this.unit_id}this.tabLabel=$(this.options.tabLabel);if(this.unit_id){this.tabLabel=$(this.options.tabLabel+this.unit_id)}this.slider=$(this.slideElemId);this.flag=false;if(this.tabLabel&&this.tabLabel.innerHTML==''){this.flag=true}},setUnit:function(id){this.unit_id=id},getSegmentData:function(){var url=this.url,pos=url.indexOf('index.html');if(pos!=-1){url=this.url.substring(0,pos)}else{pos=url.indexOf('.html');if(pos!=-1){url=this.url.substring(0,pos)+'/'}}url=url+'action='+this.options.ajaxAction;if(this.unit_id){url+=(';unit_id='+this.unit_id)}url+=(';disallow_low_priority_records='+this.disallow_low_priority_records+'/');new Ajax(url,{method:'get',onComplete:function(e){this.getResponse(e)}.bind(this),use_language:true}).request()},getResponse:function(e){var response=new Response_class(e),parent=null,last_elem=null,last=false,is_opened=false;if($defined(response.content)){parent=$(this.options.parent);if(parent){parent.show();this.is_opened=true}last_elem=response.content.getLast();response.content.each(function(data,key){if(last_elem.title==data.title){last=true}if(this.options.tabTitle){data.title=this.options.tabTitle}data.show_site_parameter=this.options.show_site_parameter;data.scroll_elem_width=this.options.scroll_elem_width;this.segments[key]=new RozetkaSegment_Class(data,this,this.tpl,key,this.tabLabel,last,this.flag);if(this.activeKey===null){this.setActiveSegmentByKey(key)}}.bind(this))}else{if(this.tabLabel){this.tabLabel.setHTML('')}}App.fireEvent('renewImages');$(document.body).fireEvent('bindToolTipEvents');this.is_opened&&document.fireEvent('updateContent')},setActiveSegmentByKey:function(key){this.segments[key].setActive();this.activeKey=key}});RozetkaSegments_Class.implement(new Options());var RozetkaSegment_Class=new Class({a:{},segments:{},data:{},tpl:'',slideElem:null,scroller:null,tabElem:null,key:null,tabLabel:null,flag:null,initialize:function(data,segments,tpl,key,tabLabel,last,flag){this.segments=segments;this.data=data;this.tpl=tpl;this.key=key;if(tabLabel){this.tabLabel=tabLabel}this.createSlideElem(last);this.drawGoods();if($defined($(this.segments.scrollTab))){this.tabElem.addEvent('click',function(e){new Event(e).stop();this.setActive()}.bind(this))}else{this.setActive()}this.flag=flag},setActive:function(){this.segments.segments.each(function(segment){segment.setLocked()});if(this.flag&&this.tabLabel){this.tabLabel.setHTML(this.data.title)}this.slideElem.setStyle('display','block');if($defined(this.tabElem)){this.tabElem.addClass('active')}this.scroller._checkControlsStatus();this.firePluginEvent('onLoadContentCarousel');App.fireEvent('renewImages')},setLocked:function(){this.slideElem.setStyle('display','none');if($defined(this.tabElem)){this.tabElem.removeClass('active')}},createSlideElem:function(last){this.slideElem=new Element('div',{styles:{display:'none'}});this.slideElem.setProperty('name','segment_'+this.key);this.slideElem.setHTML(App.getHTML(this.tpl,this.data));this.slideElem.injectInside(this.segments.slideElemId);if($defined($(this.segments.scrollTab))){this.createSlideTab(last)}this.data.goods.records.each(function(el){if(el.id){GoodsCatalog.add(el.id,this.segments.options.goods_type)}}.bind(this));document.fireEvent('updateBlockContent',this.slideElem)},createSlideTab:function(last){var spanElem=new Element('span');this.tabElem=new Element('a',{'href':'#'});if(last){this.tabElem.addClass('last')}spanElem.setHTML(this.data.title);spanElem.injectInside(this.tabElem);this.tabElem.injectInside(this.segments.scrollTab)},drawGoods:function(){this.scroller=new RozetkaScroller_class(this.segments.slider.getElement('[name=segment_'+this.key+']'));this.scroller.setOptions({widthScrollElement:this.data.scroll_elem_width,visibleElementsLength:Math.floor(this.segments.slider.offsetWidth/this.data.scroll_elem_width),step:4});this.scroller.run()}});RozetkaSegment_Class.implement(new PluginEvents_class(),new RzEvalScripts_class());var RozetkaSectionScroller_class=RozetkaScroller_class.extend({options:{countAddedItems:5,'tpl':{'template':'<div class=\"clearfix slider g-tile-fix-height\" name=\"section_scroller\" _action=\"${action}\"> <a class=\"sprite-side slider-al\" data-direction=\"left\" href=\"#\" name=\"controls\">&lt;<\/a> <a class=\"sprite-side slider-ar\" data-direction=\"right\" href=\"#\" name=\"controls\">&gt;<\/a> <div class=\"slider-inner\" name=\"slider-inner\"> <div class=\"clearfix slider-sliding-box\" name=\"elems-container\" style=\"width:${width}px\"> <\/div> <\/div> <\/div>','tpl_items':'{if data} {for item in data} ${rozetkaEvents.setGoodsData(item.ga_goods_data)} ${GTMEventsData.setGoodsData(item.id,item.ga_goods_data)} {if item.title_only} {var item_title_only = item.title_only} {else} {var item_title_only = item.title} {\/if} <div class=\"slider-i-td\" name=\"scroll-element\"> <div class=\"slider-i ${item.sell_status}\" tool_tip=\"1\" {if show_buttons}id=\"catalog_item${item.id}\"{\/if} data-location=\"${location}\" data-position=\"${parseInt(item_index)+1}\"> <input type=\"hidden\" name=\"scroll_item_id\" value=\"${item.id}\"\/> {if item.ga_goods_data.content}<input type=\"hidden\" name=\"content_gtm${item.id}\" value=\"${item.ga_goods_data.content}\" \/>{\/if} <figure class=\"g-img\"> <div class=\"g-img-inner g-img-inner-150 pos-fix\"> {if item.tag} <span class=\"g-tag g-tag-portal\"> <img alt=\"${item.tag.title}\" class=\"sprite g-tag-icon-small-${item.tag.name}\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" \/> <\/span> {\/if} <a class=\"g-i-img-link responsive-img\" onclick=\"document.fireEvent(\'goodsImageClick\',{extend_event:[{name:\'goods_id\',value:${item.id}}{if !item.is_section},{name:\'eventLocation\',value:\'${location}\'}{\/if}{if item.ga_goods_data.content},{name:\'eventContent\',value:\'${item.ga_goods_data.content}\'}{\/if}]});\" href=\"${item.href}\"> <img class=\"centering-img\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" data_src=\"${item.image.url}\" width=\"${item.image.width}\" height=\"${item.image.height}\" alt=\"${item_title_only|escape}\" title=\"${item_title_only|escape}\" \/> <\/a> <\/div> <\/figure> <div class=\"clearfix\"> <div class=\"g-id\" style=\"display: none;\">${item.id}<\/div> <\/div> <div class=\"clearfix\"> <div class=\"g-title\"> <a class=\"g-title-link\" onclick=\"document.fireEvent(\'goodsTitleClick\',{extend_event:[{name:\'goods_id\',value:${item.id}}{if !item.is_section && location},{name:\'eventLocation\',value:\'${location}\'}{\/if}{if item.ga_goods_data.content},{name:\'eventContent\',value:\'${item.ga_goods_data.content}\'}{\/if}]});\" href=\"${item.href}\" >${item.title}<\/a> <\/div> {if item.sell_status != \'available\'} <div class=\"g-i-status-wrap\"> <div class=\"g-i-status ${item.sell_status}\"> {if item.sell_status == \'limited\'} Закінчується {elseif item.sell_status == \'out_of_stock\'} Закінчився {\/if} <\/div> {if item.sell_status == \'out_of_stock\'} <div class=\"viewed-lable-out_of_stock\"> <img class=\"g-label-out_of_stock-icon sprite\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"Продано\"> <\/div> {\/if} <\/div> {\/if} {var show_old_price = parseInt(item.old_price) && parseInt(String(item.old_price).replace(\/\\s+\/g, \'\')) > parseInt(String(item.price).replace(\/\\s+\/g, \'\'))} {if show_old_price} <div class=\"g-price-old\"> <div class=\"g-price-old-inner\"> <div class=\"g-price-old-uah\"> ${item.old_price.toString().toPriceFormat()}<span class=\"g-price-old-uah-sign\">&thinsp;${item.unit}<\/span> <\/div> <\/div> <\/div> {\/if} {if item.price} <div class=\"g-price{if show_old_price} g-price-cheaper{\/if} float-lt\"> <div class=\"g-price-uah\"> ${item.price.toString().toPriceFormat()}<span class=\"g-price-uah-sign\">&thinsp;${item.unit}<\/span> <\/div> <\/div> {if scroller_location == \'accessories_tab\'} {if parseInt(item.pl_bonus_charge_pcs)} <div class=\"g-pl-bonuses g-pl-bonuses-indent clear-both\" name=\"bonuses_block\"> <span class=\"g-pl-bonuses-inner{if parseInt(item.pl_use_instant_bonus)} sprite-side{\/if}\"> +<span class=\"g-pl-bonuses-num\">${item.pl_bonus_charge_pcs.toString().toPriceFormat()}<\/span> {var bonus_morph = [ \'бонус\', \'бонуси\', \'бонусів\' ]} {var bonus_plural = plural(item.pl_bonus_charge_pcs)} ${bonus_morph[bonus_plural]} <\/span> <\/div> {\/if} {\/if} {if show_buttons && item.sell_status != \'out_of_stock\'} <div class=\"g-buy\" name=\"{if item.is_section}buy_portal_carousel{else}buy_details_${scroller_location}{\/if}\" id=\"${item.id}\"><\/div> {\/if} {if scroller_location == \'accessories_all\' || scroller_location == \'related\'} {if parseInt(item.pl_bonus_charge_pcs)} <div class=\"g-pl-bonuses g-pl-bonuses-indent clear-both\" name=\"bonuses_block\"> <span class=\"g-pl-bonuses-inner{if parseInt(item.pl_use_instant_bonus)} sprite-side{\/if}\"> +<span class=\"g-pl-bonuses-num\">${item.pl_bonus_charge_pcs.toString().toPriceFormat()}<\/span> {var bonus_morph = [ \'бонус\', \'бонуси\', \'бонусів\' ]} {var bonus_plural = plural(item.pl_bonus_charge_pcs)} ${bonus_morph[bonus_plural]} <\/span> <\/div> {\/if} {\/if} {\/if} <\/div> <div class=\"g-rating\"> {if item.count_comments > 0} <a class=\"novisited g-rating-reviews-link\" href=\"${item.href}comments\/\" data-count=\"${item.count_comments}\" onclick=\"document.fireEvent(\'commentsLinkClick\', {extend_event: [{name: \'goods_id\', value: ${item.id} }]})\" > {var word_forms = [\'відгук\', \'відгуки\', \'відгуків\']} {var plural_form = plural(item.count_comments)} {if item.users_rating > 0} <span class=\"sprite g-rating-stars\"> <span class=\"sprite g-rating-stars-i\" style=\"width:${item.users_rating*20}%\"><\/span> <\/span> <span class=\"g-rating-reviews\"> ${item.count_comments} ${word_forms[plural_form]} <\/span> {else} <span class=\"g-rating-reviews\"> <span class=\"g-rating-none sprite-side\">${item.count_comments} ${word_forms[plural_form]}<\/span> <\/span> {\/if} <\/a> {elseif show_buttons} <a href=\"${item.href}comments\/#comment_form\" class=\"novisited g-rating-reviews-link\"> <span class=\"g-rating-reviews\"> <span class=\"g-rating-none sprite-side\">Залишити відгук<\/span> <\/span> <\/a> {\/if} <\/div> <\/div> <\/div> {\/for} {\/if}'},cssClasses:{active:"active",hidden:"hidden"},goods_type:'scroll',selectors:{slave_block_for_dynamic_height:null,master_block_for_dynamic_height:null,block_for_dynamic_height:null,exlude_from_height:null},show_buttons:true,dynamic_height:false},_location:'',_action:'',_scroller_location:'',controlElem:null,_data:null,_first_position:null,_second_position:null,_scrollers_obj:null,initialize:function(parentElem,scrollers_obj){this._scrollers_obj=scrollers_obj;this.controlElem=parentElem;this._action=scrollers_obj.section_scroll_action;this._location=scrollers_obj.location;this._scroller_location=scrollers_obj.scroller_location;this.attachToObserver(['LoadTabCompleted'])},setData:function(data){this.data=data;this._first_position=0;this._second_position=this.data.count<this.options.countAddedItems?this.data.count:this.options.countAddedItems},updateData:function(data){this.data=data;this._second_position=this.data.count<this._second_position+this.options.countAddedItems?this.data.count:this._second_position+this.options.countAddedItems;if(this.options.vector=='horizontal'){this._getContainerElement().setStyle('width',(this.data.total_count*this.options.widthScrollElement)+'px')}},_getElements:function(){this._elems=this.parentElem.getElements(this.options.elems);return this._elems},_controlsClickHandler:function(event){var event=new Event(event).stop();var vector=this._getVectorControl(event.target);if(vector!=undefined){if(vector=='right'&&this._second_position>(this.data.count-this._first_position)){this._scrollers_obj.tryUploadData(true)}this._updateScrollerItems();if(!this._isPossibleScrollByVector(vector)){this._scrollers_obj.processStart();this._scrollers_obj.addEvent('finishUploadData',function(e){this._onFinishUploadData(vector)}.bind(this))}else{this._tryScrollingByVector(vector)}}},_onFinishUploadData:function(vector){this._updateScrollerItems();this._tryScrollingByVector(vector)},_hideControl:function(control,vector){if(vector!='right'||!this._scrollers_obj.isUploadInProgress()||this.options.circular){this.parent(control,vector)}},_isPossibleScrollByVector:function(vector){var result=false,count_elems_by_left;if(vector=='right'&&this._scrollers_obj.isUploadInProgress()){count_elems_by_left=Math.ceil(this._getContainerScrollLeft()/this.options.widthScrollElement);if((this.data.count-count_elems_by_left-2*this.options.visibleElementsLength)>0){result=true}}else{result=this.parent(vector)}return result},getSectionScrollerTemplateRootElement:function(){return this.controlElem.getElementsBySelector('[name=section_scroller]')[0]},run:function(){var data=this._getItemsByPosition(),repeat_inject_count=0,repeat_inject_index=1;this.controlElem.setHTML(App.getHTML(this.options.tpl.template,{width:this.options.vector=='horizontal'?this.data.total_count*this.options.widthScrollElement:this.options.widthScrollElement,location:this._location,scroller_location:this._scroller_location,action:this._action,vector:this.options.vector}));this.parentElem=this.getSectionScrollerTemplateRootElement();this._injectElems(data);if(this.options.visibleElementsLength=='auto'){App.addEvent('timedResize',function(){this._loadNextElements();this._loadDataFromScrollers()}.bind(this))}RozetkaScroller_class.prototype.run.call(this);if(this.options.vector=='horizontal'){this._getContainerElement().setStyle('width',this.data.total_count*this.options.widthScrollElement)}this._getElementsContainerParent().addEvent('scroll',this._loadNextElements.bind(this));if(this.options.show_buttons){this._setActiveForBuyButton()}$(document.body).fireEvent('bindToolTipEvents');App.fireEvent('renewImages');this._getElementsContainerParent().addEvent('scroll',this._loadDataFromScrollers.bind(this))},_loadNextElements:function(){var last_visible_element_x_axis=this._getContainerScrollLeft()+this.options.visibleElementsLength*this.options.widthScrollElement;if(last_visible_element_x_axis>=this._first_position*this.options.widthScrollElement-this.options.widthScrollElement){this._second_position=Math.ceil(last_visible_element_x_axis/this.options.widthScrollElement)+this.options.countAddedItems;this._second_position=this._second_position>this.data.count?this.data.count:this._second_position;this._updateScrollerItems();this._loadDataFromScrollers()}this._checkControlsStatus()},_loadDataFromScrollers:function(){if(this._getContainerScrollLeft()>=(this.data.count-this.options.visibleElementsLength*2)*this.options.widthScrollElement&&this._scrollers_obj.isUploadAvailable()){this._scrollers_obj.addEvent('finishUploadData',this._loadNextElements.bind(this));this._scrollers_obj.tryUploadData()}},_checkControlsStatus:function(){var scroll=this._getContainerScrollLeft(),limits=this._getLimits();this._getControls().each(function(control){switch(this._getVectorControl(control)){case'left':if(!this.options.circular&&scroll==0){this._hideControl(control,'left')}else{this._showControl(control,'left')}break;case'right':if(!this.options.circular&&this._first_position>=this.data.count&&scroll>=limits.right){this._hideControl(control,'right')}else{this._showControl(control,'right')}break}}.bind(this))},_injectElems:function(data){if(!data){data=this._getItemsByPosition()}var content=App.getHTML(this.options.tpl.tpl_items,{data:data,location:this._location,scroller_location:this._scroller_location,show_buttons:this.options.show_buttons,action:this._action});new Element('span').setHTML(content).getChildren().inject(this._getContainerElement());document.fireEvent('updateBlockContent',this._getContainerElement())},_getItemsByPosition:function(){var goods={};for(this._first_position;this._first_position<this._second_position;this._first_position++){goods[this._first_position]=this.data.goods[this._first_position];goods[this._first_position]['index']=this._first_position}this._second_position=this.data.count<this._second_position+this.options.countAddedItems?this.data.count:this._second_position+this.options.countAddedItems;return goods},_setActiveForBuyButton:function(){this._getContainerElement().getElements('[name=scroll_item_id]').each(function(elem){if(this.options.show_buttons){GoodsCatalog.add(elem.getValue(),this.options.goods_type)}elem.remove()}.bind(this))},_updateScrollerItems:function(){this._injectElems();this._setActiveForBuyButton();this.firePluginEvent('onLoadContentCarousel');$(document.body).fireEvent('bindToolTipEvents');App.fireEvent('renewImages')},_checkMinimumLoaded:function(){if(this.data.total_count>=this.data.count&&this.data.count<this.options.countAddedItems){this._loadDataFromScrollers()}},onLoadTabCompleted:function(){this._checkControlsStatus()}});RozetkaSectionScroller_class.implement(new Events(),new Options(),new PluginEvents_class());var RozetkaCollectionScrollers_class=new Class({options:{menu_item_selector:'[name=menu_item]',control_scrollers:'[name=scrollers]',elemsContainer:'[name=elems-container]',count_start_items:8,limit:100,enable_preload:true,tabAll:{'isView':true,name:'',show_all:false,show_all_name:'',show_top_links:true,show_bottom_links:false},'tpl':{'template':'{if tab_all.show_top_links} <nav> <ul class=\"clearfix m-tabs\" name=\"tips\"> {if tab_all.isView && tab_all.show_all} <li class=\"m-tabs-i\"> <a href=\"#\" id=\"all\" name=\"menu_item\" class=\"novisited m-tabs-link active\">${tab_all.show_all_name}<\/a> <\/li> {\/if} {if count > 1} {if sections} {for section in sections} <li class=\"m-tabs-i\"> <a href=\"#\" id=\"${section.name}\" name=\"menu_item\" class=\"novisited m-tabs-link\">${section.title}<\/a> <\/li> {\/for} {\/if} {\/if} {if tab_all.isView} {if !tab_all.href && !tab_all.show_all} <li class=\"m-tabs-i\"> <a href=\"#\" id=\"all\" name=\"menu_item\" class=\"novisited m-tabs-link active\">${tab_all.name}<\/a> <\/li> {else} <li class=\"m-tabs-i m-tabs-i-more\"> <a href=\"${tab_all.href}\" class=\"arrow-link detail-accessories-more-link novisited\" {if tab_all.data_tab} name=\"tabs_switcher\" data-tab=\"${tab_all.data_tab}\" {\/if} onclick=\"document.fireEvent(\'clickAllBlock\',{extend_event:[{name:\'eventLocation\',value:\'accessories\'}]});\"> <span class=\"arrow-link-inner\">${tab_all.name}<\/span>&nbsp;&rarr; <\/a> <\/li> {\/if} {\/if} <\/ul> <\/nav> {\/if} <div name=\"scrollers\"><\/div> {if tab_all.show_bottom_links} <ul class=\"clearfix m-tabs\" name=\"scroller_bottom_links\" data-class=\"exclude_height\"> <li class=\"detail-accessories-l-i\"> <a href=\"${tab_all.href}\" class=\"arrow-link detail-accessories-more-link novisited\" name=\"tabs_switcher\" data-tab=\"${tab_all.data_tab}\" onclick=\"document.fireEvent(\'clickAllBlock\',{extend_event:[{name:\'eventLocation\',value:\'accessories\'}]});\"> <span class=\"arrow-link-inner\">Усі аксесуари<\/span>&nbsp;&rarr; <\/a> <\/li> <\/ul> {\/if}',process_tpl:preloaders.green_process_tpl},cssClasses:{active:"active",hidden:"hidden"},section_field:'section'},scroller_options:null,section_scroll_action:'',location:'',scroller_location:'',_upload_data_status:null,_status_values:{NOT_STARTED:0,REQUEST_IN_PROGRESS:1,REQUEST_COMPLETED:2,COMPLETED:3,WILL_NOT_DO:4},controlElem:null,control_scrollers:null,_tabs:{},_data:null,_data_for_sections:null,_menu_items:{},_current_tab:'',_url:null,_unit_id:null,load_start:null,_sorted_sections:[],initialize:function(data,elem,url,relation_name,count_start_items,enable_preload){this._tabs={};this._menu_items={};this._data=data;this._url=url;this.relation_name=relation_name;this.controlElem=elem;if(count_start_items){this.options.count_start_items=count_start_items}if(typeof enable_preload!=="undefined"){this.options.enable_preload=enable_preload}this.load_start=this.options.count_start_items;if(!this.options.enable_preload||this._data.count<this.options.count_start_items){this._upload_data_status=this._status_values.WILL_NOT_DO}else{this._upload_data_status=this._status_values.NOT_STARTED}this._sortSectionsByOrder()},_sortSectionsByOrder:function(){var sections_array=[];Object.values(this._data.sections).forEach(function(value){sections_array.push(value)}.bind(this));this._sorted_sections=sections_array.sort(function(a,b){if(a.order==b.order){return 0}return a.order-b.order})},run:function(){this._setContent();this._activeSwitcher();this.control_scrollers=this.controlElem.getElementsBySelector(this.options.control_scrollers)[0];if(this.control_scrollers){if(this._data['field']){this.options.section_field=this._data['field']}var data=this.getChangedData();this._createScrollerBySection(this.control_scrollers,'all',data);this._current_tab='all';document.fireEvent('ScrollerDataLoaded',{location:this.location,goods_data:data})}App.fireEvent('renewImages')},getChangedData:function(){var result=Object.clone(this._data);if(result['sections']&&!result['total_count']){result['total_count']=0;Object.values(result['sections']).each(function(section){result['total_count']+=(section['count']||0)})}return result},setUnit:function(id){this._unit_id=id},processStart:function(){this.control_scrollers.processStart(this.options.tpl.process_tpl)},isUploadAvailable:function(){var result=false;if(this._upload_data_status===this._status_values.NOT_STARTED){result=true}return result},isUploadInProgress:function(){var result=false;if(this._upload_data_status===this._status_values.REQUEST_IN_PROGRESS||this._upload_data_status===this._status_values.REQUEST_COMPLETED){result=true}return result},isFullData:function(){var result=false;if(this._upload_data_status===this._status_values.COMPLETED||this._upload_data_status===this._status_values.WILL_NOT_DO){result=true}return result},tryUploadData:function(hide_process_start){if(this.isUploadAvailable()){!hide_process_start&&this.processStart();this._upload_data_status=this._status_values.REQUEST_IN_PROGRESS;var action=this._url+'action=getRelationsRecordsJSON';action=this._unit_id?action+';unit_id='+this._unit_id:action;action=action+';offset='+this.load_start+';length='+this.options.limit;action=action+';relation_name='+this.relation_name+'/';var ajax=new Ajax(action,{method:'get',headers:{ajaxAction:action}}).request();ajax.addEvent('onComplete',function(e){this._onUploadData(e)}.bind(this))}},_onUploadData:function(e){var section_name,response=new Response_class(e),loaded_goods;this._upload_data_status=this._status_values.REQUEST_COMPLETED;if(response.content.count){this.load_start+=response.content.count}loaded_goods=(response.content.goods)?response.content:[];this._mergeResponseData(response.content);this._groupGoodsBySections();for(section_name in this._tabs){if(section_name=='all'){window.fireEvent('ScrollerDataLoadAjax',{location:this.location,goods_data:loaded_goods});this._tabs[section_name].updateData(this._data)}else{this._tabs[section_name].updateData(this._data_for_sections[section_name])}}if(!response.content.count||response.content.count<this.options.limit){this._upload_data_status=this._status_values.COMPLETED}else{this._upload_data_status=this._status_values.NOT_STARTED}this.control_scrollers.processStop();this.fireEvent('finishUploadData');App.fireEvent('renewImages')},_mergeResponseData:function(data){this._data.count+=data.count;if(data.goods){this._data.goods=this._data.goods.concat(data.goods)}},_setContent:function(){this.controlElem.setHTML(App.getHTML(this.options.tpl.template,{sections:this._sorted_sections,count:this._data.count_sections,tab_all:this.options.tabAll}))},_createScrollerBySection:function(elem,section_name,data){this._tabs[section_name]=new RozetkaSectionScroller_class(elem,this);if(this.scroller_options){this._tabs[section_name].setOptions(this.scroller_options)}this._tabs[section_name].setData(data);this._tabs[section_name].run()},_groupGoodsBySections:function(){var sections={};this._sorted_sections.forEach(function(value,key){var goods4sections=[],section_name=value['name'];Object.values(this._data.goods).each(function(goods){if(goods[this.options.section_field]==section_name||(Array.isArray(goods[this.options.section_field])&&goods[this.options.section_field].contains(section_name))){goods4sections.push(goods)}}.bind(this));sections[section_name]={goods:goods4sections,count:goods4sections.length,total_count:this._sorted_sections[key]['count']||0}}.bind(this));Object.values(sections).each(function(section){if(!section['total_count']||section['total_count']<section['count']){section['total_count']=section['count']}});this._data_for_sections=sections},_activeSwitcher:function(){this.controlElem.getElements(this.options.menu_item_selector).each(function(elem){var id=elem.getProperty('id');this._menu_items[id]={elem:elem}}.bind(this));for(id in this._menu_items){var item=this._menu_items[id];item.elem.removeEvents('click');item.elem.addEvent('click',this._onSectionClick.bindWithEvent(this,item))}},_onSectionClick:function(e,menu_item){new Event(e).stop();if(!this._data_for_sections){this._groupGoodsBySections()}var id=menu_item.elem.getProperty('id');if(id!=this._current_tab){this._switchContentBySection(id);this._setActiveItem(id)}},_switchContentBySection:function(id){if(this.control_scrollers){this.control_scrollers.getFirst().remove();if(!this._tabs[id]){this._createScrollerBySection(this.control_scrollers,id,this._data_for_sections[id])}else{this.control_scrollers.adopt(this._tabs[id].parentElem)}if(!this.isFullData()){this.processStart();this.tryUploadData()}else{this.firePluginEvent('tabAccessoriesContentDownload');this._tabs[id]._checkControlsStatus()}document.fireEvent('clickCategoryAccessories',{extend_event:[{name:'eventContext',value:id}]});this.addEventOnce('finishUploadData',function(e){this.control_scrollers.processStop();this._tabs[id]._updateScrollerItems();this._tabs[id]._checkControlsStatus();this._tabs[id]._checkMinimumLoaded();this.firePluginEvent('tabAccessoriesContentDownload')}.bind(this))}App.fireEvent('renewImages')},_setActiveItem:function(active_id){for(id in this._menu_items){var item=this._menu_items[id];if(active_id==id){item.elem.addClass('active')}else{item.elem.removeClass('active')}}this._current_tab=active_id}});RozetkaCollectionScrollers_class.implement(new Options(),new Events(),new PluginEvents_class());var RozetkaLoadableScroll_class=RozetkaScroller_class.extend({options:{action:'',base_href:null,additional_params:{},countAddedItems:5,'tpl':{'template':'<div class=\"clearfix slider g-tile-fix-height\" name=\"section_scroller\" _action=\"${action}\"> <a class=\"sprite-side slider-al\" data-direction=\"left\" href=\"#\" name=\"controls\">&lt;<\/a> <a class=\"sprite-side slider-ar\" data-direction=\"right\" href=\"#\" name=\"controls\">&gt;<\/a> <div class=\"slider-inner\" name=\"slider-inner\"> <div class=\"clearfix slider-sliding-box\" name=\"elems-container\" style=\"width:${width}px\"> <\/div> <\/div> <\/div>','tpl_items':'{if data} {for item in data} ${rozetkaEvents.setGoodsData(item.ga_goods_data)} ${GTMEventsData.setGoodsData(item.id,item.ga_goods_data)} {if item.title_only} {var item_title_only = item.title_only} {else} {var item_title_only = item.title} {\/if} <div class=\"slider-i-td\" name=\"scroll-element\"> <div class=\"slider-i ${item.sell_status}\" tool_tip=\"1\" {if show_buttons}id=\"catalog_item${item.id}\"{\/if} data-location=\"${location}\" data-position=\"${parseInt(item_index)+1}\"> <input type=\"hidden\" name=\"scroll_item_id\" value=\"${item.id}\"\/> {if item.ga_goods_data.content}<input type=\"hidden\" name=\"content_gtm${item.id}\" value=\"${item.ga_goods_data.content}\" \/>{\/if} <figure class=\"g-img\"> <div class=\"g-img-inner g-img-inner-150 pos-fix\"> {if item.tag} <span class=\"g-tag g-tag-portal\"> <img alt=\"${item.tag.title}\" class=\"sprite g-tag-icon-small-${item.tag.name}\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" \/> <\/span> {\/if} <a class=\"g-i-img-link responsive-img\" onclick=\"document.fireEvent(\'goodsImageClick\',{extend_event:[{name:\'goods_id\',value:${item.id}}{if !item.is_section},{name:\'eventLocation\',value:\'${location}\'}{\/if}{if item.ga_goods_data.content},{name:\'eventContent\',value:\'${item.ga_goods_data.content}\'}{\/if}]});\" href=\"${item.href}\"> <img class=\"centering-img\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" data_src=\"${item.image.url}\" width=\"${item.image.width}\" height=\"${item.image.height}\" alt=\"${item_title_only|escape}\" title=\"${item_title_only|escape}\" \/> <\/a> <\/div> <\/figure> <div class=\"clearfix\"> <div class=\"g-id\" style=\"display: none;\">${item.id}<\/div> <\/div> <div class=\"clearfix\"> <div class=\"g-title\"> <a class=\"g-title-link\" onclick=\"document.fireEvent(\'goodsTitleClick\',{extend_event:[{name:\'goods_id\',value:${item.id}}{if !item.is_section && location},{name:\'eventLocation\',value:\'${location}\'}{\/if}{if item.ga_goods_data.content},{name:\'eventContent\',value:\'${item.ga_goods_data.content}\'}{\/if}]});\" href=\"${item.href}\" >${item.title}<\/a> <\/div> {if item.sell_status != \'available\'} <div class=\"g-i-status-wrap\"> <div class=\"g-i-status ${item.sell_status}\"> {if item.sell_status == \'limited\'} Закінчується {elseif item.sell_status == \'out_of_stock\'} Закінчився {\/if} <\/div> {if item.sell_status == \'out_of_stock\'} <div class=\"viewed-lable-out_of_stock\"> <img class=\"g-label-out_of_stock-icon sprite\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"Продано\"> <\/div> {\/if} <\/div> {\/if} {var show_old_price = parseInt(item.old_price) && parseInt(String(item.old_price).replace(\/\\s+\/g, \'\')) > parseInt(String(item.price).replace(\/\\s+\/g, \'\'))} {if show_old_price} <div class=\"g-price-old\"> <div class=\"g-price-old-inner\"> <div class=\"g-price-old-uah\"> ${item.old_price.toString().toPriceFormat()}<span class=\"g-price-old-uah-sign\">&thinsp;${item.unit}<\/span> <\/div> <\/div> <\/div> {\/if} {if item.price} <div class=\"g-price{if show_old_price} g-price-cheaper{\/if} float-lt\"> <div class=\"g-price-uah\"> ${item.price.toString().toPriceFormat()}<span class=\"g-price-uah-sign\">&thinsp;${item.unit}<\/span> <\/div> <\/div> {if scroller_location == \'accessories_tab\'} {if parseInt(item.pl_bonus_charge_pcs)} <div class=\"g-pl-bonuses g-pl-bonuses-indent clear-both\" name=\"bonuses_block\"> <span class=\"g-pl-bonuses-inner{if parseInt(item.pl_use_instant_bonus)} sprite-side{\/if}\"> +<span class=\"g-pl-bonuses-num\">${item.pl_bonus_charge_pcs.toString().toPriceFormat()}<\/span> {var bonus_morph = [ \'бонус\', \'бонуси\', \'бонусів\' ]} {var bonus_plural = plural(item.pl_bonus_charge_pcs)} ${bonus_morph[bonus_plural]} <\/span> <\/div> {\/if} {\/if} {if show_buttons && item.sell_status != \'out_of_stock\'} <div class=\"g-buy\" name=\"{if item.is_section}buy_portal_carousel{else}buy_details_${scroller_location}{\/if}\" id=\"${item.id}\"><\/div> {\/if} {if scroller_location == \'accessories_all\' || scroller_location == \'related\'} {if parseInt(item.pl_bonus_charge_pcs)} <div class=\"g-pl-bonuses g-pl-bonuses-indent clear-both\" name=\"bonuses_block\"> <span class=\"g-pl-bonuses-inner{if parseInt(item.pl_use_instant_bonus)} sprite-side{\/if}\"> +<span class=\"g-pl-bonuses-num\">${item.pl_bonus_charge_pcs.toString().toPriceFormat()}<\/span> {var bonus_morph = [ \'бонус\', \'бонуси\', \'бонусів\' ]} {var bonus_plural = plural(item.pl_bonus_charge_pcs)} ${bonus_morph[bonus_plural]} <\/span> <\/div> {\/if} {\/if} {\/if} <\/div> <div class=\"g-rating\"> {if item.count_comments > 0} <a class=\"novisited g-rating-reviews-link\" href=\"${item.href}comments\/\" data-count=\"${item.count_comments}\" onclick=\"document.fireEvent(\'commentsLinkClick\', {extend_event: [{name: \'goods_id\', value: ${item.id} }]})\" > {var word_forms = [\'відгук\', \'відгуки\', \'відгуків\']} {var plural_form = plural(item.count_comments)} {if item.users_rating > 0} <span class=\"sprite g-rating-stars\"> <span class=\"sprite g-rating-stars-i\" style=\"width:${item.users_rating*20}%\"><\/span> <\/span> <span class=\"g-rating-reviews\"> ${item.count_comments} ${word_forms[plural_form]} <\/span> {else} <span class=\"g-rating-reviews\"> <span class=\"g-rating-none sprite-side\">${item.count_comments} ${word_forms[plural_form]}<\/span> <\/span> {\/if} <\/a> {elseif show_buttons} <a href=\"${item.href}comments\/#comment_form\" class=\"novisited g-rating-reviews-link\"> <span class=\"g-rating-reviews\"> <span class=\"g-rating-none sprite-side\">Залишити відгук<\/span> <\/span> <\/a> {\/if} <\/div> <\/div> <\/div> {\/for} {\/if}',process:preloaders.process_tpl},cssClasses:{active:"active",hidden:"hidden"},analytics:{location:'',action:''},scroller_location:'',goods_type:'scroll',template_options:{},selectors:{bonuses_block:'[name=bonuses_block]'},show_buttons:true},controlElem:null,_first_position:null,_second_position:null,_total_chunks:null,_current_chunk_index:null,_items_per_chunk:null,_total_items_in_section:null,_data:{goods:[]},UploadDataStatuses:{NOT_STARTED:0,REQUEST_IN_PROGRESS:1,CHUNK_REQUEST_COMPLETED:2,COMPLETED:3},_upload_data_status:null,initialize:function(parentElem){this.controlElem=parentElem;this._upload_data_status=this.UploadDataStatuses.NOT_STARTED;this.attachToObserver(['LoadTabCompleted'])},_processStart:function(){this.parentElem.processStart(this.options.tpl.process)},_processStop:function(){this.parentElem.processStop()},tryUploadData:function(to_chunk){var params;if(this.isUploadAvailable()){this._upload_data_status=this.UploadDataStatuses.REQUEST_IN_PROGRESS;params={action:this.options.action,offset:this._data.goods.length,length:(to_chunk-this._current_chunk_index)*this._items_per_chunk};if(this.options.additional_params){params=Object.merge(params,this.options.additional_params)}if(params.offset+params.length>this._total_items_in_section){params.length=this._total_items_in_section-params.offset}this._getDataFromServer(App.buildUrl(this.options.base_href,params),to_chunk,{method:'get',onComplete:this._onUploadData.bind(this)})}},_onUploadData:function(e){var response=new Response_class(e);this._processStop();if(response.isDone()){this.updateData(response.content);this._checkControlsStatus();this.fireEvent('finishUploadData')}},_getDataFromServer:function(url,to_chunk,options){this._current_query_options=options;this._current_query_url=url;this._current_to_chunk=to_chunk;if(this._previous_to_chunk==undefined){this._previous_to_chunk=1}if(!this._load_chunk_interval){this._load_chunk_interval=setInterval(function(){if(this._current_query_options&&this._current_query_url!=this._previous_query_url&&this._current_to_chunk>this._previous_to_chunk){if(this._previous_ajax_instance&&this._previous_ajax_instance.running){this._previous_ajax_instance.cancel()}this._previous_ajax_instance=new Ajax(this._current_query_url,this._current_query_options);this._previous_ajax_instance.request();this._previous_query_url=this._current_query_url;this._previous_to_chunk=this._current_to_chunk;this._current_query_options=null}else{clearInterval(this._load_chunk_interval);this._load_chunk_interval=null}}.bind(this),1000)}},isUploadAvailable:function(){return this._upload_data_status!=this.UploadDataStatuses.COMPLETED},isUploadInProgress:function(){return this._upload_data_status==this.UploadDataStatuses.REQUEST_IN_PROGRESS},setData:function(data){this._data=data;this._first_position=0;this._second_position=this._data.goods.length<this.options.countAddedItems?this._data.goods.length:this.options.countAddedItems;this._current_chunk_index=1;this._items_per_chunk=this._data.chunk_count||this._data.goods.length;this._total_items_in_section=this._data.total_count||this._items_per_chunk;this._upload_data_status=this._total_items_in_section==this._items_per_chunk?this.UploadDataStatuses.COMPLETED:this.UploadDataStatuses.NOT_STARTED;this._total_chunks=Math.ceil(this._total_items_in_section/this._items_per_chunk)||1},updateData:function(data){if(data.goods&&data.goods.length){window.fireEvent('ScrollerDataLoadAjax',{location:this.options.analytics.location,goods_data:data});this._data.goods=this._data.goods.concat(data.goods)}this._updateCurrentChunkIndex();if(this._current_chunk_index>=this._total_chunks){this._upload_data_status=this.UploadDataStatuses.COMPLETED}else{this._upload_data_status=this.UploadDataStatuses.CHUNK_REQUEST_COMPLETED}this._second_position=this._data.goods.length<this._second_position+this.options.countAddedItems?this._data.goods.length:this._second_position+this.options.countAddedItems;if(this._total_items_in_section==null&&(!this.options.vector||this.options.vector!=='vertical')){this._getContainerElement().setStyle('width',this._data.goods.length*this.options.widthScrollElement+'px')}},_updateCurrentChunkIndex:function(){this._current_chunk_index=Math.ceil(this._data.goods.length/this._items_per_chunk)},_getElements:function(){this._elems=this.parentElem.getElements(this.options.elems);return this._elems},_controlsClickHandler:function(event){var event=new Event(event).stop();var vector=this._getVectorControl(event.target);if(vector!=undefined){this._checkControlsStatus();this._updateScrollerItems();if(this._isPossibleScrollByVector(vector)){this._tryScrollingByVector(vector)}}},_onFinishUploadData:function(vector){this._updateScrollerItems();this._tryScrollingByVector(vector)},_hideControl:function(control,vector){if(vector!='right'||!this.isUploadInProgress()||this.options.circular){this.parent(control,vector)}},getSectionScrollerTemplateRootElement:function(){return this.controlElem.getElementsBySelector('[name=section_scroller]')[0]},run:function(){var wrapper,data={width:this._data.goods.length*this.options.widthScrollElement,location:this.options.analytics.location,scroller_location:this.options.scroller_location,action:this.options.analytics.action,template_options:this.options.template_options,vector:this.vector,show_buttons:this.options.show_buttons};this._initTpl(data);this.parentElem=this.getSectionScrollerTemplateRootElement();this._injectElems(this._getItemsByPosition());if(this.options.visibleElementsLength=='auto'){App.addEvent('timedResize',function(){this._loadNextElements();this._loadDataFromServer()}.bind(this))}RozetkaScroller_class.prototype.run.call(this);(!this.options.vector||this.options.vector!=='vertical')&&this._getContainerElement().setStyle('width',this._total_items_in_section*this.options.widthScrollElement+'px');wrapper=this._getElementsContainerParent();wrapper.addEvent('scroll',this._loadNextElements.bind(this));this._setActiveForBuyButton();$(document.body).fireEvent('bindToolTipEvents');App.fireEvent('renewImages');wrapper.addEvent('scroll',this._loadDataFromServer.bind(this));wrapper.addEvent('scroll',this._checkControlsStatus.bind(this))},_initTpl:function(data){this.controlElem.setHTML(App.getHTML(this.options.tpl.template,data))},_loadNextElements:function(){var last_visible_element_x_axis=this._getContainerScrollLeft()+this.options.visibleElementsLength*this.options.widthScrollElement;if(last_visible_element_x_axis>=this._first_position*this.options.widthScrollElement-this.options.widthScrollElement){this._second_position=Math.ceil(last_visible_element_x_axis/this.options.widthScrollElement)+this.options.countAddedItems;this._second_position=this._second_position>this._data.goods.length?this._data.goods.length:this._second_position;this._updateScrollerItems()}},_getNextChunkIndexToLoad:function(){var chunk_width=this._items_per_chunk*this.options.widthScrollElement,visible_elements_width=this._getElementsContainerParent().offsetWidth,current_chunk=Math.ceil((this._getContainerScrollLeft()+visible_elements_width)/chunk_width);return current_chunk<this._total_chunks?current_chunk+1:this._total_chunks},_loadDataFromServer:function(){if(this._getContainerScrollLeft()>=(this._data.goods.length-this.options.visibleElementsLength*2)*this.options.widthScrollElement&&this.isUploadAvailable()&&this._getNextChunkIndexToLoad()>this._current_chunk_index){this._processStart();this.addEvent('finishUploadData',this._loadNextElements.bind(this));this.tryUploadData(this._getNextChunkIndexToLoad())}else{this._processStop()}},_checkControlsStatus:function(){var scroll=this._getContainerScrollLeft();var limits=this._getLimits();this._getControls().each(function(control){switch(this._getVectorControl(control)){case'left':if(!this.options.circular&&scroll==0){this._hideControl(control,'left')}else{this._showControl(control,'left')}break;case'right':if(!this.options.circular&&this._first_position>=this._data.goods.length&&scroll>=limits.right){this._hideControl(control,'right')}else{this._showControl(control,'right')}break}}.bind(this))},_injectElems:function(data){if(!data){data=this._getItemsByPosition()}var content=App.getHTML(this.options.tpl.tpl_items,{data:data,location:this.options.analytics.location,scroller_location:this.options.scroller_location,action:this.options.analytics.action,template_options:this.options.template_options,show_buttons:this.options.show_buttons}),children=new Element('span').setHTML(content).getChildren(),pl_service=App.getService('ProgramLoyalty'),bonuses_blocks;children.inject(this._getContainerElement());bonuses_blocks=this._getContainerElement().getElements(this.options.selectors.bonuses_block);pl_service&&bonuses_blocks.length&&pl_service.addOnPLVisibilityChange(bonuses_blocks);return children},_getItemsByPosition:function(){var goods={};for(this._first_position;this._first_position<this._second_position;this._first_position++){goods[this._first_position]=this._data.goods[this._first_position];goods[this._first_position]['index']=this._first_position}this._second_position=this._data.goods.length<this._second_position+this.options.countAddedItems?this._data.goods.length:this._second_position+this.options.countAddedItems;return goods},_setActiveForBuyButton:function(){this.options.show_buttons&&this._getContainerElement().getElements('[name=scroll_item_id]').each(function(elem){GoodsCatalog.add(elem.getValue(),this.options.goods_type);elem.remove()}.bind(this))},_updateScrollerItems:function(){this._injectElems();this._setActiveForBuyButton();this.firePluginEvent('onLoadContentCarousel');$(document.body).fireEvent('bindToolTipEvents');App.fireEvent('renewImages')},onLoadTabCompleted:function(){this._checkControlsStatus()}});RozetkaLoadableScroll_class.implement(new Events(),new Options(),new PluginEvents_class());var RozetkaElementsScroller_class=RozetkaScroller_class.extend({Class:'RozetkaElementsScroller_class',options:{is_optimized:false,paginator:{selectors:{container:'[name=pages]'}},spacing:0,inject_controls:true,auto_scroll:false,start_timeout:10000,click_timeout:60000,scroll_timeout:5000,_refresh_timeout_time:100,_wrapper_scroll_timeout:500},_scroller_slide_timeout_id:null,_fire_scroller_slide:true,_refresh_timeout_point:null,_wrapper_size:0,_page_container:null,_scroll_timeout_id:null,_timeout:0,initialize:function(parentElem){this.parent(parentElem);this.attachToObserver(['ChangeBlockOffer'])},onChangeBlockOffer:function(){this.refresh()},_getFx:function(){if(!this._fx){this._fx=new Fx.Scroll(this._getElementsContainerParent(),{wheelStops:false})}return this._fx},_wrapperOnScroll:function(e){this._checkControlsStatus();this._scroller_slide_timeout_id&&clearTimeout(this._scroller_slide_timeout_id);this._scroller_slide_timeout_id=setTimeout(function(){if(this._fire_scroller_slide){var gtm_data={extend_event:[]};if(this.options.gtm_location){gtm_data.extend_event.extend([{name:'eventLocation',value:this.options.gtm_location}])}if(this.options.num_block){gtm_data.extend_event.extend([{name:'eventField',value:this.options.num_block+' block'}])}document.fireEvent('scroller_slide',gtm_data)}this._fire_scroller_slide=true}.bind(this),this.options._wrapper_scroll_timeout)},_fireEventScrollerUse:function(event_data){this.parent(event_data);this._fire_scroller_slide=false},run:function(){var wrapper=this._getElementsContainerParent();wrapper.addEvent('scroll',this._wrapperOnScroll.bind(this));App.addEvent('timedResize',this.refresh.bind(this));document.addEvent('TabChangeCompleted',this.refresh.bind(this));this._setContainerElementsSize();this._checkControlsStatus();if(this._getControls()&&this._getElements()&&this._getContainerElement()){this._getControls().each(function(el){el.addEvent('click',this._controlsClickHandler.bind(this))}.bind(this))}if(this.options.auto_scroll){App.addOnDomReady(this._checkKitCoordinates.bind(this));window.addEvent('scroll',this._checkKitCoordinates.bind(this))}document.addEvent('accessoryScroll',function(e){if(this._getElementsContainerParent().contains(e.container)){this.setScrollTimeout(true)}}.bind(this));if(this.options.allow_swipe&&App.isTouchDevice()){this._addEventOnSwipe()}this._initPaginator();this._wrapper_size=wrapper[this._getChangePropertyName()];this.options.is_optimized&&this.optimizeElements();App.fireEvent('renewImages');return this},_checkKitCoordinates:function(){if(this.options.auto_scroll&&!this._scroll_timeout_id){var window_size=window.getSize(),coordinates=this._getContainerElement().getCoordinates(),range=window_size.scroll.y+window_size.size.y-coordinates.height/3;if(range>coordinates.top){this._scroll_timeout_id=setTimeout(function(){this.setScrollTimeout()}.bind(this),this.options.start_timeout-this.options.scroll_timeout)}}},_controlsClickHandler:function(e){this.setScrollTimeout(true);this.parent(e)},setScrollTimeout:function(click){if(this.options.auto_scroll){clearTimeout(this._scroll_timeout_id);this._timeout=!!click?this.options.click_timeout:this.options.scroll_timeout;this._scroll_timeout_id=setTimeout(function(){this._timeout=this.options.scroll_timeout;this._tryScrollingByVector('right',true)}.bind(this),this._timeout)}},refresh:function(){if(this._refresh_timeout_point){clearTimeout(this._refresh_timeout_point)}this._refresh_timeout_point=setTimeout(function(){this._setContainerElementsSize();this._scroller&&this._scroller.update();this._checkControlsStatus();this._scrollToLeft(this.getFirstVisibleElement());App.fireEvent('renewImages');this.options.is_optimized&&this.optimizeElements()}.bind(this),this.options._refresh_timeout_time)},optimizeElements:function(){var elements=this._getElements(),property=this._getChangeStylePropertyName(),max=0;property=(property=='width')?'height':'width';elements.each(function(element){element.style.removeProperty(property);max=Math.max(max,parseInt(element.getStyle(property)))});elements.each(function(element){element.setStyle(property,max)})},_initPaginator:function(){var container=this.parentElem.getElement(this.options.paginator.selectors.container);if(this.checkFillData()&&container){this._paginator=new RozetkaPaginatorForScroller_class(container,this).setOptions(this.options.paginator).init()}},_setContainerElementsSize:function(){var property=this._getChangePropertyName(),style=this._getChangeStylePropertyName(),size=this._getElementsContainerParent()[property],elements=this._getElements(),width=0;size=this._fixSize(size,this._getElementsContainerParent(),this._getChangeStylePropertyName());if(this.options.circular&&this._wrapper_size!=size){elements.each(function(elem){elem.setStyle(style,size)})}elements.each(function(elem){width+=this._fixSize(elem[property],elem,this._getChangeStylePropertyName())}.bind(this));this._getContainerElement().setStyle(style,width);this._wrapper_size=size},_fixSize:function(size,elem,property){var elem_size,alter_size=0;if(elem&&elem.getBoundingClientRect&&"function"==typeof elem.getBoundingClientRect){elem_size=elem.getBoundingClientRect();if(elem_size[property]){alter_size=elem_size[property]}else if(this.options.vector=='vertical'){alter_size=elem_size.bottom-elem_size.top}else{alter_size=elem_size.right-elem_size.left}}return size>=alter_size?size:Math.ceil(alter_size)},_checkControlsStatus:function(){var scroll=this._getContainerScrollLeft(),limits=this._getLimits();this._getControls().each(function(control){switch(this._getVectorControl(control)){case'left':if((scroll!=0||this.options.circular)&&this.checkFillData()){this._showControl(control,'left')}else{this._hideControl(control,'left')}break;case'right':if((scroll<(limits.right)||this.options.circular)&&this.checkFillData()){this._showControl(control,'right')}else{this._hideControl(control,'right')}break}}.bind(this))},_isPossibleScrollByVector:function(vector){var result=false,scroll=this._getContainerScrollLeft();switch(vector){case'left':result=(scroll>0)||this.options.circular;break;case'right':result=(scroll<this._getLimits().right)||this.options.circular;break}return result},_tryScrollingByVector:function(vector,autoscrolled){var shift=this.getShiftByVector(vector),scroll=this._getContainerScrollLeft(),autoscrolled=(typeof autoscrolled=='undefined'?false:autoscrolled);if(this.options.circular&&((scroll==0&&!shift&&vector=='left')||(scroll>=this._getLimits().right&&vector!='left'))){shift=this._getCircularShiftByVector(vector)}else{this.smoothScrollToLeft(shift)}if(!autoscrolled){this._prepareGTMEventData(this.parentElem.getProperty('_action'),scroll,autoscrolled)}App.fireEvent('renewImages');if(this._timeout!=this.options.click_timeout){this.setScrollTimeout()}},_getCircularShiftByVector:function(vector){var elements=this._getElements(),element=null;if(vector=='left'){element=elements[elements.length-1]}else{element=elements[0]}this.scrollToElement(element,true)},scrollToElement:function(element,autoscrolled){var shift=this.getShiftElement(element),scroll=this._getContainerScrollLeft(),autoscrolled=(typeof autoscrolled=='undefined'?false:autoscrolled);this.isEnableAnimation(shift)?this.smoothScrollToLeft(shift):this._changeElemsByOpacity(shift);if(!autoscrolled){this._prepareGTMEventData(this.parentElem.getProperty('_action'),scroll,false)}App.fireEvent('renewImages')},isEnableAnimation:function(shift){return(Math.abs(this._getContainerScrollLeft()-shift)<=this._getBlockSize())?true:false},_changeElemsByOpacity:function(scroll){new Fx.Style(this._getContainerElement(),'opacity',{duration:this.options.fx_opacity_duration,onComplete:function(){this._scrollToLeft(scroll);new Fx.Style(this._getContainerElement(),'opacity',{duration:this.options.fx_opacity_duration,onComplete:function(){this._checkControlsStatus()}.bind(this)}).start(1)}.bind(this)}).start(0)}});RozetkaElementsScroller_class.implement(new Events());var RozetkaPaginatorForScroller_class=new Class({Class:'RozetkaPaginatorForScroller_class',options:{tpl:{pages:'<li class=\"paginator-i\"> <a class=\"paginator-link\" href=\"#\" name=\"page\">&nbsp;<\/a> <\/li>'},selectors:{container:'[name=pages]',elem:'[name=page]'},cssClasses:{active:'active'}},_container:null,_scroller:null,_wrapper_size:0,_pages:[],_active_page:null,initialize:function(container,scroller){this._container=container;this._scroller=scroller},init:function(){this._scroller._getElementsContainerParent().addEvent('scroll',this._scrollHandler.bind(this));this.update();return this},_scrollHandler:function(){var elements=this._scroller.getVisibleElements(),element=null,index=0;while(!element&&elements.length>index){this._pages.forEach(function(entity){if(entity.elements[0]==elements[index]){element=entity.page;return false}}.bind(this));index++}element&&this.activationPage(element)},_resizeHandler:function(){var wrapper=this._scroller._getElementsContainerParent(),property=this._scroller._getChangePropertyName();if(this._wrapper_size!=wrapper[property]){this.update();this._wrapper_size=wrapper[property]}},update:function(){var property=this._scroller._getChangePropertyName(),width=this._scroller._getElementsContainerParent()[property];this._pages=[];this._container.innerHTML='';if(this._scroller.options.inject_controls){this._createPagesForInjectControlls(width,property)}else{this._createPagesForNotInjectControlls(width,property)}if(this._pages){this._scrollHandler()}App.fireEvent('renewImages')},_createPagesForNotInjectControlls:function(container_width,property){var stack=[],sum=0;this._scroller._getElements().each(function(elem){if((sum+elem[property])<=container_width){sum+=elem[property];stack.push(elem)}else{sum=elem[property];this._createPage(stack);stack=[elem]}}.bind(this));stack.length&&this._createPage(stack)},_createPagesForInjectControlls:function(container_width,property){var elements=this._scroller._getElements(),parent=elements[0],stack=[],sum=0;elements.each(function(elem){if((sum+elem[property])<container_width){sum+=elem[property];stack.push(elem)}else{sum=elem[property]+parent[property];this._createPage(stack);stack=[parent,elem]}parent=elem}.bind(this));stack.length&&this._createPage(stack)},_createPage:function(stack){var element=new Element('div'),page=null,target=null;element.setHTML(App.getHTML(this.options.tpl.pages,this));page=element.getFirst();page.inject(this._container);target=page.getElement(this.options.selectors.elem);if(target){this._pages.push({elements:stack,page:target});target.addEvent('click',this._clickPageHandler.bind(this))}},_clickPageHandler:function(event){var target=event.target,page=this._pages.filter(function(elem){return elem.page==target})[0];new Event(event).stop();this._scroller.setScrollTimeout(true);this._scroller.scrollToElement(page.elements[0],false)},activationPage:function(element){this._pages.forEach(function(entity){if(entity.page.hasClass(this.options.cssClasses.active)){entity.page.removeClass(this.options.cssClasses.active)}}.bind(this));element.addClass(this.options.cssClasses.active)}});RozetkaPaginatorForScroller_class.implement(new Options(),new Events());var RozetkaToolTips_class=new Class({Class:'RozetkaToolTips_class',elements_with_tips:null,tip_popup:null,tip_block_name:null,hover_elem:null,options:{tpl:'<div class=\"goods-popup-hover\"> <div class=\"popup-css\"> <div name=\"content\" class=\"goods-popup-hover-content\"> <\/div> <div class=\"pistil\"><\/div> <\/div> <\/div>',block_with_tips_selector:'[tool_tip=1]',popup_content_selector:'div[name=tip_content]',left_width_to_arrow:40,right_width_to_arrow:95,heigth_to_arrow:50,top_right_class:'pistil-top-right',top_left_class:'pistil-top-left',left_class:'pistil-left',right_class:'pistil-right',more_link_name:'tooltip-more'},initialize:function(name){this.tip_block_name=name;this._createPopup();this._addEventsForToolTips();$(document.body).addEvent('bindToolTipEvents',this._addEventsForToolTips.bind(this))},_createPopup:function(){this.tip_popup=new Element('div');this.tip_popup.setStyles({display:'none',position:'absolute',top:0,'z-index':4});this.tip_popup.setHTML(this.options.tpl);$(document.body).adopt(this.tip_popup)},_addEventsForToolTips:function(){this.elements_with_tips=$(document.body).getElements('div[name='+this.tip_block_name+']');this.elements_with_tips.each(function(elem_parent){elem_parent.getElements(this.options.block_with_tips_selector).each(function(elem){if(elem.getElement(this.options.popup_content_selector)){elem.addEvents({'mouseenter':this._showTip.bindWithEvent(this,elem),'mouseleave':this._hideTip.bindWithEvent(this)})}}.bind(this))}.bind(this));this.tip_popup.addEvents({'mouseover':this.toolTipPopupActions.bindWithEvent(this,'show'),'mouseleave':this.toolTipPopupActions.bindWithEvent(this,'hide')})},_hideTip:function(){this.tip_popup.setStyle('display','none')},_showTip:function(event,elem){this.hover_elem=elem;if(this._setContent()){this.tip_popup.setStyle('display','');var position=this.toolTipPosition();this.tip_popup.setStyles({top:position.top,left:position.left});this.tip_popup.removeClass(this.tip_popup.className);this.tip_popup.addClass(position.class_name);App.fireEvent('renewImages')}},_setContent:function(){var content=this.tip_popup.getElement('[name=content]');var text=this.hover_elem.getElement(this.options.popup_content_selector);content.setHTML(text.innerHTML);return!this.isEmptyContent(text)},isEmptyContent:function(container){var result=true;container.getChildren().each(function(elem){if(elem.getProperty('name')!=this.options.more_link_name&&/\S/.test(elem.getText())){result=false;return 0}}.bind(this));return result},toolTipPopupActions:function(event,action){new Event(event).stop();if(action=='show'){this.tip_popup.setStyle('display','')}else if(action=='hide'){this.tip_popup.setStyle('display','none')}},toolTipPosition:function(){var block_coords=this.getToolTipBlock().getCoordinates();var elem_coords=this.hover_elem.getCoordinates();var tip_popup_coords=this.tip_popup.getCoordinates();var document_size=$(document.body).getSize();var left=0;var top=0;var class_name='left';if(block_coords.width>block_coords.height){if(elem_coords.left+tip_popup_coords.width+35>block_coords.right){left=elem_coords.right-tip_popup_coords.width;class_name=this.options.top_right_class}else{left=elem_coords.left-this.options.left_width_to_arrow;class_name=this.options.top_left_class}top=elem_coords.bottom+29}else{if(elem_coords.left>document_size.size.x-elem_coords.left){left=elem_coords.left-tip_popup_coords.width;class_name=this.options.right_class}else{left=elem_coords.right;class_name=this.options.left_class}top=elem_coords.top+elem_coords.height/2-this.options.heigth_to_arrow}return{left:left,top:top,class_name:class_name}},getToolTipBlock:function(){var elem=this.hover_elem;while(elem.getProperty('name')!=this.tip_block_name){elem=elem.getParent()}return elem}});RozetkaToolTips_class.implement(new Options);var UTAForms_class=UTAAbstract_class.extend({Class:'UTAForms_class',options:{properties:{title:'data-title'},glue:': '},_activated_time:0,_first_send_time:0,_count_user_error:0,_count_server_error:0,initEvents:function(){this.parent();window.addEvent('beforeunload',this.onBeforeUnloadHandler.bind(this));this._object.form.getFormElements().each(function(elem){elem.addEvent('focus',this.onActivatedNextFormField.bind(this));elem.addEvent('focus',this.onActivatedFormHandler.bind(this));elem.addEvent('blur',this.onDeactivatedFormField.bind(this))}.bind(this));this._object.addEvent('sendCommentForm',this.onFirstSendForm.bind(this));this._object.addEvent('failSendForm',this.onFailureSendForm.bind(this));this._object.addEvent('completeSendForm',this.onCompleteSendForm.bind(this));this._object.form.addEvent('onFieldsCheckFailed',this.onFailureCheckFields.bind(this));this._object.form.addEvent('onAfterComplete',this.onAfterCompleteHandler.bind(this))},onAfterCompleteHandler:function(){var result={timingVar:'send',timingLabel:'successful'};result['timingValue']=this.getTime();result['eventAttemptCount']=this._count_user_error+1;this.trackEvent(result)},onFailureCheckFields:function(elems){var result={timingVar:'send',timingLabel:'unsuccessful'},fields=[];result['timingValue']=this.getTime();elems.each(function(elem){if(elem.hasAttribute(this.options.properties.title)){fields.push(elem.getAttribute(this.options.properties.title))}}.bind(this));result['eventField']=fields.join('|');this._count_user_error++;result['eventAttemptCount']=this._count_user_error;this.trackEvent(result)},onCompleteSendForm:function(){var result={timingVar:'response',timingLabel:'successful'};result['timingValue']=this.getTime();this.trackEvent(result);this.reset()},onFailureSendForm:function(resp){var result={timingVar:'response',timingLabel:'unsuccessful'};result['timingValue']=this.getTime();this._count_server_error++;result['eventAttemptCount']=this._count_server_error;if(resp.status&&resp.statusText){result['eventError']=resp.status+this.options.glue+resp.statusText}this.trackEvent(result)},onFirstSendForm:function(){var result={timingVar:'send',timingLabel:'first'};if(!this._first_send_time){result['timingValue']=this._first_send_time=this.getTime();this.trackEvent(result)}},onActivatedNextFormField:function(e){var result={timingVar:'activation',timingLabel:'field'};document.fireEvent('FormFieldFocus');if(this._activated_time){result['timingValue']=this.getTime()-this._activated_time;if(e.target&&e.target.hasAttribute(this.options.properties.title)){result['eventField']=e.target.getAttribute(this.options.properties.title)}this.trackEvent(result)}},onActivatedFormHandler:function(e){var result={timingVar:'activation',timingLabel:'first'};if(!this._activated_time){this._activated_time=this.getTime();result['timingValue']=this._activated_time;if(e.target&&e.target.hasAttribute(this.options.properties.title)){result['eventField']=e.target.getAttribute(this.options.properties.title)}this.trackEvent(result)}},onDeactivatedFormField:function(){document.fireEvent('FormFieldBlur')},onBeforeUnloadHandler:function(){var result={timingVar:'leave',timingValue:this.getTime(),timingLabel:'noAttempts',eventAttemptCount:this._count_user_error+this._count_server_error,eventNonInteraction:1};if(this._count_user_error||this._count_server_error){result['timingLabel']='withAttempts'}if(this._activated_time){this.reset();this.trackEvent(result)}},reset:function(){this.parent();this._activated_time=0;this._first_send_time=0;this._count_user_error=0;this._count_server_error=0}});var PopupStorage_class=new Class({popups:{},getPopup:function(id,tpl,pElem){var popup_id=this.getId(id,tpl,pElem);if(!this.exist(popup_id)){this.popups[popup_id]=new Popup_class(tpl,pElem)}return this.popups[popup_id]},exist:function(popup_id){return this.popups.hasOwnProperty(popup_id)},getId:function(id,tpl,pElem){return(String(id)+(tpl?tpl:'')+(pElem?pElem:'')).getHashNum()}});var RozetkaImagePopup_class=new Class({Class:'RozetkaImagePopup_class',elem:null,image:null,popup:null,data:null,options:{tpl:'<div class=\"lightbox-popup\"> <div class=\"popup-css\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div name=\"content\"><\/div> <\/div> <\/div> ',content_tpl:'<div class=\"center container\"> <h2 name=\"title\"><\/h2> <table class=\"large-image\"> <tr> <td name=\"image\" class=\"show-foto {if data.big_image}popup-big-image{\/if}\"> ${data.image} {if data.big_image} <br> <a href=\"${data.big_image.href}\" target=\"blank\">{if data.text_for_big_image}${data.text_for_big_image}{else}Відкрити велике зображення{\/if}<\/a> <i>(${data.big_image.w} &times; ${data.big_image.h})<\/i> {\/if} <\/td> <\/tr> <\/table> <\/div>',text_for_big_image:null,max_width:1024},initialize:function(elem,image,overlay,big_image){this.elem=elem;this.image=image;this.popup=new Popup_class(this.options.tpl);if(overlay){this.popup.overlayON();this.popup._overlay._elem.setStyle('z-index','100')}switch($type(this.elem)){case'array':this.elem.each(function(el){el.addEvent('click',this.onClick.bindWithEvent(this))}.bind(this));break;case'element':this.elem.addEvent('click',this.onClick.bindWithEvent(this));break}this.popup.setContent(this.options.content_tpl,this.buildData(big_image))},buildData:function(big_image){this.data={data:{image:this.image,text_for_big_image:this.options.text_for_big_image}};if(big_image&&big_image.w>this.options.max_width){this.data.data.big_image=big_image}return this.data},onClick:function(event){new Event(event).stop();this.popup.open()}});RozetkaImagePopup_class.implement(new Options);var RozetkaElementsPerformance_class=new Class({place:'Catalog',setTrackEvent:function(parent_elem,href,action,gtm_data){var parent_element=$(parent_elem);if(parent_element){var elements=parent_element.getElements('a[href='+href+']');elements.extend(parent_element.getElements('a[href^='+href+'#]'));this._setClickEvent(elements,action,gtm_data)}},setTrackEventForFilter:function(parent_elem,href,action,gtm_data){this.setTrackEventForFilterBySelector(parent_elem,'a[href='+href+']',action,gtm_data)},setTrackEventForFilterBySelector:function(parent_elem,selector,action,gtm_data){var parent_element=$(parent_elem),previous;if(parent_element){var elements=parent_element.getElements(selector);var extend_elements=[];for(var index=0;index<elements.length;index++){if(previous=elements[index].getPrevious()){extend_elements.include(previous)}}elements.extend(extend_elements);this._setClickEvent(elements,action,gtm_data)}},setTrackEventForTrackBar:function(parent_elem,inputs,action,gtm_data){var parent_element=$(parent_elem);if(parent_element){var elements=parent_element.getElements('button[id='+inputs.button+']');this._setClickEvent(elements,action,gtm_data)}},_setClickEvent:function(elems,action,data){elems.each(function(elem){elem.addEvent('click',function(){var event_data={extend_event:[]},event_value;Object.each(data,function(value,key){event_value=value;if(typeof value=='object'&&(value.min||value.max)){if(value.min&&$(value.min)){event_value=$(value.min).value}if(value.max&&$(value.max)){event_value+='-'+$(value.max).value}}event_data.extend_event.push({name:key,value:event_value})});if(action&&!action.contains("sort | ")){document.fireEvent("applyFilter",event_data)}else{document.fireEvent("sortClick",event_data)}})})},_setEvent:function(e,params){if(_gaq){if(params.data){var label='not';var input_min=$(params.data.min);if(input_min&&input_min.value.toInt()>0){label='min'}var input_max=$(params.data.max);if(input_max&&input_max.value.toInt()>0){label=(label=='not')?'max':'min-max'}params.label=label}_gaq.push(['_trackEvent','Elements Performance',params.action,params.label])}},setPlace:function(place){this.place=place}});ApiSocial_class=new Class({_facebook_api_loaded:false,_vk_api_loaded:false,_facebook_app_id:'205429962821175',_facebook_sdk_src:'https://connect.facebook.net/ru_RU/sdk.js',_facebook_graph_version:'v1.0',_vk_app_id:'',initialize:function(){var settings_version=''+'v2.12';if(settings_version){this._facebook_graph_version=settings_version}if(this._facebook_graph_version==='v1.0'){this._facebook_sdk_src='https://connect.facebook.net/ru_RU/all.js'}},isLoaded:function(network){var result=false;if(this['_'+network+'_api_loaded'])result=true;return result},initFBApi:function(){FB.init({appId:this._facebook_app_id,xfbml:true,version:this._facebook_graph_version})},initVKApi:function(){VK.init({apiId:this._vk_app_id,onlyWidgets:true})},loadFBApi:function(){if(!this.isLoaded('facebook')){var script=Asset.javascript(this._facebook_sdk_src,{'onload':this.callbackFBLoad.bind(this)})}},callbackFBLoad:function(targetUrl){this._facebook_api_loaded=true;this.initFBApi();FB.Event.subscribe('edge.create',function(targetUrl){App.trackSocial('facebook','like')});FB.Event.subscribe('edge.remove',function(targetUrl){App.trackSocial('facebook','unlike')})},loadVKApi:function(elem,title,description,image_url,text_button){if(!this.isLoaded('vk')){var script=Asset.javascript('https://userapi.com/js/api/openapi.js?47',{'onload':this.callbackVKLoad.bind(this)})}},callbackVKLoad:function(targetUrl){this._vk_api_loaded=true;this.initVKApi();VK.Widgets.Like("vk_like",{type:"button",pageUrl:social_href});VK.Observer.subscribe('widgets.like.liked',function(targetUrl){App.trackSocial('vk','like')});VK.Observer.subscribe('widgets.like.unliked',function(targetUrl){App.trackSocial('vk','unlike')})},initTwitterCallback:function(){if(window.twttr){window.twttr.events.bind('tweet',function(event){if(event){var targetUrl;if(event.target&&event.target.nodeName=='IFRAME'){targetUrl=this._extractParamFromUri(event.target.src,'url')}_gaq.push(['_trackSocial','twitter','tweet',targetUrl])}}.bind(this))}},_extractParamFromUri:function(uri,paramName){if(!uri){return}var uri=uri.split('#')[0];var parts=uri.split('?');if(parts.length==1){return}var query=decodeURI(parts[1]);paramName+='=';var params=query.split('&');for(var i=0,param;param=params[i];++i){if(param.indexOf(paramName)===0){return unescape(param.split('=')[1])}}}});var Social_Abstract_class=new Class({Class:"Social_Abstract_class",_options:{},_apiPromise:null,initialize:function(options){this._options=$extend(this._options,options)},loadAPI:function(){},isMember:function(){},initWidgetGroup:function(){},_loadHandler:function(callback){callback()}});var Social_VK_class=Social_Abstract_class.extend({Class:'Social_VK_class',_options:{app_id:'2743724',api_url:'//userapi.com/js/api/openapi.js?47',group_id:'20877147',widget_container:'vk_groups'},loadAPI:function(){if(!this._apiPromise){this._apiPromise=new Promise(function(resolve,reject){Asset.javascript(this._options['api_url'],{'onload':this._loadHandler.bind(this,resolve)})}.bind(this))}return this._apiPromise},isMember:function(){var callback=function(resolve,reject){this.loadAPI().then(function(){VK.api('groups.isMember',{gid:this._options['group_id']},function(data){data.response==1?resolve(true):resolve(false)})}.bind(this),reject)};return new Promise(callback.bind(this))},initWidgetGroup:function(element_id,options){var callback=function(resolve,reject){this.loadAPI().then(function(){var widget_options={mode:0,width:0,height:0};VK.Widgets.Group(element_id,$extend(widget_options,options),this._options.group_id);VK.Observer.subscribe('widgets.groups.joined',this._trackLike.bind(this,'like'));VK.Observer.subscribe('widgets.groups.leaved',this._trackLike.bind(this,'unlike'));resolve()}.bind(this),reject)};return new Promise(callback.bind(this))},_loadHandler:function(callback){VK.init({apiId:this._options.app_id,onlyWidgets:true});this.parent(callback)},_trackLike:function(action){if(this._action!=action){App.trackSocial('Вконтакте',action);this.options._action=action}}});var Social_FB_class=Social_Abstract_class.extend({Class:'Social_FB_class',_options:{app_id:'205429962821175',api_url:'//connect.facebook.net/ru_RU/sdk.js',version:'v1.0',page_id:'164271473587410'},loadAPI:function(){if(!this._apiPromise){this._apiPromise=new Promise(function(resolve,reject){Asset.javascript(this._options['api_url'],{'onload':this._loadHandler.bind(this,resolve)})}.bind(this))}return this._apiPromise},isMember:function(){var callback=function(resolve,reject){this.loadAPI().then(function(){FB.api('/me/likes/'+this.page_id,'GET',{},function(response){(response['data']&&response['data'].length)?resolve(true):resolve(false)})}.bind(this),reject)};return new Promise(callback.bind(this))},initWidgetGroup:function(element_id,options){var callback=function(resolve,reject){this.loadAPI().then(function(){FB.XFBML.parse();resolve()}.bind(this),reject)};return new Promise(callback.bind(this))},_loadHandler:function(callback){FB.init({appId:this._options.app_id,xfbml:true,version:this._options.version});this.parent(callback)}});var Social_Google_class=Social_Abstract_class.extend({Class:'Social_Google_class',_options:{api_url:'https://apis.google.com/js/platform.js'},loadAPI:function(){if(!this._apiPromise){this._apiPromise=new Promise(function(resolve,reject){Asset.javascript(this._options['api_url'])}.bind(this))}return this._apiPromise},isMember:function(){var callback=function(resolve){resolve(false)};return new Promise(callback.bind(this))},initWidgetGroup:function(element_id,options){var callback=function(resolve,reject){this.loadAPI()};return new Promise(callback.bind(this))}});RozetkaApiSocial_class=ApiSocial_class.extend({Class:'RozetkaApiSocial_class',options:{_last_vk_track_social_action:null},current_url:null,_vk_api_url:'https://userapi.com/js/api/openapi.js?47',_facebook_app_id:'205429962821175',_vk_app_id:'2743724',_vk_group_id:'20877147',_fb_page_id:'164271473587410',_fb_load_callback:null,_social:{},_controllers:{'vkontakte':'Social_VK_class','google':'Social_Google_class','facebook':'Social_FB_class'},callbackFBLoad:function(){this.parent();if(this._fb_load_callback instanceof Function){this._fb_load_callback()}},loadFBApi:function(callback){if(!this.isLoaded('facebook')){this._fb_load_callback=callback;this.parent()}else if(callback instanceof Function){callback()}},setCurrentURL:function(current_url){this.current_url=current_url},vkSubscribe:function(event_name,callback){if(this.isLoaded('vk')){VK.Observer.subscribe(event_name,callback.bind(this))}},vkOnJoinGroup:function(){this.vkSubscribe('widgets.groups.joined',this._trackVKLike.bind(this,'like'));this.vkSubscribe('widgets.groups.leaved',this._trackVKLike.bind(this,'unlike'))},vkWidgetGroup:function(element_id,options){if(this._vk_api_loaded){var widget_options={mode:0,width:0,height:0};VK.Widgets.Group(element_id,$extend(widget_options,options),this._vk_group_id);this.vkOnJoinGroup()}},loadVKApi:function(callback){if(!this.isLoaded('vk')){var script=Asset.javascript(this._vk_api_url,{'onload':function(){this._callbackVKLoad(callback)}.bind(this)})}else if(callback instanceof Function){callback()}},_callbackVKLoad:function(callback){this._vk_api_loaded=true;this.initVKApi();callback&&callback()},_trackVKLike:function(action){if(this.options._last_vk_track_social_action!=action){App.trackSocial('Вконтакте',action);this.options._last_vk_track_social_action=action}},loadVKShareButton:function(elem,title,description,image_url,text_button){this._vk_elem=elem;this._vk_title=title;this._vk_description=description;this._vk_image_url=image_url;this._vk_text=text_button;if(!this.isLoaded('vk')){var script=Asset.javascript('http://vkontakte.ru/js/api/share.js?9',{'onload':this.callbackVKLoadShareButton.bind(this)})}else{this.callbackVKLoadShareButton()}},callbackVKLoadShareButton:function(){if(window.VK!=undefined){var button_options={title:this._vk_title,description:this._vk_description,image:this._vk_image_url};if(this.current_url){button_options['url']=this.current_url}$(this._vk_elem).innerHTML=VK.Share.button(button_options,{type:"round",text:this._vk_text});$(this._vk_elem).addEvent('click',this._trackVKLike.bind(this))}},get:function(name){var controller=App.getConstructorByClassName(this._controllers[name]);if(!this._social[name]&&controller){this._social[name]=new controller(this.options[name]||{})}return this._social[name]}});RozetkaApiSocial_class.implement(new Options);var ElementSelect_class=new Class({Class:'ElementSelect_class',options:{selectors:{block:'[name=select_block]',link:'[name=drop_link]',drop_block:'[name=drop_block]',drop_element:'[name=drop_element]',drop_block_wrap:'[name=drop_block_wrap]',input:'input[type=hidden]',search_element:'input[name=search_element]',search_element_wrap:'[name=search_element_wrap]',drop_element_not_found:'[name=drop_element_not_found]'},cssClasses:{hidden:'hidden',checked:'active'},properties:{question:{title:'data-question-title',value:'data-question-value'},value:'data-value',active:'data-active'},entity:'ElementSelectEntity_class',tpl_phrases:'Виберіть варіант',phrases:'',set_value:true,suggest_count_elems_show:4},_hidden_elements_count:0,_elements:[],initialize:function(){this.options.phrases=App.getHTML(this.options.tpl_phrases,{});this.attachToObserver(['LoadTabContent','ResetForm','DisableForm'])},init:function(container){var constructor=App.getConstructorByClassName(this.options.entity);constructor&&container.getElements(this.options.selectors.block).each(function(block){this._elements.push(new constructor(block,this).setOptions(this.options).init())}.bind(this));return this},_reset:function(container){container.getElements(this.options.selectors.block).each(function(block){this._elements.forEach(function(element){element._container==block&&element.reset()})}.bind(this))},_disable:function(container){container.getElements(this.options.selectors.block).each(function(block){this._elements.forEach(function(element){element._container==block&&element.disable()})}.bind(this))},closeOtherSelect:function(select){this._elements.each(function(element){if(element!=select){element.close()}})},onLoadTabContent:function(data){this.init(data[0])},onResetForm:function(data){this._reset(data[0])},onDisableForm:function(data){this._disable(data[0])}});ElementSelect_class.implement(new Options(),new Events());var ElementSelectEntity_class=new Class({Class:'ElementSelectEntity',options:{selectors:{block:'[name=select_block]',link:'[name=drop_link]',drop_block:'[name=drop_block]',drop_element:'[name=drop_element]',drop_block_wrap:'[name=drop_block_wrap]',input:'input[type=hidden]',search_element:'[name=search_element]',search_element_wrap:'[name=pickups_search_element_wrap]',drop_element_not_found:'[name=drop_element_not_found]'},cssClasses:{invalid:null,hidden:'hidden',checked:'active'},properties:{question:{title:'data-question-title',value:'data-question-value'},value:'data-value',active:'data-active',title:'data-title'},tpl_phrases:'Виберіть варіант',phrases:'',set_value:true,suggest_count_elems_show:4},_container:null,_controller:null,_drop_block:null,_link:null,_input:null,_drop_elements:[],_not_fount_element:null,_drop_block_wrap:null,_suggest_active:null,_search_element:null,_search_element_wrap:null,elements:[],showed_elements:[],initialize:function(container,controller){this._container=container;this._controller=controller;this.options.phrases=App.getHTML(this.options.tpl_phrases,{})},init:function(){this._link=this._container.getElement(this.options.selectors.link);this._drop_block=this._container.getElement(this.options.selectors.drop_block);this._input=this._container.getElement(this.options.selectors.input);this._link.removeEvents('click').addEvent('click',this._handlerLink.bind(this));this.initDropElements();this.initSearchElement();$(document.body).addEvent('click',this._hideDropBlock.bind(this));if(this._input&&this._input.value&&this.options.set_value){this.setValue(this._input.value)}this._input['setValue']=this.setValue.bind(this);return this},setValue:function(value){var elements=this._getElementByValue(value);if(elements&&elements.length>0){this._selectElement(elements[0]);this.close()}},getValue:function(){return this._input?this._input.getValue():null},initSearchElement:function(){if(this.options.selectors.search_element&&this.elements.length>=this.options.suggest_count_elems_show){this._search_element=this._container.getElement(this.options.selectors.search_element);this._search_element_wrap=this._container.getElement(this.options.selectors.search_element_wrap);if(this._search_element){this._search_element.removeEvent('click',this._stopEvent.bind(this));this._search_element.addEvent('click',this._stopEvent.bind(this));this._search_element.removeEvent('keydown',this.onKeyDown.bind(this));this._search_element.addEvent('keydown',this.onKeyDown.bind(this));this._search_element.removeEvent('keyup',this.onKeyUp.bind(this));this._search_element.addEvent('keyup',this.onKeyUp.bind(this))}}else if(this._search_element){this._search_element=null}},onKeyUp:function(){this._hidden_elements_count=0;this.showed_elements=[];this._drop_elements.forEach(function(element){if(this._search_element.value===''||this.hasMatches(element.getProperty(this.options.properties.title).trim().toLowerCase(),this._search_element.value.trim().toLowerCase())){element.show();this.showed_elements.push(element)}else{element.hide();this._hidden_elements_count++}}.bind(this));this._drop_block.scrollTo(0,0);if(this._not_fount_element){if(this._drop_elements.length===this._hidden_elements_count){this._not_fount_element.show()}else{this._not_fount_element.hide()}}},onKeyDown:function(e){if(e.keyCode===27||e.keyCode===9){this.close()}},hasMatches:function(str,needle){if(~str.indexOf(needle)){return true}else if(needle.length>2&&needle.split(' ').length>1){return needle.split(' ').every(function(word){return~str.indexOf(word)})}else{return false}},_stopEvent:function(e){new Event(e).stop()},initDropElements:function(){this.elements=[];this._drop_elements=this._container.getElements(this.options.selectors.drop_element);this._drop_elements.forEach(function(element){element.removeEvent('click',this._handlerDropElement.bind(this));if(!~this.elements.indexOf(element)){element.addEvent('click',this._handlerDropElement.bind(this));this.elements.push(element)}}.bind(this));if(this.options.selectors.drop_element_not_found){this._not_fount_element=this._container.getElement(this.options.selectors.drop_element_not_found);this._not_fount_element&&this._not_fount_element.hide()}this._drop_block_wrap=this._container.getElement(this.options.selectors.drop_block_wrap);this._drop_block_wrap&&this._drop_block_wrap.hide()},_getElementByValue:function(value){return this._drop_elements.filter(function(element){return(value==element.getProperty(this.options.properties.value))}.bind(this))},_selectElement:function(element){var value=element&&element.getProperty(this.options.properties.value);if(value){this._setLinkHTML(element);this._link.setProperty('data-value',value);this._input.value=value;this._input.fireEvent('change',{target:this._input});this._input.disabled=false;this._clearDropElementsCss();element.addClass(this.options.cssClasses.checked);this._container.highlightReset(this.options.cssClasses.invalid);this.fireEvent('selectElement',{target:element,'value':value});document.fireEvent('changedSelectElement')}},_setLinkHTML:function(element){this._link.setHTML(element.innerHTML)},_handlerDropElement:function(e){new Event(e).stop();this._selectDropElement(e.target)},_selectDropElement:function(element){this._selectElement(element);this.fireEvent('elementSelectOptionClick',{target:this._input});this.close();this.analytic(element);this._fireDropElementEvent(element)},_clearDropElementsCss:function(){this._drop_elements.each(function(element){element.hasClass(this.options.cssClasses.checked)&&element.removeClass(this.options.cssClasses.checked)}.bind(this))},_fireEventByName:function(event_name,input){var event={type:event_name};event['target']=input;input.fireEvent('focus',event)},_hideDropBlock:function(e){this.close()},close:function(){if(this.isVisible()){this._hideSelect()}},_handlerLink:function(e){e&&new Event(e).stop();this._controller&&this._controller.closeOtherSelect(this);if(this.isVisible()){this._hideSelect()}else{this._showSelect()}},_showSelect:function(){if(this._search_element){this._search_element.show();this._search_element_wrap&&this._search_element_wrap.show()}this._drop_block_wrap&&this._drop_block_wrap.show();this._drop_block.show();if(this._search_element){this._search_element.focus();this._fireEventByName('focus',this._search_element)}},_hideSelect:function(){if(this._search_element){this._search_element.blur();this._search_element_wrap&&this._search_element_wrap.hide();this._search_element.hide();this._search_element.value='';this.onKeyUp()}this._drop_block_wrap&&this._drop_block_wrap.hide();this._drop_block.hide()},reset:function(){this._link.setHTML(this.options.phrases);if(!this._input.disabled){this._input.value=null;this._input.disabled=true}this._clearDropElementsCss()},disable:function(){this._link.removeEvents('click')},isVisible:function(){return!this._drop_block.hasClass('hidden')},_fireDropElementEvent:function(target){document.fireEvent('dropSelectElement',{target:target})},analytic:function(element){var events=[];if(element&&element.hasAttribute(this.options.properties.question.title)&&element.hasAttribute(this.options.properties.question.value)&&element.getAttribute(this.options.properties.question.title)!==''&&element.getAttribute(this.options.properties.question.value)!==''){events.push({name:'eventContext',value:element.getAttribute(this.options.properties.question.title)});events.push({name:'eventContent',value:element.getAttribute(this.options.properties.question.value)})}document.fireEvent('dropDownList',{extend_event:events})},setInputProperty:function(name,value){this._input.setProperty(name,value)},getInputProperty:function(name){return this._input.getProperty(name)},getInput:function(){return this._input},isValid:function(show_errors){var result=true;if(this._input){if(this._input.getProperty('_required')==='required'&&!this._input.getValue()&&this._container.isVisible()){result=false;if(show_errors){this._container.highlightError(this.options.cssClasses.invalid);if(this._drop_block.hasClass(this.options.cssClasses.hidden)){this._link.click()}document.fireEvent('formSendFieldError',{extend_event:[{name:'eventError',value:'Поле не заполнено'},{name:'eventField',value:this._input.getAttribute('data-title')?this._input.getAttribute('data-title'):this._input.getAttribute('name')}]});this.fireEvent('notValid')}}else{this._container.highlightReset(this.options.cssClasses.invalid)}}return result},getElementBlock:function(){return this._container},isElementOffScreen:function(){var position_select=this._container.getCoordinates();return window.scrollY>(position_select.bottom)||window.scrollY<(position_select.top)}});ElementSelectEntity_class.implement(new Options(),new Events());var ElementSelectSortEntity_class=ElementSelectEntity_class.extend({Class:'ElementSelectSortEntity_class',options:{reload:true},init:function(){this.parent();this._drop_block.addEvent('click',function(event){new Event(event).stop()});return this},_handlerDropElement:function(e){this.parent(e);if(this.options.reload){window.location.href=e.target.href}this.fireEvent('sortEntityChanged')},setActiveElemByValue:function(value){var elem=null;this._drop_elements.each(function(el){if(el.getProperty(this.options.properties.value)==value){elem=el}}.bind(this));if(elem){this._link.setHTML(elem.innerHTML);this._input.value=value;this._input.disabled=false;this._clearDropElementsCss();elem.addClass(this.options.cssClasses.checked)}}});var CustomVars_class=new Class({Class:'CustomVars_class',Implements:[Options],_vars:{},options:{vars:{}},set:function(name,value){if($defined(this.options.vars[name])){var options=this.options.vars[name];App.setCustomVar(options.slot,name,value||options.default_value,options.opt_scope)}},remove:function(name){if($defined(this.options.vars[name])){App.deleteCustomVar(parseInt(this.options.vars[name].slot))}}});var RozetkaCustomVars_class=CustomVars_class.extend({Class:'RozetkaCustomVars_class',options:{vars:{Users:{slot:1,default_value:'customer',opt_scope:1},goods_sell_status:{slot:2,default_value:null,opt_scope:3},SSC_product:{slot:3,default_value:null,opt_scope:3},userId:{slot:4,default_value:null,opt_scope:1},rival_bot:{slot:5,default_value:1,opt_scope:3},VisitorCity:{slot:5,default_value:null,opt_scope:1}}}});var TrackUserOfMadeOrder_class=new Class({Class:'TrackUserOfMadeOrder_class',options:{index:1,name:'Users',value:'Customer',opt_scope:1},initialize:function(){App.addOnDomReady(function(){this.checkAlreadyMadeOrder()}.bind(this));$(document).addEvent('signIn',this.checkAlreadyMadeOrder.bind(this))},checkAlreadyMadeOrder:function(){if(Cookie.get("made_order")&&!Cookie.get("just_made_order")){App.setCustomVar(this.options.index,this.options.name,this.options.value,this.options.opt_scope);Cookie.remove('made_order',{domain:'.rozetka.com.ua',path:'/'})}},onOrderSuccess:function(){Cookie.set('made_order',1,{duration:365,domain:'.rozetka.com.ua',path:'/'});Cookie.set('just_made_order',1,{domain:'.rozetka.com.ua',path:'/'})}});TrackUserOfMadeOrder_class.implement(new Options);var OAuth2Inform_class=new Class({ACTION:{NEW_USER:1,EXISTING_USER:2,NEED_USER_EMAIL:3,EXISTING_EMAIL:4,AUTH_USER:5},popup:null,oauth:null,type:null,options:{popup_class:Popup_class,popup_tpl:'<div class=\"popup-css auth-social-popup\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div class=\"auth-new\" name=\"content\"><\/div> <\/div>',tpl:{'message_content':'<p class=\"auth-social-message\">${content}<\/p>','signin':'<div class=\"auth-social-wrap\"> {if typeof title != \'undefined\'}<h2 class=\"auth-title\">Ви зайшли як ${title}<\/h2>{\/if} <form method=\"post\" action=\"\/cgi-bin\/form.php\" name=\"submit-by-ajax\"> <div class=\"auth-f-i f-i1\"> <div class=\"auth-f-i-title\">Эл. почта<\/div> <input class=\"input-text auth-input-text\" type=\"text\" name=\"login\" {if typeof email != \'undefined\'}value=\"${email}\"{\/if}> <div class=\"auth-message msg\" name=\"msg\"> {if typeof email != \'undefined\'} <p class=\"auth-message-text\"> Користувач з адресою ${email} вже зареєстрований на Розетці.<br> Якщо це ви - введіть пароль. <\/p> {\/if} <\/div> <\/div> <div class=\"auth-f-i f-i\"> <div class=\"auth-f-i-title\">Пароль<\/div> <input class=\"input-text auth-input-text\" type=\"password\" name=\"password\"> <div class=\"auth-f-remind-pass\"> <a class=\"auth-f-remind-pass-link novisited xhr\" href=\"#\" name=\"remind\">Нагадати пароль<\/a> <\/div> <\/div> <div class=\"clearfix f-i auth-f-submit\"> <div class=\"auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <button class=\"btn-link-i\" type=\"submit\" name=\"signin\">Увійти<\/button> <\/span> <a class=\"novisited auth-f-cancel\" href=\"#\" name=\"close\">Скасувати<\/a> <\/div> <\/div> <\/form> <\/div>','remind_password':'<div class=\"auth-social-wrap\"> <h2 class=\"auth-title\">Нагадування пароля<\/h2> <form class=\"f-remember\"> <div class=\"auth-f-i f-i\"> <div class=\"auth-f-i-title\">Ел.&nbsp;пошта <span class=\"require\">*<\/span><\/div> <input type=\"text\" {if typeof email != \'undefined\'}value=\"${email}\"{\/if} class=\"input-text\" name=\"login\" value=\"${User.getEmail(true)}\" _required=\"required\" _pattern=\"^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$|^\\s*((\\+?\\s*(\\(\\s*)?3)?[\\s-]*(\\(\\s*)?8[\\s-]*)?(\\(\\s*)?0[\\s-\\(]*[1-9][\\s-]*\\d(\\s*\\))?([\\s-]*\\d){7}\\s*$\"> <\/div> <div class=\"auth-f-i f-i\"> <div class=\"auth-f-i-title\">Ми надішлемо вам лист із&nbsp;посиланням для зміни пароля<\/div> <\/div> <div class=\"clearfix f-i auth-f-submit\"> <div class=\"auth-remember-pass-submit\"> <span class=\"btn-link btn-link-gray auth-remember-pass-submit-btn\"> <button class=\"btn-link-i\" type=\"submit\" name=\"send_password\">Отримати тимчасовий пароль<\/button> <\/span> <\/div> <div class=\"auth-remember-pass\"> <a class=\"novisited auth-remember-pass-link\" name=\"return_back\" href=\"#\">Скасувати<\/a> <\/div> <\/div> <div name=\"msg\" class=\"msg error\"><\/div> <\/form> <\/div>'},selectors:{remind_password:'[name=remind]',return_button:'[name=return_back]'},ajax:{remind_password:'https://my.rozetka.com.ua/ua/remind-password/#remindPassword',signin:'https://my.rozetka.com.ua/ua/signin/#SignIn'},action:{'facebook':{'new_user':'<div> Вы вошли как ${title} <\/div>','existing_user':'<div> Вы вошли как ${title} <\/div>','need_email':'<div> Вы вошли как ${title} <\/div>','auth_user':'<div> Вы вошли как ${title} <\/div>'},'vkontakte':{'new_user':'<div> Вы вошли как ${title} <\/div>','existing_user':'<div> Вы вошли как ${title} <\/div>','need_email':'<div> Вы вошли как ${title} <\/div>','auth_user':'<div> Вы вошли как ${title} <\/div>'}},google_widget:'https://apis.google.com/js/platform.js'},initialize:function(oauth){this.oauth=oauth},inform:function(value,type){this.type=type;if(value==this.ACTION.NEW_USER){this.loadGoogleWidget(type);this.informNewUser(this.getData())}else if(value==this.ACTION.EXISTING_USER){this.loadGoogleWidget(type);this.informExistingUser(this.getData())}else if(value==this.ACTION.NEED_USER_EMAIL){this.onEmptyEmail()}else if(value==this.ACTION.AUTH_USER){this.informUserAuth(this.getData())}},informUserAuth:function(data){this.showPopup(this.options.action[this.type].auth_user,data)},loadGoogleWidget:function(type){if(type=='google'){Asset.javascript(this.options.google_widget)}},informNewUser:function(data){this.showPopup(this.options.action[this.type].new_user,data)},informExistingUser:function(data){this.showPopup(this.options.action[this.type].existing_user,data)},getData:function(additional_data){S.renew();var data=typeof User.S.accounts!='undefined'&&typeof User.S.accounts[this.type]!='undefined'?User.S.accounts[this.type]:{};if(additional_data){data=$merge(data,additional_data)}return data},showPopup:function(tpl,data){var popup=this.getPopup();popup.setContent(tpl,data);popup.open()},getPopup:function(){this.popup=this.popup||new this.options.popup_class(this.options.popup_tpl);return this.popup},onEmptyEmail:function(){this.social_id=this.oauth.get('social_id');this.user_title=this.oauth.get('user_title');var data=this.oauth.getTemplatesData();data['type']=this.type;data['social_id']=this.social_id;data['title']=this.user_title;this.showPopup(this.options.action[this.type].need_email,data);this.addPopupEvents();this.popup.form.addEvent('submit',this.sendEmail.bind(this))},sendEmail:function(e){new Event(e).stop();var options={onComplete:this.onGetEmail.bind(this)};this.popup.form.trySend(options)},onGetEmail:function(resp){this.popup.form.processStop();var response=new Response_class(resp);if(response.isDone()){this.informNewUser(this.getData(response.S.user.accounts[this.type]));S.onLoad(response.S);this.oauth.trackAuth(this.type);this.clearPopupEvents()}else{if(response.action==this.ACTION.EXISTING_EMAIL){this.email=this.popup.getElement('input[name=email]').getValue();this.showSigninPopup()}else{if(response.Message.content){response.Message.setOptions({tpl:this.options.tpl.message_content});this.popup.content.setHTML(response.Message.getContentTpl())}}}},showSigninPopup:function(){this.showPopup(this.options.tpl.signin,{email:this.email,social_id:this.social_id,title:this.user_title,type:this.type});this.popup.form.addEvent('submit',this.authorize.bind(this));this.popup.getElement(this.options.selectors.remind_password).addEvent('click',this.showRemindPassword.bind(this))},authorize:function(e){new Event(e).stop();var options={onComplete:this.onAuthorize.bind(this),headers:{ajaxAction:this.options.ajax.signin}};this.popup.form.trySend(options)},onAuthorize:function(resp){this.popup.form.processStop();var response=new Response_class(resp);if(response.isDone()){this.clearPopupEvents();this.bindAccount(this.social_id,this.type);response.doAction();this.popup.close()}else{this.popup.msg.setHTML(response.Message.content)}},bindAccount:function(social_id,type){var options={onComplete:this.onBindAccount.bind(this),method:'post',data:{social_id:social_id},headers:{ajaxAction:'https://my.rozetka.com.ua/ua/signin/oauth/'+type+'/#bindAccount'}};new Ajax('/cgi-bin/form.php',options).request()},onBindAccount:function(resp){var response=new Response_class(resp);if(response.isDone()){this.oauth.trackAuth(this.type);this.clearPopupEvents();this.informExistingUser(this.getData({title:this.user_title}));S.load()}else{this.oauth.trackError(this.type)}},showRemindPassword:function(e){new Event(e).stop();this.showPopup(this.options.tpl.remind_password,{email:this.email});this.popup.form.addEvent('submit',this.sendPassword.bind(this));this.popup.getElement(this.options.selectors.return_button).addEvent('click',this.showSigninPopup.bind(this))},sendPassword:function(e){new Event(e).stop();var options={headers:{'ajaxAction':this.options.ajax.remind_password},onComplete:this.onSendPassword.bind(this)};this.popup.form.trySend(options)},onSendPassword:function(resp){this.popup.form.processStop();var Response=new Response_class(resp);this.popup.msg.setHTML(Response.Message.content)},addPopupEvents:function(){this.getPopup().addEvent('beforeClose',this.onClose.bind(this));this.getPopup().addEvent('close',this.clearPopupEvents.bind(this))},onClose:function(){this.oauth.trackError(this.type)},clearPopupEvents:function(){this.popup.$events.close=null;this.popup.$events.beforeClose=null}});OAuth2Inform_class.implement(new Options);var OAuth2_class=new Class({auth_property_value:null,events_added:false,window:null,informer:null,names:{'social_action':'action','social_error':'error','social_id':'social_id','social_users_phone_hash':'user_phone_hash','social_error_key':'error_key','user_title':'user_title'},options:{informer_class:typeof(OAuth2Inform_class)!=='undefined'?OAuth2Inform_class:null,social_buttons_name:'social_button_auth',social_buttons_location:'data-location',csrf_token:null,social_attr:'type',binding:false,inform:false,tpl:{"facebook":'{if User.isAuthInSocial(\"facebook\")} <form action=\"https:\/\/my.rozetka.com.ua\/ua\/cgi-bin\/form.php?r=https%3A%2F%2Fmy.rozetka.com.ua%2Fua%2Fsignin%2Foauth%2Ffacebook%2F&action=unbindAccount\" class=\"profile-social-unbind-f\" method=\"post\"> <input type=\"hidden\" name=\"type\" value=\"facebook\"> <label class=\"social-bind-i social-bind-i-fb\"> <span class=\"sprite-side btn-link btn-link-gray activated\"> <button type=\"submit\" class=\"btn-link-i\" onclick=\"document.fireEvent(\'unbindSocial\', {extend_event: [{name: \'eventContent\', value: \'Facebook\'}]});\"> <span class=\"social-bind-i-head\">${title}<\/span> <span class=\"social-bind-i-link inline novisited xhr\">Скасувати зв\'язок<\/span> <\/button> <\/span> <\/label> <\/form> {else} <span class=\"social-bind-i social-bind-i-fb\"> <a href=\"http:\/\/www.facebook.com\/v2.12\/dialog\/oauth\/?client_id=205429962821175&redirect_uri=https%3A%2F%2Fmy.rozetka.com.ua%2Fua%2Fsignin%2Foauth%2Ffacebook%2F&display=popup&scope=public_profile%2Cemail%2Cuser_likes\" target=\"_blank\" class=\"sprite-side btn-link btn-link-gray\" id=\"checkout_auth_fb\" onclick=\"document.fireEvent(\'bindSocial\', {extend_event: [{name: \'eventContent\', value: \'Facebook\'}]});\" > <span class=\"btn-link-i\"> <span class=\"social-bind-i-head\">Facebook<\/span> <span class=\"novisited xhr\">Зв\'язати з соцмережею<\/span> <\/a> <\/span> <\/span> {\/if}',"vkontakte":'{if User.isAuthInSocial(\"vkontakte\")} <form action=\"https:\/\/my.rozetka.com.ua\/ua\/cgi-bin\/form.php?r=https%3A%2F%2Fmy.rozetka.com.ua%2Fua%2Fsignin%2Foauth%2Fvkontakte%2F&action=unbindAccount\" class=\"profile-social-unbind-f\" method=\"post\"> <input type=\"hidden\" name=\"type\" value=\"vkontakte\"> <label class=\"social-bind-i social-bind-i-vk\"> <span class=\"sprite-side btn-link btn-link-gray activated\"> <button type=\"submit\" class=\"btn-link-i\" onclick=\"document.fireEvent(\'unbindSocial\', {extend_event: [{name: \'eventContent\', value: \'VKontakte\'}]});\"> <span class=\"social-bind-i-head\">${title}<\/span> <span class=\"social-bind-i-link inline novisited xhr\">Скасувати зв\'язок<\/span> <\/button> <\/span> <\/label> <\/form> {else} <span class=\"social-bind-i social-bind-i-vk\"> <a href=\"\" target=\"_blank\" class=\"sprite-side btn-link btn-link-gray\" id=\"checkout_auth_vk\" onclick=\"document.fireEvent(\'bindSocial\', {extend_event: [{name: \'eventContent\', value: \'VKontakte\'}]});\" > <span class=\"btn-link-i\"> <span class=\"social-bind-i-head\">ВКонтакті<\/span> <span class=\"novisited xhr\">Зв\'язати з соцмережею<\/span> <\/a> <\/span> <\/span> {\/if}'}},initialize:function(social_buttons_name){if(social_buttons_name){this.options.social_buttons_name=social_buttons_name}return this},update:function(tpl){var template=null,templates={},element_name=null,form,anchor;if(!this.options.replacement_tpl){templates[this.options.social_buttons_name]=this.options.tpl}else{templates=this.options.replacement_tpl}for(element_name in templates){template=templates[element_name];if(template){if(tpl){template=$merge(template,tpl)}this.updateElements(template,element_name)}}return this},updateElements:function(template,element_name){$ES("[name="+element_name+"]").each(function(el){var account=el.getProperty(this.options.social_attr),form,anchor,template_data,location=el.getProperty(this.options.social_buttons_location);if(account){template_data=this.getTemplatesData(account);template_data['location']=location?location:null;el.setHTML(App.getHTML(template[account],template_data));if(User.isAuthInSocial(account)){form=el.getElement('form');if(form){form.addEvent('submit',function(e){new Event(e).stop();form.trySend()});form.addEvent('onResponseDone',function(){this.trackEvent(account,'unbind');this.fireEvent('social_unbind')}.bind(this))}}else{anchor=el.getElement('a');if(anchor){anchor.removeEvents('click');this.updateAnchorToken(anchor);anchor.addEvent('click',this.authorize.bind(this))}}}}.bind(this))},getTemplatesData:function(accounts){var account=accounts||this.type;return typeof User.S.accounts!=='undefined'&&typeof User.S.accounts[account]!=='undefined'?User.S.accounts[account]:{}},updateAnchorToken:function(el){var state,state_new,match,redirect_uri;if(this.options.csrf_token){state=this.getParamByName(el.href,'state');state_new=md5(decodeURI(Cookie.get('uid')).replace(/[+]/g,' ')+this.options.csrf_token);if(state){el.href=el.href.replace(state,state_new)}else{el.href=el.href+"&state="+state_new}}if(this.options.binding){match=el.href.match(/.*\&redirect_uri=(.[^&]*).*/i);if(match){redirect_uri=match[1]+encodeURIComponent('?type=bind');el.href=el.href.replace(match[1],redirect_uri)}}},getParamByName:function(href,name){var regexS,regex,results;name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");regexS="[\\?&]"+name+"=([^&#]*)";regex=new RegExp(regexS);results=regex.exec(href);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "))},authorize:function(e){var event=new Event(e),el;event.stop();this.fireEvent('login_start');el=this.searchElementType($(event.target));if(el){this.type=el.getProperty(this.options.social_attr)}this.getDialogHrefByLang(this.type,this.options.current_lang);setTimeout(function(){this.doAuthorize(this.searchElWithHref($(event.target)))}.bind(this),1000);document.fireEvent('ShowSocialPopup')},searchElWithHref:function(el){if(!el.getProperty('href')&&el.getParent()){el=this.searchElWithHref(el.getParent())}return el},searchElementType:function(el){if(!el.getProperty(this.options.social_attr)&&el.getParent()){el=this.searchElementType(el.getParent())}return el},openWindow:function(url,title,w,h){var left,top;left=(screen.width/2)-(w/2);top=(screen.height/2)-(h/2);return window.open(url,title,'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left)},checkClosed:function(window){if(window&&typeof window!='number'){this.window=window}if(this.window){if(this.window.closed){this.window=null;this.bindEvents();S.load(true)}else{setTimeout(this.checkClosed.bind(this),100)}}},doAuthorize:function(el){if(el.href){this.checkClosed(this.openWindow(el.href,'',600,300))}},bindEvents:function(){if(!this.track_auth){S.addEvent('loadS',function(e){if(this.type){this.handle();this.addSocialEvents();this.type=null}}.bind(this));this.track_auth=true}},handle:function(){var value,name;this.fireEvent('login_complete');for(name in this.names){value=Cookie.get(name);if(value){this[this.names[name]]=value.replace(/\+/g,' ');Cookie.remove(name,{path:'/',domain:'rozetka.com.ua'})}}},addSocialEvents:function(){if(this.type&&User.isAuthInSocial(this.type)){this.trackAuth(this.type);this.onAction(this.get('action'))}else{var action=this.get('action');if(action){this.onAction(action)}else{var error=this.get('error'),type=this.get('type'),error_key=this.get('error_key'),user_phone_hash=this.get('user_phone_hash');if(error){this.trackError(this.type);var OauthMessage=new Message_class({content:error,code:'5'});App.showMessage(OauthMessage);this.fireEvent('login_failed',{value:this.get('error')});this.trackSignInFailEvent(error,type,user_phone_hash,error_key)}}}},trackSignInFailEvent:function(error,type,user_phone_hash,error_key){var event_data={eventError:error,eventLabel:type};if(error_key=='phoneInBlackList'){User.increaseAuthAttemptsCount();event_data["eventError"]="BlackList";event_data["eventContext"]=User.getAuthAttemptsCount();event_data["userPhoneNumberHash"]=user_phone_hash}document.fireEvent('signInFailed',event_data)},trackAuth:function(type){var event=this.options.binding?'bind':'login';this.trackEvent(type,event);this.fireEvent('login_success')},trackError:function(type){this.trackEvent(type,'close')},trackEvent:function(type,event){App.trackEvent('SocialAuthorization',type,event)},onAction:function(value){if(this.options.inform&&value){this.getInformer().inform(value,this.type)}},getDialogHrefByLang:function(soc_title,lang){var site_cookie_lang;if((window['LanguageSwitcher']===undefined||!window['LanguageSwitcher'].isDisabledMultilang())&&window['LanguageDeterminer_class']!==undefined){site_cookie_lang=LanguageDeterminer_class.prototype.getLangCookie()}if(site_cookie_lang&&lang!=site_cookie_lang){var url=this.options.ajax.url+soc_title+this.options.ajax.action,options={data:{return_href:this.options.url[soc_title],site_lang:site_cookie_lang},method:'post',headers:{ajaxAction:url},onComplete:this._onGetDialogHrefByLang.bind(this,soc_title)};new Ajax('/cgi-bin/form.php',options).request()}},_onGetDialogHrefByLang:function(type,response){try{var result=JSON.parse(response)}catch(err){App.err(err)}var url=result.content,soc_type='social_href_'+type,element=document.getElementById(soc_type);if(url&&element){element.setAttribute('href',url)}},getInformer:function(){this.informer=this.informer||new this.options.informer_class(this);return this.informer},setInformOptions:function(options){this.getInformer().setOptions(options)},get:function(value){var val;if(this[value]){val=this[value];this[value]=null}else{val=null}return val}});OAuth2_class.implement(new Options(),new Events());var RozetkaViewsAnalytics_class=new Class({setEventForSplitTestNewTile:function(parent_elem,href,params){var parent_element=$(parent_elem);if(parent_element){var elements=parent_element.getElements('a[href='+href+']');elements.extend(parent_element.getElements('a[href^='+href+'#]'));for(var index=0;index<elements.length;index++){var event='click-'+params.view_type;elements[index].addEvent('click',function(e){var locations='';if(params.view_type=='list'){locations=params.position}else{locations=params.position+'_'+this._calculateCountColumn(params.flag)+'_'+params.plitka_type}rozetkaEvents.trackEvent(event,params.category,locations,params.rank)}.bind(this))}}},_calculateCountColumn:function(flag){var windowWidth=window.innerWidth;var countColumn=0;if(windowWidth<1260){countColumn=2}else if(windowWidth<1495){countColumn=3}else if(windowWidth<=1860){countColumn=4}else{countColumn=5}if(flag){countColumn+=1}return countColumn}});var Watcher_class=new Class({Class:'Watcher_class',_it:false,x:false,y:false,_track:function(what){var cookie_sid_accessible=this._getCookieSidAccessibleUrlParam();new Ajax('/w/?'+md5(new String(new Date().getTime())).substr(0,6)+what+cookie_sid_accessible).request()},_getCookieSidAccessibleUrlParam:function(){var cookie_sid_accessible='';if(!!parseInt(Cookie.get('ho_sid'))&&Cookie.get('sid')){cookie_sid_accessible='&cookie_sid_accessible='+Cookie.get('sid')}return cookie_sid_accessible},initialize:function(){if('ontouchstart'in document.documentElement||'ontouchstart'in document.documentElement||'ontouchend'in document.documentElement||'ongesturestart'in document.documentElement||'ongesturechange'in document.documentElement||'ongestureend'in document.documentElement){this._track(1);return}document.documentElement.onmousemove=this._mm.bind(this);App.addOnDomReady(function(){$$('[name="price"]').each(function(el){el.addEvent('mousedown',this._md.bind(this));el.addEvent('mouseup',this._mu.bind(this));if($defined(window.ie)){el.addEvent('dblclick',this._pact.bind(this))}}.bind(this))}.bind(this))},_mm:function(e){if(!this._it){var cx=$defined(window.ie)?event.clientX:e.clientX;var cy=$defined(window.ie)?event.clientY:e.clientY;if(!this.x){this.x=cx;this.y=cy}else if(this.x!=cx||this.y!=cy){this._it=true;this._track(2)}}},_pact:function(){var txt;if(window.getSelection){txt=window.getSelection().toString();if(!txt||txt.length<=1){return}}else if(document.selection){var sel=document.selection;txt=sel.createRange().text;if(!txt||txt.length<=1){return}}else{return}this._track(3)},_md:function(){this.pdown=true},_mu:function(){if(this.pdown){this.pdown=false;this._pact()}}});var Watcher=new Watcher_class();var SplitTests_class=new Class({tests:{},options:{url:'/split_tests/getSplitTestValueByNameAJAX',cookie_duration:31,split_variants:{'show':50,'hide':50},rand_prefix:'_rand',changable:false},_cookie_storage:null,_test_statuses:{},initialize:function(options,split_variants){this.setOptions(options);if(split_variants){this.options.split_variants=split_variants}this._cookie_storage=Cookie;this._cookie_storage.options={domain:'rozetka.com.ua',path:'/',duration:this.options.cookie_duration}},setVariant:function(test_name,variant){var currentValue=this.getVariant(test_name);if(currentValue!=variant){this._cookie_storage.set(test_name,variant)}this.tests[test_name]=variant},getVariant:function(test_name){if(this.tests[test_name]===undefined){this.tests[test_name]=this._cookie_storage.get(test_name);if(this.tests[test_name]!==false&&this.tests[test_name].test(new RegExp('"[a-z0-9_]+"','g'))){try{this.tests[test_name]=JSON.parse(this.tests[test_name]);this._cookie_storage.set(test_name,this.tests[test_name])}catch(err){}}if(this.tests[test_name]!==false&&this.options.changable){var random=this._cookie_storage.get(test_name+this.options.rand_prefix);if(random!==false){var variant=null,current_total=0;Object.some(this.options.split_variants,function(value,key){current_total+=value;if(random<=current_total){variant=key;return true}return false});this.setVariant(test_name,variant)}}}return this.tests[test_name]},getSplitTestVariant:function(name,onCompleteFunction,section_id){var variant=this.getVariant(name);if(variant){onCompleteFunction(variant)}else if(this.options.url){this._sendAJAX(name,onCompleteFunction,section_id)}else{variant=this._split(name);if(!variant){throw new Error('Не удалось определить вариант')}this.setVariant(name,variant);onCompleteFunction(variant)}},_split:function(test_name){var total=0,random,result=null,current_total=0;Object.each(this.options.split_variants,function(value){total+=value});random=Math.random()*total;if(this.options.changable){this._cookie_storage.set(test_name+this.options.rand_prefix,Math.round(random))}Object.some(this.options.split_variants,function(value,key){current_total+=value;if(random<=current_total){result=key;return true}return false});return result},_sendAJAX:function(name,onCompleteFunction,section_id){var data={name:name,section_id:section_id};new Ajax(this.options.url,{data:data,method:'get',onComplete:function(response){var resp=new Response_class(response);if(resp.isDone()){this.setVariant(name,resp.content)}onCompleteFunction(resp.content)}.bind(this)}).request()},isTestEnabled:function(name){var result=false;if(Object.getLength(this._test_statuses)>0&&typeof this._test_statuses[name]!=='undefined'){result=this._test_statuses[name]}return result},setTestStatus:function(name,status){this._test_statuses[name]=status}});SplitTests_class.implement(new Options());var TimedWindowEvent_class=new Class({options:{min_interval:80,_refresh_interval:50},_boundOnTimeout:null,_lastFiredTime:0,_timeout_id:0,_app_event_name:null,initialize:function(event_name){this._app_event_name='timed'+event_name.charAt(0).toUpperCase()+event_name.substr(1);this._boundOnTimeout=this._onTimeout.bind(this);window.addEvent(event_name,this._eventListener.bind(this))},_eventListener:function(){clearTimeout(this._timeout_id);this._onTimeout()},_onTimeout:function(){var currentTime=new Date().getTime();if(currentTime-this._lastFiredTime>this.options.min_interval){this._lastFiredTime=currentTime;this._dispatchTimedWindowEvent()}else{this._timeout_id=setTimeout(this._boundOnTimeout,this.options._refresh_interval)}},_dispatchTimedWindowEvent:function(){App.fireEvent(this._app_event_name)}});TimedWindowEvent_class.implement(new Options());var TimedWindowLastEvent_class=new Class({_boundOnTimeout:null,_refresh_interval:80,_timeout_id:0,_app_event_name:null,initialize:function(event_name){this._app_event_name='timedLast'+event_name.charAt(0).toUpperCase()+event_name.substr(1);this._boundOnTimeout=this._onTimeout.bind(this);window.addEvent(event_name,this._eventListener.bind(this))},_eventListener:function(){clearTimeout(this._timeout_id);this._timeout_id=setTimeout(this._boundOnTimeout,this._refresh_interval)},_onTimeout:function(){this._dispatchTimedWindowLastEvent()},_dispatchTimedWindowLastEvent:function(){App.fireEvent(this._app_event_name)}});var RozetkaImask_class=new Class({options:{targetClass:".iMask",maskEmptyChr:'',validNumbers:"1234567890",validAlphas:"abcdefghijklmnopqrstuvwxyz",validAlphaNums:"abcdefghijklmnopqrstuvwxyz1234567890",update_on_start:true,convert_alphas_to_upper:false,onFocus:Class.empty,onBlur:Class.empty,onValid:Class.empty,onInvalid:Class.empty,onKeyDown:Class.empty},initialize:function(options){this.setOptions(options);if(this.options.update_on_start){this.update()}},update:function(){var fields=$$(this.options.targetClass);fields.each(function(obj,i){obj.options=Json.evaluate(obj.alt);if(obj.options.type=="number"){obj.setStyle("text-align","right")}obj.addEvent("mousedown",function(event){var event=new Event(event)}.bind(this));obj.addEvent("mouseup",function(event){event=new Event(event);if(obj.selectionStart>=0&&obj.selectionStart<obj.value.length){while(!this._isInputPosition(obj,obj.selectionStart)){this._selectNext(obj)}}this._onMouseUp(event,obj)}.bind(this));obj.addEvent("click",function(event){event=new Event(event);event.stop()});obj.addEvent("keydown",function(event){event=new Event(event);this._onKeyDown(event,obj);this.fireEvent("onKeyDown",obj,20)}.bind(this));obj.addEvent("focus",function(event){event=new Event(event);event.stop();this._onFocus(event,obj);this.fireEvent("onFocus",obj,20)}.bind(this));obj.addEvent("blur",function(event){event=new Event(event);event.stop();this._onBlur(event,obj);this.fireEvent("onBlur",obj,20)}.bind(this));obj.onpaste=this._onPaste.bind(this,obj)}.bind(this))},_onMouseUp:function(event,obj){if(obj.options.type=="fixed"){var p=this._getSelectionStart(obj);this._setCursor(obj,p)}else if(obj.options.type=="number"){this._setEnd(obj)}},_onKeyDown:function(event,obj){if(event.code==13){obj.blur();if(!$defined(obj.options.submit_form_on_enter)||obj.options.submit_form_on_enter){this._submitForm(obj)}}else if(event.control&&event.code==86){this._onPaste.bind(event,obj)}else if(!(event.code==9)){event.stop();if(obj.options.type=="fixed"){var p=this._getSelectionStart(obj);switch(event.code){case 8:this._selectPrevious(obj);this._updSelection(obj,this._getSelectionStart(obj),this.options.maskEmptyChr);break;case 36:this._selectFirst(obj);break;case 35:this._setEnd(obj);break;case 37:case 38:this._selectPrevious(obj);break;case 39:this._selectNext(obj);break;case 40:this._selectNext(obj);break;case 46:this._updSelection(obj,p,this.options.maskEmptyChr);break;default:var upd_result,chr=this._chrFromEvent(event);if(chr!==null&&this._isViableInput(obj,p,chr)){if(event.shift||obj.options.convert_alphas_to_upper){upd_result=this._updSelection(obj,p,chr.toUpperCase())}else{upd_result=this._updSelection(obj,p,chr)}if(upd_result){this.fireEvent("onValid",[event,obj],20);this._selectNext(obj)}}else{this.fireEvent("onInvalid",[event,obj],20)}break}}else if(obj.options.type=="number"){switch(event.code){case 8:case 46:this._popNumber(obj);break;default:var chr=this._chrFromEvent(event);if(this.options.validNumbers.indexOf(chr)>=0){this._pushNumber(obj,chr);this.fireEvent("onValid",[event,obj],20)}else{this.fireEvent("onInvalid",[event,obj],20)}break}}}},_onFocus:function(event,obj){this._setEnd.delay(20,this,obj)},_onBlur:function(event,obj){},_selectFirst:function(obj){for(var i=0,len=obj.options.mask.length;i<len;i++){if(this._isInputPosition(obj,i)){this._setCursor(obj,i);return}}},_selectPrevious:function(obj,p){if(!$chk(p)){p=this._getSelectionStart(obj)}if(p<=0){this._selectFirst(obj)}else{if(this._isInputPosition(obj,(p-1))){this._setCursor(obj,(p-1))}else{this._selectPrevious(obj,(p-1))}}},_selectNext:function(obj,p){if(!$chk(p))p=this._getSelectionEnd(obj)+1;if(p>obj.options.mask.length){this._setEnd(obj)}else{if(this._isInputPosition(obj,p)){this._setCursor(obj,p)}else{this._updSelection(obj,p)}}},_setCursor:function(obj,a){if(!obj.selectionStart||obj.selectionStart!==a){if(obj.setSelectionRange){obj.focus();obj.setSelectionRange(a,a)}else if(obj.createTextRange){var r=obj.createTextRange();r.collapse();r.moveStart("character",a);r.moveEnd("character",0);r.select()}obj.scrollTo(a*10-obj.clientWidth/2,false)}},_updSelection:function(obj,p,chr){var result=true;if(this._isInputPosition(obj,p)){var value=obj.value;var output="";output+=value.substring(0,p);if(p<=(obj.options.mask.length-1)){output+=chr}if(chr===''){output+=value.substr(p+1)}else{output+=value.substr(p)}if(output.length>obj.options.mask.length){result=false}else{var mask_chr,i,reg_exp=new RegExp('([^'+this.options.validAlphaNums+'])','gi');value=output.replace(reg_exp,'');output='';for(i=0;i<obj.options.mask.length;i++){mask_chr=obj.options.mask[i];if("9ax".indexOf(mask_chr)>=0){if(!value){break}output+=value.substring(0,1);value=value.substring(1)}else{output+=mask_chr}}obj.value=output;this._setCursor(obj,p)}}else{obj.value=obj.value.substring(0,p)+obj.options.mask.substr(p,1)+obj.value.substr(p+1);this._setCursor(obj,p+1)}return result},_setEnd:function(obj){var len=obj.value.length;this._setCursor(obj,len)},_getSelectionStart:function(obj){var p=0;if(obj.selectionStart){if($type(obj.selectionStart)=="number")p=obj.selectionStart}else if(document.selection){var r=document.selection.createRange().duplicate();r.moveEnd("character",obj.value.length);p=obj.value.lastIndexOf(r.text);if(r.text=="")p=obj.value.length}return p},_getSelectionEnd:function(obj){var p=0;if(obj.selectionEnd){if($type(obj.selectionEnd)=="number"){p=obj.selectionEnd}}else if(document.selection){var r=document.selection.createRange().duplicate();r.moveStart("character",-obj.value.length);p=r.text.length}return p},_isInputPosition:function(obj,p){var mask=obj.options.mask.toLowerCase();var chr=mask.charAt(p);if("9ax".indexOf(chr)>=0){return true}return false},_isViableInput:function(obj,p,chr){var mask=obj.options.mask.toLowerCase();var chMask=mask.charAt(p);switch(chMask){case'9':if(this.options.validNumbers.indexOf(chr)>=0){return true}break;case'a':if(this.options.validAlphas.indexOf(chr)>=0){return true}break;case'x':if(this.options.validAlphaNums.indexOf(chr)>=0){return true}break;default:return false;break}},_wearMask:function(obj,str){var mask=obj.options.mask.toLowerCase();var output="";for(var i=0,u=0,len=mask.length;i<len;i++){switch(mask.charAt(i)){case'9':if(this.options.validNumbers.indexOf(str.charAt(u).toLowerCase())>=0){if(str.charAt(u)==""){output+=this.options.maskEmptyChr}else{output+=str.charAt(u++)}}else{output+=this.options.maskEmptyChr}break;case'a':if(this.options.validAlphas.indexOf(str.charAt(u).toLowerCase())>=0){if(str.charAt(u)==""){output+=this.options.maskEmptyChr}else{output+=str.charAt(u++)}}else{output+=this.options.maskEmptyChr}break;case'x':if(this.options.validAlphaNums.indexOf(str.charAt(u).toLowerCase())>=0){if(str.charAt(u)==""){output+=this.options.maskEmptyChr}else{output+=str.charAt(u++)}}else{output+=this.options.maskEmptyChr}break;default:output+=mask.charAt(i);break}}return output},_stripMask:function(obj){var value=obj.value;if(""==value)return"";var output="";if(obj.options.type=="fixed"){for(var i=0,len=value.length;i<len;i++){if((value.charAt(i)!=this.options.maskEmptyChr)&&(this._isInputPosition(obj,i))){output+=value.charAt(i)}}}else if(obj.options.type=="number"){for(var i=0,len=value.length;i<len;i++){if(this.options.validNumbers.indexOf(value.charAt(i))>=0){output+=value.charAt(i)}}}return output},_chrFromEvent:function(event){var chr='';switch(event.code){case 48:case 96:chr='0';break;case 49:case 97:chr='1';break;case 50:case 98:chr='2';break;case 51:case 99:chr='3';break;case 52:case 100:chr='4';break;case 53:case 101:chr='5';break;case 54:case 102:chr='6';break;case 55:case 103:chr='7';break;case 56:case 104:chr='8';break;case 57:case 105:chr='9';break;default:chr=event.key;break}return chr},_pushNumber:function(obj,chr){obj.value=obj.value+chr;this._formatNumber(obj)},_popNumber:function(obj){obj.value=obj.value.substring(0,(obj.value.length-1));this._formatNumber(obj)},_formatNumber:function(obj){var str2=this._stripMask(obj);var str1="";for(var i=0,len=str2.length;i<len;i++){if('0'!=str2.charAt(i)){str1=str2.substr(i);break}}str2=str1;str1="";for(var len=str2.length,i=obj.options.decDigits;len<=i;len++){str1+="0"}str1+=str2;str2=str1.substr(str1.length-obj.options.decDigits);str1=str1.substring(0,(str1.length-obj.options.decDigits));var re=new RegExp("(\\d+)(\\d{"+obj.options.groupDigits+"})");while(re.test(str1)){str1=str1.replace(re,"$1"+obj.options.groupSymbol+"$2")}obj.value=str1+obj.options.decSymbol+str2},_getObjForm:function(obj){var parent=obj.getParent();if(parent.getTag()=="form"){return parent}else{return this._getObjForm(parent)}},_submitForm:function(obj){var form=this._getObjForm(obj);form.submit()},_onPaste:function(obj,e){e.stopPropagation();e.preventDefault();var clipboardData=e.clipboardData||window.clipboardData,pastedData=clipboardData.getData('Text'),start_position=this._getSelectionStart(obj),index,chr,upd_result;for(index=0;index<pastedData.length;index++){chr=pastedData[index];if(chr!==null&&this._isViableInput(obj,start_position,chr.toLowerCase())){if(e.shift||obj.options.convert_alphas_to_upper){upd_result=this._updSelection(obj,start_position,chr.toUpperCase())}else{upd_result=this._updSelection(obj,start_position,chr)}if(upd_result){this._selectNext(obj);start_position=this._getSelectionStart(obj)}else{break}}}this.fireEvent('onPaste',[obj],20)}});RozetkaImask_class.implement(new Events,new Options);var ZeroClipboard={version:"1.0.7",clients:{},moviePath:'ZeroClipboard.swf',nextId:1,$:function(thingy){if(typeof(thingy)=='string')thingy=document.getElementById(thingy);if(!thingy.addClass){thingy.hide=function(){this.style.display='none'};thingy.show=function(){this.style.display=''};thingy.addClass=function(name){this.removeClass(name);this.className+=' '+name};thingy.removeClass=function(name){var classes=this.className.split(/\s+/);var idx=-1;for(var k=0;k<classes.length;k++){if(classes[k]==name){idx=k;k=classes.length}}if(idx>-1){classes.splice(idx,1);this.className=classes.join(' ')}return this};thingy.hasClass=function(name){return!!this.className.match(new RegExp("\\s*"+name+"\\s*"))}}return thingy},setMoviePath:function(path){this.moviePath=path},dispatch:function(id,eventName,args){var client=this.clients[id];if(client){client.receiveEvent(eventName,args)}},register:function(id,client){this.clients[id]=client},getDOMObjectPosition:function(obj,stopObj){var info={left:0,top:0,width:obj.width?obj.width:obj.offsetWidth,height:obj.height?obj.height:obj.offsetHeight};while(obj&&(obj!=stopObj)){info.left+=obj.offsetLeft;info.top+=obj.offsetTop;obj=obj.offsetParent}return info},Client:function(elem){this.handlers={};this.id=ZeroClipboard.nextId++;this.movieId='ZeroClipboardMovie_'+this.id;ZeroClipboard.register(this.id,this);if(elem)this.glue(elem)}};ZeroClipboard.Client.prototype={id:0,ready:false,movie:null,clipText:'',handCursorEnabled:true,cssEffects:true,handlers:null,glue:function(elem,appendElem,stylesToAdd){this.domElement=ZeroClipboard.$(elem);var zIndex=99;if(this.domElement.style.zIndex){zIndex=parseInt(this.domElement.style.zIndex,10)+1}if(typeof(appendElem)=='string'){appendElem=ZeroClipboard.$(appendElem)}else if(typeof(appendElem)=='undefined'){appendElem=document.getElementsByTagName('body')[0]}var box=ZeroClipboard.getDOMObjectPosition(this.domElement,appendElem);this.div=document.createElement('div');var style=this.div.style;style.position='absolute';style.left=''+box.left+'px';style.top=''+box.top+'px';style.width=''+box.width+'px';style.height=''+box.height+'px';style.zIndex=zIndex;if(typeof(stylesToAdd)=='object'){for(addedStyle in stylesToAdd){style[addedStyle]=stylesToAdd[addedStyle]}}appendElem.appendChild(this.div);this.div.innerHTML=this.getHTML(box.width,box.height)},getHTML:function(width,height){var html='';var flashvars='id='+this.id+'&width='+width+'&height='+height;if(navigator.userAgent.match(/MSIE/)){var protocol=location.href.match(/^https/i)?'https://':'http://';html+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+protocol+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+width+'" height="'+height+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+flashvars+'"/><param name="wmode" value="transparent"/></object>'}else{html+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+width+'" height="'+height+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+flashvars+'" wmode="transparent" />'}return html},hide:function(){if(this.div){this.div.style.left='-2000px'}},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide();this.div.innerHTML='';this.div.parentNode&&this.div.parentNode.removeChild(this.div);this.domElement=null;this.div=null}},reposition:function(elem){if(elem){this.domElement=ZeroClipboard.$(elem);if(!this.domElement)this.hide()}if(this.domElement&&this.div){var box=ZeroClipboard.getDOMObjectPosition(this.domElement);var style=this.div.style;style.left=''+box.left+'px';style.top=''+box.top+'px'}},setText:function(newText){this.clipText=newText;if(this.ready)this.movie.setText(newText)},addEventListener:function(eventName,func){eventName=eventName.toString().toLowerCase().replace(/^on/,'');if(!this.handlers[eventName])this.handlers[eventName]=[];this.handlers[eventName].push(func)},setHandCursor:function(enabled){this.handCursorEnabled=enabled;if(this.ready)this.movie.setHandCursor(enabled)},setCSSEffects:function(enabled){this.cssEffects=!!enabled},receiveEvent:function(eventName,args){eventName=eventName.toString().toLowerCase().replace(/^on/,'');switch(eventName){case'load':this.movie=document.getElementById(this.movieId);if(!this.movie){var self=this;setTimeout(function(){self.receiveEvent('load',null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var self=this;setTimeout(function(){self.receiveEvent('load',null)},100);this.ready=true;return}this.ready=true;this.movie.setText(this.clipText);this.movie.setHandCursor(this.handCursorEnabled);break;case'mouseover':if(this.domElement&&this.cssEffects){this.domElement.addClass('hover');if(this.recoverActive)this.domElement.addClass('active')}break;case'mouseout':if(this.domElement&&this.cssEffects){this.recoverActive=false;if(this.domElement.hasClass('active')){this.domElement.removeClass('active');this.recoverActive=true}this.domElement.removeClass('hover')}break;case'mousedown':if(this.domElement&&this.cssEffects){this.domElement.addClass('active')}break;case'mouseup':if(this.domElement&&this.cssEffects){this.domElement.removeClass('active');this.recoverActive=false}break}if(this.handlers[eventName]){for(var idx=0,len=this.handlers[eventName].length;idx<len;idx++){var func=this.handlers[eventName][idx];if(typeof(func)=='function'){func(this,args)}else if((typeof(func)=='object')&&(func.length==2)){func[0][func[1]](this,args)}else if(typeof(func)=='string'){window[func](this,args)}}}}};ZeroClipboard.setMoviePath('https://i.rozetka.ua/flash/ZeroClipboard.swf');var VotingPopup_class=new Class({options:{tpl:{popup_tpl:'<div class=\"popup-vote\"> <div class=\"popup-css\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div class=\"auth-new\" name=\"content\"><\/div> <\/div> <\/div>',popup_content_tpl:'<p>Чтобы проголосовать <a href=\"#\" name=\"promo-signin\" class=\"underline\">войдите<\/a> или <a href =\"https:\/\/my.rozetka.com.ua\/ua\/signup\/\" class=\"underline\">зарегистрируйтесь<\/a><\/p> '},signin_selector:'a[name=promo-signin]',timeout:1000,vote_only_confirmed_users:true},popup:null,is_open:null,content:null,timeout:null,initialize:function(){this.createPopup()},createPopup:function(){this.popup=new Element('div');this.popup.setStyles({position:'absolute',top:0,'z-index':10000});this.hide();this.popup.setHTML(this.options.tpl.popup_tpl);this.content=this.popup.getElement('[name=content]');$(document.body).adopt(this.popup);$(document.body).addEvent('click',this.hide.bind(this));this.popup.addEvent('click',function(e){new Event(e).stopPropagation()});window.addEvent('keydown',function(e){if((new Event(e).key)==='esc'&&this.is_open)this.hide()}.bind(this))},setContent:function(){this.content.setHTML(this.options.tpl.popup_content_tpl)},bindEvents:function(){this.sign_in=this.popup.getElement(this.options.signin_selector);this.sign_in.addEvent('click',function(e){User.toggleSignIn();window.scrollTo(0,0);new Event(e).stop()})},getPopup:function(){return this.popup},getCoordinates:function(){return this.popup.getFirst().getCoordinates()},setStyles:function(styles){this.popup.setStyles(styles)},show:function(){this.setContent();this.bindEvents();this.popup.removeClass('hidden');this.is_open=true},hideOnDelay:function(delay){this.clearTimeout();var delay=delay||this.options.timeout;this.is_open=false;this.timeout=setTimeout(this.checkToHide.bind(this),delay)},checkToHide:function(){if(!this.is_open){this.hide()}},hide:function(){this.popup.addClass('hidden');this.is_open=false},clearTimeout:function(){if(this.timeout){clearTimeout(this.timeout)}},signUp:function(){App.getService('User').setOptions({is_signup:true})}});VotingPopup_class.implement(new Options);var AuthorizationVotingPopup_class=VotingPopup_class.extend({options:{'tpl':{'popup_tpl':'<div class=\"popup-vote\"> <div class=\"popup-css\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div class=\"auth-new\" name=\"content\"><\/div> <\/div> <\/div>','unauthorized_tpl':'<div class=\"mes-red\">Для того, щоб проголосувати, необхідно авторизуватися на&nbsp;сайті<\/div> <form class=\"f-signin\"> <div class=\"f-item\"> <div class=\"f-title\">Електронна пошта:<\/div> <input type=\"text\" class=\"input-text\" name=\"login\" _required=\"required\" value=\"${User.getEmail(true)}\" _pattern=\"^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$\"> <\/div> <div class=\"f-item\"> <div class=\"f-title\">Пароль:<\/div> <input type=\"password\" class=\"input-text\" name=\"password\" _required=\"required\"> <\/div> <div name=\"msg\" class=\"error\"><\/div> <div class=\"f-item\"> <div class=\"f-title\"><a href=\"#\" class=\"xhr lightblue\" name=\"remind_password\">Я забув пароль<\/a><\/div> <\/div> <div class=\"submit\"> <button class=\"button-css-blue\" type=\"submit\" name=\"signin\">Увійти<\/button> <a class=\"xhr lightblue cancel\" name=\"close\" href=\"#\">Скасувати<\/a> <\/div> <div class=\"signup-promo\"> Немає облікового запису?<br> <a href=\"#\" class=\"xhr lightblue\" name=\"registration\">Зареєструватися<\/a> <\/div> <\/form> ','registration_tpl':'<h4>Реєстрація облікового запису<\/h4> <div class=\"f-comment\">Обов\'язкові поля позначено зірочкою <span class=\"require\">*<\/span><\/div> <form class=\"f-signup\"> <div class=\"f-item\"> <div class=\"f-title\">Ваше ім\'я: <span class=\"require\">*<\/span><\/div> <input type=\"text\" class=\"input-text\" name=\"first_name\" _required=\"required\"> <\/div> <div class=\"f-item\"> <div class=\"f-title\">Електронна пошта: <span class=\"require\">*<\/span><\/div> <input type=\"text\" class=\"input-text\" name=\"email\" _required=\"required\" value=\"${User.getEmail(true)}\" _pattern=\"^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$\"> <\/div> <div class=\"f-item\"> <div class=\"f-title\">Придумайте собі пароль: <span class=\"require\">*<\/span><\/div> <input type=\"password\" class=\"input-text\" name=\"password\" _required=\"required\" _pattern=\"^.{6,}$\"> <\/div> <div class=\"submit\"> <button class=\"button-css-green\" type=\"submit\" name=\"register\">Зареєструватися<\/button> <a class=\"xhr lightblue cancel\" name=\"return_back\" href=\"#\">Скасувати<\/a> <\/div> <div class=\"error\" name=\"msg\"><\/div> <\/form> ','remind_password_tpl':'<h4>Нагадування пароля<\/h4> <form class=\"f-remember\"> <div class=\"f-item\"> <div class=\"f-title\">Електронна пошта: <span class=\"require\">*<\/span><\/div> <input type=\"text\" class=\"input-text\" name=\"email\" _required=\"required\" value=\"${User.getEmail(true)}\" _pattern=\"^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$\"> <\/div> <div class=\"f-item\"> <div class=\"f-title f-comment\">Ми надішлемо вам листа з&nbsp;автоматично<br>згенерованим паролем<\/div> <\/div> <div class=\"submit\"> <button class=\"button-css-green\" type=\"submit\" name=\"send_password\">Надіслати пароль<\/button> <a class=\"xhr lightblue cancel\" name=\"return_back\" href=\"#\">Скасувати<\/a> <\/div> <div name=\"msg\" class=\"error\"><\/div> <\/form> ','confirm_remind_tpl':'<h5 class=\"auth-title h2\">Підтвердження електронної пошти<\/h5> <div class=\"email-confirm-note\"> <p>На&nbsp;вказану вами електронну пошту ми&nbsp;надіслали листа з&nbsp;посиланням для підтвердження реєстрації. Щоби підтвердити свою електронну пошту, перейдіть за&nbsp;цим посиланням.<\/p> <\/div>','confirm_request_tpl':'<h4>Ви не підтвердили електронну пошту<\/h4> <div class=\"f-item\"> <div class=\"f-title\">Для того щоб проголосувати, необхідно підтвердити свою електронну пошту. Для цього в листі, надісланому нами, необхідно перейти за вказаним посиланням.<\/div> <\/div> <div class=\"submit\"> <button class=\"button-css-green\" type=\"submit\" name=\"send_request\">Надіслати листа<\/button> <a class=\"xhr lightblue cancel\" name=\"close\" href=\"#\">Закрити<\/a> <\/div> <div name=\"msg\" class=\"error\"><\/div>'},'selectors':{'send_request':'[name=send_request]','registration':'[name=registration]','return_back':'[name=return_back]','remind_password':'[name=remind_password]','send_password':'[name=send_password]','register':'[name=register]','signin':'[name=signin]','msg':'[name=msg]','login':'[name=login]'},'ajax':{'signin':'https://my.rozetka.com.ua/ua/signin/#SignIn','remind':'https://my.rozetka.com.ua/ua/remind-password/#remindPassword','signup':'https://my.rozetka.com.ua/ua/signup/#SignUp','confirm':'https://my.rozetka.com.ua/ua/confirm-email/#sendCode'},'process':preloaders.process_tpl},currently_signed_up:null,initialize:function(){this.parent();User.addEvent('signIn',this.onSignIn.bind(this));User.addEvent('signOut',this.onUnauthorizedUser.bind(this))},onSignIn:function(){var need_confirm_email=this.options.vote_only_confirmed_users&&!User.isEmailConfirmed();if(this.currently_signed_up){if(need_confirm_email){this.onConfirmNotify()}}else if(need_confirm_email){this.onRequestConfirm()}else{this.hide()}},onRequestConfirm:function(){this.changeContent(this.options.tpl.confirm_request_tpl);var send_request_btn=this.popup.getElement(this.options.selectors.send_request);send_request_btn.addEvent('click',this.action.bindWithEvent(this,'sendConfirmMail'))},sendConfirmMail:function(){this.popup.processStart(this.options.process);new Ajax('/cgi-bin/form.php',{method:'post',headers:{ajaxAction:this.options.ajax.confirm},onComplete:this.onSendConfirmMail.bind(this)}).request()},onSendConfirmMail:function(resp){this.popup.processStop();var Response=new Response_class(resp);this.popup.getElement(this.options.selectors.send_request).hide();if(Response.Message){this.popup.getElement(this.options.selectors.msg).setHTML(Response.Message.content)}},onUnauthorizedUser:function(){this.changeContent(this.options.tpl.unauthorized_tpl);var registration=this.popup.getElement(this.options.selectors.registration);var remind_password=this.popup.getElement(this.options.selectors.remind_password);var signin=this.popup.getElement(this.options.selectors.signin);var login=this.popup.getElement(this.options.selectors.login);registration.addEvent('click',this.action.bindWithEvent(this,'onRegistration'));remind_password.addEvent('click',this.action.bindWithEvent(this,'onRemindPassword'));signin.addEvent('click',this.action.bindWithEvent(this,'signin'));if(Cookie.get("login")&&login){login.value=Cookie.get("login")}},signin:function(){var options={};options.onComplete=this.onSingnin.bind(this);options.headers={'ajaxAction':this.options.ajax.signin};this.popup.getElement('form').trySend(options)},onSingnin:function(resp){var Response=new Response_class(resp);this.popup.getElement('form').processStop();if(!Response.isError()){Cookie.set('login',this.popup.getElement(this.options.selectors.login).value,{duration:183,domain:'rozetka.com.ua',path:'/'})}else{Cookie.remove('login',{domain:'rozetka.com.ua',path:'/'});if(Response.Message){this.popup.getElement(this.options.selectors.msg).setHTML(Response.Message.content)}}if($defined(Response.action)){$defined(Response.S)?S.onLoad(Response.S):S.load()}},onRegistration:function(){this.changeContent(this.options.tpl.registration_tpl);var return_back=this.popup.getElement(this.options.selectors.return_back);var register=this.popup.getElement(this.options.selectors.register);return_back.addEvent('click',this.action.bindWithEvent(this,'onUnauthorizedUser'));register.addEvent('click',this.action.bindWithEvent(this,'signUp'))},signUp:function(){this.parent();var options={headers:{'ajaxAction':this.options.ajax.signup},onComplete:this.onSignUp.bind(this)};this.popup.getElement('form').trySend(options)},onSignUp:function(resp){this.popup.getElement('form').processStop();var Response=new Response_class(resp);if(!Response.isDone()&&Response.Message){this.popup.getElement(this.options.selectors.msg).setHTML(Response.Message.content)}if($defined(Response.action)){this.currently_signed_up=true;$defined(Response.S)?S.onLoad(Response.S):S.load()}},onRemindPassword:function(){this.changeContent(this.options.tpl.remind_password_tpl);var return_back=this.popup.getElement(this.options.selectors.return_back);var send_password=this.popup.getElement(this.options.selectors.send_password);var login=this.popup.getElement(this.options.selectors.login);return_back.addEvent('click',this.action.bindWithEvent(this,'onUnauthorizedUser'));send_password.addEvent('click',this.action.bindWithEvent(this,'sendPasswordMail'));if(Cookie.get("login")&&login){login.value=Cookie.get("login")}},sendPasswordMail:function(){var options={headers:{'ajaxAction':this.options.ajax.remind},onComplete:this.onSendPassword.bind(this)};this.popup.getElement('form').trySend(options)},onSendPassword:function(resp){this.popup.getElement('form').processStop();var Response=new Response_class(resp);this.popup.getElement(this.options.selectors.msg).setHTML(Response.Message.content)},onConfirmNotify:function(){this.changeContent(this.options.tpl.confirm_remind_tpl)},action:function(e,method){new Event(e).stop();this[method]()},bindEvents:function(){this.popup.getElements('[name=close]').each(function(elem){elem.addEvent('click',function(e){new Event(e).stop();this.hide()}.bind(this))}.bind(this))},setContent:function(){if(User.isAuth()){if(this.options.vote_only_confirmed_users&&!User.isEmailConfirmed()){this.onRequestConfirm()}}else{this.onUnauthorizedUser()}},changeContent:function(content){this.content.setHTML(content);this.bindEvents()}});AuthorizationVotingPopup_class.implement(new Options);var Prices_class=new Class({Class:'Prices_class',options:{},is_updated:0,user_price_type:null,initialize:function(options){if(S.checkup)this.onLoadS(S);S.addEvent('loadS',function(S){this.onLoadS(S)}.bind(this));App.addOnDomReady(function(){this.update()}.bind(this))},init:function(id){},onLoadS:function(S){if(S.user&&S.user.price_type){this.user_price_type=S.user.price_type}else{this.user_price_type=null}this.update()},isShowAllowed:function(){return this.user_price_type!=undefined},update:function(){if(this._collectElements()){if(this.isShowAllowed()){this.showAdditionalElemnts()}else{this.hideAdditionalElemnts()}this.fireEvent('update');this.is_updated=1}},showAdditionalElemnts:function(){for(var i=0;i<this.additional_elements.length;i++){if(this.additional_elements[i].hasClass('hidden')){this.additional_elements[i].removeClass('hidden')}}for(var i=0;i<this.original_elements.length;i++){if(!this.original_elements[i].hasClass('hidden')&&this._hasCurrentPriceTypeReplacement(this.original_elements[i])){this.original_elements[i].addClass('hidden')}}},hideAdditionalElemnts:function(){for(var i=0;i<this.additional_elements.length;i++){if(!this.additional_elements[i].hasClass('hidden')){this.additional_elements[i].addClass('hidden')}}for(var i=0;i<this.original_elements.length;i++){if(this.original_elements[i].hasClass('hidden')){this.original_elements[i].removeClass('hidden')}}},_hasCurrentPriceTypeReplacement:function(original_element){var repalcements=original_element.getParent().getElements("[name*=prices|"+this.user_price_type+"]");return repalcements.length},_collectElements:function(){if(this.user_price_type!=null){var selector="[name*=prices|"+this.user_price_type+"]";this.additional_elements=$$(selector);this.original_elements=$$("[name*=prices_active_element_original]")}return this.additional_elements}});Prices_class.implement(new Events);var RozetkaPrices_class=Prices_class.extend({initialize:function(options){this.parent(options);document.addEvent('loadContentComplete',function(){this.update()}.bind(this))},isShowAllowed:function(){var is_allowed=true;var promotions=null;var curentTime=new Date();if(typeof PricesPromotions!="undefined"){promotions=PricesPromotions.getPromotionsData();for(var promotion in promotions){if(promotions[promotion].special_price&&promotions[promotion].special_price==this.user_price_type&&promotions[promotion].end_date<curentTime.getTime()){is_allowed=false;break}}}return this.user_price_type!=undefined&&is_allowed},showAdditionalElemnts:function(){this.parent();window.fireEvent('updateTrackBar')}});var RozetkaPromotions_class=new Class({options:{template:'<div class=\"viewed\" id=\"recent_goods_scroller\" name=\"recent_goods_scroller\" _action=\"recent_goods_sroller\"> <header class=\"viewed-promo-heading\"> <h2 class=\"viewed-promo-title\">{if title}${title}{else}Рекомендуємо для вас{\/if}<\/h2> <\/header> <div class=\"clearfix slider\" name=\"recent_goods_screen\"> <a href=\"#\" class=\"sprite-side slider-al hidden\" name=\"recent_goods_control\" _action=\"left\" data-direction=\"left\">&lt;<\/a> <a href=\"#\" class=\"sprite-side slider-ar hidden\" name=\"recent_goods_control\" _action=\"right\" data-direction=\"right\">&gt;<\/a> <div class=\"slider-inner\"> <div class=\"g-i-tr-block\" name=\"recent_goods_container\"> {if data} {for item in data} ${rozetkaEvents.setGoodsData(item)} ${GTMEventsData.setGoodsData(item.id, item)} {if !lang_suffix}{var lang_suffix = \'\'}{\/if} {if item[\'title\' + lang_suffix]} {var item_title = item[\'title\' + lang_suffix]} {else} {var item_title = item.title} {\/if} {if item[\'href\' + lang_suffix]} {var item_href = item[\'href\' + lang_suffix]} {else} {var item_href = item.href} {\/if} {if item.title_only} {var item_title_only = item.title_only} {else} {var item_title_only = item.title} {\/if} <div class=\"slider-i-td ${item.sell_status} {if data.length == 1}single{\/if}{if data.length == 2}twice{\/if}{if data.length == 3}third{\/if}{if data.length == 4}fourth{\/if}\" name=\"recent_goods_item\"> <div id=\"catalog_item${item.id}\" tool_tip=\"1\" class=\"slider-i viewed-i\" data-location=\"recentPromo\" data-position=\"${++item_index}\"> <input type=\"hidden\" name=\"slider_pos_number${item.id}\" value=\"${item_index}\" \/> <div class=\"viewed-i-col-left\"> <figure class=\"g-img{if data.length == 1} float-lt{\/if}\"> <div class=\"g-img-inner g-img-inner-150 pos-fix\"> <a href=\"${item_href}\" class=\"g-i-img-link\" onclick=\"document.fireEvent(\'goodsImageClick\',{extend_event:[{name:\'goods_id\',value:${item.id}},{name:\'eventLocation\',value:\'recentPromo\'},{name:\'eventPosition\',value:${item_index}}]});\"> {if item.large_image} <img class=\"g-img-icon centering-img\" src=\"${item.large_image.url}\" width=\"${item.large_image.width}\" height=\"${item.large_image.height}\" alt=\"${item_title_only|escape}\" title=\"${item_title_only|escape}\" \/> {else} <img class=\"g-img-icon centering-img\" src=\"${item.image.url}\" width=\"${item.image.width}\" height=\"${item.image.height}\" alt=\"${item_title_only|escape}\" title=\"${item_title_only|escape}\" \/> {\/if} <\/a> <\/div> <\/figure> <\/div> <div class=\"viewed-i-col-right\"> <div class=\"g-title\"> <a href=\"${item_href}\" class=\"g-title-link viewed-i-title-link novisited\" onclick=\"document.fireEvent(\'goodsTitleClick\',{extend_event:[{name:\'goods_id\',value:${item.id}},{name:\'eventLocation\',value:\'recentPromo\'},{name:\'eventPosition\',value:${item_index}}]});\"> ${item_title} <\/a> <\/div> {if item.sell_status != \'available\'} <div class=\"g-i-status-wrap\"> <div class=\"g-i-status ${item.sell_status}\"> {if item.sell_status == \'limited\'} Закінчується {elseif item.sell_status == \'unavailable\'} Немає в наявності {elseif item.sell_status == \'out_of_stock\'} Закінчився {elseif item.sell_status == \'waiting_for_supply\'} Очікується постачання {elseif item.sell_status == \'archive\'} Знято з виробництва {\/if} <\/div> {if item.sell_status == \'out_of_stock\'} <div class=\"viewed-lable-out_of_stock\"> <img class=\"g-label-out_of_stock-icon sprite\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"Продано\"\/> <\/div> {\/if} <\/div> {\/if} {if item.price > 0 && item.sell_status != \'archive\'} {if item.old_price && item.old_price > item.price} <div class=\"g-price-old\"> <div class=\"g-price-old-inner\"> <div class=\"g-price-old-uah\"> ${item.old_price.toString().toPriceFormat()}<span class=\"g-price-old-uah-sign\">&thinsp;{if item.unit}${item.unit}{\/if}<\/span> <\/div> <\/div> <\/div> {\/if} <div class=\"g-price{if item.old_price && item.old_price > item.price} g-price-cheaper{\/if}\" name=\"prices_active_element_original\"> <div class=\"g-price-uah\"> ${item.price.toString().toPriceFormat()}<span class=\"g-price-uah-sign\">&thinsp;{if item.unit}${item.unit}{\/if}<\/span> <\/div> <\/div> {\/if} {if item.sell_status == \'available\' || item.sell_status == \'limited\' || item.sell_status == \'call\'} <div class=\"clearfix\"> <div class=\"g-buy\" name=\"buy_details_recent_goods\" goods_id=\"${item.id}\"><\/div> <ul class=\"inline g-tools\"> <li class=\"g-tools-i\" name=\"wishlists_recent_goods\"><\/li> <li class=\"g-tools-i g-tools-delimiter\" name=\"recent_goods_comparison_details\"><\/li> <\/ul> <\/div> <div class=\"g-rating\"> {if item.count_comments > 0} {var comment_morph = [\'відгук\', \'відгуки\', \'відгуків\']} {var plural_form = plural(item.count_comments)} <a class=\"novisited g-rating-reviews-link\" onclick=\"document.fireEvent(\'comments_link_click\', {extend_event: [{name: \'goods_id\', value: ${item.id}}]});\" href=\"${item_href}comments\/\"> {if item.users_rating > 0} <span class=\"sprite g-rating-stars\"> <span class=\"sprite g-rating-stars-i\" style=\"width:${item.users_rating*20}%\"><\/span> <\/span> <span class=\"g-rating-reviews\"> ${item.count_comments} ${comment_morph[plural_form]} <\/span> {else} <span class=\"g-rating-reviews\"> <span class=\"g-rating-none sprite-side\">${item.count_comments} ${comment_morph[plural_form]}<\/span> <\/span> {\/if} <\/a> {\/if} <\/div> {elseif item.sell_status != \'archive\'} <div class=\"main-personal-to-waitlist\" name=\"waitlist\" goods_id=\"${item.id}\"> <span name=\"waitlist_recent_goods\"><\/span> <\/div> {else} <div class=\"g-i-new-models-link\"> <a href=\"${item.section_href}producer=${item.producer};sort=novelty\/\" class=\"novisited arrow-link\">Рекомендуємо нові&nbsp;&rarr;<\/a> <\/div> {\/if} {if item.coupon} <div class=\"g-tip\"> <div class=\"g-tip-coupon\">${item.coupon}<\/div> <\/div> {\/if} <\/div> <\/div> <\/div> {\/for} {\/if} <\/div> <\/div> <\/div> <\/div>',scroller_options:{scroller:'[name=recent_goods_scroller]',elemsContainer:'[name=recent_goods_container]',elems:'[name=recent_goods_item]',controls:'[name=recent_goods_control]',screen:'[name=recent_goods_screen]',vector:'horizontal',inject_controls:true,gtm_location:'recent'},atp_statuses:['limited','available']},_data_init:false,_data_lazy:{requestURL:('https:'+'//rozetka.com.ua/news-articles-promotions/promotions/action=')},_goods_id_to_promotion_data:{},_goods_id_to_additional_text:{},_goods_id_to_additional_text_delivery:{},setGoodsByPriceType:function(price_type,goods_id){if(this.isDataInit()){var data=this.getPromotionsData();Object.each(data,function(item,key){if(item.special_price==price_type){if(item.promo_goods){item.promo_goods.push(goods_id)}else{item.promo_goods=[goods_id]}data[key]=item}});this.setPromotionsData(data)}else{this.addEvent('_LoadPromotionsData',this.setGoodsByPriceType.bind(this,price_type,goods_id))}},isDataInit:function(){return this._data_init},loadDataByAjax:function(method){new Ajax(this._data_lazy.requestURL+method+'/',{method:'get',onComplete:this._loadData.bind(this),withCredentials:true,use_language:true}).request()},setPromotionsData:function(promotions_data){this._goods_id_to_promotion_data=this._preparePromotionData(promotions_data);if(!this._data_init){this._data_init=true;this.fireEvent("_LoadPromotionsData");this.fireEvent("LoadPromotionsData")}},getPromotionsData:function(){return this._goods_id_to_promotion_data},_loadData:function(response){var data={};try{data=App.getService('JSON').parse(response)}catch(e){App.log('Promotions_loadData',response)}this.setPromotionsData(data)},_preparePromotionData:function(promotions_data){var result={};Object.each(promotions_data,function(promotion){promotion.goods_ids.forEach(function(goods_id){if(!result[goods_id]){result[goods_id]=promotion}})}.bind(this));return result},mergePromotionsData:function(promotions_data){$extend(this._goods_id_to_promotion_data,this._preparePromotionData(promotions_data))},setAdditionalText:function(goods_id_to_additional_text){this._goods_id_to_additional_text=goods_id_to_additional_text},setAdditionalTextDelivery:function(goods_id_to_additional_text_delivery){this._goods_id_to_additional_text_delivery=goods_id_to_additional_text_delivery},getAdditionalText:function(){return this._goods_id_to_additional_text},getAdditionalTextDelivery:function(){return this._goods_id_to_additional_text_delivery},mergeAdditionalText:function(goods_id_to_additional_text){$extend(this._goods_id_to_additional_text,goods_id_to_additional_text)},initRecentGoods:function(goods_ids,block,title){document.addEvent('recentGoodsShowed',function(){App.getServiceDelay('NewRecentGoods').then(function(NewRecentGoods){NewRecentGoods.getSortedGoodsAjax(NewRecentGoods.getSortedGoods(),function(recent_goods){this.showRecentByPromotionGoods(goods_ids,block,title,NewRecentGoods,recent_goods)}.bind(this))}.bind(this))}.bind(this));User.addEvent('signOut',function(){this.hideBlock(block)}.bind(this))},showBlock:function(block){block.removeClass('hidden')},hideBlock:function(block){block.addClass('hidden')},showRecentByPromotionGoods:function(goods_ids,block,title,new_recent_goods,recent_goods){var promo_recent=[],language_suffix;recent_goods.each(function(recent){if(this.options.atp_statuses.contains(recent.sell_status)&&goods_ids.contains(recent.id.toString())){recent.price=Math.round(recent.price);promo_recent.push(recent)}}.bind(this));if(promo_recent.length){language_suffix=new_recent_goods.options.language===''?null:'_'+new_recent_goods.options.language;block.setHTML(App.getHTML(this.options.template,{data:promo_recent,title:title,lang_suffix:language_suffix}));this.showBlock(block);var scroll_container=block.getElement(this.options.scroller_options.scroller);if(scroll_container&&promo_recent.length>4){new RozetkaElementsScroller_class(scroll_container).setOptions(this.options.scroller_options).run()}GoodsCatalog.findAndAddCatalogItems(block,'promotions_recent_goods');this.addGTMProducts(promo_recent)}else{this.hideBlock(block)}},addGTMProducts:function(goods){var products=[];goods.each(function(item,position){var object={productID:item.id,productName:item.title_only||item.title,eventProductCategoryId:item.parent_id,productVendorID:item.producer_id,productPrice:item.price,productPosition:++position,productMerchantID:item.merchant_id,productSellerID:item.seller_id,productLocation:'recentPromo'};products.push(object)}.bind(this));document.fireEvent('productsPromoRecentImpressions',{extend_event:[{name:'products',value:products}]})}});RozetkaPromotions_class.implement(new Events());var RozetkaPromotionsMembersForm_class=new Class({Class:'RozetkaPromotionsMembersForm_class',options:{selectors:{suggest_input_id:'promotion_suggest_locality',form:'member_registration_form',get_from_account:'a[name=get_from_account]',rules:'a[name=rules]',agree:'input[name=agree]',pass_block:'div[name=pass]',login_button:'button[name=login]',msg:'div[name=msg]',login_block:'[name="login_block"]',email_block:'[name="email_block"]',phone_block:'[name="phone_block"]',fio_block:'[name="fio_block"]',submit_block:'[name="submit_block"]',email_for_completion_msg:'[name="email_for_completion_msg"]',phone_for_completion_msg:'[name="phone_for_completion_msg"]',city:'[name="city"]',city_id:'[name="city_id"]',login_info:'[name=login_info]',login_info_popup_parent:'[name=login_info_popup]'},popup:{header_tpl:'<div class=\"popup-css popup-promo-completed\"> <a href=\"#\" class=\"popup-close-medium-delivery\" name=\"close\"> <img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"×\" class=\"popup-close-medium-icon sprite\"> <\/a> <div name=\"content\" class=\"promo-rules-content\"><\/div> <\/div>',confirm_request_tpl:'<h5 class=\"auth-title h2\">Ви не підтвердили електронну пошту<\/h5> <p>Для того, щоби взяти участь в акції, будь ласка, підтвердьте свою електронну пошту.<\/p> <p>Для цього в листі, надісланому нами, необхідно перейти за вказаним посиланням.<\/p> <div class=\"auth-f-submit-btn submit-register\"> <span class=\"btn-link btn-link-blue\"> <button type=\"submit\" class=\"btn-link-i\" name=\"send_request\">Надіслати листа<\/button> <\/span> <\/div> <div name=\"msg\" class=\"error\"><\/div>',unauthorized_tpl:'<h5 class=\"auth-title h2\">Вхід в інтернет-магазин<\/h5> <div class=\"auth-msg\" name=\"app-message\"><\/div> <div name=\"msg\" class=\"social-msg sprite-side flex\"><\/div> <form class=\"auth-f clearfix pos-fix\" method=\"post\" data-collect_errors=\"1\"> <div class=\"auth-f-email\" data-auth-email=\"або\"> <div class=\"auth-f-msg\" name=\"msg\"><\/div> <div class=\"auth-f-i\"> <div class=\"auth-f-i-title\">Ел.&nbsp;пошта або телефон<\/div> <input type=\"text\" class=\"input-text auth-input-text\" name=\"login\" _required=\"required\" value=\"${User.getEmail(true)}\" _pattern=\"^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$|^\\s*((\\+?\\s*(\\(\\s*)?3)?[\\s-]*(\\(\\s*)?8[\\s-]*)?(\\(\\s*)?0[\\s-\\(]*[1-9][\\s-]*\\d(\\s*\\))?([\\s-]*\\d){7}\\s*$\"> <div name=\"email_hint_block\" class=\"hidden\"><\/div> <\/div> <div name=\"auth_blocks\"><\/div> <\/div> <div class=\"auth-f-social auth-f-social-indent\"> <div class=\"auth-f-social-title\">Увійти як користувач<\/div> {if use_vk} <div name=\"social_button_auth_popup\" type=\"vkontakte\" class=\"auth-f-social-i\" {if defined(\'location_value\')}data-location=\"${location_value}\"{\/if}><\/div> {\/if} <div name=\"social_button_auth_popup\" type=\"facebook\" class=\"auth-f-social-i\" {if defined(\'location_value\')}data-location=\"${location_value}\"{\/if}><\/div> <div name=\"social_button_auth_popup\" type=\"google\" class=\"auth-f-social-i\" {if defined(\'location_value\')}data-location=\"${location_value}\"{\/if}><\/div> {if !location.pathname.test(new RegExp(\'\\\/signup\\\/\', \'gi\'))} <div class=\"auth-f-signup\"> {var is_promotions = new RegExp(\'news-articles-promotions\/promotions\').test(location.pathname)} <a href=\"https:\/\/my.rozetka.com.ua\/ua\/signup\/\" name=\"registration\" class=\"novisited auth-f-signup-link\" onclick=\"document.fireEvent(\'registration\', {extend_event: [{if is_promotions}{name: \'eventLocation\', value: \'Promotions\'}{\/if}]});\" >Зареєструватися<\/a> <\/div> {\/if} <\/div> <\/form>',simple_auth_tpl:'<div name=\"simple_auth\" class=\"hidden\"> <div class=\"auth-f-i\"> <div class=\"auth-f-i-title\">Пароль<\/div> <input type=\"password\" class=\"input-text auth-input-text\" name=\"password\" _required=\"required\"> <div class=\"auth-message hidden\" name=\"wrong_password_block\"> <h5 class=\"auth-forgot-pass-tooltip-title\" name=\"password_hint\"><\/h5> <p class=\"auth-forgot-pass-tooltip-note\">Перевірте розкладку клавіатури і&nbsp;Caps Lock<\/p> <span name=\"send_me_temp_pass\"><\/span> <\/div> <div class=\"auth-f-remind-pass\"> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/remind-password\/\" name=\"forgot_button\" class=\"auth-f-remind-pass-link novisited xhr\">Нагадати пароль<\/a> <\/div> <label class=\"checkbox auth-f-i-remember\"> <input class=\"hidden checkbox-input\" type=\"checkbox\" name=\"remember\" checked=\"checked\" value=\"1\"> <span class=\"checkbox-label sprite-side auth-f-i-remember-text\">Запам\'ятати мене<\/span> <\/label> <div name=\"recaptcha_placeholder\"> <div name=\"recaptcha\" class=\"recaptcha recaptcha-indent\" data-sitekey=\"6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU\"><\/div> <\/div> <div class=\"auth-message recaptcha-tooltip hidden\" name=\"wrong_captcha_signin_block\"> Необхiдно пiдтвердити, що ви не робот <\/div> <\/div> <div class=\"clearfix f-i auth-f-submit\"> <div class=\"auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <button type=\"submit\" class=\"btn-link-i\" name=\"auth_submit\">Увійти<\/button> <\/span> <a href=\"#\" class=\"novisited auth-f-cancel\" name=\"close\">Скасувати<\/a> <\/div> <\/div> <\/div>'},requestURL:'/cgi-bin/form.php',ajax:{registration:'https://rozetka.com.ua/ua/promotions/members/#singUpPromotionMember',user_data:'https://rozetka.com.ua/ua/promotions/members/#getUserData',},message:{tpl:'<div class=\"sprite-side message code${code}\"> <a href=\"#\" class=\"message-close-link\" onclick=\"clearUserMessages(event, \'msg\');\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite message-close-link-img\"> <\/a> ${content} <\/div> ',field_error:'<div class=\"sprite-side message code${code}\"> <a href=\"#\" class=\"message-close-link\" onclick=\"clearUserMessages(event, \'${field}\');\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite message-close-link-img\"> <\/a> ${content} <\/div> '},tpl:{message:'<div class="pos-fix sprite-side message code${code}"> <a href="" class="message-close-link" onclick="clearUserMessages(event);"> <img src="https://i.rozetka.ua/design/_.gif" width="24" height="24" class="sprite message-close-link-img"> </a> ${content} </div>',field:'<div class=\"promo-auth-f-i-filled\">${text}<\/div> <div class=\"promo-auth-f-i-change\"> <a href=\"#\" class=\"xhr novisited\">Змінити<\/a> <\/div>',password:'<div class=\"promo-details-reg-i clearfix p-form-item\"> <div class=\"promo-details-reg-i-label p-form-i-title\">Пароль<\/div> <div class=\"promo-details-reg-i-right\"> <input type=\"password\" name=\"pass\" class=\"input-text\"> <\/div> <div class=\"clearfix auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <button name=\"login\" class=\"btn-link-i\">Увійти<\/button> <\/span> <\/div> <\/div>',successfull_popup_info:'{if promotion_text_popup} ${promotion_text_popup} {else} {if !is_pre_order} {if order_id != 0} <h2 class=\"promo-reg-completed-title\">Реєстрацію в&nbsp;акції завершено<\/h2> <p class=\"promo-reg-completed-text\">Дякуємо! Ваше замовлення  <span class=\"bold\">№${order_id}<\/span> прийнято<\/p> {if promotion_end_data} <p class=\"promo-reg-completed-text-date\"> Результати розіграшу будуть опубліковані <span class=\"bold\">${promotion_end_data[\'day\']} ${promotion_end_data[\'month\']} ${promotion_end_data[\'year\']} року<\/span> <\/p> {\/if} <p class=\"promo-reg-completed-text\">Щиро бажаємо вам перемоги!<\/p> <p class=\"promo-reg-completed-remark\">*усі номери замовлень проходять перевірку, у разі недотримання правил акції реєстрацію може бути анульовано<\/p> {else} <h2 class=\"promo-reg-completed-title\">Реєстрацію в&nbsp;акції завершено<\/h2> <p class=\"promo-reg-completed-text\">Дякуємо!<\/p> <p class=\"promo-reg-completed-text\"> Результати розіграшу буде опубліковано на сторінці <a class=\"novisited promo-reg-completed-link\" href=\"${promotion_href}\">${promotion_href}<\/a> <\/p> <p class=\"promo-reg-completed-text\">Щиро бажаємо вам перемоги!<\/p> {\/if} {else} <div class=\"pre-order-reg-complete aligned-center\"> <div class=\"pre-order-reg-complete-header h2 sprite-side\"> ${user_name}, дякуємо за&nbsp;ваше предзамовлення <\/div> <div class=\"pre-order-reg-complete-text\"> Ми&nbsp;зв\'яжемося з&nbsp;вами, коли товар надійде в&nbsp;продаж <\/div> <span class=\"btn-link btn-link-blue pre-order-reg-complete-btn\"> <a href=\"#\" class=\"btn-link-i\" name=\"close\"> ОК <\/a> <\/span> <\/div> {\/if} {\/if}',login_info_popup:'<div class=\"popup-css double-auth-info-popup\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div name=\"content\"><\/div> <\/div>',login_info_popup_content:'<div class=\"double-auth-info-descr\" > Вкажіть логін вашого особистого кабінету для авторизації або створіть логін для реєстрації на Розетці. <\/div>',agree_msg_content:'Будь ласка, підтвердьте згоду з правилами акції',auth_user_email_exists:'<div class=\"auth-message\"> <p class=\"auth-message-text\"> Користувач із такою електронною адресою вже зареєстрований на Розетці. Якщо це ваша пошта, ви можете <a href=\"#\" class=\"novisited\" name=\'relogin\'>перелогінитися<\/a>. Або вкажіть іншу адресу <\/p> <\/div>',success_signin_message:'Ви вдало увійшли на сайт!',process:preloaders.green_process_tpl},_auth_blocks_options:{tpl:{message:'<div class=\"pos-fix sprite-side message code${code}\"> <a href=\"\" class=\"message-close-link\" onclick=\"clearUserMessages(event, \'msg\')\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite message-close-link-img\"> <\/a> ${content} <\/div>'},selectors:{send_form_btn_block:'[name="submit_form_btn_block"]'},track_email_change:true,blocks_type:'promotion'},confirm_signup:{tpl:'<div class=\"promo-details-reg-i-right\"> <div class=\"auth-msg\" name=\"promo-reg-confirm-phone-msg\"><\/div> <\/div> <div class=\"clearfix\"> <div class=\"promo-details-reg-i-label\"> Код підтвердження <\/div> <div class=\"promo-details-reg-i-right clearfix\"> <input class=\"input-text double-auth-input\" name=\"verify_code\" _pattern=\"^[0-9]+$\" _required=\"required\" type=\"text\"> <input name=\"phone_id\" value=\"${phone_id}\" type=\"hidden\"> <input name=\"user_id\" value=\"${user_id}\" type=\"hidden\"> <div class=\"promo-details-msg-wrap\"> <div class=\"promo-details-msg\"> На&nbsp;номер <span class=\"bold\">${phone} <\/span>відправлено SMS із&nbsp;кодом <\/div> <div name=\"resend_code_msg\" class=\"promo-details-msg-sand\"><\/div> <a href=\"#\" name=\"resend_code\" class=\"promo-details-link novisited xhr\" onclick=\"document.fireEvent(\'getAnotherConfirmCode\',{extend_event:[{name:\'eventLocation\',value:\'promoReg\'}]});\"> Запитати код ще раз <\/a> <\/div> <\/div> <\/div>',block_selector:'[name=signup_confirm_block]'},_date_day_suffix:'[day]',_date_month_suffix:'[month]',_date_year_suffix:'[year]',auth_type:'promotion',disabled_class:'disabled',language:null,domain:null},user_data:null,choose_model_select_element:null,_user:null,wait_auth:null,choose_model_select:null,_city_suggest:null,initialize:function(parent){this.parent=parent;if(this.parent.options.form_options){this.setOptions(this.parent.options.form_options)}this.form=$(this.options.selectors.form);this.form.action='/cgi-bin/form.php';this.form.get_from_account=this.form.getElement(this.options.selectors.get_from_account);this.form.rules=this.form.getElement(this.options.selectors.rules);this.form.agree=this.form.getElement(this.options.selectors.agree);this.form.submit_block=this.form.getElement(this.options._auth_blocks_options.selectors.send_form_btn_block);this.login_block=this.form.getElement(this.options.selectors.login_block);this.email_block=this.form.getElement(this.options.selectors.email_block);this.phone_block=this.form.getElement(this.options.selectors.phone_block);this.fio_block=this.form.getElement(this.options.selectors.fio_block);this.submit_block=this.form.getElement(this.options.selectors.submit_block);this._addShowInfoEvents();this.msg_block=this.form.msg=this.form.getElement(this.options.selectors.msg);this.form.addEvent('submit',this.onSubmit.bind(this));if(this.form.get_from_account){this.form.get_from_account.addEvent('click',this.onGetAccuntData.bind(this))}if(this.form.rules){this.form.rules.addEvent('click',this.parent.showRules.bind(this.parent))}this._user=App.getService('User');this._user.addEvent('signIn',this.onSignIn.bind(this));this._user.addEvent('signInFailed',this.onSignInFailed.bind(this));this._user.addEvent('signOut',this.onSignOut.bind(this));this._user.addEvent('signIn',this.getUserData.bind(this));if(this._user.isAuth()){this.getUserData();this.onSignIn()}else{this.onSignOut()}return this},setCitySuggest:function(suggest){var current_city=App.getService('CityChooser')&&App.getService('CityChooser').getCurrentCity(),city_element=this.form.getElement(this.options.selectors.city),city_id_element=this.form.getElement(this.options.selectors.city_id);if(suggest&&city_element&&city_id_element){this._city_suggest=suggest;this._city_suggest.setDefaultData({count:0,records:[],text:'default_data'});this._city_suggest.init(city_element);if(current_city&&current_city.id){city_element.value=current_city.title;city_id_element.value=current_city.id}document.addEvent('ChangeLocality',function(param){city_id_element.value=0;if(param&&param.value&&param.element&&param.element.id){city_id_element.value=param.element.id}}.bind(this))}},setChooseModelSelect:function(select){this.choose_model_select=select;this.choose_model_select.addEvent('initSelectModels',this.onInitSelectModels.bind(this))},onInitSelectModels:function(){this.choose_model_select_element=this.choose_model_select.getSelectElement();this.updateConfirmButton();this.choose_model_select_element.getInput().addEvent('change',this.updateConfirmButton.bind(this))},onSubmit:function(e){e&&new Event(e).stop();var old_states=this._enableFormElements(['email','phone']),options={headers:{'ajaxAction':this.options.ajax.registration},onComplete:this.checkResp.bind(this,old_states)},model_select=this.choose_model_select&&this.choose_model_select.getSelectElement(),agree_msg_content=App.getHTML(this.options.tpl.agree_msg_content,{}),not_valid_elements=this.form.notValid();if(!this.form.agree||this.form.agree.checked){this.form.agree_msg&&this.form.agree_msg.remove();this.msg_block&&(this.msg_block.innerHTML='');this.form.agree_msg=null;this._setGTMErrorFields(not_valid_elements);if(!model_select||model_select.isValid(true)){this.form.trySend(options)}}else{if(not_valid_elements&&not_valid_elements.length){not_valid_elements.push(this.form.agree)}this._setGTMErrorFields(not_valid_elements,agree_msg_content);if(!this.form.agree_msg){this.form.agree_msg=new Element('div',{name:'msg'}).inject(this.form.agree,'before')}this.form.agree_msg.setHTML(App.getHTML(this.options.message.tpl,{code:Message_class.prototype.CODE.ERROR,content:agree_msg_content}))}},_addShowInfoEvents:function(){this.form.getElement(this.options.selectors.login_info).addEvent('click',function(e){new Event(e).stop();var popup=new Popup_class(this.options.tpl.login_info_popup,this.form.getElement(this.options.selectors.login_info_popup_parent));popup.setContent(App.getHTML(this.options.tpl.login_info_popup_content));popup.open()}.bind(this))},_enableFormElements:function(names){var old_states={};if(this._user.isAuth()){names.each(function(name){if(this.form[name]){old_states[name]={disabled:Boolean(this.form[name].getProperty('disabled'))};this.form[name].removeProperty('disabled')}}.bind(this))}return old_states},_restoreFormElements:function(names_data){Object.each(names_data,function(name_data,name){if(this.form[name]){name_data.disabled?this.form[name].setProperty('disabled','disabled'):this.form[name].removeProperty('disabled')}}.bind(this))},_setGTMErrorFields:function(fields,message){if(fields&&fields.length){var event_data={extend_event:[]},eventContent=[],separator='/';fields.each(function(field){if(field.getAttribute('name')){eventContent.push(field.getAttribute('name'))}});if(eventContent.length){event_data.extend_event.push({name:'eventContent',value:eventContent.join(separator)});if(message){event_data.extend_event.push({name:'eventError',value:message})}document.fireEvent('promoAttemptLogin',event_data)}}},checkResp:function(old_states,resp){this.msg_block&&this.msg_block.hide();var Response=new Response_class(resp),popup;this.form.processStop();if(old_states){this._restoreFormElements(old_states)}if(!Response.isError()&&Response.content){this._resetForm();popup=new Popup_class(this.options.popup.header_tpl);popup.setContent(App.getHTML(this.options.tpl.successfull_popup_info,Response.content),this.form);popup.open()}else if(Response.action&Response.ACTION.USER_AUTH){this._needAuthorize(Response.Message)}else if(Response.action&Response.ACTION.USER_SIGNUP_CONFIRM){this._prepareSignUpConfirmBlock(Response.content);Response.doAction()}else if(Response.isVoid()){if(!this._user.isAuth()&&$defined(Response.S)&&$defined(Response.S.user)&&Response.S.user.auth){this.wait_auth=true;this._user.changeAuthType(this.options.auth_type)}Response.doAction();this._user.fireSignInEvent('email')}else{if(Response.Message&&Response.Message.name==='AuthUserEmailExists'){this.form.getElement('[name='+Response.Message.field+']').setHTML(App.getHTML(this.options.tpl.auth_user_email_exists)).show();this.form.getElement('[name=relogin]').addEvent('click',function(e){new Event(e).stop();this._user.SignOut();this.form.login.value=this.form.email.value;this._needAuthorize()}.bind(this))}else{this._showErrorMessage(Response.Message);this._scrollToMessage()}}},_resetForm:function(){this.email_block.injectAfter(this.fio_block);this.phone_block.injectAfter(this.fio_block);this.email_block.getElement(this.options.selectors.email_for_completion_msg).hide();this.phone_block.getElement(this.options.selectors.phone_for_completion_msg).hide();this.form.getElement('[name=email_error]').hide();if(this._user.isAuth()){this.login_block.hide();this.form.login.setProperty('disabled','disabled');this.email_block.show();this.form.email.value?this.form.email.setProperty('disabled','disabled'):this.form.email.removeProperty('disabled');this.phone_block.show();this.form.phone.removeProperty('disabled')}else{this.login_block.show();this.form.login.removeProperty('disabled');this.email_block.hide();this.form.email.setProperty('disabled','disabled');this.phone_block.hide();this.form.phone.setProperty('disabled','disabled')}},_prepareSignUpConfirmBlock:function(response_content){var confirm_signup_block=this.form.getElement(this.options.confirm_signup.block_selector);this._user.changeAuthType(this.options.auth_type);this._user.addEventOnce('signIn',this._onUserSignUpByPhone.bind(this));this.login_block.hide();this.form.login.setProperty('disabled','disabled');this.email_block.show();this.form.email.removeProperty('disabled');this.form.phone.value=this.form.login.value;this.phone_block.show();this.email_block.getElement(this.options.selectors.email_for_completion_msg).show();this.email_block.injectBefore(confirm_signup_block);confirm_signup_block.setHTML(App.getHTML(this.options.confirm_signup.tpl,response_content)).show();this.form.setFocus();this._user.setOptions({signup_confirm:{confirm_by_popup:false}}).switchSignUpConfirmBlock(this.form,null);this.wait_auth=false},_onUserSignUpByPhone:function(){this._user.restoreSignUpConfirmBlock();this.submit_block.getElements('button').removeEvents();this.form.getElement(this.options.confirm_signup.block_selector).empty().hide();if(this._user.sign_up_confirm_phone_requesting){this.onSubmit()}else if(this.form.email.value){this.form.phone.removeProperty('disabled')}},_showErrorMessage:function(Message){this.msg_block=this.form.msg;var field=Message.field&&this.form.getElement('[name="'+Message.field+'"]');if(field){this.msg_block=field;this.msg_block.setHTML(Message.getContentTpl(this.options.message.field_error))}else{this.msg_block.setHTML(Message.getContentTpl(this.options.message.tpl))}this.msg_block.show()},onGetAccuntData:function(e){new Event(e).stop();if(this._user.isAuth()){this.getUserData()}else{this.showAuthPopup()}},getUserData:function(){this.form.processStart(this.options.tpl.process);new Ajax(this.options.requestURL,{data:{promotion_id:this.form.promotion.value},method:'post',headers:{'ajaxAction':this.options.ajax.user_data},onComplete:this.onGetUserData.bind(this)}).request()},onGetUserData:function(resp){var Response=new Response_class(resp);if(Response.content){this.user_data=Response.content;this.setFields(this.user_data)}this.form.processStop()},setFields:function(data){var names=['fio','phone','email','city'];names.each(function(name){if(data[name]&&this.form[name]){this.form[name].value=data[name];if(name==='email'){this.form.email.setProperty('disabled','disabled');this.email_block.getElement(this.options.selectors.email_for_completion_msg).hide();this.email_block.injectAfter(this.fio_block)}}}.bind(this));if(data.details){this._setDetailsFields(data.details)}},_setDetailsFields:function(details){var name;for(name in details){this._applayValue(this.form.getElements('[name^="'+name+'"]'),details[name])}},_isDateFieldElements:function(elements){var fields_length=3,counter=0;if(elements&&elements.length){elements.forEach(function(element){[this.options._date_day_suffix,this.options._date_month_suffix,this.options._date_year_suffix].forEach(function(suffix){if(element.name.indexOf(suffix,element.name.length-suffix.length)!==-1){counter++}})}.bind(this))}return fields_length==counter},_applyDateFieldValue:function(elements,value){var date=value&&value.split('-'),values={};if(date&&date.length){values[this.options._date_year_suffix]=parseInt(date[0]);values[this.options._date_month_suffix]=parseInt(date[1]);values[this.options._date_day_suffix]=parseInt(date[2]);elements.forEach(function(element){[this.options._date_day_suffix,this.options._date_month_suffix,this.options._date_year_suffix].forEach(function(suffix){if(element.name.indexOf(suffix,element.name.length-suffix.length)!==-1&&values[suffix]>0){element.hasOwnProperty('setValue')?element.setValue(values[suffix]):this._setValue(element,values[suffix])}}.bind(this))}.bind(this))}},_applyMultiTextValue:function(element,value){if(value&&value.length){value.forEach(function(val){element.value=val;element=element.onblur()})}},_applayValue:function(elements,value){var i,length=elements&&elements.length;if(length){if(this._isDateFieldElements(elements,value)){this._applyDateFieldValue(elements,value)}else if(elements[0].getAttribute('data-type')=='MultiText'){this._applyMultiTextValue(elements[0],value)}else if(elements[0].hasOwnProperty('setValue')){elements[0].setValue(value)}else{for(i=0;i<length;i++){this._setValue(elements[i],value)}}}},_setValue:function(element,value){switch(element.getTag()){case'select':element.options.length&&element.getElements('option').forEach(function(option){option.selected=(element.multiple&&value.length)?value.indexOf(option.value)>=0:(option.value==value)});break;case'textarea':case'input':if(['checkbox','radio'].contains(element.type)){element.checked=value.length?value.indexOf(element.value)>=0:(element.value==value);break}else{element.value=value}}},_needAuthorize:function(msg){if(!this._auth_blocks){this._auth_blocks=new AuthorizationBlocks_class(this.form,this.options._auth_blocks_options)}this.wait_auth=true;this._auth_blocks.needAuth(msg);document.fireEvent('agreementExistUser')},showAuthPopup:function(){if(!this.auth_popup){this.auth_popup=new RozetkaAuthorizationPromotionsPopup_class();this.auth_popup.setOptions({'tpl':{'confirm_request_tpl':this.options.popup.confirm_request_tpl}})}this.auth_popup.show()},_resetAuth:function(){this.form.getElement('[name=auth_blocks]').empty();this._auth_blocks=null},onSignIn:function(S){this._resetAuth();this.msg_block.hide();var login_value=this.form.login.value,login_type=login_value&&this._user.getLoginType(login_value);if(this.login_block.isVisible()){this.login_block.hide();this.form.login.setProperty('disabled','disabled')}if(!this.email_block.isVisible()){this.email_block.show();this.form.email.removeProperty('disabled');if(login_type==='email'){this.form.email.value=login_value}}if(!this.phone_block.isVisible()){this.phone_block.show();this.form.phone.removeProperty('disabled');if(login_type==='phone'){this.form.phone.value=login_value}}if(this.wait_auth){if(login_type==='phone'){this.form.phone.setProperty('disabled','disabled');this.form.email.removeProperty('disabled');this.email_block.injectBefore(this.submit_block);this.email_block.getElement(this.options.selectors.email_for_completion_msg).show();this.form.email.focus()}else if(login_type==='email'){this.form.email.setProperty('disabled','disabled');this.form.phone.removeProperty('disabled');this.phone_block.injectBefore(this.submit_block);this.phone_block.getElement(this.options.selectors.phone_for_completion_msg).show();this.form.phone.focus()}this.msg_block=this.form.msg;this.msg_block.setHTML(App.getHTML(this.options.message.tpl,{code:Message_class.prototype.CODE.DONE,content:this.options.tpl.success_signin_message}));this.hidePassField();this.form.processStop();this.wait_auth=false}},onSignOut:function(){if(this.form){this._resetForm();this.form.email.value='';this.form.phone.value=''}},onSignInFailed:function(data){var response_message=data.response;if(this.wait_auth){this.msg_block=this.form.msg;this.msg_block.setHTML(response_message.getContentTpl(this.options.message.tpl));this.msg_block.show();this.form.processStop()}},hidePassField:function(){if(this.form.pass_block){this.form.pass_block.hide()}},_scrollToMessage:function(){new Fx.Scroll(window).toElement(this.msg_block)},updateConfirmButton:function(){if(this.form.submit_block.hasClass(this.options.disabled_class)&&this.choose_model_select_element.getValue().length>0){this.form.submit_block.removeClass(this.options.disabled_class)}if(this.choose_model_select_element.getValue().length===0){this.form.submit_block.addClass(this.options.disabled_class)}}});RozetkaPromotionsMembersForm_class.implement(new Options);var RozetkaPromotionsMembers_class=new Class({options:{classes:{members_form:RozetkaPromotionsMembersForm_class},selectors:{rules:'show_rules',card_number:'show_card_number',members_form:'member_registration_form'},popup:{header_tpl:'<div class=\"popup-css popup-viewed-auth\"> <a href=\"#\" class=\"popup-close-medium-delivery\" name=\"close\"> <img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"×\" class=\"popup-close-medium-icon sprite\"> <\/a> <div class=\"promo-rules-content-wrap\"> <div name=\"content\" class=\"promo-rules-content\"><\/div> <\/div> <\/div>'},text:{rules:'',card_number:''},form_options:{language:null,domain:null}},initialize:function(options){this.setOptions(options);if($(this.options.selectors.members_form)){this.members_form=new this.options.classes.members_form(this);this.members_form.login_type="email"}this.rules=$(this.options.selectors.rules);this.card_number=$(this.options.selectors.card_number);if(this.rules){this.rules.addEvent('click',this.showRules.bind(this))}if(this.card_number){this.card_number.addEvent('click',this.showCardNumber.bind(this))}},setChooseModelSelect:function(select){if(this.members_form){this.members_form.setChooseModelSelect(select)}},setCitySuggest:function(suggest){if(this.members_form&&suggest){this.members_form.setCitySuggest(suggest)}},showRules:function(e){new Event(e).stop();var popup=new Popup_class(this.options.popup.header_tpl);popup.setContent(this.options.text.rules,this);popup.open()},showCardNumber:function(e){new Event(e).stop();var popup=new Popup_class(this.options.popup.header_tpl);popup.setContent(this.options.text.card_number,this);popup.open()}});RozetkaPromotionsMembers_class.implement(new Options);var RozetkaAuthorizationVotingPopup_class=AuthorizationVotingPopup_class.extend({Class:'RozetkaAuthorizationVotingPopup_class',options:{popup_class:Popup_class,tpl:{popup_tpl:'<div class=\"popup-css popup-viewed-auth\"> <a href=\"#\" class=\"popup-close-medium-delivery\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"×\" class=\"popup-close-medium-icon sprite\"><\/a> <div name=\"content\"><\/div> <\/div>',popup_content_tpl:'<h5 class=\"auth-title h2\">Вхід в інтернет-магазин<\/h5> <div class=\"auth-msg\" name=\"app-message\"><\/div> <div name=\"msg\" class=\"social-msg sprite-side flex\"><\/div> <form class=\"auth-f clearfix pos-fix\" method=\"post\" data-collect_errors=\"1\"> <div class=\"auth-f-email\" data-auth-email=\"або\"> <div class=\"auth-f-msg\" name=\"msg\"><\/div> <div class=\"auth-f-i\"> <div class=\"auth-f-i-title\">Ел.&nbsp;пошта або телефон<\/div> <input type=\"text\" class=\"input-text auth-input-text\" name=\"login\" _required=\"required\" value=\"${User.getEmail(true)}\" _pattern=\"^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$|^\\s*((\\+?\\s*(\\(\\s*)?3)?[\\s-]*(\\(\\s*)?8[\\s-]*)?(\\(\\s*)?0[\\s-\\(]*[1-9][\\s-]*\\d(\\s*\\))?([\\s-]*\\d){7}\\s*$\"> <div name=\"email_hint_block\" class=\"hidden\"><\/div> <\/div> <div name=\"auth_blocks\"><\/div> <\/div> <div class=\"auth-f-social auth-f-social-indent\"> <div class=\"auth-f-social-title\">Увійти як користувач<\/div> {if use_vk} <div name=\"social_button_auth_popup\" type=\"vkontakte\" class=\"auth-f-social-i\" {if defined(\'location_value\')}data-location=\"${location_value}\"{\/if}><\/div> {\/if} <div name=\"social_button_auth_popup\" type=\"facebook\" class=\"auth-f-social-i\" {if defined(\'location_value\')}data-location=\"${location_value}\"{\/if}><\/div> <div name=\"social_button_auth_popup\" type=\"google\" class=\"auth-f-social-i\" {if defined(\'location_value\')}data-location=\"${location_value}\"{\/if}><\/div> {if !location.pathname.test(new RegExp(\'\\\/signup\\\/\', \'gi\'))} <div class=\"auth-f-signup\"> {var is_promotions = new RegExp(\'news-articles-promotions\/promotions\').test(location.pathname)} <a href=\"https:\/\/my.rozetka.com.ua\/ua\/signup\/\" name=\"registration\" class=\"novisited auth-f-signup-link\" onclick=\"document.fireEvent(\'registration\', {extend_event: [{if is_promotions}{name: \'eventLocation\', value: \'Promotions\'}{\/if}]});\" >Зареєструватися<\/a> <\/div> {\/if} <\/div> <\/form>',unauthorized_tpl:'<form class=\"clearfix\" method=\"post\"> <h5 class=\"voting-auth-header\">Оцінка відгуку про&nbsp;товар<\/h5> <div class=\"voting-msg\" name=\"app-message\"><\/div> <div name=\"message\"><\/div> <div class=\"clearfix pos-fix\"> <div class=\"auth-f-social-b\" data-auth-email=\"або\"> <div class=\"auth-f-social-title\">Увійти як користувач<\/div> {if use_vk} <div name=\"social_button_auth_popup\" type=\"vkontakte\" class=\"auth-f-social-i\" data-location=\"votingPopup\"><\/div> {\/if} <div name=\"social_button_auth_popup\" type=\"facebook\" class=\"auth-f-social-i\" data-location=\"votingPopup\"><\/div> <div name=\"social_button_auth_popup\" type=\"google\" class=\"auth-f-social-i\" data-location=\"votingPopup\"><\/div> <\/div> <div class=\"voting-auth-f-email\"> <div name=\"email_block\" class=\"auth-f-i\"> <div class=\"f-i-title-vert\">Ел. пошта або телефон<\/div> <input name=\"login\" type=\"text\" class=\"input-text auth-input-text\" _required=\"required\" _pattern=\"^([^\\​]+)@([^\\​]+)\\.([^\\​]+)$|^\\s*((\\+?\\s*(\\(\\s*)?3)?[\\s-]*(\\(\\s*)?8[\\s-]*)?(\\(\\s*)?0[\\s-\\(]*[1-9][\\s-]*\\d(\\s*\\))?([\\s-]*\\d){7}\\s*$\"> <div name=\"email_hint_block\" class=\"hidden\"><\/div> <\/div> <div name=\"auth_blocks\"><\/div> <div class=\"auth-save-submit\"> <span name=\"save_vote_button\" class=\"btn-link btn-link-green\"> <button class=\"btn-link-i\">Зберегти оцінку<\/button> <\/span> <\/div> <div name=\"signup-terms-block\" class=\"signup-terms-popup\"> <span class=\"signup-terms-text\">Реєструючись, ви погоджуєтеся з&nbsp;<a class=\"xhr\" id=\"user_agreement_link\" href=\"#\" onclick=\"document.fireEvent(\'GTMAgreementClick\', { extend_event: [{ name: \'eventContent\', value: \'Buyer\'}]});return false;\">угодою користувача<\/a><\/span> <\/div> <\/div> <\/div> <\/form>',confirm_phone_popup_content:'<form class=\"clearfix\" data-event-location=\"votingPopup\"> <h5 class=\"voting-auth-header\">Оцінка відгуку про&nbsp;товар<\/h5> <div class=\"voting-msg\" name=\"app-message\"><\/div> <div class=\"clearfix pos-fix\"> <div class=\"voting-auth-f-email\"> <div class=\"auth-f-i\"> <div class=\"f-i-title-vert\">Ел. пошта або телефон<\/div> <input name=\"login\" type=\"text\" class=\"input-text auth-input-text\" disabled=\"disabled\" value=\"${confirm_data.phone}\"> <\/div> <\/div> <\/div> <div class=\"voting-auth-confirm\"> {var event_location = tpl_data && tpl_data.event_location || \'votingPopup\'} <div class=\"double-auth-wrap\"> <div class=\"double-auth-title\"> На&nbsp;номер <span class=\"bold\">${confirm_data.phone} <\/span>відправлено SMS із&nbsp;кодом підтвердження <\/div> <div class=\"double-auth-num\"> Код підтвердження <\/div> <input class=\"input-text double-auth-input\" name=\"verify_code\" _pattern=\"^[0-9]+$\" _required=\"required\" type=\"text\"> <input name=\"phone_id\" value=\"${confirm_data.phone_id}\" type=\"hidden\"> <input name=\"user_id\" value=\"${confirm_data.user_id}\" type=\"hidden\"> <span class=\"btn-link btn-link-blue double-auth-submit\"> <button type=\"submit\" name=\"confirm_signup_submit\" class=\"btn-link-i\">Підтвердити<\/button> <\/span> <\/div> <div name=\"resend_code_msg\" class=\"double-auth-msg\"><\/div> <a href=\"#\" name=\"resend_code\" class=\"xhr novisited double-auth-link\" onclick=\"document.fireEvent(\'getAnotherConfirmCode\',{extend_event:[{name:\'eventLocation\',value:\'${event_location}\' }]});\"> Запитати код ще раз <\/a> <\/div> <\/form>',},selectors:{login:'input[name=login]',msg:'[class*=msg]',email:'[name=email]',app_message:'[name="app-message"]',save_vote_button:'[name=save_vote_button]'},signin_url:'https://my.rozetka.com.ua/ua/signin/',_auth_blocks_options:{tpl:{message:'<div class=\"pos-fix sprite-side message code${code}\"> <a href=\"\" class=\"message-close-link\" onclick=\"clearUserMessages(event, \'msg\')\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite message-close-link-img\"> <\/a> ${content} <\/div>'},selectors:{msg:'[name="msg"]',send_form_btn_block:'[name=save_vote_button]'},track_email_change:true,blocks_type:'popup'},auth_type:'popup'},actor:null,initialize:function(){this.attachToObserver([]);this.parent();this.actor=App.getService('User');OAuth2.addEvent('login_failed',this.onError.bind(this))},createPopup:function(){this.options.popup_class.prototype.processStart=function(process){if(this.isOpened()){this.content.processStart(process)}};this.options.popup_class.prototype.processStop=function(){if(this.isOpened()){this.content.processStop()}};this.popup=new this.options.popup_class(this.options.tpl.popup_tpl)},changeContent:function(content,data){if(this.options.vote_location){if(typeof data==='undefined'){data={'location_value':this.options.vote_location}}else{data['location_value']=this.options.vote_location}}this.popup.setContent(content,data);this.popup._posUpdate();this.bindEvents();this.fireEvent('formPopupOpen',{form:this.popup.getElement('form')})},_initUserAgreement:function(){if(!this.popup){return}var user_agreement_popup=new UserAgreementPopup_class(this.popup);user_agreement_popup.init()},show:function(){this.setContent();this.bindEvents();this.popup.open();this._initUserAgreement();if(!this.actor.isAuth()){this.updateOAuth()}},hide:function(){this.popup.close()},is_opened:function(){return this.popup.isOpened()},onUnauthorizedUser:function(){document.fireEvent('showVotingSignInPopup');this.changeContent(this.options.tpl.unauthorized_tpl);var login=this.popup.getElement(this.options.selectors.login),save_vote_button=this.popup.getElement(this.options.selectors.save_vote_button);if(save_vote_button){save_vote_button.addEvent('click',function(e){new Event(e).stop();document.fireEvent('saveVoteButtonClick');if(this.popup.form.checkFields()){this.popup.form.processStart(preloaders.green_process_tpl);var url='https://rozetka.com.ua/ua/comments/#getUser';new Ajax('/cgi-bin/form.php',{data:{login:login.value},method:'post',headers:{ajaxAction:url},onComplete:function(resp){this.popup.form.processStop();var response=new Response_class(resp);if(response.action&response.ACTION.USER_SIGNUP_CONFIRM){this._prepareSignUpConfirmPopup();response.doAction();save_vote_button.hide()}else if(response.action&response.ACTION.USER_AUTH){this._getAuthBlocks().needAuth(response.Message);document.fireEvent('agreementExistUser')}else if(response.Message){this.popup.getElement(this.options.selectors.app_message).setHTML(response.Message.getContentTpl())}else{var old_auth=this.actor.isAuth(),current_auth;response.doAction();if((current_auth=this.actor.isAuth())&&current_auth!==old_auth){this.actor.changeAuthType(this.options.auth_type);this.actor.fireSignInEvent('email')}}}.bind(this)}).request()}}.bind(this))}if(Cookie.get("login")&&login){login.value=Cookie.get("login")}this.updateOAuth();this.popup.getElements('[name="close"]').each(function(elem){elem.addEvent('click',function(e){new Event(e).stop();this.popup.close()}.bind(this))}.bind(this))},_getAuthBlocks:function(){if(!this._auth_blocks){this._auth_blocks=new AuthorizationBlocks_class(this.popup.form,this.options._auth_blocks_options);this.popup.addEventOnce('close',function(){this._auth_blocks=null;document.fireEvent('agreementNotExistUser')}.bind(this))}return this._auth_blocks},_prepareSignUpConfirmPopup:function(){this.actor.changeAuthType(this.options.auth_type);this.actor.addEventOnce('confirmSignupPopupClose',this._onUserSignUpPopupClose.bind(this));this.actor.setOptions({signup_confirm:{confirm_by_popup:true}}).switchSignUpConfirmBlock(this._getSignUpConfirmPopup(),this.options.tpl.confirm_phone_popup_content,{})},_getSignUpConfirmPopup:function(){if(!this.signup_confirm_popup){this.signup_confirm_popup=new this.options.popup_class(this.options.tpl.popup_tpl);this.signup_confirm_popup._setAsMoadal()}return this.signup_confirm_popup},_onUserSignUpPopupClose:function(){this.actor.restoreSignUpConfirmBlock();this.signup_confirm_popup=null},updateOAuth:function(){OAuth2.update()},onError:function(params){if(this.popup.msg){if(params&&params.value){this.popup.msg.innerHTML=params.value;this.popup.msg.style.color='#f00'}else{this.popup.msg.innerHTML=''}}}});RozetkaAuthorizationVotingPopup_class.implement(new Options,new Events);var RozetkaTagPopup_class=Popup_class.extend({popup_message:'<h3 class=\"icons-title\" name=\"title\">${title}<\/h3> <div class=\"icons-text\"> ${text} <\/div> {if link&&link_title} <p class=\"text-right\"><a href=\"${link}\" target=\"_blank\" class=\"icons-link arrow-link novisited\"><span class=\"arrow-link-inner\">${link_title}<\/span>&nbsp;&rarr;<\/a><\/p> {\/if}',popup_template:'<div class=\"icons-popup aligned-left\" name=\"content\"><\/div>',data:{title:null,text:null,link:null,link_title:null},timeout:400,popup_is_opened:false,initialize:function(parent){this.parent(this.popup_template,parent);this.data={title:null,text:null,link:null,link_title:null};parent.addEvent('mouseenter',function(e){this.popup_is_opened=true;setTimeout(function(){if(this.popup_is_opened){this.setContent(this.popup_message,this.data);this.elem.getElements('a').each(function(el){el.target='_blank'});this.elem.setStyles({visibility:'hidden'});this.open();this.updatePositionPopup();this.elem.setStyles({visibility:'visible'})}}.bind(this),this.timeout)}.bind(this));parent.addEvent('mouseleave',function(e){this.popup_is_opened=false;setTimeout(function(){if(!this.popup_is_opened){this.close()}}.bind(this),this.timeout)}.bind(this));return this},setTitle:function(title){this.data.title=title;return this},setText:function(text){this.data.text=text;return this},setExternalLink:function(title,link){var element;this.data.link_title=title.trim();this.data.link=link.trim();if(this.data.link.length!=0&&this.data.link_title==''){element=new Element('a');element.href=this.data.link;this.data.link_title=element.hostname}return this},updatePositionPopup:function(){var winWidth=window.getSize().size.x,blockWidth=parseInt(this._getPositionCalculator().getLeft());if(blockWidth>winWidth-this.pElem.getPosition().x){this.content.addClass('right')}if(this.content.getPosition().x<0){this.content.addClass('left')}return this}});var RozetkaCheckoutSuggest_class=Suggest_class.extend({options:{view_default:false,tip_selector:'tip_for_input',loader_css_class:'suggest-loader',arrow_css_class:'dropdown-input-arrow',title_by_another_locality:'Введіть інше місто...',links_of_tips_for_suggest_tpl:'<div class=\"f-i-sign\"> {var count=0} {for record in records} {if count<limit } наприклад, <a href=\"#\" class=\"lightblue xhr\" locality_id=${record.id}>${record.title}<\/a> {\/if} {var count=count+1} {\/for} <\/div>',url:'suggest/action=getLocalitiesForSuggestJSON/',full_title:'${title}{if defined(\'old_title\') && old_title} (${old_title}){\/if}{if big_city==0}{if region} - ${region}{if defined(\'region_old_title\') && region_old_title} (${region_old_title}){\/if} обл.{if show_all && district}, ${district}{if defined(\'district_old_title\') && district_old_title} (${district_old_title}){\/if} р-н{\/if}{\/if}{\/if}',allow_input_custom_text:false,scroll_settings:{height_by_step:25,height_of_block:250,count_elements_in_block:12},min_count_chars:1,default_location_type:'contactData',language:null,domain:null},location_type:null,initialize:function(){this._defaultData={};this._currentValue='';this._defaultValue='';this._history={};this._suggest=null;this._isChosenLocality=false;this.elem=new Element('div')},init:function(input){this.parent(input);if(!this.location_type){this.setDefaultLocationType()}this.input.addEvent('click',function(){this.input.select();document.fireEvent('clickToPopupCity',{extend_event:[{name:'eventLocation',value:this.location_type},{name:'userCityId',value:this.getCityIdByName(this.input.value)}]})}.bind(this));this.input.addEvent('keyup',function(){if(!this._suggest||this._suggest.key===null){var data={};if(this.input.value==this._defaultValue){data['element']=CityChooser.getCurrentCity();this._isChosenLocality=true}else{data['element']={id:0};this._isChosenLocality=false}this.input.fireEvent('ChangeLocality',data)}}.bind(this));this.tip_for_input=$(this.options.tip_selector);this.tip_for_input.addEvent('click',function(){this.isOpened()||this.input.select()}.bind(this));if(this.input.value==''){this._initLinksOfTips()}this._defaultValue=this.input.value;this.initCityChooser()},getCityIdByName:function(name){var result={},result_id=null;if(this._defaultData&&this._defaultData.records){result=this._defaultData.records.filter(function(record){return record.title==name}).pop()}if(result&&result.hasOwnProperty('id')){result_id=result['id']}return result_id},initCityChooser:function(){CityChooser.addEvent('citySelected',this._onCitySelectedFromChooser.bind(this));this.input.addEvent('ChangeLocality',function(p){document.fireEvent('ChangeLocality',p)})},_moveActive:function(shift){this.parent(shift);this._scroll()},_initLinksOfTips:function(){var div=new Element('div').setHTML(App.getHTML(this.options.links_of_tips_for_suggest_tpl,{records:this._defaultData.records,random_record:this._defaultData.random_record,current_city:CityChooser.getCurrentCity(),limit:1})).getElement('div').injectAfter(this.tip_for_input.parentElement);this.addXHRClickEvent(div.getElements('a'))},addXHRClickEvent:function(elems,records_storage){if(!records_storage){records_storage=this._defaultData}elems.each(function(e){e.addEvent('click',function(event){new Event(event).stop();var record,key;for(key in records_storage.records){if(records_storage.records[key].id==e.getProperty('locality_id')){record=records_storage.records[key]}}if(!record&&records_storage.random_record.id==e.getProperty('locality_id')){record=records_storage.random_record}this._isChosenLocality=true;this.input.fireEvent('ChangeLocality',{element:record,view_default:this.options.view_default,location_type:this.location_type,value:e.innerHTML});this.setDefaultLocationType();this.trackCitySelectedEvent(record.id);this.input.value=this._currentValue=this._defaultValue=e.innerHTML}.bind(this))}.bind(this))},setDefaultData:function(data){this._defaultData=data;this._defaultData.records.push({id:0,another_locality:true,title:this.options.title_by_another_locality})},onFocus:function(e){this._currentValue=this.input.value;this._isChosenLocality=false;this._checkChanges('default_data')},onBlur:function(e){if(this.input.value==this._defaultValue||this.input.value==''){this.input.value=this._defaultValue}else if(!this._isChosenLocality){this._resetChangedValues()}this._hide()},onKeyDown:function(e){e=new Event(e);if(e.key=='up'||e.key=='down'){e.stop();this._moveActive(e.key=='up'?-1:1)}else if(e.key=='enter'){e.stop();var key=this._suggest.elems.length==1?0:this._suggest.key;if(key!==null){this._enterActive(key)}}else if(e.key=='esc'){this.input.value='';this._checkChanges(false)}else if(e.key=='tab'){this._hide()}},_enterActive:function(k,item){this._isChosenLocality=true;if(this._suggest.records[k]&&this._suggest.records[k]['another_locality']){this.input.value=this._defaultValue='';this.input.focus()}else{var text=this.elem.getElement('[name'+'='+k+']');this.input.value=this._currentValue=this._defaultValue=text.getProperty('text');this.input.fireEvent('ChangeLocality',{element:this._suggest.records[k],view_default:this.options.view_default,location_type:this.location_type,value:this.input.value});this.setDefaultLocationType();this.trackCitySelectedEvent(this._suggest.records[k].id)}this._hide()},_resetChangedValues:function(){if(!this.options.allow_input_custom_text){this.input.value=''}this.input.fireEvent('ChangeLocality',{element:{id:0}})},_checkChanges:function(value){if(this.input.value.length==0||value=='default_data'){if(!$defined(this._history['default_data'])){this._history['default_data']=$extend({html:App.getHTML(this.options.tpl,this._defaultData)},this._defaultData)}this._suggestion('default_data');this.options.view_default=true}else if(this.input.value.length<this.options.min_count_chars){this._hide()}else if(value==this.input.value){if($defined(this._history[this.input.value])){this._suggestion(this.input.value)}else if(isNaN(value)){this._processStart();this._getSuggest(this.input.value)}this.options.view_default=false}},_suggestion:function(test){this._suggest=$extend({elems:[],key:null,active:null},this._history[test.toLowerCase()]);this.elem.setHTML(this._suggest.html);this._processStop();this._show();if(this._suggest.count){this._suggest.records.each(function(item,key){this._suggest.elems.include(this._markupSuggestion(this.elem.getElement('[name='+key+']')).addEvent('mousemove',this._setActive.bind(this,key)).addEvent('click',this._enterActive.bind(this,key)))}.bind(this))}if(this._suggest.elems.length==1){this._setActive(0)}},_getSuggest:function(test){var options={method:'get',onSuccess:this._setSuggest.bind(this),onComplete:this._suggestion.bind(this,test),use_language:true,withCredentials:true},url=this.options.domain+this.options.url+'?name='+test.toLowerCase().url_encode();url+=this.options.language?'&language='+this.options.language:'';new Ajax(url,options).request()},_setSuggest:function(resp){resp=decodeURIComponent(resp);var Response=new Response_class(resp);Response.doAction();if(!Response.isError()){Response.content.records=this._filterIdenticalLocalitites(Response.content.records);this._history[Response.content.text]=$extend({html:App.getHTML(this.options.tpl,Response.content)},Response.content)}},_filterIdenticalLocalitites:function(records){var exist_ids=[],result=[];records.each(function(record){if(exist_ids.indexOf(record.id)===-1){result.push(record);exist_ids.push(record.id)}}.bind(this));return result},_processStart:function(){this.tip_for_input.removeClass(this.options.arrow_css_class);this.tip_for_input.addClass(this.options.loader_css_class)},_processStop:function(){this.tip_for_input.removeClass(this.options.loader_css_class);this.tip_for_input.addClass(this.options.arrow_css_class)},_onCitySelectedFromChooser:function(city){var city_id=city.data.id;if(city_id){this._isChosenLocality=true;this.location_type=city.location_type;this.input.fireEvent('ChangeLocality',{element:city.data,view_default:this.options.view_default,location_type:city.location_type,value:App.getHTML(this.options.full_title,city.data)});if(city_id!=CityChooser.default_city.id){this.input.highlightReset();this.input.value=this._currentValue=this._defaultValue=App.getHTML(this.options.full_title,city.data)}}},_compareRecords:function(a,b){var result;result=b.big_city-a.big_city;if(result==0){result=this._compareStrings(a.title,b.title);result=result?result:this._compareStrings(a.region,b.region);result=result?result:this._compareStrings(a.district,b.district)}return result},trackCitySelectedEvent:function(id){$(document).fireEvent('checkoutCitySelected',{extend_event:[{name:'eventContext'},{name:'eventTab'},{name:'eventContent',value:id}]})},resetValue:function(){this.input.value=this._currentValue=this._defaultValue=''},setDefaultLocationType:function(){this.location_type=this.options.default_location_type},getSuggestInputValue:function(){return this.input?this.input.value:null}});var RozetkaCityChooser_class=new Class({options:{selectors:{current_city_container_id:'city-chooser',current_city_element:'a[name=city]',xhr_container_id:'[name=xhr_container]',suggest_input_id:'popup_suggest_locality',info_popup:'[name=popup]'},tpl:{chooser_popup:'<div class=\"popup-css header-city-choose-popup\"> <a href=\"#\" class=\"popup-close\" name=\"close\"> <img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"> <\/a> <div name=\"msg\"><\/div> <div name=\"content\"><\/div> <\/div>',chooser_popup_content:'<h2 class=\"header-city-title\">Виберіть своє місто<\/h2> <p class=\"header-city-delivery sprite-side\">&nbsp;доставляємо замовлення по&nbsp;всій Україні!<\/p> <div class=\"header-city-box clearfix\" name=\"xhr_container\"> {var i = 0} {for city in records} {if city.id} {if i % 3 == 0}<div class=\"clearfix\">{\/if} {if city.id == current_city.id} <div class=\"header-city-i\"> <span class=\"header-city-i-text\" locality_id=${city.id}> ${city.title} <\/span> <\/div> {else} <div class=\"header-city-i\"> <a href=\"#\" class=\"header-city-i-link novisited\" locality_id=${city.id}> ${city.title} <\/a> <\/div> {\/if} {eval}i++{\/eval} {if i % 3 == 0 || records.length == i}<\/div>{\/if} {\/if} {\/for} <\/div> <p>Або введіть інший населений пункт України<\/p> <div class=\"header-city-search\"> <div class=\"pos-fix inline\"> <input id=\"popup_suggest_locality\" autocomplete=\"off\" name=\"suggest_locality\" type=\"text\" placeholder=\"Введіть своє місто\" tabindex=\"6\" value=\"\" maxlength=\"200\" class=\"input-text header-city-search-input-text\" > <div id=\"tip_for_input\" class=\"pos-abs\">&nbsp;<\/div> <\/div> <\/div> <div class=\"header-city-search-example\" name=\"xhr_container\"> {if random_record} Наприклад, <a href=\"#\" class=\"header-city-search-example-link novisited xhr\" locality_id=${random_record.id}>${random_record.title}<\/a> {\/if} <\/div> <p class=\"header-city-info\">Вибір міста допоможе надати актуальну інформацію про&nbsp;наявність товару, його ціну та&nbsp;способи доставки у&nbsp;вашому місті! Це допоможе зберегти більше вільного часу для вас<\/p> ',info_popup_content:'<div class=\"header-city-location\"> <div class=\"header-city-location-i header-city-location-town\">${title}<\/div> {if region}<div class=\"header-city-location-i header-city-location-region\">${region} обл.<\/div>{\/if} {if show_all}<div class=\"header-city-location-i header-city-location-district\">${district} р-н<\/div>{\/if} <div class=\"header-city-location-change\"> <a href=\"#\" onclick=\"document.fireEvent(\'clickToPopupCity\');\" class=\"xhr sprite-side header-city-location-change-link\">Змінити регіон<\/a> <\/div> <\/div>',suggest:'{if count} <ul class=\"suggestions\"> {for record in records} <li class=\"suggestion-i\" text=\"${record.title}{if record.old_title} (${record.old_title}){\/if}{if record.big_city==0}{if record.region} - ${record.region}{if record.region_old_title}(${record.region_old_title}){\/if} обл.{if record.show_all && record.district}, ${record.district}{if record.district_old_title} (${record.district_old_title}){\/if} р-н{\/if}{\/if}{\/if}\" name=\"${record_index}\">${record.title}{if record.old_title} (${record.old_title}){\/if}{if record.big_city==0}{if record.region} - ${record.region}{if record.region_old_title} (${record.region_old_title}){\/if} обл.{if record.show_all && record.district}, ${record.district}{if record.district_old_title} (${record.district_old_title}){\/if} р-н{\/if}{\/if}{\/if} <\/li> {\/for} <\/ul> {else} <ul class=\"suggestions\"> <li class=\"suggestion-i not-found\">Місто не знайдено. <br\/>Перевірте правильність написання або введіть найближчий до вас!<\/li> <\/ul> {\/if}',current_city:'<a href=\"#\" class=\"header-city-select-link sprite-side whitelink\" name=\"city\" onclick=\"document.fireEvent(\'clickToPopupCity\', {extend_event: [{name:\'userCityId\', value: ${id}}]});\"> <span class=\"xhr bold\">${sliced_title}<\/span> <\/a> <div name=\"popup\" class=\"popup-css header-city-popup hidden\"><\/div>',links_of_tips_for_suggest_tpl:''},cities_action:'suggest/action=getLocalityInfo/',city_slice_title_length:14,mouseEnterDelay:500,default_title:'',language:null,domain:null},popup_cities:{},default_city:{id:'0',title:'',big_city:null,region:null,district:null,show_all:null},current_city:null,current_city_element:null,current_city_container:null,suggest:null,info_popup:null,popup:null,do_refresh:true,mouseEnterTimeoutId:0,initialize:function(){this.current_city=this.default_city},init:function(popup_cities){this.suggest=new RozetkaCityChooserSuggest_class().setOptions({tpl:this.options.tpl.suggest,links_of_tips_for_suggest_tpl:this.options.tpl.links_of_tips_for_suggest_tpl,language:this.options.language,domain:this.options.domain});this.popup_cities=popup_cities;this.default_city.title=this.options.default_title;this.current_city_container=$(this.options.selectors.current_city_container_id);if(!S.checkup){S.addEventOnce('loadS',function(){this.initCurrentCity();this.setDefaultSuggestData()}.bind(this))}else{this.initCurrentCity();this.setDefaultSuggestData()}User.addEvent('currentlySignedIn',this._onUserSignIn.bind(this));User.addEvent('signOut',function(){this.suggest.setDefaultData({count:0,records:[],text:'default_data'});this.suggest.clearDefaultDataHistory()}.bind(this));OAuth2.addEvent('login_success',this._onUserSignIn.bind(this));document.addEvent('ChangeLocality',this._onCityChange.bind(this))},setDefaultSuggestData:function(){if(User.S&&User.S.suggest_cities&&User.S.suggest_cities.count){this.suggest.clearDefaultDataHistory();this.suggest.setDefaultData(User.S.suggest_cities)}else{this.suggest.setDefaultData({count:0,records:[],text:'default_data'})}},showCurrentCity:function(){this.current_city_container.setHTML(App.getHTML(this.options.tpl.current_city,this.getCurrentCity()));this.current_city_element=this.current_city_container.getElement(this.options.selectors.current_city_element);this.current_city_element.removeEvents();this._addAskCityEventToElem(this.current_city_element);if(this.current_city.id){this.info_popup=this.current_city_container.getElement(this.options.selectors.info_popup);App.addOnDomReady(function(){this.fireEvent('citySelected',{data:this.getCurrentCity(),location_type:this.suggest.location_type})}.bind(this));this.info_popup.removeEvents();this._addCityHoverEvents()}},_addAskCityEventToElem:function(elem){elem.addEvent('click',this.askCity.bind(this))},_addCityHoverEvents:function(){this.current_city_element.addEvent('mouseenter',function(){this.mouseEnterTimeoutId=setTimeout(this._showInfo.bind(this),this.options.mouseEnterDelay)}.bind(this));this.current_city_container.addEvent('mouseleave',this._hideInfo.bind(this))},_hideInfo:function(){if(this.info_popup){this.info_popup.hide()}clearTimeout(this.mouseEnterTimeoutId)},_showInfo:function(){if(this.info_popup&&(!this.popup||!this.popup.isOpened())){this.info_popup.setHTML(App.getHTML(this.options.tpl.info_popup_content,this.getCurrentCity()));this._addAskCityEventToElem(this.info_popup);this.info_popup.show()}},initCurrentCity:function(){var city_id=User.getVisitorCity();if(city_id&&city_id.toInt()){this._getCityByIdAJAX(city_id.toInt())}else{this.showCurrentCity()}},_onUserSignIn:function(){var visitor_city=User.getProperty('visitor_city');if(visitor_city){User.setVisitorCustomVar(visitor_city);this.initCurrentCity()}this.setDefaultSuggestData()},_unsetCityIdCookie:function(){Cookie.set('visitor_city',0,{domain:'.rozetka.com.ua',path:'/'})},_getCityByIdAJAX:function(id){this.do_refresh=false;var options={method:'get',onComplete:this._onCityGet.bind(this),use_language:true,withCredentials:true},url=this.options.domain+this.options.cities_action+'?id='+id;new Ajax(url,options).request()},_onCityGet:function(resp){this.do_refresh=true;resp=decodeURIComponent(resp);if(resp){resp='{code:'+'1'.toInt()+',content:'+resp+'}';resp=new Response_class(resp);this.current_city=resp.content;this._setVisitorCity()}else{this._unsetCityIdCookie()}document.fireEvent('CityGet');this.showCurrentCity()},askCity:function(e,popup_options){if(e){new Event(e).stop()}if(popup_options){this.popup=new Popup_class(popup_options.hasOwnProperty('tpl')?popup_options.tpl:this.options.tpl.chooser_popup,popup_options.hasOwnProperty('parent')?popup_options.parent:this.current_city_container);if(popup_options.location_type){this.suggest.location_type=popup_options.location_type}}else{this.popup=new Popup_class(this.options.tpl.chooser_popup,this.current_city_container)}this.popup.addEvent('close',this._onPopupClose.bind(this));this._hideInfo();var data=this.popup_cities;data.current_city=this.getCurrentCity();this.popup.setContent(this.options.tpl.chooser_popup_content,data);this.popup.getElements(this.options.selectors.xhr_container_id).each(function(elem){this.suggest.addXHRClickEvent(elem.getElements('a'),this.popup_cities)}.bind(this));this.popup.open();this._initSuggest();if(this.current_city.id){this.fireEvent('citySelected',{data:this.getCurrentCity(),location_type:this.suggest.location_type})}$(document).fireEvent('currentCityChanged',{extends_event:[{name:'userCityId',value:this.current_city.id}]})},_initSuggest:function(){this.suggest.init(this.options.selectors.suggest_input_id)},_onCityChange:function(params){if(this._setCurrentCity(params)){if(this.popup&&this.popup.isOpened()){this.popup.close()}else{this._onPopupClose()}}},_setVisitorCity:function(){User.setVisitorCustomVar(this.current_city.id)},_onPopupClose:function(){if(this.current_city.id){this._setVisitorCity()}this.showCurrentCity()},getCurrentCity:function(){var title_length=this.options.city_slice_title_length,sliced_title='';if(title_length&&this.current_city.title.length>title_length){sliced_title=this.current_city.title.slice(0,title_length)+'...'}else{sliced_title=this.current_city.title}return $merge(this.current_city,{sliced_title:sliced_title})},_setCurrentCity:function(params){var result=false,data=params.element;if(data.id&&data.id!=this.current_city.id){this.current_city=data;result=true;document.fireEvent('changeCity',{extend_event:[{name:'userCityId',value:data.id},{name:'eventLocation',value:params.location_type}]})}return result},resetCity:function(){this.current_city=this.default_city;this._unsetCityIdCookie();this.showCurrentCity()}});RozetkaCityChooser_class.implement(new Events(),new Options());var RozetkaCityChooserSuggest_class=RozetkaCheckoutSuggest_class.extend({options:{default_location_type:'Head',language:null,domain:null},init:function(input){this.parent(input);if(this.input.value!=''){this._initLinksOfTips()}},_initLinksOfTips:function(){},_suggestion:function(test){if(test!=='default_data'||this._defaultData.count){this.parent(test)}},trackCitySelectedEvent:function(id){$(document).fireEvent('checkoutCitySelected',{extend_event:[{name:'eventContext',value:'Head'},{name:'eventContent',value:id}]})},clearDefaultDataHistory:function(){this._history.default_data=null}});var RozetkaGoogleMapBase_class=new Class({options:{api_key:'AIzaSyBj7XDClRGcxA9xTV3KPIwyijuHODynh4w',api_url:location.protocol+'//api-maps.yandex.ru/2.0-stable/'+'?load=package.map,package.controls,package.geoObjects&mode=release',map_div_id:'google_map',markerclusterer_url:'/google_markerclusterer.js',markerclusterer_image_path:'https://i.rozetka.ua/design/google_markerclusterer/m',bounds:{offset:0.005,ukraine:{min:[44.103232,22.197485],max:[52.692818,40.544653]}},place_mark:{zoom:15,preset:'twirl#blueStretchyIcon'},marker_icon:'https://i.rozetka.ua/design/google-maps-marker.png',selected_marker_icon:'https://i.rozetka.ua/design/google-maps-selected-marker.png',on_api_ready:null,language:'ru-UA'},points:null,zoom_control:null,map:null,api_ready:false,_place_mark_collection:null,_recreate_map:false,_opened_info_window:null,_info_windows_list:[],_is_maps_loaded:false,_marker_clusterer:null,_language_suffix:'-UA',_available_languages_map:{'ru':'ru','ua':'uk'},initialize:function(options){if(options!==undefined){this.setOptions(options)}this.options.api_url=location.protocol+'//maps.googleapis.com/maps/api/js?key='+this.options.api_key+'&callback=googleMapReady';if(this.options.language){if((window['LanguageSwitcher']===undefined||!window['LanguageSwitcher'].isDisabledMultilang())&&window['LanguageDeterminer_class']!==undefined){lang=LanguageDeterminer_class.prototype.getLangCookie();this.options.api_url+='&language='+this._available_languages_map[lang]+this._language_suffix}else{this.options.api_url+='&language='+this.options.language}}},init:function(){this._loadMarkerClusterer().then(function(){if(typeof google==='undefined'||!google.maps){Asset.javascript(this.options.api_url,{async:true})}else{this.onGoogleMapReady()}}.bind(this));document.addEvent('google_map_ready',this.onGoogleMapReady.bind(this));App.addEvent('timedResize',function(){this._recreate_map=true}.bind(this))},onGoogleMapReady:function(){this.api_ready=true;if('function'===typeof this.options.on_api_ready){this.options.on_api_ready();this.initMapEvents()}},isReady:function(){return this.api_ready},initMapEvents:function(){if(this.map){google.maps.event.trigger(this.map,'resize');google.maps.event.addListener(this.map,'idle',function(){this._is_maps_loaded=true}.bind(this))}},removeAllPoints:function(){this.points=null;if(this._place_mark_collection){this._place_mark_collection.each(function(place_mark){place_mark.setMap(null)})}},setNewPoints:function(points){this.points=points.clone()},closeBalloon:function(){if(this._opened_info_window){this._opened_info_window.close()}},showBalloon:function(point){if(point&&this._place_mark_collection){this._place_mark_collection.each(function(place_mark){if(place_mark.getPosition().lat().toFixed(4)===parseFloat(point.coordinates[0]).toFixed(4)&&place_mark.getPosition().lng().toFixed(4)===parseFloat(point.coordinates[1]).toFixed(4)){this._openInfoWindow(point.id,place_mark)}}.bind(this))}},show:function(){this._closeOpenedInfoWindow();this._setMap();this._setPointsForMap();this._setMarkerCluster(this._place_mark_collection);this._setBounds(this._getBoundsForPoints())},setPointAsSelectedOnReady:function(place_mark){if(!this._is_maps_loaded){google.maps.event.addListenerOnce(this.map,'idle',function(){this.setPointAsSelected(place_mark)}.bind(this))}else{this.setPointAsSelected(place_mark)}},setPointAsSelected:function(place_mark){this.map.setCenter(place_mark.getPosition());this.map.setZoom(this.options.place_mark.zoom);place_mark.setIcon({url:this.getSelectedMarkerImage(place_mark.id),labelOrigin:new google.maps.Point(18,20)});place_mark.setLabel(place_mark.label.text?{text:String(place_mark.label.text),fontSize:'15px',color:'#fff'}:null)},getMarkerImage:function(){return this.options.marker_icon},getSelectedMarkerImage:function(){return this.options.selected_marker_icon},getGoogleCoordinates:function(coordinates){return Array.isArray(coordinates)?new google.maps.LatLng(coordinates[0],coordinates[1]):coordinates},addPlaceMark:function(point){var place_mark_options=this.options.place_mark,mark_property={iconContent:point.iconContent||point.title,balloonContentHeader:point.balloonContentHeader||point.title,balloonContent:point.balloonContent||(point.description||point.title),hintContent:point.hintContent||point.title},placemark;if(point.place_mark_options){place_mark_options=point.place_mark_options;if(place_mark_options.iconImageHref){mark_property.iconContent=''}}var coordinates=this.getGoogleCoordinates(point.coordinates);var icon=point.icon?point.icon:this.getMarkerImage(point.title);placemark=new google.maps.Marker({position:coordinates,map:this.map,title:point.title?point.title.toString().stripTags():null,label:this._getPointLabel(point),icon:icon});placemark.id=point.id;if(mark_property.balloonContent){var info_window=new google.maps.InfoWindow({content:mark_property.balloonContent});this._addInfoWindow(point.id,info_window);google.maps.event.addListener(placemark,"click",function(id,place_mark,e){this._openInfoWindow(id,place_mark);document.fireEvent('mapPinClick',{extend_event:[{name:'eventContent',value:mark_property.balloonContent}]})}.bind(this,point.id,placemark))}return placemark},_getBoundsForPoints:function(){var j,point_position,current_point,min=[],max=[];if(this.points){for(point_position=0;point_position<this.points.length;point_position++){if(this.points[point_position].coordinates&&this.points[point_position].coordinates[0]&&this.points[point_position].coordinates[1]){current_point=this.points[point_position].coordinates;if(!(min.length&&max.length)){for(j=0;j<2;j++){max[j]=current_point[j].toFloat();min[j]=current_point[j].toFloat()}}for(j=0;j<2;j++){if(max[j]<current_point[j].toFloat()){max[j]=current_point[j].toFloat()}if(min[j]>current_point[j].toFloat()){min[j]=current_point[j].toFloat()}}}}}if(min.length&&max.length){if(this.options.bounds.offset){min[1]-=this.options.bounds.offset;min[0]-=this.options.bounds.offset;max[1]+=this.options.bounds.offset;max[0]+=this.options.bounds.offset}}else{min=this.options.bounds.ukraine.min;max=this.options.bounds.ukraine.max}return[new google.maps.LatLng(min[0],min[1]),new google.maps.LatLng(max[0],max[1])]},_setMap:function(){if(!this.map||this._recreate_map){this.map=new google.maps.Map($(this.options.map_div_id),{scaleControl:true,mapTypeControl:true,streetViewControl:true,zoomControl:true,fullscreenControl:true,rotateControl:false});this._setBounds(this._getBoundsForPoints());google.maps.event.addListener(this.map,"click",function(event){this.closeBalloon()}.bind(this));this._recreate_map=false}},_setBounds:function(points){var bounds=new google.maps.LatLngBounds(points[0],points[1]);this.map.fitBounds(bounds)},_setPointsForMap:function(){var i,current_point;if(this.points&&this.map){if(!this._place_mark_collection){this._place_mark_collection=[]}for(i=0;i<this.points.length;i++){current_point=this.points[i];if(!current_point.id){current_point.id=i}if(current_point.coordinates&&current_point.coordinates[0]&&current_point.coordinates[1]){this._place_mark_collection.push(this.addPlaceMark(current_point,i+1))}}}},_getPointLabel:function(point){return typeof point.label!='undefined'?point.label:(point.title?{text:point.title?point.title.toString():'',fontSize:'12px'}:null)},_openInfoWindow:function(office_number,place_mark){this._closeOpenedInfoWindow();this._getInfoWindow(office_number).open(this.map,place_mark);this._opened_info_window=this._getInfoWindow(office_number)},_closeOpenedInfoWindow:function(){if(this._opened_info_window){this._opened_info_window.close()}},_addInfoWindow:function(office_number,info_window){this._info_windows_list[parseInt(office_number)]=info_window},_getInfoWindow:function(office_number){return this._info_windows_list[parseInt(office_number)]||null},_setMarkerCluster:function(place_markers){if(this._marketClusterLoaded()){if(this._marker_clusterer){this._marker_clusterer.clearMarkers()}this._marker_clusterer=new MarkerClusterer(this.map,place_markers,{maxZoom:this.options.place_mark.zoom-1,imagePath:this.options.markerclusterer_image_path})}},_marketClusterLoaded:function(){return typeof MarkerClusterer==='function'},_loadMarkerClusterer:function(){var callback=function(resolve){App.loadScript(this.options.markerclusterer_url,resolve,resolve)};return new Promise(callback.bind(this))}});RozetkaGoogleMapBase_class.implement(new Options(),new Events());googleMapReady=function(){document.fireEvent("google_map_ready")};var RozetkaGoogleMap_class=RozetkaGoogleMapBase_class.extend({options:{service_log_img:'img_logo',img_height_class:'check-map-img-logo',popup:{header_tpl:'<div class=\"popup-css popup-map-container\"> <div name=\"close\" class=\"popup-close popup-map-close\"> <a href=\"#\" class=\"inline\"> <img width=\"27\" height=\"27\" class=\"popup-close-medium-icon sprite\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"X\"> <\/a> <\/div> <div name=\"msg\"><\/div> <div name=\"content\" class=\"popup-map-content\"><\/div> <\/div> ',info_tpl:'<div class=\"clearfix\"> <div class=\"check-map-cities\"> <div name=\"ymap_head\" class=\"clearfix\"> {if need_pickup} {if Object.getLength(service.all)} <div class=\"check-map-cities-b\"> <span class=\"check-map-cities-title\">Сеть аптек<\/span> <div class=\"check-map-cities-wrap\" name=\"select_block\"> <a href=\"#\" class=\"check-map-cities-link novisited sprite-side\" service_id=\"${service.id}\" name=\"drop_link\"> <span class=\"dotted\">{if service.title}${service.title}{else}Все аптеки{\/if}<\/span> <\/a> <div class=\"check-map-cities-drop hidden\" name=\"drop_block\"> <div class=\"popup-dropdown check-map-cities-dropdown\"> <ul class=\"check-map-cities-l\"> <div class=\"check-map-cities-l-inner\"> {for data in service.all} {for method_data in data.response} {for service_data in method_data.services} <div class=\"check-map-cities-l-i\"> <div class=\"check-map-cities-l-i-link sprite-side\" name=\"drop_element\" data-value=\"${service_data.service.id}_${data.goods_id}\"> <span class=\"check-map-cities-l-i-img responsive-img\"> ${data.seller.logo} <\/span> <span class=\"check-map-cities-l-i-text\"> <span name=\"service_name\">${service_data.service.title}<\/span> {if service_data.pickups.pickups.length} {var points_count_morph = [\'аптека\', \'аптеки\', \'аптек\']} {var plural_form = plural(service_data.pickups.pickups.length)} <span class=\"check-map-cities-l-i-text-i\">${service_data.pickups.pickups.length} ${points_count_morph[plural_form]}<\/span> {\/if} <\/span> <\/div> <\/div> {\/for} {\/for} {\/for} <div class=\"check-map-cities-l-i\"> <div class=\"check-map-cities-l-i-link sprite-side\" name=\"drop_element\"> <span class=\"check-map-cities-l-i-img responsive-img\">&nbsp;<\/span> <span class=\"check-map-cities-l-i-text\"> <span name=\"service_name\">Все аптеки<\/span> <\/span> <\/div> <\/div> <\/div> <\/ul> <\/div> <\/div> <input type=\"hidden\"\/> <\/div> <\/div> {\/if} {if !service.title && count} <div class=\"check-map-cities-b check-map-cities-b-available\"> <span class=\"check-map-cities-title\">Доступно<\/span> <div class=\"check-map-cities-wrap\"> {var points_count_morph = [\'аптека\', \'аптеки\', \'аптек\']} {var plural_form = plural(count)} <span class=\"check-map-cities-total\">${count}&nbsp;<span class=\"check-map-cities-total-text\">${points_count_morph[plural_form]}<\/span><\/span> <\/div> <\/div> {\/if} {\/if} <div class=\"aligned-center check-map-img-logo responsive-img\" name=\"img_logo\"><\/div> <div name=\"unavailable_pickup\" class=\"hidden\"> <a href=\"#\" class=\"check-map-l-i novisited active\"> <div class=\"clearfix check-map-l-title\"> <div class=\"check-map-l-number\"> <span class=\"check-map-l-number-inner sprite-side\" name=\"number\"><\/span> <\/div> <div class=\"check-map-l-name\" name=\"title\"><\/div> <\/div> <div class=\"check-map-l-content\"> <div class=\"check-map-l-status bold\">Немає в наявності<\/div> <\/div> <\/a> <\/div> <\/div> <div class=\"check-pharmacy-popup hidden\" name=\"required\"> <a href=\"#\" class=\"message-close-link\" onclick=\"this.getParent().hide();return false;\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite check-pharmacy-icon\"> <\/a> <h2 class=\"check-pharmacy-title sprite-side\">Выберите аптеку, из&nbsp;которой удобно забрать данный товар<\/h2> <p class=\"check-pharmacy-text\">Вы&nbsp;сможете изменить свой выбор во&nbsp;время оформления заказа<\/p> <\/div> <div class=\"check-pharmacy-popup hidden\" name=\"not_available\"> <a href=\"#\" class=\"message-close-link\" onclick=\"this.getParent().hide();return false;\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite check-pharmacy-icon\"> <\/a> <h2 class=\"check-pharmacy-title sprite-side\">Выберите пункт самовывоза<\/h2> <p class=\"check-pharmacy-text\">Данный товар отсутствует в&nbsp;выбранной вами сети аптек &laquo;<span name=\"seller_title\">Аптека КОСМО<\/span>&raquo;, по&nbsp;адресу&nbsp;<span name=\"pickup_unavailable_address\">ул. Межигорская, д. 1<\/span><\/p> <p class=\"check-pharmacy-text\">Необходимо выбрать другую аптеку для самовывоза<\/p> <\/div> <div class=\"check-pharmacy-popup hidden\" name=\"not_available_pickups_from_service\"> <h2 class=\"check-pharmacy-title sprite-side\">Наразі вільних поштоматів немає<\/h2> <\/div> <div class=\"check-map-l\"> <div class=\"check-map-l-inner\" name=\"pickups_list\"> <\/div> <\/div> <\/div> <div class=\"check-map\" id=\"google_map\"><\/div> <\/div>',pickups_tpl:'<a href=\"#\" class=\"check-map-l-i novisited{if selected} check-pharmacy{\/if}\" name=\"pickup_${id}\" element_id=\"${id}\"> <div class=\"clearfix check-map-l-title\" name=\"control\" element_id=\"${id}\"> <div class=\"check-map-l-number\"> <span class=\"check-map-l-number-inner sprite-side\">${office_number}<\/span> <\/div> <div class=\"check-map-l-name\">${title}<\/div> {if required} <div class=\"check-map-l-price\">${goods.price.primary.decimals.toString().toPriceFormat()}&nbsp;<span class=\"check-map-l-price-uah\"><\/span>${goods.price.primary.unit}<\/div> {\/if} <\/div> <div class=\"check-map-l-content\" name=\"slide_elem\"> {if goods && goods.additional_text} <div class=\"check-map-l-short-desc red\">${goods.additional_text}<\/div> {\/if} {if description} <div class=\"check-map-l-desc\">${$decodeHtml(description)}<\/div> {\/if} {if required} <div class=\"map-g-wrap\"> {if old_price_should_be_shown} <div class=\"map-g-price-old-wrap\"> <div class=\"map-g-price-old\">${goods.old_price.primary.decimals.toString().toPriceFormat()}<span class=\"map-g-price-old-uah\">&thinsp;${goods.old_price.primary.unit}<\/span><\/div> <\/div> {\/if} <div class=\"clearfix\"> <div class=\"map-g-price{if old_price_should_be_shown} map-g-price-cheaper{\/if}\"> ${goods.price.primary.decimals.toString().toPriceFormat()}<span class=\"map-g-price-uah\">&thinsp;${goods.price.primary.unit}<\/span> <\/div> <div class=\"inline\" name=\"pickup_button\" data-goods_id=\"${goods.id}\" data-service_id=\"${service_id}\" data-pickup_id=\"${pickup_id}\" data-price_usd=\"${goods.price_usd}\"><\/div> <\/div> <\/div> {\/if} <\/div> <\/a>',balloon_tpl:'<div class=\"{if image_for_map}popup-map-baloon-wide{\/if}\"> {if required} {if points && points.length > 1} {var points_count_morph = [\'аптека\', \'аптеки\', \'аптек\']} {var plural_form = plural(points.length)} <h3 class=\"map-baloon-header\"><span class=\"bold\">${points.length} ${points_count_morph[plural_form]}<\/span> за адресою: ${address}<\/h3> {\/if} <div class=\"map-baloon-l\"> <div class=\"map-baloon-l-inner\"> {for point in points} <div class=\"map-baloon-l-i\"> {if point.image_for_map} <div class=\"map-baloon-l-i-img responsive-img\"> ${point.image_for_map} <\/div> {\/if} <div class=\"{if point.image_for_map}map-baloon-l-i-content{\/if}\"> <div class=\"map-baloon-l-i-adress bold\">${point.number}, ${point.pickup_title}<\/div> <address class=\"popup-map-baloon-address\">${point.address}<\/address> <p class=\"map-baloon-l-i-text\">${point.description}<\/p> <div class=\"map-g-wrap\"> <div class=\"map-g-price\">${point.goods.price.primary.decimals.toString().toPriceFormat()}&nbsp;<span class=\"map-g-price-uah\">${point.goods.price.primary.unit}<\/span><\/div> <div class=\"inline\" name=\"pickup_button\" data-goods_id=\"${point.goods.id}\" data-service_id=\"${point.service_id}\" data-pickup_id=\"${point.id}\" data-price_usd=\"${goods.price_usd}\"><\/div> <\/div> <\/div> <\/div> {\/for} <\/div> <\/div> {else} {if image_for_map} <div class=\"popup-map-baloon-img\">${image_for_map}<\/div> {\/if} <div class=\"popup-map-baloon-number\">${number}<\/div> <address class=\"popup-map-baloon-address\">${address}<\/address> <span class=\"popup-map-baloon-text\">${$decodeHtml(description)}<\/p> {\/if} <\/div>',nearest_tpl:'<div class=\"check-map-cities-text clearfix\" name=\"nearest\">Найближчі аптеки<\/div> <div class=\"check-map-cities-text clearfix\" name=\"other\">Другие аптеки<\/div>'},selectors:{pickups_list:'[name=pickups_list]'},slide_duration:300},_logo_image_url:null,_is_points_renew:true,_popup:null,_pickups_list:[],_current_pickup:null,_pickup_id_to_set_active:null,_office_number_to_id:{},_pickup_select_required:false,_service:{},_tmp_container:null,initialize:function(options){this.parent(options);document.addEvent('addWithPoint',this._hideNotifications.bind(this));App.addEvent('timedResize',this._resizeHandler.bind(this))},setNewPoints:function(points,service_image,required,service){var i;this._service=service;this._pickup_select_required=!!required;for(i=0;i<this._pickups_list.length;i++){if(this._pickups_list[i].place_mark){try{this._pickups_list[i].place_mark.setMap(null)}catch(e){}}}this._pickup_id_to_set_active=null;this._pickups_list=[];this._current_pickup=null;this.parent(points);this._is_points_renew=true;if(this._popup&&this._popup.elem){this._setServiceLogo(service_image);this._logo_image_url=service_image}else{this._logo_image_url=service_image}},getCurrentPickupId:function(){var result=null;if(this._current_pickup&&this._current_pickup.id){result=this._current_pickup.id}return result},setActivePickup:function(id){this._pickup_id_to_set_active=id},selectPickup:function(pickup_id){var index;this._pickups_list.each(function(elem,key){if(elem.id==pickup_id){index=key}});(index||index===0)&&this._onSelectPickupItem(index)},showNotification:function(name){this._popup.elem.getElement('[name="'+name+'"]').show()},updateUnavailable:function(name,data){var container=this._popup.elem.getElement('[name="'+name+'"]');container.getElement('[name="seller_title"]').setHTML(data.seller_title);container.getElement('[name="pickup_unavailable_address"]').setHTML(data.pickup_title);container=this._popup.elem.getElement('[name="unavailable_pickup"]');container.getElement('[name="number"]').setHTML(data.number);container.getElement('[name="title"]').setHTML(data.pickup_title);container.show()},showSelect:function(){this.select&&this.select._handlerLink()},show:function(){var popup=this._getPopup();popup.open();this._setServiceLogo(this._logo_image_url);popup.elem.addEvent('click',function(e){new Event(e).stop();this._hideNotifications()}.bind(this));this._showMap();if(this._pickup_id_to_set_active&&this._pickup_id_to_set_active!==""){this._setActivePickupItemById(this._pickup_id_to_set_active);this._pickup_id_to_set_active=null}else{this._setBounds(this._getBoundsForPoints());this._unSelectPickups();this._current_pickup=null}},fixScrollHeight:function(){var container=this._popup.elem.getElement(this.options.selectors.pickups_list),head=this._popup.elem.getElement('[name="ymap_head"]'),unavailable=container.getParent().getElement('[name="unavailable_pickup"]'),height=head.getParent().getParent().getSize().size.y;height-=head.getSize().size.y;if(unavailable){height-=unavailable.getSize().size.y}container.setStyle('max-height',height+'px')},_setPointAsUnSelected:function(place_mark){place_mark.setIcon({url:this.getMarkerImage(place_mark.id),labelOrigin:new google.maps.Point(18,20)});place_mark.setLabel(place_mark.label.text?{text:String(place_mark.label.text),fontSize:'15px',color:'#666'}:null)},_setActivePickupItemById:function(id){var i;if(id!==null){for(i=0;i<this._pickups_list.length;i++){if(this._pickups_list[i].id==id){this._onSelectPickupItem(i);this._openInfoWindow(id,this._pickups_list[i].place_mark)}}}},_resizeHandler:function(){if(this._current_pickup){this._current_pickup.slider.wrapper.setStyle('height','auto')}},_setServiceLogo:function(service_image){var img=this._popup.elem.getElement('div[name='+this.options.service_log_img+']');if(service_image){img.innerHTML=service_image;if(!img.hasClass(this.options.img_height_class)){img.addClass(this.options.img_height_class)}}else{img.removeClass(this.options.img_height_class);img.innerHTML=""}},_onSelectPickupItem:function(item_id){this._hideNotifications();if(this._current_pickup!=this._pickups_list[item_id]){this.closeBalloon();this._unSelectPickups(item_id);if(this._pickups_list[item_id].place_mark){this.setPointAsSelectedOnReady(this._pickups_list[item_id].place_mark)}else{this._setBounds(this._getBoundsForPoints())}this._pickups_list[item_id].slider.stop();this._pickups_list[item_id].slider.slideIn();this._pickups_list[item_id].slide_item.addClass('active');setTimeout(function(){var container=this._popup.elem.getElement(this.options.selectors.pickups_list),x=0,y=this._pickups_list[item_id].slide_item.offsetTop-container.getChildren().shift().offsetTop;new Fx.Scroll(container).scrollTo(x,y)}.bind(this),this.options.slide_duration);this._current_pickup=this._pickups_list[item_id]}},_unSelectPickups:function(active_item_id){var i;for(i=0;i<this._pickups_list.length;i++){if(i!=active_item_id){if(this._pickups_list[i].place_mark){this._setPointAsUnSelected(this._pickups_list[i].place_mark)}this._pickups_list[i].slider.stop();this._pickups_list[i].slider.slideOut();this._pickups_list[i].slide_item.removeClass('active')}}},_createPointSelectList:function(place_mark,id,office_number){var list_elem,pickups_div=this._popup.elem.getElement(this.options.selectors.pickups_list),list_item=pickups_div.getElement('[name=pickup_'+this._pickups_list.length+']'),control=list_item.getElement('[name=control]'),slide_elem=list_item.getElement('[name=slide_elem]'),slider=new Fx.Slide(slide_elem,{duration:this.options.slide_duration});slider.wrapper.setStyles({'margin':0,'height':'0px'});control.addEvent('click',function(place_mark,office_number,e){new Event(e).stop();this._onSelectPickupItem(control.getProperty('element_id'));if(place_mark){this._openInfoWindow(place_mark.id,place_mark)}if(control.getParentByName('nearest',3)){document.fireEvent('nearestPointClick')}}.bind(this,place_mark,office_number));list_elem={place_mark:place_mark,control:control,slide_elem:slide_elem,slider:slider,id:id,slide_item:list_item};this._pickups_list.push(list_elem)},_getIdByOfficeNumber:function(office_number){return this._office_number_to_id[office_number.toString()]},_setOfficeNumberToId:function(office_number,id){this._office_number_to_id[office_number.toString()]=id},_showMap:function(){this._setMap();if(!this._pickups_list.length&&this._is_points_renew){this._setPointsForMap();this._is_points_renew=false}},_getPopup:function(){if(!this._popup){this._popup=new Popup_class(this.options.popup.header_tpl);var count=0;this.points.each(function(point){if(point.points){count+=point.points.length}else{count++}});var popup_content=App.getHTML(this.options.popup.info_tpl,{service:this._service,need_pickup:this._pickup_select_required,count:count});this._popup.setContent(popup_content);this._popup.addEvent('close',function(e){this.fireEvent('pickup_selected',this.getCurrentPickupId());this._unSelectPickups()}.bind(this));if(this._pickup_select_required){if(PickupPointsMap.isOtherServicesLoaded()){if(PickupPointsMap.hasServices()){this.select=new PickupsSelectElement_class(this._popup.elem);this.select.init().addEvent('elementSelectOptionClick',function(e){var splitted=e.target.value.split('_');if(splitted[0]&&splitted[1]){PickupPointsMap.showPickups(splitted[0],splitted[1])}else{PickupPointsMap.showAll()}})}}else if(this._popup.getElement('[name="drop_link"]')){this._popup.getElement('[name="drop_link"]').addEvent('click',function(e){new Event(e).stop();PickupPointsMap.getOtherServices(this._service.goods_id,true)}.bind(this))}}}return this._popup},_setMap:function(){var map_recreated=this._recreate_map,points=this.points,active_pickup=this._pickup_id_to_set_active;this.parent();if(map_recreated){this.setNewPoints(points,this._logo_image_url,this._pickup_select_required,this._service);this.setActivePickup(active_pickup)}},_hideNotifications:function(){if(this._popup){this._popup.elem.getElement('[name="required"]').hide();this._popup.elem.getElement('[name="not_available"]').hide()}},_makePointOnMap:function(point,title){var place_mark=null,balloon_content=null,coordinates={lat:parseFloat(point.coordinates[0]),lng:parseFloat(point.coordinates[1])};if(this.map){point.required=!!(this._pickup_select_required&&point.goods);if(!point.points){point.points=[point]}balloon_content=new Element('div').setHTML(App.getHTML(this.options.popup.balloon_tpl,point));App.getService('PickupPointsAddButtonController').initButtons(balloon_content);place_mark=new google.maps.Marker({position:coordinates,map:this.map,label:title?{text:String(title),fontSize:'15px',color:'#666'}:null,title:point.title,icon:{url:this.getMarkerImage(title),labelOrigin:new google.maps.Point(18,20)}});place_mark.id=point.id;var info_window=new google.maps.InfoWindow({content:balloon_content});this._addInfoWindow(place_mark.id,info_window);google.maps.event.addListener(place_mark,"click",function(id,place_mark,e){this._onSelectPickupItem(this._getIdByOfficeNumber(place_mark.id));this._openInfoWindow(place_mark.id,place_mark)}.bind(this,title,place_mark))}return place_mark},_setPointsForMap:function(){var i,place_mark=[],current_point;if(this.points){this._emptyPickupsListContent();this._createTmpContainer();for(i=0;i<this.points.length;i++){current_point=this.points[i];this._injectServiceHeader(i);if(!current_point.office_number){current_point.office_number=i+1}if(current_point.coordinates&&current_point.coordinates[0]&&current_point.coordinates[1]){place_mark[i]=this._makePointOnMap(current_point,current_point.office_number);this._setOfficeNumberToId(place_mark[i].id,i)}this._createItemDiv(current_point,i)}this._setPickupsListContent();this._destroyTmpContainer();App.getService('PickupPointsAddButtonController').initButtons(this._popup.elem);for(i=0;i<this.points.length;i++){this._createPointSelectList(place_mark[i],this.points[i].id,this.points[i].office_number)}this._setMarkerCluster(place_mark)}},_injectServiceHeader:function(current_point_index){},_shouldOldPriceBeShown:function(goods){return goods&&goods.old_price&&Math.round(goods.old_price.primary.raw)>Math.round(goods.price.primary.raw)},_prepareDataToCreateItemDiv:function(current_point,i){var data={title:current_point.title,description:current_point.description,id:i,office_number:current_point.office_number,required:!!(this._pickup_select_required&&current_point.goods),goods:current_point.goods,pickup_id:current_point.id,service_id:current_point.service_id,selected:null,old_price_should_be_shown:this._shouldOldPriceBeShown(current_point.goods)};if(data.required&&current_point.goods&&current_point.goods.seller_id&&S.data&&S.data.pickups_by_seller&&S.data.pickups_by_seller.length&&S.data.pickups_by_seller.filter(function(elem){return elem.seller_id==current_point.goods.seller_id&&elem.pickup_id==current_point.id}).length){data.selected=selected}return data},_createItemDiv:function(current_point,i){var data=this._prepareDataToCreateItemDiv(current_point,i);if(current_point.has_unavailable){if(this._tmp_container.textContent==''){this._tmp_container.textContent=App.getHTML(this.options.popup.nearest_tpl,{})}if(current_point.nearest){this._tmp_container=this._tmp_container.getElement('[name="nearest"]')}else{this._tmp_container=this._tmp_container.getElement('[name="other"]')}}this._tmp_container.textContent+=App.getHTML(this.options.popup.pickups_tpl,data)},_createTmpContainer:function(){this._destroyTmpContainer();this._tmp_container=new Element('div')},_destroyTmpContainer:function(){if(this._tmp_container){this._tmp_container.empty();this._tmp_container=null}},_setPickupsListContent:function(){var pickups_div=this._popup.elem.getElement(this.options.selectors.pickups_list);if(pickups_div){pickups_div.innerHTML=this._tmp_container?this._tmp_container.textContent:''}},_emptyPickupsListContent:function(){var pickups_div=this._popup.elem.getElement(this.options.selectors.pickups_list);pickups_div&&pickups_div.empty()}});var GTMData_Storage_class=new Class({_storage:{'goods':[],'kit':[]},default_type:'goods',goods_id:null,initialize:function(){this.attachToObserver(['LoadGTMData'])},onLoadGTMData:function(data){if(data){Object.values(data).each(function(record){record.id&&this.setGoodsData(record.id,record)}.bind(this))}},setGoodsData:function(id,data,type){var resulted_type=type||this.default_type;if(this.existGoodsData(id,resulted_type)){this._storage[resulted_type][id]=Object.merge(this.getGoodsData(id,resulted_type),Object.clone(data))}else{this._storage[resulted_type][id]=data}},setGoodsDataOnce:function(id,key,value,type){var obj={};obj[key]=value;this._storage[type||this.default_type][id]=obj},getGoodsData:function(id,type){var source_type=type||this.default_type;return this._storage[source_type][id]||null},getGoodsDataField:function(id,field,type){var source_type=type||this.default_type;return(this._storage[source_type][id]&&this._storage[source_type][id][field])?this._storage[source_type][id][field]:null},existGoodsData:function(id,type){return!!this._storage[type||this.default_type][id]},removeGoodsData:function(id,type){var source_type=type||this.default_type;if(this._storage[source_type][id]){delete this._storage[source_type][id]}},setGoodsId:function(id){this.goods_id=parseInt(id,10)},getGoodsId:function(){return this.goods_id}});GTMData_Storage_class.implement(new Events());var GTMData_Banners_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_Banners_class',data:[],mini_promo_position:1,options:{GTM:{events:{click_promo:{event_name:'clickPromo',extend_event:[{name:'eventAction',handler:'getAction'},{name:'promoContext',handler:'getContext'},{name:'promoContent',handler:'getContent'},{name:'eventPosition',handler:'getPosition'},{name:'eventLocation',handler:'getLocation'}]},switch_promo:{event_name:'switchPromo',extend_event:[{name:'eventAction',handler:'getAction'},{name:'eventContext',handler:'getContext'},{name:'eventContent',handler:'getContent'},{name:'eventPosition',handler:'getPosition'}]},show_promo:{event_name:'showPromo',extend_event:[{name:'eventAction',handler:'getAction'},{name:'eventContext',handler:'getContext'},{name:'eventContent',handler:'getContent'},{name:'eventPosition',handler:'getPosition'},{name:'eventNoninteraction',value:1}]},show_stretch:{event_name:'showStretch',extend_event:[{name:'eventAction',handler:'getAction'},{name:'eventContext',handler:'getContext'},{name:'eventContent',handler:'getContent'},{name:'eventNoninteraction',value:1}]},click_stretch:{event_name:'clickStretch',extend_event:[{name:'eventAction',handler:'getAction'},{name:'promoContext',handler:'getContext'},{name:'promoContent',handler:'getContent'},{name:'eventLocation',handler:'getLocation'}]},show_promo_banners:{event_name:'initialShowPromo',extend_event:[{name:'eventAction',value:'show'},{name:'eventCategory',value:'Interactions'},{name:'eventLabel',value:'banner'},{name:'eventNoninteraction',value:1},{name:'promotionImpressions',handler:'getPromotionImpressions'}]},close_update:{event_name:'closeUpdate',extend_event:[{name:'eventLabel',value:'closeUpdate'},{name:'eventAction',value:'click'},{name:'eventCategory',value:'Interactions'}]},update_browser:{event_name:'updateBrowser',extend_event:[{name:'eventLabel',value:'updateBrowser'},{name:'eventAction',value:'click'},{name:'eventCategory',value:'Interactions'}]},pagination_click_big_promo:{event_name:'switchPaginationPromo',extend_event:[{name:'eventAction',value:'switch'},{name:'eventContext',handler:'getContext'},{name:'eventContent',handler:'getContent'},{name:'eventPosition',handler:'getPosition'}]}}}},base_GTM_event:{eventCategory:'Interactions',eventLabel:'banner'},initialize:function(){this.attachToObserver(['switchBigPromo','clickBanner']);App.addOnDomReady(this._fireImpressionEvent.bind(this))},onSwitchBigPromo:function(e){if(App.domIsReady){this.setEventData(e[0],'big_promo',null,'Promo',e[1],e[2]?e[2]:null,e[3])}else{this.setEventDataImpression(e[0],'big_promo',null,'Promo',e[1],e[2]?e[2]:null,e[3])}},onClickBanner:function(e){if(App.domIsReady){this.setEventData(e[0],e[1],e[2],e[3],null,e[4])}else{this.setEventDataImpression(e[0],e[1],e[2],e[3],null,e[4])}},setEventData:function(content,context,elem,name,position,action,location){this.data=this.getPromotionData(content,context,position,action,location);if(this.data.eventAction=='switch'&&context=='big_promo'){document.fireEvent(this.data.eventAction+'Pagination'+name)}else if(this.data.eventAction!='show'){document.fireEvent(this.data.eventAction+name)}if(this.isImg(elem)){this.bindClickListeners(elem,content,name,this.data)}},isImg:function(elem){return elem&&elem.getElement('img')&&elem.getElement('img').getAttribute('alt')},bindClickListeners:function(elem,content,name,event_data){var data=[];data[content]=event_data;elem.getElement('img').addEvent('click',function(){this.data=data[elem.getElement('img').getAttribute('alt')];this.data['eventAction']='click';document.fireEvent('click'+name)}.bind(this))},getPromotionData:function(content,context,position,action,location){var data={eventAction:action||'show',promoContent:content,promoContext:context,eventLocation:location};if(position&&context!='mini_promo'){data['eventPosition']=position}else if(context=='mini_promo'){data['eventPosition']=this.mini_promo_position;this.mini_promo_position++}return data},setEventDataImpression:function(content,context,elem,name,position,action,location){var promotionImpression=this.getPromotionData(content,context,position,action,location);if(!this.data['promotionImpressions']){this.data['promotionImpressions']=[]}this.data['promotionImpressions'].push(promotionImpression)},_fireImpressionEvent:function(){if(this.data['promotionImpressions']){document.fireEvent('initialShowPromo')}},getAction:function(){return this.data.eventAction},getContext:function(){return this.data.promoContext},getContent:function(){return this.data.promoContent},getPosition:function(){return this.data.eventPosition},getPromotionImpressions:function(){return this.data.promotionImpressions},getLocation:function(){return this.data.eventLocation||'fat-menu'}});GTMData_Banners_class.implement(new Events);var GTMData_FatMenu_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_FatMenu_class',options:{GTM:{events:{banner_click:{event_name:'fatmenuBigBannerClick',extend_event:[{name:'eventLabel',value:'banner'},{name:'eventContext',value:'big_promo'},{name:'eventContent',handler:'getBannerTitle'},{name:'eventLocation',value:'fat-menu'}]},menu_elem_click:{event_name:'fatmenuLinkClick',extend_event:[{name:'eventLocation',handler:'getElementNestingLevel'},{name:'eventContent',handler:'getElementType'},{name:'eventContext',handler:'getTabTitle'},{name:'eventLabel',value:'fat-menu'},{name:'eventField',handler:'getElementHref'}]},scroll_click_main:{event_name:'fatmenuControls1Click',extend_event:[{name:'eventAction',value:'scroll'},{name:'eventLabel',value:'fat-menu'},{name:'eventLocation',value:'level2'}]},register_popup:{event_name:'registerPopup',extend_event:[{name:'eventLabel',value:'registerPopup'},{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLocation',handler:'getPageType'}]},close_register_popup:{event_name:'closeRegisterPopup',extend_event:[{name:'eventLabel',value:'closeRegisterPopup'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLocation',handler:'getPageType'}]},success_registration:{event_name:'successRegistration',extend_event:[{name:'eventLabel',value:'successRegistration'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'send'},{name:'eventLocation',handler:'getPageType'}]},error_register_popup:{event_name:'errorRegisterPopup',extend_event:[{name:'eventLabel',value:'errorRegisterPopup'},{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'error'},{name:'eventLocation',handler:'getPageType'}]}}}},base_GTM_event:{eventLocation:'fat-menu',eventAction:'click',eventCategory:'Interactions'},getPageType:function(){var result='WishList';if(dataLayer&&dataLayer[0]&&$defined(dataLayer[0].pageType)&&dataLayer[0].pageType){result=dataLayer[0].pageType}return result},getBannerTitle:function(e){var target=new Event(e).target;return target.getTag()==='img'?target.getProperty('alt'):target.getProperty('title')},getElementHref:function(e){var target=new Event(e).target;return target.getProperty('href')},getElementNestingLevel:function(e){var target=new Event(e).target;return target.getProperty('data-level')},getElementType:function(e){var target=new Event(e).target;return target.getProperty('data-type')},getElemNovelty:function(e){var target=new Event(e).target;return target.getProperty('is_new')},getTabTitle:function(e){var target=new Event(e).target;return target.getText()}});var GTMData_Language_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_Language_class',options:{GTM:{events:{showPopupLanguage:{event_name:'showPopupLanguage',extend_event:[{name:'eventLabel',value:'uaLanguagePopup'},{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'}]}}}}});var GTMData_Footer_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_Footer_class',options:{GTM:{events:{click_app_footer:{event_name:'clickAppFooter',extend_event:[]},footer_subscribes:{event_name:'footerSubscribes',extend_event:[]}}}},base_GTM_event:{eventCategory:'Conversions',eventAction:'click'}});var GTMData_SocialLinkPopup_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_SocialLinkPopup_class',options:{GTM:{events:{linkFacebook:{event_name:'showHeaderSocialPopup',container:'social_popup',selector:'[type=facebook]',extend_event:[{name:'eventLabel',value:'linkFacebook'}]},linkGoogle:{event_name:'showHeaderSocialPopup',container:'social_popup',selector:'[type=google]',extend_event:[{name:'eventLabel',value:'linkGoogle'}]},linkVkontakte:{event_name:'showHeaderSocialPopup',container:'social_popup',selector:'[type=vkontakte]',extend_event:[{name:'eventLabel',value:'linkVkontakte'}]},closeLinkSocial:{event_name:'showHeaderSocialPopup',container:'social_popup',selector:'[name=close]',extend_event:[{name:'eventLabel',value:'closeLinkSocial'}]},social:{event_name:'loginSuccessSocialPopup',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'signup'},{name:'eventLabel',value:'social'}]}}}},base_GTM_event:{eventCategory:'Interactions',eventAction:'click',eventLocation:'popUp'}});App.addOnDomReady(function(){window['GTMEvents']&&GTMEvents.initDataBlocks([new GTMData_SocialLinkPopup_class()])});var GTMData_AuthBlocks_class=GTMData_BaseAbstract_class.extend({options:{GTM:{events:{get_temp_pass:{event_name:'authBlocksGetTempPass',extend_event:[{name:'eventAction',value:'click'},{name:'eventLabel',value:'getTempPassword'},{name:'eventValue',value:1}]},remembered_password:{event_name:'authBlocksRememberedPassword',extend_event:[{name:'eventAction',value:'click'},{name:'eventLabel',value:'rememberedPassword'}]},forgot_password:{event_name:'authBlocksForgotPassword',extend_event:[{name:'eventAction',value:'click'},{name:'eventLabel',value:'forgotPassword'}]},blocks_opened:{event_name:'authBlocksOpened',extend_event:[{name:'eventAction',value:'open'},{name:'eventLabel',value:'popup'}]},email_exists:{event_name:'authBlocksEmailExists',extend_event:[{name:'eventAction',value:'error'}]},successful_signin:{event_name:'authBlocksSignIn',extend_event:[{name:'eventAction',value:'signin'}]},wrong_password:{event_name:'authBlocksWrongPassword',extend_event:[{name:'eventAction',value:'error'},{name:'eventLabel',value:'wrongPassword'}]},signin_failed:{event_name:'signInFailed',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'signfail'},{name:'eventLabel',handler:'getEventLabel'},{name:'eventError',handler:'getEventError'},{name:'eventContext',handler:'getEventContext'},{name:'userPhoneNumberHash',handler:'getUserPhoneNumberHash'},]},showPhoneConfirmBlock:{event_name:'showPhoneConfirmBlock',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'phoneAuthBlock'}]},signUpConfirmPhone:{event_name:'signUpConfirmPhone',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'ConfirmPhone'}]},getAnotherConfirmCode:{event_name:'getAnotherConfirmCode',extend_event:[{name:'eventCategory',value:'Interactions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'getAnotherCode'}]}}}},base_GTM_event:{eventCategory:'Interactions'},getEventLabel:function(data){return data.eventLabel||null},getEventError:function(data){return data.eventError||null},getEventContext:function(data){return data.eventContext||null},getUserPhoneNumberHash:function(data){return data.userPhoneNumberHash||null}});App.addOnDomReady(function(){window['GTMEvents']&&GTMEvents.initDataBlocks([new GTMData_AuthBlocks_class()])});var GTMData_BannerApplication_class=GTMData_BaseAbstract_class.extend({options:{GTM:{events:{show_popup:{event_name:'ShowPopupBannerApp',extend_event:[{name:'eventAction',value:'show'},{name:'eventLabel',value:'popupApp'},{name:'eventContent',handler:'getEventContent'},{name:'eventLocations',value:'popupApp'},{name:'eventNoninteraction',value:1}]},close_popup:{event_name:'ClosePopupBannerApp',extend_event:[{name:'eventAction',value:'click'},{name:'eventLabel',value:'closePopupApp'},{name:'eventContent',handler:'getEventContent'},{name:'eventLocations',value:'popupApp'}]},continue_popup:{event_name:'ContinuePopupBannerApp',extend_event:[{name:'eventAction',value:'click'},{name:'eventLabel',value:'continueFullVersion'},{name:'eventContent',handler:'getEventContent'},{name:'eventLocations',value:'popupApp'}]},open_app_popup:{event_name:'OpenPopupBannerApp',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openApp'},{name:'eventContent',handler:'getEventContent'},{name:'eventLocations',value:'popupApp'}]},open_app_banner:{action:'click',selector:'[name=app-banner-open-app]',extend_event:[{name:'eventCategory',value:'Conversions'},{name:'eventAction',value:'click'},{name:'eventLabel',value:'openApp'},{name:'eventContent',handler:'getEventContent'},{name:'eventLocations',value:'smartBanner'}]}}}},base_GTM_event:{eventCategory:'Interactions'},_os_mapper:{'AndroidOS':'android','iOS':'iOs'},getEventContent:function(){var service=App.getService('mobileDetector'),os;if(service!==null){os=service()}return this._os_mapper.hasOwnProperty(os)?this._os_mapper[os]:null}});var GTMData_Forms_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_Forms_class',options:{GTM:{events:{'form_sent_error':{event_name:'formSentError',extend_event:[{name:'eventAction',value:'send'},{name:'eventLabel',value:'error'}]},'form_sent_success':{event_name:'formSentSuccess',extend_event:[{name:'eventAction',value:'send'},{name:'eventLabel',value:'successful'}]},'form_activation':{event_name:'formActivation',extend_event:[{name:'eventAction',value:'send'},{name:'eventLabel',value:'activation'}]}}}},base_GTM_event:{event:'OWOX',eventCategory:'Forms / Fields',eventAction:'click'},initialize:function(){this.attachToObserver(['formPopupOpen','LoadTabContent','LoadBodyPage','signInFailed']);App.addOnDomReady(function(){this._initEvents()}.bind(this))},_initEvents:function(container){container=!container?document:container;container.getElements('form[data-collect_errors="1"]').each(function(form,index){if(form.getFormElements().length>0){form.addEvents({'onFieldsCheckFailed':function(fields_data){var extend_event=this._prepareFormData([],form),message_content='';if(fields_data){fields_data.each(function(field){message_content=((field.getProperty('_required')||field.getProperty('required'))&&field.value.trim()=='')?'required':'pattern';extend_event.push({name:'eventField',value:this._getFieldTitle(field)});extend_event.push({name:'eventError',value:message_content+' / validation'});document.fireEvent('formSentError',{extend_event:extend_event})}.bind(this))}}.bind(this),'onAfterComplete':function(resp){var response=new Response_class(resp),extend_event=this._prepareFormData([],form),message_content='',is_success=true,message_content_parts=[];if(response){if(response.Message){is_success=response.Message.isDone();if(response.Message.content){message_content=response.Message.content;message_content_parts=message_content.split("\n");message_content=message_content_parts[0]}}else{is_success=response.isDone()||response.isVoid()}}else{is_success=false;message_content='Сервер не вернул ответ'}if(is_success){document.fireEvent('formSentSuccess',{extend_event:extend_event})}else{message_content+=message_content?' / ':'';extend_event.push({name:'eventError',value:message_content+'server'});document.fireEvent('formSentError',{extend_event:extend_event})}}.bind(this)});form.getFormElements().each(function(field){field.addEventOnce('focus',function(){var extend_event;if(form.getProperty('data-form_checker_status')!='actived'){form.setProperty('data-form_checker_status','actived');extend_event=this._prepareFormData([],form);extend_event.push({name:'eventField',value:this._getFieldTitle(field)});document.fireEvent('formActivation',{extend_event:extend_event})}}.bind(this))}.bind(this))}form.removeProperty('data-collect_errors')}.bind(this))},_prepareFormData:function(extend_event,form){var form_title=this._getFormTitle(form);if(form_title){extend_event.push({name:'eventForm',value:form_title})}else{extend_event.push({name:'eventLocation',value:window.location.href})}return extend_event},_getFormTitle:function(form){return form.getProperty('data-title')||form.getProperty('title')||form.getProperty('name')},_getFieldTitle:function(field){return field.getProperty('data-title')||field.getProperty('title')||field.getProperty('name')},onFormPopupOpen:function(data){var form=data[0].form;if(form){this._initEvents(form.getParent())}},onLoadTabContent:function(tab_content_data){if(tab_content_data&&tab_content_data[0]&&tab_content_data[0].getElement('[name="comments_container"]')){this._initEvents(tab_content_data[0])}},onLoadBodyPage:function(data){if(Object.getLength(data)>0){Object.each(data,function(child){this._initEvents(child)}.bind(this))}},onSignInFailed:function(resp){var extend_event=[];if(resp&&resp[0]&&resp[0].response&&resp[0].response.content){extend_event.push({name:'eventError',value:resp[0].response.content+' / server'});document.fireEvent('formSentError',{extend_event:extend_event})}}});GTMData_Forms_class.implement(new Events());var GTMData_AutoCityChoose_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_AutoCityChoose_class',options:{GTM:{events:{autoCityChoose:{event_name:'autoCityChoose',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'auto'},{name:'eventLabel',value:'cityChoose'}]}}}}});var ShowMoreClass=new Class({text:null,link:null,options:{cssClasses:{boxHide:"box-hide"}},initialize:function(linkId,textId,restore_state){this.text=$(textId);this.link=$(linkId);this.link.addEvent("click",function(event){event.preventDefault();this.show();document.fireEvent('descriptionMore');this.fireEvent('show')}.bind(this));restore_state&&this.text.addClass(this.options.cssClasses.boxHide);this.checkLink();if(!this.isNeedShowLink()){this.show()}},isNeedShowLink:function(){return this.text.getCoordinates().height>=parseInt(this.text.getStyle('max-height'),10)},show:function(event){this.text.removeClass(this.options.cssClasses.boxHide);this.checkLink()},checkLink:function(){this.isNeedShowLink()?this.link.show():this.link.hide()}});ShowMoreClass.implement(new Events());var ShowMoreSeoClass=ShowMoreClass.extend({layout:null,container:null,options:{cssClasses:{layoutFixId:"layout_fix",textContainerId:"text-description-page"}},initialize:function(linkId,textId,restore_state){this.parent(linkId,textId,restore_state);this.layout=$(this.options.cssClasses.layoutFixId);this.container=$(this.options.cssClasses.textContainerId);this.setHeight();App.addEvent('timedLastResize',this.setHeight.bind(this))},setHeight:function(){this.layout&&this.layout.setStyle('height',this.container.clientHeight)},show:function(){this.parent();this.setHeight()},update:function(){this.text.addClass(this.options.cssClasses.boxHide);this.checkLink();this.setHeight()}});OutdatedBrowserBanner_class=RozetkaStretchBanner.extend({_navigator:navigator.userAgent,options:{cookie_name:'banner_outdated_browser_disable',cookie_options:{duration:0,path:'/'}},getActualBanner:function(){var i,u,re;if(this._banners.length&&!this._actual_banner){find:for(i=0;i<this._banners.length;i++){for(u=0;u<this._banners[i].regular_expressions.length;u++){re=new RegExp(this._banners[i].regular_expressions[u],'gim');if(re.exec(this._navigator)){this._actual_banner=this._banners[i];break find}}}}return this._actual_banner},_setGTMEvents:function(){this.parent();if(this.getContainer('banner_place').getElement('a')){this.getContainer('banner_place').getElement('a').addEvent('click',function(){document.fireEvent('updateBrowser')})}if(this.getContainer('close_block').getElement('a')){this.getContainer('close_block').getElement('a').addEvent('click',function(){document.fireEvent('closeUpdate')})}},isDisable:function(){return(this.getActualBanner()&&!this._checkCookie())}});var SlideEffect_class=new Class({_slider:null,_is_visible:true,_is_transitory:false,initialize:function(elem){this._slider=new Fx.Slide(elem);this._slider.addEvent('onComplete',function(){this._is_transitory=false}.bind(this))},show:function(){if(!this._is_transitory&&!this._is_visible){this._is_transitory=true;this._slider.slideIn();this._is_visible=true}},hide:function(){if(!this._is_transitory&&this._is_visible){this._is_transitory=true;this._slider.slideOut();this._is_visible=false}},toggle:function(){if(!this._is_transitory){this._is_transitory=true;if(this._is_visible){this._slider.slideOut();this._is_visible=false}else{this._slider.slideIn();this._is_visible=true}}}});var PopupEffect_class=new Class({options:{tpl:'<div> <div name=\"content\"><\/div> <\/div>',overlay:{enabled:false,background:'#fff',zindex:200}},_popup:null,_elem_name:null,initialize:function(elem,options){if(options!=undefined&&options.is_absolute==true){this._popup=new Popup_class(this.options.tpl)}else{this._popup=new Popup_class(this.options.tpl,elem)}if(options&&options.overlay&&options.overlay.enabled){this._popup.overlayON({styles:{'z-index':this.options.overlay.zindex,'background-color':this.options.overlay.background}})}if(elem.innerHTML!=undefined&&elem.innerHTML){this._popup.setContent(elem.innerHTML)}elem.innerHTML='';elem.removeClass('hidden');this._elem_name=elem.getAttribute('name');this._popup.addEvent('close',function(){document.fireEvent('closePopup_'+this._elem_name)}.bind(this))},show:function(){if(!this._popup.isOpened()){this._popup.open()}else{this._popup.close()}},hide:function(){this._popup.close()}});var StyleEffect_class=new Class({_is_visible:true,_elem:null,_class_show:null,_class_hide:null,initialize:function(elem){this._elem=elem;this._class_show=this._elem.getAttribute('class_show');this._class_hide=this._elem.getAttribute('class_hide')},show:function(){if(!this._is_visible){this._elem.setAttribute('class',this._class_show);this._is_visible=true}},hide:function(){if(this._is_visible){this._elem.setAttribute('class',this._class_hide);this._is_visible=false}},toggle:function(){if(this._is_visible){this._elem.setAttribute('class',this._class_hide);this._is_visible=false}else{this._elem.setAttribute('class',this._class_show);this._is_visible=true}}});var ElementEffect_class=new Class({options:{attribute_name:'effect_type',effect_id_attribute:'effect_id'},effect_element:{},effect_id_counter:0,initialize:function(options){if(options){this.setOptions(options)}},init:function(){var elements=document.getElements("["+this.options.attribute_name+"]");elements.forEach(function(elem){if(this._getEffect(elem)==undefined){this._createEffect(elem.getAttribute(this.options.attribute_name),elem)}}.bind(this))},removeHidden:function(){var elements=document.getElements("["+this.options.attribute_name+"]");elements.forEach(function(elem){elem.removeClass('hidden')})},_createEffect:function(effect_name,elem){var result=undefined;if(effect_name!=undefined){switch(effect_name){case'slide':result=this.effect_element[this.effect_id_counter]=new SlideEffect_class(elem);break;case'popup':result=this.effect_element[this.effect_id_counter]=new PopupEffect_class(elem);break;case'absolute_popup':result=this.effect_element[this.effect_id_counter]=new PopupEffect_class(elem,{is_absolute:true});break;case'absolute_overlay_popup':result=this.effect_element[this.effect_id_counter]=new PopupEffect_class(elem,{is_absolute:true,overlay:{enabled:true}});break;case'style':result=this.effect_element[this.effect_id_counter]=new StyleEffect_class(elem);break;default:console.log('В '+elem+' задан не существующий эффект');break}elem.setAttribute(this.options.effect_id_attribute,this.effect_id_counter);this.effect_id_counter=this.effect_id_counter+1}return result},show:function(elem){var effect=this._getEffect(elem);if(effect!=undefined){effect.show()}else{elem.show()}return effect||elem},hide:function(elem){var effect=this._getEffect(elem);if(effect==undefined){effect=this._createEffect(elem.getAttribute(this.options.attribute_name),elem)}if(effect==undefined){elem.hide()}else{effect.hide()}return effect||elem},toggle:function(elem){var effect=this._getEffect(elem);if(effect==undefined){effect=this._createEffect(elem.getAttribute(this.options.attribute_name),elem)}if(effect==undefined){elem.toggle()}else{effect.toggle()}return effect||elem},_getEffect:function(elem){var effect,effect_num=elem.getAttribute(this.options.effect_id_attribute);if(effect_num!=undefined){effect=this.effect_element[effect_num]}return effect}});ElementEffect_class.implement(new Events);var RozetkaSplashBoxClass=new Class({Class:'RozetkaSplashBoxClass',options:{selectors:{button:'[name=splash-button]',popup:'[name=splash-popup]'},hide_class:'hidden',delayBefore:400,delayAfter:600},_container:null,_button:null,_timer:0,_on_show_gtm_event:null,initialize:function(container,on_show_gtm_event){this._container=container;this.on_show_gtm_event=on_show_gtm_event;this.attachToObserver(['ShowingSplashPopup'])},init:function(){this._button=this._container.getElement(this.options.selectors.button);this._button.removeEvents('click');if(App.isDesktop()){this._container.addEvent('mouseenter',this._onButtonMouseEnter.bind(this));this._container.addEvent('mouseleave',this._onContainerMouseLeave.bind(this))}else{this._button.addEvent('click',this._onButtonClick.bind(this));document.body.addEvent('click',this._hidePopup.bind(this))}return this},onShowingSplashPopup:function(data){if(data[0]!==this){this._hidePopup()}},_onButtonMouseEnter:function(e){clearTimeout(this._timer);this._timer=setTimeout(this._showPopup.bind(this),this.options.delayBefore)},_onContainerMouseLeave:function(e){clearTimeout(this._timer);this._timer=setTimeout(this._hidePopup.bind(this),this.options.delayAfter)},_onButtonClick:function(e){if(!this._isVisible()){new Event(e).stop();this._showPopup()}},_showPopup:function(){var popup=this.getPopup();clearTimeout(this._timer);if(popup&&!this._isVisible()){if(this.on_show_gtm_event){document.fireEvent(this.on_show_gtm_event)}this.fireEvent('ShowingSplashPopup',this);popup.removeClass(this.options.hide_class)}},_hidePopup:function(){var popup=this.getPopup();if(popup&&this._isVisible()){popup.addClass(this.options.hide_class)}},_isVisible:function(){var popup=this.getPopup();return(popup&&!popup.hasClass(this.options.hide_class))},getPopup:function(){return this._container.getElement(this.options.selectors.popup)}});RozetkaSplashBoxClass.implement(new Events(),new Options());var RozetkaSplashCartBoxClass=RozetkaSplashBoxClass.extend({Class:'RozetkaSplashCartBoxClass',_cart:null,hide_popup:false,initialize:function(container,cart_object){this.parent(container);this._cart=cart_object},init:function(){this.parent();if(App.isDesktop()){this._button.addEvent('click',this._onButtonClick.bind(this))}document.addEvent("miniCartBlockShowed",this.onMiniCartBlockShowed.bind(this));return this},_onButtonClick:function(e){new Event(e).stop();if(!App.isDesktop()){if(this._isVisible()){this._hidePopup();this._openCart()}else{this._showPopup()}}else{this._openCart()}},_openCart:function(){this._cart.openCart()},onMiniCartBlockShowed:function(event){if(event.id=='sidebar-cart-block-content'){this.hide_popup=true}else{this.hide_popup=false}},_showPopup:function(){if(!this.hide_popup||this._cart.empty()){this.parent()}}});RozetkaSplashCartBoxClass.implement(new Events(),new Options());var CSRF_TokenManager_class=new Class({Binds:['_filterFormToInjectCSRFToken','_addTokenInputToForm'],Class:'CSRF_TokenManager_class',options:{token_cookie_name:'uid',token_field_name:'request_token',protect_always:'1',csrf_sign_form:'data-secure-csrf'},initialize:function(){this.attachToObserver(['contentUpdate','LoadTabCompleted','LoadBodyPage','lightBoxCommentCreated']);App.addEvent('listenDomNodeInsert',function(){if(window['MutationObserver']){new MutationObserver(this.onMutationObserveDOMNodeInserted.bind(this)).observe(document.body,{childList:true,subtree:true,characterData:false,attributes:false})}else{document.addEventListener('DOMNodeInserted',this.onDOMNodeInserted.bind(this))}}.bind(this))},addProtect:function(container){var container_to_protect=container||$(document.body);container_to_protect.getElements('form').filter(this._filterFormToAttribute.bind(this)).filter(this._filterFormToInjectCSRFToken.bind(this)).each(this._addTokenInputToForm.bind(this))},updateProtect:function(container){var container_to_protect=container||$(document.body);container_to_protect.getElements('form').filter(this._filterFormToAttribute.bind(this)).each(this._updateTokenInput.bind(this))},_addTokenInputToForm:function(form,index,all_forms){form.appendChild(new Element('input',{type:'hidden',name:this.options.token_field_name,value:this.getToken()}))},_updateTokenInput:function(form,index,all_forms){$(form).getElements('input[name='+this.options.token_field_name+']').each(function(input){input.value=this.getToken()}.bind(this))},getTokenForAjax:function(){var result={};result[this.options.token_field_name]=this.getToken();return result},_filterFormToInjectCSRFToken:function(form,index,all_forms){return!$(form).getElements('input[name='+this.options.token_field_name+']').length&&(!form.getAttribute('method')||form.getAttribute('method').toLowerCase()!=='get')},onContentUpdate:function(elem){this.addProtect(elem[0])},onLightBoxCommentCreated:function(container){this.addProtect(container[0])},onLoadTabCompleted:function(arg){this.addProtect()},onDOMNodeInserted:function(event){var target_element=event.target||event.srcElement;if(target_element.tagName==='FORM'&&this._filterFormToInjectCSRFToken(target_element)){this._addTokenInputToForm(target_element)}},onMutationObserveDOMNodeInserted:function(mutationRecordsList){var form_node;mutationRecordsList.forEach(function(mutationRecord){if(mutationRecord.addedNodes.length){form_node=this._getFormNode(mutationRecord.addedNodes);if(form_node&&this._filterFormToInjectCSRFToken(form_node)){this._addTokenInputToForm(form_node)}}}.bind(this))},_getFormNode:function(nodes){var result='';for(var i=0;i<nodes.length;i++){if(nodes[i].tagName==='FORM'){result=nodes[i];break}}return result},_filterFormToAttribute:function(form){return form.getAttribute(this.options.csrf_sign_form)==='1'||this.options.protect_always==='1'},onLoadBodyPage:function(data){if(Object.getLength(data)>0){Object.each(data,function(child){this.addProtect(child)}.bind(this))}},getToken:function(){return Cookie.get(this.options.token_cookie_name)}});CSRF_TokenManager_class.implement(new Events());var KitsConstructor_class=new Class({Class:'KitsConstructor_class',_units:{},_kit_costs:{},_kit_unit_goods_ids:{},_current_units_goods_ids:{},_code_element:null,options:{price_block_id_prefix:'kit_price',code_block_id_prefix:'kit_code',from_cart:0,url:window.location.protocol+"//"+window.location.hostname+'/kits_costs/'},catalog_item:null,initialize:function(catalog_item,options){var source_data=catalog_item.getSource().getData();this.setOptions(options);this._kit_unit_goods_ids=this.options.goods_ids;this.catalog_item=catalog_item;this._current_units_goods_ids=source_data.unit_ids;this._kit_costs={};if(!source_data.main_kit_id){source_data.main_kit_id=source_data.kit_id}this._cacheData(source_data.main_kit_id)},changeCurrentState:function(unit_id,position){var units_hash,url,similar_unit_id,source_data=this.catalog_item.getSource().getData(),price_block=this._getPriceBlockSelector(source_data),code_block=this._getCodeBlockSelector(source_data);similar_unit_id=this._kit_unit_goods_ids[unit_id][position]['unit_id'];Object.each(this._kit_unit_goods_ids[unit_id],function(pos){delete this._current_units_goods_ids[pos['unit_id']]}.bind(this));this._current_units_goods_ids[similar_unit_id]=this._kit_unit_goods_ids[unit_id][position]['id'];source_data.unit_ids=this._current_units_goods_ids;source_data.kit_id=this._kit_unit_goods_ids[unit_id][position]['kit_id'];units_hash=this._getCurrentUnitsHash();if(code_block!==null){$(code_block).setHTML(this._getKitCode(source_data))}if(this._kit_costs[units_hash]!==undefined){$(price_block).setHTML(this._kit_costs[units_hash]);this.catalog_item.update()}else{url=App.buildUrl(this.options.url,{goods_id:source_data.goods_id,kit_id:source_data.kit_id,unit_ids:Object.keys(source_data.unit_ids),unit_goods_ids:Object.values(source_data.unit_ids),cart:this.options.from_cart});new Ajax(url,{method:'get',update:price_block,onSuccess:function(){this.catalog_item.update();this._cacheData(source_data.main_kit_id)}.bind(this)}).request()}},_getKitCode:function(source_data){var data=[source_data.kit_id,source_data.goods_id,Object.values(source_data.unit_ids).join('-')];return data.join('-')},_cacheData:function(kit_id){var units_hash=this._getCurrentUnitsHash();this._kit_costs[units_hash]=$(this.options.price_block_id_prefix+kit_id).innerHTML},_getCurrentUnitsHash:function(){return Object.values(this._current_units_goods_ids).join('_')},_getPriceBlockSelector:function(source_data){return this.options.price_block_id_prefix+source_data.main_kit_id},_getCodeBlockSelector:function(source_data){return(this.options.code_block_id_prefix)?this.options.code_block_id_prefix+source_data.main_kit_id:null}});KitsConstructor_class.implement(new Events(),new Options());var KitCarousel_class=new Class({Class:'KitCarousel_class',options:{container:'[name=carousel_container]',element:'[name=carousel_element]',controls:{prev:'[name=carousel_control_left]',next:'[name=carousel_control_right]'},controls_css:{prev:'disabled',next:'disabled'},control_size:0,is_centered:true,is_vertical:false,is_stretchable:false,is_circular:false,is_single:false,scroll_count:null},_parent:null,_container:null,_elements:null,_controls:{},_fx:null,_size_style:'width',_offset_style:'margin-left',_element_size:0,_current_pos:0,_is_run:false,initialize:function(parent){this._parent=$(parent);this._controls={};this.attachToObserver(['ChangeBlockOffer'])},onChangeBlockOffer:function(){this._resize()},run:function(){if(this.options.is_vertical){this._size_style='height';this._offset_style='margin-top'}if(this.options.is_single){this.options.scroll_count=1}this._container=this._parent.getElement(this.options.container);if(this._container&&this._getElements()&&this._getElements().length){this.reset();this._bindEvents();this._updateFx();this._resize();if(this.options.is_stretchable){App.addEvent('timedLastResize',function(){this._resize()}.bind(this))}}return this},reset:function(){this._container.setStyle(this._size_style,9000);this._elements=null;var size=this._getElementsTotalSize();this._element_size=size/this._getElements().length;this._container.setStyle(this._size_style,size);this._container.setStyle(this._offset_style,this.options.control_size-(this._getVisibleAreaSize()*this._current_pos));this._checkControls()},_bindEvents:function(){this._getControl('prev').addEvent('click',function(e){new Event(e).stop();this._controlsClickHandler('prev');App.fireEvent('renewImages')}.bind(this));this._getControl('next').addEvent('click',function(e){new Event(e).stop();this._controlsClickHandler('next');App.fireEvent('renewImages')}.bind(this))},_getElementsTotalSize:function(){var size=0;this._getElements().each(function(el){size+=this.options.is_vertical?el.offsetHeight:el.offsetWidth}.bind(this));return Math.ceil(size)},_resize:function(){if(this.options.is_single){this._element_size=this._getVisibleAreaSize();this._getElements().each(function(el){el.setStyle(this._size_style,this._element_size)}.bind(this));this._container.setStyle(this._size_style,this._getElementsTotalSize());this._container.setStyle(this._offset_style,this.options.control_size-(this._getVisibleAreaSize()*this._current_pos))}else{var limits=this._getLimits(),offset;if(limits.prev==limits.next){offset=this.options.is_centered?(this._getVisibleAreaSize()-this._getContainerSize(this._container))/2:0;this._container.setStyle(this._offset_style,this.options.control_size+offset)}else if(this._getContainerOffset()<limits.next){this._container.setStyle(this._offset_style,limits.next)}else if(this._getContainerOffset()>limits.prev){this._container.setStyle(this._offset_style,limits.prev)}}this._checkControls()},_controlsClickHandler:function(direction,multiplier,fx_options){var newOffset=this._getNewOffset(direction,multiplier);multiplier=multiplier||1;if(newOffset!=null&&!this._is_run){switch(direction){case'prev':this._current_pos-=multiplier;break;case'next':this._current_pos+=multiplier;break}document.fireEvent('accessoryScroll',{container:this._container});this._slide(newOffset,direction,fx_options)}},_getNewOffset:function(direction,multiplier){multiplier=multiplier||1;var result=null,offset=this._getContainerOffset(),limits=this._getLimits();if(this._getContainerSize(this._container)>this._getVisibleAreaSize()){switch(direction){case'prev':if(offset<limits.prev){result=offset+this._getScrollAmount()*multiplier;result=result>limits.prev?limits.prev:result}break;case'next':if(offset>limits.next){result=offset-this._getScrollAmount()*multiplier;result=result<limits.next?limits.next:result}break}}return result},_getScrollAmount:function(){return this.options.scroll_count?this._element_size*this.options.scroll_count:this._getVisibleAreaSize()-this._element_size},_getContainerSize:function(container){return this.options.is_vertical?container.getSize().size.y:container.getSize().size.x},_getVisibleAreaSize:function(){return(this.options.is_vertical?this._parent.getSize().size.y:this._parent.getSize().size.x)-2*this.options.control_size},_slide:function(newOffset,direction,fx_options){this._is_run=true;var fx=this.getFx();fx_options&&fx.setOptions(fx_options);fx.start(newOffset);this.fireEvent('slide',[this._current_pos,direction])},_switch:function(newOffset){this._updateSwitchFx(newOffset);this._is_run=true;this.getFx().start('opacity',0)},_checkControls:function(){var offset=this._getContainerOffset(),limits=this._getLimits();if(limits.prev==limits.next){this._getControl('next').addClass('hidden');this._getControl('prev').addClass('hidden')}else{this._getControl('next').removeClass('hidden');this._getControl('prev').removeClass('hidden');if(offset>=limits.prev){this._getControl('prev').addClass(this.options.controls_css.prev)}else{this._getControl('prev').removeClass(this.options.controls_css.prev)}if(offset<=limits.next){this._getControl('next').addClass(this.options.controls_css.next)}else{this._getControl('next').removeClass(this.options.controls_css.next)}}this.fireEvent('checkControls')},_getElements:function(){if(this._elements==null){this._elements=this._parent.getElements(this.options.element).filter(function(el){return(!el.hasClass('hidden'))})}return this._elements},_getControl:function(direction){if(this._controls[direction]==null){this._controls[direction]=this._parent.getElement(this.options.controls[direction])}return this._controls[direction]},_getContainerOffset:function(){return this._container.getStyle(this._offset_style).toInt()},_getLimits:function(){var limits={prev:this.options.control_size,next:this._getContainerSize(this._parent)-this._getContainerSize(this._container)-this.options.control_size};if(limits.next>limits.prev){limits.next=limits.prev}return limits},_updateFx:function(){var fx=new Fx.Style(this._container,'margin-top',{onComplete:function(){this._is_run=false;this._checkControls()}.bind(this)});this.setFx(fx)},_updateSwitchFx:function(newOffset){var fx=new Fx.Style(this._container,'margin-top',{duration:'short',onComplete:function(){this._is_run=false;this._container.setStyle(this._offset_style,newOffset);this._checkControls();this._updateFx()}.bind(this)});this.setFx(fx)},getFx:function(){return this._fx},setFx:function(fx){this._fx=fx},getPagesCount:function(){return Math.ceil(this._getContainerSize(this._container)/this._getScrollAmount())},getActivePage:function(){return Math.ceil((this.options.control_size-this._getContainerOffset())/this._getScrollAmount())+1},scrollToFirstFrom:function(elements_ids,data_selector){var first_index=null,first=this._getElements().some(function(element,index){var id=element.data(data_selector),result=(id&&elements_ids.indexOf(parseInt(id))>=0);result&&(first_index=index);return result});if(first&&first_index>0){this._controlsClickHandler('next',first_index,{duration:0});App.fireEvent('renewImages')}},goToPage:function(page){var diff,newOffset,active_page=this.getActivePage(),direction=page<active_page?'prev':'next';if(page!=active_page&&page>=1&&page<=this.getPagesCount()&&!this._is_run){diff=Math.abs(active_page-page);newOffset=this._getNewOffset(direction,diff);if(diff<=2){this._slide(newOffset,direction)}else{this._switch(newOffset)}}}});KitCarousel_class.implement(new Events(),new Options());var SellerInfo_class=new Class({options:{tpl:{popup:'<div class=\"pistil-{if options.layout == \'bottom\'}top{else}right{\/if} merchant-popup\" style=\"position:absolute;\" name=\"about_seller\"> <div class=\"goods-popup-hover\"> <div class=\"popup-css\"> <div name=\"msg\"><\/div> <div name=\"content\" class=\"goods-popup-hover-content\"><\/div> <div class=\"pistil\" name=\"pistil\"><\/div> <\/div> <\/div> <\/div> ',content:'{var rounded_rank = Math.round(data.rank)} {if data.logo} {macro getLogo(title, logo)} <img src=\"${logo.url}\" width=\"${logo.width}\" height=\"${logo.height}\" alt=\"${title}\"> {\/macro} {if data.href && Boolean(data.use_logo_href)} <a href=\"${data.href}\" class=\"merchant-popup-logo responsive-img\"> ${getLogo(data.title, data.logo)} <\/a> {else} <span class=\"merchant-popup-logo responsive-img\"> ${getLogo(data.title, data.logo)} <\/span> {\/if} {else} {if data.href && Boolean(data.use_logo_href)} <a href=\"${data.href}\" class=\"merchant-popup-link blacklink sprite-side\"> ${data.title} <\/a> {else} <span class=\"merchant-popup-name sprite-side\"> ${data.title} <\/span> {\/if} {\/if} {if data.is_show_feedback} <a href=\"${controller.getQuestionHref(data.id)}\" class=\"merchant-popup-ask-question novisited\" onclick=\"document.fireEvent(\'askQuestion\', { extend_event:[{ name: \'eventSellerID\', value: ${data.id}}]});\"> Поставити запитання продавцю <\/a> {\/if} {if Boolean(data.show_seller_rank)} {var merchant_rating_classes = [\'\', \' merchant-rating-green\', \' merchant-rating-yellow\', \' merchant-rating-red\']} {var merchant_class_number = 0} {if data.count_votes >= 5} {if rounded_rank >= 80} {var merchant_class_number = 1} {elseif rounded_rank < 60} {var merchant_class_number = 3} {else} {var merchant_class_number = 2} {\/if} {\/if} <div class=\"merchant-rating${merchant_rating_classes[merchant_class_number]}\"> {if data.count_votes >= 5} {var word_forms = [\'відгук\', \'відгуки\', \'відгуків\']} {var plural_form = plural(data.count_votes)} <div class=\"merchant-rating-comments\"> Усього <span class=\"merchant-rating-comments-count\">${data.count_votes}<\/span> ${word_forms[plural_form]} про&nbsp;продавця,<br \/> <span class=\"merchant-rating-comments-percent\">${rounded_rank}%<\/span> позитивних <\/div> {else} <div class=\"merchant-rating-no-comments\"> Недостатньо відгуків<br \/>для&nbsp;формування рейтингу <\/div> {\/if} <div class=\"merchant-rating-scale valigned-middle inline\"> <div class=\"merchant-rating-scale-inner\" {if data.count_votes} style=\"width: ${rounded_rank}%;\" {else} style=\"width: 0;\" {\/if} > <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"1\" height=\"1\" alt=\"_\" \/> <\/div> <\/div> {if data.count_votes > 0} <a href=\"${controller.getReviewsHref(data.title_translit)}\" class=\"merchant-popup-reviews valigned-middle novisited\" target=\"_blank\">Всі відгуки<\/a> {\/if} <\/div> {\/if} <div class=\"merchant-popup-text\"> ${data.docket} <\/div>'},selectors:{btn_seller:'[name="show_seller_info"]',popup_parent:'[name="popup_parent"]'},language:'',question_href:'https://my.rozetka.com.ua/ua/profile/market/message/add/uq/',reviews_href:'https://rozetka.com.ua/ua/seller/',stub_question_href:'https://my.rozetka.com.ua/ua/profile/market_stub/message/add/uq/',use_stub:0},_data:{},initialize:function(){document.addEvent('updateSellerInfoHandlers',this._updateHandlers.bind(this))},_updateHandlers:function(){document.getElements(this.options.selectors.btn_seller).each(function(elem){elem.addEvent('click',this._onClick.bind(this));elem.removeProperty('name')}.bind(this))},getQuestionHref:function(seller_id){return this.options.use_stub?this.options.stub_question_href:this.options.question_href+seller_id},getReviewsHref:function(seller_title){return this.options.reviews_href+seller_title+'/reviews/'},_onClick:function(e){e=new Event(e).stop();var target=e.target,seller_block=target.getParentByName('seller_block'),layout=seller_block.getProperty('popup_layout'),onComplete;seller_block.popup_parent=seller_block.getElement(this.options.selectors.popup_parent);onComplete=function(data){var options={layout:layout};if(data.docket){seller_block.popup=new Seller_Popup(this.options.tpl.popup,seller_block.popup_parent||document.body);seller_block.popup.setOptions(options);seller_block.popup.setContent(this.options.tpl.content,{data:data,controller:this});seller_block.popup.elem.setStyle('visibility','hidden');if(!seller_block.popup_parent){seller_block.popup.initUpdatePosition(seller_block,target,layout)}seller_block.popup.open();seller_block.popup._setPosition(seller_block,target,layout);seller_block.popup.elem.setStyle('visibility','')}else{document.fireEvent('closeOtherPopups')}}.bind(this);if(!seller_block.popup){this.getSellerData(seller_block.getProperty('seller_id'),onComplete)}else{if(!seller_block.popup.isOpened()){seller_block.popup.elem.setStyle('visibility','hidden');seller_block.popup.open();if(!seller_block.popup_parent){seller_block.popup._setPosition(seller_block,target,layout)}seller_block.popup.elem.setStyle('visibility','')}else{seller_block.popup.close()}}},_getAjaxAction:function(seller_id){var url='/sellers/action=getSellerInfoJSON;seller_id='+seller_id+'/';if(this.options.language){url="/"+this.options.language+url}url=window.location.protocol+"//"+window.location.hostname+url;return url},getSellerData:function(seller_id,onComplete){if(this._data[seller_id]){onComplete(this._data[seller_id])}else{new Ajax(this._getAjaxAction(seller_id),{use_language:true,method:'get',onComplete:function(resp){resp=new Response_class(resp);if(resp.isDone()){this._data[resp.content.id]=resp.content;onComplete(this._data[resp.content.id])}}.bind(this)}).request()}}});SellerInfo_class.implement(new Options);var Seller_Popup=Popup_class.extend({options:{selectors:{pistil:'[name="pistil"]',about_seller:'[name="about_seller"]'}},_block:null,initialize:function(tpl,pElem){this.parent(tpl,pElem);this.attachToObserver(['ChangeBlockOffer'])},initUpdatePosition:function(block,target,layout){this._updatePosition=function(){if(this.isOpened()){this._setPosition(block,target,layout)}}.bind(this);this.addEvent('open',function(){App.addEvent('timedResize',this._updatePosition)}.bind(this));this.addEvent('close',function(){App.removeEvent('timedResize',this._updatePosition)}.bind(this))},onChangeBlockOffer:function(){if('function'==typeof this._updatePosition){this._updatePosition()}},_setPosition:function(block,target,layout){var pistil=this.getElement(this.options.selectors.pistil),pistil_left,d_width,popup_width,block_coords,styles,left,center,i_left;if('bottom'==layout){if(!block.popup_parent){block_coords=block.getCoordinates();d_width=document.body.getSize().size.x;popup_width=this.getElement(this.options.selectors.about_seller).offsetWidth;center=popup_width/2-target.offsetWidth/2;left=block_coords.left-center;i_left=target.getPosition().x;if((left+popup_width)>d_width){left=d_width-popup_width-10}if((i_left-left)>popup_width){left=i_left-(popup_width-target.offsetWidth*2)}this.elem.setStyles({position:'absolute',left:left,top:block_coords.top+block.offsetHeight+pistil.offsetHeight})}else{block.popup_parent.setStyle('top',pistil.offsetHeight)}pistil_left=i_left-this.elem.getPosition().x-pistil.offsetWidth/2+target.offsetWidth/2;pistil.setStyle('left',pistil_left)}if('left'==layout){styles={top:-parseInt(pistil.getStyle('top'),10)-pistil.offsetHeight/2+target.offsetHeight/2,left:-this.getElement(this.options.selectors.about_seller).offsetWidth-pistil.offsetWidth};block.popup_parent.setStyles(styles)}}});var ElementSelect_class=new Class({Class:'ElementSelect_class',options:{selectors:{block:'[name=select_block]',link:'[name=drop_link]',drop_block:'[name=drop_block]',drop_element:'[name=drop_element]',drop_block_wrap:'[name=drop_block_wrap]',input:'input[type=hidden]',search_element:'input[name=search_element]',search_element_wrap:'[name=search_element_wrap]',drop_element_not_found:'[name=drop_element_not_found]'},cssClasses:{hidden:'hidden',checked:'active'},properties:{question:{title:'data-question-title',value:'data-question-value'},value:'data-value',active:'data-active'},entity:'ElementSelectEntity_class',tpl_phrases:'Виберіть варіант',phrases:'',set_value:true,suggest_count_elems_show:4},_hidden_elements_count:0,_elements:[],initialize:function(){this.options.phrases=App.getHTML(this.options.tpl_phrases,{});this.attachToObserver(['LoadTabContent','ResetForm','DisableForm'])},init:function(container){var constructor=App.getConstructorByClassName(this.options.entity);constructor&&container.getElements(this.options.selectors.block).each(function(block){this._elements.push(new constructor(block,this).setOptions(this.options).init())}.bind(this));return this},_reset:function(container){container.getElements(this.options.selectors.block).each(function(block){this._elements.forEach(function(element){element._container==block&&element.reset()})}.bind(this))},_disable:function(container){container.getElements(this.options.selectors.block).each(function(block){this._elements.forEach(function(element){element._container==block&&element.disable()})}.bind(this))},closeOtherSelect:function(select){this._elements.each(function(element){if(element!=select){element.close()}})},onLoadTabContent:function(data){this.init(data[0])},onResetForm:function(data){this._reset(data[0])},onDisableForm:function(data){this._disable(data[0])}});ElementSelect_class.implement(new Options(),new Events());var ElementSelectEntity_class=new Class({Class:'ElementSelectEntity',options:{selectors:{block:'[name=select_block]',link:'[name=drop_link]',drop_block:'[name=drop_block]',drop_element:'[name=drop_element]',drop_block_wrap:'[name=drop_block_wrap]',input:'input[type=hidden]',search_element:'[name=search_element]',search_element_wrap:'[name=pickups_search_element_wrap]',drop_element_not_found:'[name=drop_element_not_found]'},cssClasses:{invalid:null,hidden:'hidden',checked:'active'},properties:{question:{title:'data-question-title',value:'data-question-value'},value:'data-value',active:'data-active',title:'data-title'},tpl_phrases:'Виберіть варіант',phrases:'',set_value:true,suggest_count_elems_show:4},_container:null,_controller:null,_drop_block:null,_link:null,_input:null,_drop_elements:[],_not_fount_element:null,_drop_block_wrap:null,_suggest_active:null,_search_element:null,_search_element_wrap:null,elements:[],showed_elements:[],initialize:function(container,controller){this._container=container;this._controller=controller;this.options.phrases=App.getHTML(this.options.tpl_phrases,{})},init:function(){this._link=this._container.getElement(this.options.selectors.link);this._drop_block=this._container.getElement(this.options.selectors.drop_block);this._input=this._container.getElement(this.options.selectors.input);this._link.removeEvents('click').addEvent('click',this._handlerLink.bind(this));this.initDropElements();this.initSearchElement();$(document.body).addEvent('click',this._hideDropBlock.bind(this));if(this._input&&this._input.value&&this.options.set_value){this.setValue(this._input.value)}this._input['setValue']=this.setValue.bind(this);return this},setValue:function(value){var elements=this._getElementByValue(value);if(elements&&elements.length>0){this._selectElement(elements[0]);this.close()}},getValue:function(){return this._input?this._input.getValue():null},initSearchElement:function(){if(this.options.selectors.search_element&&this.elements.length>=this.options.suggest_count_elems_show){this._search_element=this._container.getElement(this.options.selectors.search_element);this._search_element_wrap=this._container.getElement(this.options.selectors.search_element_wrap);if(this._search_element){this._search_element.removeEvent('click',this._stopEvent.bind(this));this._search_element.addEvent('click',this._stopEvent.bind(this));this._search_element.removeEvent('keydown',this.onKeyDown.bind(this));this._search_element.addEvent('keydown',this.onKeyDown.bind(this));this._search_element.removeEvent('keyup',this.onKeyUp.bind(this));this._search_element.addEvent('keyup',this.onKeyUp.bind(this))}}else if(this._search_element){this._search_element=null}},onKeyUp:function(){this._hidden_elements_count=0;this.showed_elements=[];this._drop_elements.forEach(function(element){if(this._search_element.value===''||this.hasMatches(element.getProperty(this.options.properties.title).trim().toLowerCase(),this._search_element.value.trim().toLowerCase())){element.show();this.showed_elements.push(element)}else{element.hide();this._hidden_elements_count++}}.bind(this));this._drop_block.scrollTo(0,0);if(this._not_fount_element){if(this._drop_elements.length===this._hidden_elements_count){this._not_fount_element.show()}else{this._not_fount_element.hide()}}},onKeyDown:function(e){if(e.keyCode===27||e.keyCode===9){this.close()}},hasMatches:function(str,needle){if(~str.indexOf(needle)){return true}else if(needle.length>2&&needle.split(' ').length>1){return needle.split(' ').every(function(word){return~str.indexOf(word)})}else{return false}},_stopEvent:function(e){new Event(e).stop()},initDropElements:function(){this.elements=[];this._drop_elements=this._container.getElements(this.options.selectors.drop_element);this._drop_elements.forEach(function(element){element.removeEvent('click',this._handlerDropElement.bind(this));if(!~this.elements.indexOf(element)){element.addEvent('click',this._handlerDropElement.bind(this));this.elements.push(element)}}.bind(this));if(this.options.selectors.drop_element_not_found){this._not_fount_element=this._container.getElement(this.options.selectors.drop_element_not_found);this._not_fount_element&&this._not_fount_element.hide()}this._drop_block_wrap=this._container.getElement(this.options.selectors.drop_block_wrap);this._drop_block_wrap&&this._drop_block_wrap.hide()},_getElementByValue:function(value){return this._drop_elements.filter(function(element){return(value==element.getProperty(this.options.properties.value))}.bind(this))},_selectElement:function(element){var value=element&&element.getProperty(this.options.properties.value);if(value){this._setLinkHTML(element);this._link.setProperty('data-value',value);this._input.value=value;this._input.fireEvent('change',{target:this._input});this._input.disabled=false;this._clearDropElementsCss();element.addClass(this.options.cssClasses.checked);this._container.highlightReset(this.options.cssClasses.invalid);this.fireEvent('selectElement',{target:element,'value':value});document.fireEvent('changedSelectElement')}},_setLinkHTML:function(element){this._link.setHTML(element.innerHTML)},_handlerDropElement:function(e){new Event(e).stop();this._selectDropElement(e.target)},_selectDropElement:function(element){this._selectElement(element);this.fireEvent('elementSelectOptionClick',{target:this._input});this.close();this.analytic(element);this._fireDropElementEvent(element)},_clearDropElementsCss:function(){this._drop_elements.each(function(element){element.hasClass(this.options.cssClasses.checked)&&element.removeClass(this.options.cssClasses.checked)}.bind(this))},_fireEventByName:function(event_name,input){var event={type:event_name};event['target']=input;input.fireEvent('focus',event)},_hideDropBlock:function(e){this.close()},close:function(){if(this.isVisible()){this._hideSelect()}},_handlerLink:function(e){e&&new Event(e).stop();this._controller&&this._controller.closeOtherSelect(this);if(this.isVisible()){this._hideSelect()}else{this._showSelect()}},_showSelect:function(){if(this._search_element){this._search_element.show();this._search_element_wrap&&this._search_element_wrap.show()}this._drop_block_wrap&&this._drop_block_wrap.show();this._drop_block.show();if(this._search_element){this._search_element.focus();this._fireEventByName('focus',this._search_element)}},_hideSelect:function(){if(this._search_element){this._search_element.blur();this._search_element_wrap&&this._search_element_wrap.hide();this._search_element.hide();this._search_element.value='';this.onKeyUp()}this._drop_block_wrap&&this._drop_block_wrap.hide();this._drop_block.hide()},reset:function(){this._link.setHTML(this.options.phrases);if(!this._input.disabled){this._input.value=null;this._input.disabled=true}this._clearDropElementsCss()},disable:function(){this._link.removeEvents('click')},isVisible:function(){return!this._drop_block.hasClass('hidden')},_fireDropElementEvent:function(target){document.fireEvent('dropSelectElement',{target:target})},analytic:function(element){var events=[];if(element&&element.hasAttribute(this.options.properties.question.title)&&element.hasAttribute(this.options.properties.question.value)&&element.getAttribute(this.options.properties.question.title)!==''&&element.getAttribute(this.options.properties.question.value)!==''){events.push({name:'eventContext',value:element.getAttribute(this.options.properties.question.title)});events.push({name:'eventContent',value:element.getAttribute(this.options.properties.question.value)})}document.fireEvent('dropDownList',{extend_event:events})},setInputProperty:function(name,value){this._input.setProperty(name,value)},getInputProperty:function(name){return this._input.getProperty(name)},getInput:function(){return this._input},isValid:function(show_errors){var result=true;if(this._input){if(this._input.getProperty('_required')==='required'&&!this._input.getValue()&&this._container.isVisible()){result=false;if(show_errors){this._container.highlightError(this.options.cssClasses.invalid);if(this._drop_block.hasClass(this.options.cssClasses.hidden)){this._link.click()}document.fireEvent('formSendFieldError',{extend_event:[{name:'eventError',value:'Поле не заполнено'},{name:'eventField',value:this._input.getAttribute('data-title')?this._input.getAttribute('data-title'):this._input.getAttribute('name')}]});this.fireEvent('notValid')}}else{this._container.highlightReset(this.options.cssClasses.invalid)}}return result},getElementBlock:function(){return this._container},isElementOffScreen:function(){var position_select=this._container.getCoordinates();return window.scrollY>(position_select.bottom)||window.scrollY<(position_select.top)}});ElementSelectEntity_class.implement(new Options(),new Events());var ElementSelectSortEntity_class=ElementSelectEntity_class.extend({Class:'ElementSelectSortEntity_class',options:{reload:true},init:function(){this.parent();this._drop_block.addEvent('click',function(event){new Event(event).stop()});return this},_handlerDropElement:function(e){this.parent(e);if(this.options.reload){window.location.href=e.target.href}this.fireEvent('sortEntityChanged')},setActiveElemByValue:function(value){var elem=null;this._drop_elements.each(function(el){if(el.getProperty(this.options.properties.value)==value){elem=el}}.bind(this));if(elem){this._link.setHTML(elem.innerHTML);this._input.value=value;this._input.disabled=false;this._clearDropElementsCss();elem.addClass(this.options.cssClasses.checked)}}});var QuantityChanger=new Class({quantity_plus_func:null,quantity_minus_func:null,recount_cost_func:null,on_zero_func:null,restore_quantity_func:null,initialize:function(quantity_plus_func,quantity_minus_func,recount_cost_func,on_zero_func,restore_quantity_func){this.quantity_plus_func=quantity_plus_func;this.quantity_minus_func=quantity_minus_func;this.recount_cost_func=recount_cost_func;this.on_zero_func=on_zero_func;this.restore_quantity_func=restore_quantity_func},onChangeQuantity:function(elem,param){var special_codes={delete_code:46,backspace_code:8,left_code:37,right_code:39},onNotValid=function(el){var fx=new Fx.Styles(el,{duration:400});fx.start({'background-color':'#ffa6a6'}).chain(function(){fx.start({'background-color':'#ffffff'})})},pressed_special_code=false,checkZero=function(){if((/^\d*$/).test(elem.value)&&parseInt(elem.value)==0){this.on_zero_func()}}.bind(this);elem.addEvent('blur',function(){checkZero();this.recount_cost_func()}.bind(this));elem.addEvent('keydown',function(e){var event=new Event(e);pressed_special_code=false;if(event.code==27||event.key=='esc'){event.stop();elem.value=this.restore_quantity_func();elem.blur()}else if(event.code==13||event.key=='enter'){checkZero();event.stop();this.recount_cost_func()}else if(event.code==107||event.code==187||event.key=='+'||event.code==38||event.key=='up'){event.stop();this.quantity_plus_func()}else if(event.code==109||event.code==189||event.key=='-'||event.code==40||event.key=='down'){event.stop();this.quantity_minus_func()}else if(Object.values(special_codes).contains(event.code)){pressed_special_code=true}}.bind(this));elem.addEvent('keypress',function(e){var event=new Event(e);if(!pressed_special_code){if(isNaN(event.key)||(document.getSelection().type!="Range"&&/^(\d){0,3}$/.exec(elem.value+event.key)==null)){event.stop();onNotValid(elem)}}})}});var ServicesOffered_class=new Class({DEFAULT_QUANTITY:1,_services_data:{},_discount_module:'Goods.Services',_context:null,_location:null,_events_initizalized:false,_is_inited:false,options:{template:'<div class=\"detail-service\"> {if is_cart} <div class=\"detail-service-title\"> Додаткові послуги до&nbsp;цього товару <\/div> {\/if} {for service in services} <div class=\"detail-service-i clearfix{if !is_cart} toOrder{\/if}{if !is_cart && (service_index) >= max_services_visible} hidden{\/if}\" name=\"service_block\" service_id=${service.service_id}> <div class=\"detail-service-check{if service.image} detail-service-with-icon-label{\/if}\"> <label class=\"detail-service-label\"> <input name=\"service_on\" class=\"hidden checkbox-input\" type=\"checkbox\" service_id=\"${service.service_id}\" {if service.is_selected}checked=\"checked\"{\/if}\/> <div class=\"checkbox-label-small sprite-side\" name=\"service_title\"> {if service.image} <div class=\"detail-service-with-icon-img responsive-img\"> <img src=\"${service.image}\" width=\"20\" height=\"17\"> <\/div>{\/if}<span class=\"checkbox-label-small-inner\">${service.title}<\/span> <\/div> <\/label> {if service.docket} <a href=\"#\" class=\"info detail-service-info\" name=\"service_info\"> <img class=\"sprite info-icon\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"14\" height=\"15\" alt=\"Докладніше\" \/> <\/a> {\/if} <\/div> <div class=\"detail-service-option\" name=\"service_items\" service_id=\"${service.service_id}\"> <div name=\"select_block\" class=\"dropdown-small\"> <div class=\"dropdown-small-title sprite-side\" name=\"drop_link\">${service.selected_item.title}<\/div> <div name=\"drop_block\" class=\"detail-service-drop hidden\"> <ul class=\"pp-comments-sort-box-sort-l\"> {for item in service.items} <li class=\"pp-comments-sort-box-l-i\"> <a href=\"#\" class=\"novisited sprite-side pp-comments-sort-box-l-i-link{if service.selected_item.item_id==item.item_id} active{\/if}\" name=\"drop_element\" data-value=\"${item.item_id}\">${item.title}<\/a> <\/li> {\/for} <\/ul> <\/div> <input name=\"selected_item\" type=\"hidden\" data-title=\"${service.selected_item.title}\" value=\"${service.selected_item.item_id}\" disabled=\"disabled\"> <\/div> <\/div> {if service.allow_select_quantity && service.cost_with_discount} <div class=\"cart-sum\"> <span class=\"cart-uah cart-sum-uah\"> <span name=\"sum\">${service.cost_with_discount.primary.decimals}<\/span >&nbsp;<span class=\"cart-uah-sign\">${service.cost_with_discount.primary.unit}<\/span> <\/span> <\/div> <div class=\"cart-amount\" name=\"quantity_block\" service_id=\"${service.service_id}\"> <a href=\"#\" class=\"cart-amount-minus{if service.quantity > 1} active{\/if}\" name=\"service_minus\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"16\" height=\"2\" alt=\"&up;\" class=\"cart-amount-minus-icon sprite\"> <\/a> <input type=\"text\" class=\"input-text cart-amount-input-text\" name=\"service_quantity\" value=\"${service.quantity}\" _pattern=\"^[0-9]+$\"> <a href=\"#\" class=\"cart-amount-plus\" name=\"service_plus\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"21\" height=\"20\" alt=\"&up;\" class=\"cart-amount-plus-icon sprite\"> <\/a> <\/div> {\/if} <div class=\"detail-service-price{if service.allow_select_quantity && service.cost_with_discount} with-counter{\/if}\" name=\"item_price\"> ${service.selected_item.cost.primary.string} <\/div> <\/div> {\/for} {if show_more_count} <a href=\"#\" class=\"detail-service-more-link novisited sprite-side\" name=\"show_more\"> <span class=\"xhr\"> {var forms = [\'додатковий сервіс\', \'додаткові сервіси\', \'додаткових сервісів\']} {var variant = plural(show_more_count)} Ще ${show_more_count}&nbsp;${forms[variant]} <\/span> <\/a> {\/if} <\/div>',docket_popup:'<div class=\"detail-service-popup\" name=\"docket_popup\"> <div class=\"popup-css\"> <a href=\"#\" class=\"popup-close-medium-delivery\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div class=\"detail-service-popup-content\" name=\"content\"><\/div> <\/div> <\/div>',popup_content:'<h3>${service.title}<\/h3> ${service.docket}',selectors:{container:'[name=services_offered]',link_show_more:'[name="show_more"]',service_block:'[name=service_block]',selected_item:'[name=selected_item]',item_price:'[name=item_price]',service_on:'[name=service_on]',service_title:'[name=service_title]',service_info:'[name=service_info]',quantity_block:'[name=quantity_block]',quantity:'[name=service_quantity]',quantity_plus:'[name=service_plus]',quantity_minus:'[name=service_minus]'},max_services_visible:2,show_more_link:false,control_elements_selectors:['service_on','selected_item'],service_block_name:'service_block',selected_item_name:'selected_item',limit_get_parent:15,item_price_css:'unchecked'},initialize:function(services_data,context,location,options){options&&this.setOptions(options);this._services_data=services_data;this._context=context||document;this._location=location;document.addEvent('serviceOfferedChange',this._onChangeServiceOffered.bind(this));document.addEvent('TabChangeCompleted',function(){this.init(true)}.bind(this));Cart.addEvent('update',this.fireServiceOfferedChange.bind(this))},fireServiceOfferedChange:function(){document.fireEvent('serviceOfferedChange',{service_offered:this})},isInited:function(){return this._is_inited},init:function(reinit){if(!this._is_inited||reinit){this.initContent();this.initRequiredEvents();this.initDocketPopups();this.initChangeQuantity();this.setCssClasses();this._is_inited=true}},initContent:function(){this.getContainer()&&this.getContainer().setHTML(App.getHTML(this.options.template,this.getInitData()))},initRequiredEvents:function(){document.addEvent('dropSelectElement',this._onChangeItems.bind(this));new ElementSelect_class().setOptions({'set_value':false}).init(this._context);this.getContainer()&&this.getContainer().getElements(this.options.selectors.service_info).each(function(element){element.addEvent('click',this.openDocketPopup.bind(this))}.bind(this));this.getContainer()&&this.options.control_elements_selectors.each(function(selector_name){this.getContainer().getElements(this.options.selectors[selector_name]).each(function(elem){elem.addEvent('change',this._onChangeСontrolElement.bind(this))}.bind(this))}.bind(this));if(!this._events_initizalized){Cart.addEvent('deletePurchase',this._onDeletePurchaseFromCart.bind(this));this._events_initizalized=true}this._initShowMoreEvent()},_initShowMoreEvent:function(){var link_show_more=(this.getContainer()&&this.getContainer().getElement(this.options.selectors.link_show_more));link_show_more&&link_show_more.addEvent('click',function(event){new Event(event).stop();this.getContainer().getElements(this.options.selectors.service_block).removeClass('hidden');link_show_more.remove()}.bind(this))},_onDeletePurchaseFromCart:function(purchase){if(this.getPurchaseId()==purchase.id){Object.each(this._services_data.services,function(service){service['quantity']=this.DEFAULT_QUANTITY},this);this.fireUncheckedServicesGTMEvent()}},setCssClasses:function(){this.getContainer()&&this.getContainer().getElements(this.options.selectors.service_on).each(function(elem){var currentItemPrice=this.getServiceBlockByChildBlock(elem);if(elem.checked){currentItemPrice.removeClass(this.options.item_price_css)}else{currentItemPrice.addClass(this.options.item_price_css)}}.bind(this))},_onChangeServiceOffered:function(data){if(data.service_offered!=this&&data.service_offered.getGoodsId()==this.getGoodsId()){Object.each(this._services_data.services,function(service,key){if(data.service_offered._services_data.services[key]!==undefined){service.selected_item=data.service_offered._services_data.services[key].selected_item;service.is_selected=data.service_offered._services_data.services[key].is_selected}});this.init(true)}},_fireGTMEvent:function(data){if(data.enable_service_target&&data.changed_service.is_selected){this._fireAddServiceToPurchasesEvent(data.selected_item)}else if(data.enable_service_target&&!data.changed_service.is_selected){this._fireRemoveServiceFromPurchasesEvent(data.selected_item)}else if(!data.enable_service_target&&data.changed_service.is_selected){this._fireRemoveServiceFromPurchasesEvent(data.selected_item);this._fireAddServiceToPurchasesEvent(data.selected_item)}},_onChangeСontrolElement:function(event){var service_block=this.getServiceBlockByChildBlock(event.target),enable_service_elem=service_block&&service_block.getElement(this.options.selectors.service_on),service=this.getServiceByBlock(service_block),need_update_cart=event.target===enable_service_elem||enable_service_elem&&enable_service_elem.checked&&(event.target.name!=this.options.selected_item_name||event.target.getValue()!=service.selected_item.item_id);if(service&&enable_service_elem){this._handleChangeService(service,event.target,enable_service_elem,need_update_cart)}this.setCssClasses()},fireUncheckedServicesGTMEvent:function(){var container=this.getContainer();if(container){container.getElements(this.options.selectors.service_on).each(function(enable_service_elem){var service_block=this.getServiceBlockByChildBlock(enable_service_elem),service=this.getServiceByBlock(service_block);var gtm_data=this._getGTMData(service,enable_service_elem,enable_service_elem);if(gtm_data.changed_service.is_selected){this._fireRemoveServiceFromPurchasesEvent(gtm_data.selected_item)}}.bind(this))}},_getGTMData:function(service,target_block,enable_service_elem){var gtm_data;service.is_selected=enable_service_elem.checked;service.selected_item=this.getSelectedItemByBlock(target_block);if(!service.is_selected){service['quantity']=this.DEFAULT_QUANTITY}gtm_data={changed_service:service,enable_service_target:target_block===enable_service_elem,selected_item:service.selected_item};return gtm_data},_handleChangeService:function(service,target_block,enable_service_elem,need_update_cart){var gtm_data=this._getGTMData(service,target_block,enable_service_elem);this.fireServiceOfferedChange();!Cart.isInPopup()&&this._fireChangeServicesOffered(gtm_data);need_update_cart&&Cart.sendChangeServicesOffered(this)&&this._fireGTMEvent(gtm_data)},_fireAddServiceToPurchasesEvent:function(selected_item){var event_data=this._getStaticEventData(selected_item),item_data=!selected_item?[]:Object.merge(this.parseData(selected_item.gtm_data),{eventLocation:Cart.isInPopup()?'Cart':'ProductPage'});selected_item&&event_data.extend_event.push({name:'eventProducts',value:[item_data]});document.fireEvent('addServiceToPurchases',event_data)},_fireRemoveServiceFromPurchasesEvent:function(selected_item){document.fireEvent('removeServiceFromPurchases',this._getStaticEventData(selected_item))},_fireChangeServicesOffered:function(data){if(data.enable_service_target&&data.changed_service.is_selected){document.fireEvent('checkService',this._getStaticEventData(data.selected_item))}else if(data.enable_service_target&&!data.changed_service.is_selected){document.fireEvent('uncheckService',this._getStaticEventData(data.selected_item))}},_getStaticEventData:function(selected_item){var event_data={extend_event:[]};event_data.extend_event.push({name:'goods_id',value:this._services_data.goods_id});event_data.extend_event.push({name:'eventLocation',value:Cart.isInPopup()?'cartService':'ProductPage'});event_data.extend_event.push({name:'eventProductId',value:parseInt(selected_item.eventProductId)});event_data.extend_event.push({name:'eventProductCategoryId',value:parseInt(selected_item.eventProductCategoryId)});event_data.extend_event.push({name:'eventProductCategoryGroupId',value:parseInt(selected_item.eventProductCategoryGroupId)});event_data.extend_event.push({name:'eventProductVendorId',value:parseInt(selected_item.eventProductVendorId)});event_data.extend_event.push({name:'eventValue',value:parseFloat(selected_item.eventValue)});event_data.extend_event.push({name:'eventMerchantId',value:parseInt(selected_item.productMerchantId)});event_data.extend_event.push({name:'eventSellerId',value:parseInt(selected_item.productSellerId)});return event_data},initDocketPopups:function(){Object.each(this._services_data.services,function(service){if(service['docket']){service['docket_popup']=new Popup_class(this.options.docket_popup);service['docket_popup'].setContent(this.options.popup_content,{service:service})}}.bind(this))},initChangeQuantity:function(){var service_id,quantity_changer;this.getContainer()&&this.getContainer().getElements(this.options.selectors.quantity_block).each(function(elem){service_id=elem.getAttribute('service_id');elem.getElement(this.options.selectors.quantity_minus).addEvent('click',this._onDecrementQuantity.bind(this,service_id));elem.getElement(this.options.selectors.quantity_plus).addEvent('click',this._onIncrementQuantity.bind(this,service_id));quantity_changer=new QuantityChanger(this._onIncrementQuantity.bind(this,service_id),this._onDecrementQuantity.bind(this,service_id),this._onChangeQuantity.bind(this,service_id),this._onZeroQuantity.bind(this,service_id),this._restoreQuantity.bind(this,service_id));quantity_changer.onChangeQuantity(elem.getElement(this.options.selectors.quantity))}.bind(this))},_onDecrementQuantity:function(service_id,event){if(event){new Event(event).stopPropagation();event.preventDefault()}this._updateQuantity(this.getServiceById(service_id),this.getServiceById(service_id).quantity-1)},_onIncrementQuantity:function(service_id,event){if(event){new Event(event).stopPropagation();event.preventDefault()}this._updateQuantity(this.getServiceById(service_id),this.getServiceById(service_id).quantity+1)},_updateQuantity:function(service,quantity){this._updateQuantityMinusElementClass(service.service_id,quantity);this._updateQuantityInDom(service.service_id,quantity);this.setServiceQuantity(service,quantity)},_onChangeQuantity:function(service_id){var quantity=this._getQuantityBlockByServiceId(service_id).getElement(this.options.selectors.quantity).value;if(quantity.toInt()){this._updateQuantity(this.getServiceById(service_id),quantity)}},_updateQuantityInDom:function(service_id,quantity){this._getQuantityBlockByServiceId(service_id).getElement(this.options.selectors.quantity).value=quantity>0?quantity:this.DEFAULT_QUANTITY},_getQuantityBlockByServiceId:function(service_id){return this.getContainer()&&this.getContainer().getElements(this.options.selectors.quantity_block).filter(function(elem){return elem.getAttribute('service_id')==service_id}).pop()},_updateQuantityMinusElementClass:function(service_id,quantity){var element=this._getQuantityBlockByServiceId(service_id).getElement(this.options.selectors.quantity_minus);if(quantity>1){element.addClass('active')}else{element.removeClass('active')}},_onZeroQuantity:function(service_id){var quantity_block=this._getQuantityBlockByServiceId(service_id),enable_service_elem=this.getServiceBlockByChildBlock(quantity_block).getElement(this.options.selectors.service_on);enable_service_elem&&enable_service_elem.removeAttribute('checked');this._handleChangeService(this.getServiceById(service_id),quantity_block,enable_service_elem,true)},_restoreQuantity:function(service_id){return this.getServiceById(service_id).quantity},openDocketPopup:function(e){new Event(e).stopPropagation();e.preventDefault();var service_block=this.getServiceBlockByChildBlock(e.target),service=this.getServiceByBlock(service_block);service&&service.docket_popup&&service.docket_popup.open()},getSelectedItemByBlock:function(block){var service_block=this.getServiceBlockByChildBlock(block),service=this.getServiceByBlock(service_block),selected_item_id=service_block?service_block.getElement(this.options.selectors.selected_item).getAttribute('value'):null;return this.getItemByServiceAndId(service,selected_item_id)},getServiceBlockByChildBlock:function(block){return block&&block.getParentByName(this.options.service_block_name,this.options.limit_get_parent)},getServiceByBlock:function(service_block){return service_block&&this.getServiceById(service_block.getAttribute('service_id'))},getContainer:function(){return this._context.getElements(this.options.selectors.container).filter(function(element){return element.getAttribute('goods_id')==this._services_data.goods_id}.bind(this)).pop()},getInitData:function(){var result=this._services_data,services_length=0,quantity;Object.each(this._services_data.services,function(service,key){services_length++;result.services[key]['is_selected']=service.is_selected!==undefined?service.is_selected:this.isServiceInCart(service);quantity=this.getDataFromCartByService(service,'quantity');result.services[key]['quantity']=quantity?quantity:this.DEFAULT_QUANTITY;result.services[key]['cost_with_discount']=this.getDataFromCartByService(service,'cost_with_discount');result.services[key]['show_elementselect']=Object.getLength(service.items)>1;if(!result.services[key]['selected_item']){result.services[key]['selected_item']=this.getItemInCartByService(service)||Object.values(service.items)[0]}}.bind(this));result.is_cart=this._location==='cart';result.show_more_count=0;result.max_services_visible=this.options.max_services_visible;if(this.options.show_more_link&&!result.is_cart&&services_length>this.options.max_services_visible){result.show_more_count=services_length-this.options.max_services_visible}return result},isServiceInCart:function(service){return!!this._getDiscountFromCartByService(service)},getItemInCartByService:function(service){var result,discount=this._getDiscountFromCartByService(service);if(discount){result=Object.values(service.items).filter(function(item){return item.item_id==discount.raw_data.item_id}).pop()}return result},getDataFromCartByService:function(service,key){var result=null,discount=this._getDiscountFromCartByService(service);if(discount){result=Cart.getPurchase(discount.purchase_id)[key]}return result},_getDiscountFromCartByService:function(service){var result;if(Cart.getDiscounts()){result=Cart.getDiscounts().filter(function(discount){var is_valid_discount=(discount.discount_module==this._discount_module&&discount.raw_data.service_id==service.service_id),service_purchase=null,service_purchase_data=null,purchase=null;if(is_valid_discount){service_purchase=Cart.getPurchase(discount.purchase_id)}if(service_purchase&&service_purchase['service_raw_data']){service_purchase_data=this.parseData(service_purchase['service_raw_data'])}if(service_purchase_data){purchase=Cart.getPurchase(service_purchase_data.purchase_id)}return purchase&&purchase.goods.id==this._services_data.goods_id}.bind(this)).pop()}return result},_onChangeItems:function(container){var service_block=this.getServiceBlockByChildBlock(container.target),selected_item=this.getSelectedItemByBlock(container.target);selected_item&&this._updateItemPrice(selected_item,service_block)},setServiceQuantity:function(service,quantity){var old_quantity=service['quantity'];service['quantity']=quantity.toInt()>0?quantity.toInt():this.DEFAULT_QUANTITY;if(old_quantity!=service['quantity']&&this.isServiceInCart(service)){Cart.sendChangeServicesOffered(this)}},updateSelectedItem:function(service,selected_item_id){service.selected_item=this.getItemByServiceAndId(service,selected_item_id);return service.selected_item},_updateItemPrice:function(item,block){block.getElement(this.options.selectors.item_price).setHTML(item.cost.primary.string)},getServiceById:function(id){return Object.values(this._services_data.services).filter(function(service){return service.service_id==id}).pop()},getItemByServiceAndId:function(service,id){return service&&Object.values(service.items).filter(function(item){return item.item_id==id}).pop()},getGoodsId:function(){return this._services_data.goods_id},getPurchaseId:function(){return this._services_data.services[0].purchase_id},updatePurchaseId:function(purchase_id){this._services_data.services[0].purchase_id=purchase_id},getSelectedServices:function(){var result={};this.getContainer()&&this.getContainer().getElements(this.options.selectors.service_on).each(function(elem){if(elem.checked){result[elem.getAttribute('service_id')]=this.getServiceBlockByChildBlock(elem).getElement(this.options.selectors.selected_item).getAttribute('value')}}.bind(this));return result},getDataForCart:function(){var service_items={},service;Object.each(this.getSelectedServices(),function(item_id,service_id){service=this.getServiceById(service_id);service_items[service_id]={id:item_id,quantity:service.quantity?service.quantity:this.DEFAULT_QUANTITY}},this);return Object.getLength(service_items)?{service_items:service_items}:{}},getTotalDataForGTM:function(){var result=[];Object.each(this.getSelectedServices(),function(item_id,service_id){result.push(this.parseData(this.getItemByServiceAndId(this.getServiceById(service_id),item_id).gtm_data))}.bind(this));return result},parseData:function(data){var result;try{result=App.getService('JSON').parse(data)}catch(e){result={}}return result},updateContext:function(context){this._context=context;this.init(true)},updateServicesSelected:function(){Object.each(this._services_data.services,function(service,key){if(service.is_selected===true&&!this.isServiceInCart(service)){service.is_selected=false;this.fireServiceOfferedChange()}else if(service.is_selected===false&&this.isServiceInCart(service)){service.is_selected=true;this.fireServiceOfferedChange()}}.bind(this))}});ServicesOffered_class.implement(new Options);var RozetkaCookie=Object.create(Cookie);RozetkaCookie.getDuration=function(seconds){var date=new Date();return date.getTime()+seconds*1000};var RozetkaCookieStorage_class=CookieStorage_class.extend({Class:'RozetkaCookieStorage_class',options:{duration:2678400,cookie:RozetkaCookie}});var RozetkaSplitTests_class=SplitTests_class.extend({Class:"RozetkaSplitTests_class",options:{cookie_duration:2678400},initialize:function(options){this.setOptions(options);this._cookie_storage=new RozetkaCookieStorage_class({duration:this.options.cookie_duration})}});var RozetkaExitProgramLoyalty_class=new Class({options:{resend_delay:0,'ajax':{exit_send_code:'https://my.rozetka.com.ua/ua/profile/bonus-account/#verifyPhone',exit:'/cgi-bin/form.php?action=exitProgramLoyalty&r=https://my.rozetka.com.ua/ua/profile/bonus-account/'},selectors:{exit_button:'[name=pl_exit]',exit_form:'[name=verify_exit_form]',exit_verify_submit:'[name=pl_exit_verify_submit]',verify_phone_resend:'[name=verify_phone_resend]',over_send_message:'[name=verify_phone_over_send]',msg:'div[name=verify_code_msg]'},tpl:{exit_popup:'<div class=\"popup-css popup-loyalty-exit\"> <a href=\"#\" name=\"close\" class=\"popup-close-medium-loyalty\"> <img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"×\" class=\"popup-close-medium-icon sprite\"> <\/a> <div name=\"content\" > <\/div> <\/div>',exit_popup_content:'{if phone} <div class=\"popup-loyalty-exit-header\">Ви&nbsp;хочете відмовитися від&nbsp;бонусного рахунку?<\/div> <div class=\"popup-loyalty-exit-desc\">Для відмови від&nbsp;бонусного рахунку вам прийде SMS з кодом підтвердження.<br\/> SMS буде надіслано на&nbsp;номер&nbsp;<nobr class=\"popup-loyalty-exit-phone\">${phone.title}<\/nobr> <\/div> <p class=\"popup-loyalty-exit-text\">Всі ваші бонуси буде анульовано!<\/p> <div class=\"popup-loyalty-exit-btn\"> <a href=\"#\" name=\"close\" class=\"novisited\">Скасувати<\/a> <span class=\"btn-link btn-link-blue\"> <button type=\"submit\" phone_id=\"${phone.id}\" name=\"pl_exit_verify_submit\" class=\"btn-link-i\">Так, відмовитися<\/button> <\/span> <\/div> {else} <div class=\"popup-loyalty-exit-prompt\"> У&nbsp;вас поки що немає бонусного рахунку <\/div> {\/if} ',not_in_pl:'<div class=\"popup-loyalty-exit-prompt\"> У&nbsp;вас поки що немає бонусного рахунку <\/div>',success_exit:'<div class=\"popup-loyalty-exit-prompt\"> Ваш бонусний рахунок деактивовано <\/div>',exit_popup_verify_code:'<div class=\"popup-loyalty-exit-header\">Відмова від бонусного рахунку<\/div> <p class=\"popup-loyalty-exit-text\">На номер&nbsp;<nobr class=\"bold\">${phone}<\/nobr>&nbsp;було надіслано SMS з кодом<\/p> <div name=\"verify_code_msg\"><\/div> <form name=\"verify_exit_form\" action=\"${ajax_request}\" method=\"POST\"> <div class=\"popup-loyalty-exit-sms\"> <span class=\"popup-loyalty-exit-sms-title\">Введіть код із SMS<\/span> <input name=\"verify_code\" required=\"required\" type=\"text\" class=\"input-text\" _pattern=\"[0-9]+\" _required=\"required\" size=\"40\"\/> <input name=\"phone_id\" type=\"hidden\" value=\"${phone_id}\"\/> <div class=\"popup-loyalty-exit-wrap clearfix\"> <span class=\"btn-link btn-link-blue popup-loyalty-exit-btn\"> <button class=\"btn-link-i\" type=\"submit\">Підтвердити<\/button> <\/span> <\/div> {if retries_number <= max_count_try} <a href=\"#\" class=\"popup-loyalty-exit-sms-repeat novisited xhr\" name=\"verify_phone_resend\" phone_id=${phone_id}>Запитати код ще раз<\/a> <span class=\"popup-loyalty-exit-sms-repeat lightgray hidden\" name=\"verify_phone_over_send\"> Перевищено ліміт запитів SMS з кодом <\/span> {else} <span class=\"popup-loyalty-exit-sms-repeat lightgray\" name=\"verify_phone_over_send\"> Перевищено ліміт запитів SMS з кодом <\/span> {\/if} <\/div> <\/form>',process:preloaders.process_tpl},max_count_try:'5',},items:{exit_button:null,is_resend:false,over_send_message:null},initialize:function(options){if(options){this.setOptions(options)}App.addOnDomReady(this.attachListeners.bind(this));this.attachToObserver(['showUserAgreement','openConditions'])},attachListeners:function(){this.items.exit_button=document.getElementsBySelector(this.options.selectors.exit_button);this.items.exit_button.forEach(function(elem){elem.removeEvents('click').addEvent('click',this.showVerifyExitProgramLoyaltyPopup.bind(this))}.bind(this))},showVerifyExitProgramLoyaltyPopup:function(e){var service=App.getService('ProgramLoyalty'),pl_data={};new Event(e).stop();if(service){pl_data=service.getData()}document.fireEvent('tryLogoutRozetkaClub');this.items.exit_popup=new Popup_class(this.options.tpl.exit_popup);if(pl_data&&pl_data.loyalty_accepted!=true){this.items.exit_popup.setOptions({single:false});this.items.exit_popup.setContent(this.options.tpl.not_in_pl,{});this.items.exit_popup.elem.setStyles({position:'absolute','z-index':1002});this.items.exit_popup.overlayON({styles:{'z-index':1001,'opacity':0.3}});this.items.exit_popup.open()}else{var data={};data.phone=User.getVerifiedPhones().pop();this.items.exit_popup.setContent(this.options.tpl.exit_popup_content,data);this.items.exit_popup.open();var exit_button=this.items.exit_popup.elem.getElementsBySelector(this.options.selectors.exit_verify_submit);this.is_resend=false;exit_button.forEach(function(elem){elem.addEvent('click',this.sendExitVerifyCode.bind(this))}.bind(this))}},sendExitVerifyCode:function(e){new Event(e).stop();if(this.items.is_resend){document.fireEvent('getLogoutCode')}else{document.fireEvent('confirmLogoutRozetkaClub')}if(e.target.getAttribute('phone_id')){var phone_id=e.target.getAttribute('phone_id');this.items.exit_popup.elem.processStart(this.options.tpl.process);new Ajax('/cgi-bin/form.php',{headers:{ajaxAction:this.options.ajax.exit_send_code},data:{phone_id:phone_id,exit_pl:true},onComplete:function(resp){this.items.exit_popup.elem.processStop();var response=new Response_class(resp);response.doAction();if(response.isError()){this.items.exit_popup.close();App.showMessage(response.Message)}else{var data=response.content;data.ajax_request=this.options.ajax.exit;data.max_count_try=parseInt(this.options.max_count_try);this.items.exit_popup.setContent(this.options.tpl.exit_popup_verify_code,data);var resend_link=this.items.exit_popup.elem.getElement(this.options.selectors.verify_phone_resend);var over_send_message=this.items.exit_popup.content.getElement(this.options.selectors.over_send_message);if(data.retries_number>=this.options.max_count_try){if(resend_link){resend_link.hide()}over_send_message.show()}else{window.setTimeout(function(){resend_link.show()}.bind(this),this.options.resend_delay)}if(resend_link){resend_link.addEvent('click',function(e){this.items.is_resend=true;this.sendExitVerifyCode(e)}.bind(this))}var exit_form=this.items.exit_popup.elem.getElementsBySelector(this.options.selectors.exit_form);exit_form.forEach(function(elem){elem.addEvent('submit',this.exitProgramLoyalty.bind(this))}.bind(this))}}.bind(this)}).request()}},exitProgramLoyalty:function(e){new Event(e).stop();document.fireEvent('logoutRozetkaClub');var options={not_show_process:true,onComplete:function(resp){this.items.confirm_form.processStop();this.items.exit_popup.elem.processStop();var response=new Response_class(resp);response.doAction();if(response.isError()){var msg=document.getElement(this.options.selectors.msg);msg.setHTML(response.Message.getContentTpl());document.fireEvent('wrongInfo',{extend_event:[{name:'eventForm',value:'logoutRozetkaClub'},{name:'eventField',value:'verify_code'},{name:'eventError',value:response.Message.content}]})}else{document.fireEvent('successLogoutRozetkaClub');this.items.exit_popup.setContent(this.options.tpl.success_exit);this.fireEvent('ExitProgramLoyalty')}}.bind(this)};this.items.exit_popup.elem.processStart(this.options.tpl.process);this.items.confirm_form=e.target;e.target.trySend(options)},onShowUserAgreement:function(){this.attachListeners()},onOpenConditions:function(){this.attachListeners()}});RozetkaExitProgramLoyalty_class.implement(new Events(),new Options());var SellButtons_class=new Class({_class:'SellButtons_class',options:{selectors:{head_link:['[name="sell_used_goods_head"]']},sell_buttons:[{name:'head_link',url_template:'{if User.getProperty(\'seller_id\')}https:\/\/my.rozetka.com.ua\/ua\/profile\/market\/item\/new\/{else}https:\/\/my.rozetka.com.ua\/ua\/signup\/#tab=seller{\/if}'}]},_user:null,elems:null,initialize:function(options){this.setOptions(options);App.addOnDomReady(function(){this._user=window['User'];this._user.addEvent('signChange',this.updateLinks.bind(this));this.elems=this.initElements(this.options.selectors,document.body);this.updateLinks()}.bind(this))},updateLinks:function(){this.options.sell_buttons.each(function(sell_button){var link_elems=this.elems[sell_button.name];link_elems.each(function(link_elem){var href=App.getHTML(sell_button.url_template,{User:this._user,Link:link_elem});link_elem.setAttribute('href',href)}.bind(this))}.bind(this))}});SellButtons_class.implement(new Options(),new InitElements(),new Events());var SuggestDataSourceAbstract_class=new Class({_filters:[],_prepared_data:[],_cache:{},initialize:function(options){this.setOptions(options)},getData:function(){return this._filterData(this._prepared_data)},_setData:function(prepared_data){this._prepared_data=prepared_data||[];return this},addFilter:function(callback){if(typeof callback=='function'&&this._filters.indexOf(callback)==-1){this._filters.push(callback)}},_filterData:function(data){var result=data||[];if(this._filters.length){result=data.filter(function(item_data){var result=true;this._filters.some(function(filter){result&=Boolean(filter(item_data));return!result});return result}.bind(this))}return result},requestData:function(params){throw new Error('Не реализован механизм запроса данных.')},_prepareParams:function(params){return params},_dataReady:function(){this.fireEvent('dataReady')}});SuggestDataSourceAbstract_class.implement(new Options,new Events());var SuggestDataSourceXhr_class=SuggestDataSourceAbstract_class.extend({_cache:{},options:{url:'',request_options:{method:'get',headers:{ajaxAction:null}}},requestData:function(params){params=this._prepareParams(params);var options=this.options.request_options,key=this._getCacheKey(params);if(!this._cache[key]){options.data=params;options.onSuccess=this.onResponse.bind(this,params);new Ajax(this.options.url,options).request()}else{this._setResponseData(this._cache[key],params)}},_getCacheKey:function(params){return md5(JSON.stringify(params))},_setResponseData:function(data,params){this._cache[this._getCacheKey(params)]=data;this._setData(data);this._dataReady()},onResponse:function(params,resp){var Response=new Response_class(decodeURIComponent(resp));Response.doAction();if(!Response.isError()){this._setResponseData(Response.content.records,params)}}});var SuggestDataSourceCities_class=SuggestDataSourceXhr_class.extend({options:{url:'https://my.rozetka.com.ua/ua/suggest/action=getLocalitiesForSuggestJSON/'},_prepareParams:function(params){params.name=params.name.toLowerCase();return this.parent(params)}});var SuggestDataSourceAreas_class=SuggestDataSourceAbstract_class.extend({_full_data:[],initialize:function(options,data){this.parent(options);this._full_data=data;this._setData(this._full_data)},requestData:function(params){var prepared_data=this._full_data.filter(function(area){var text=params.name;return area.title.test(new RegExp(text,'gi'))});this._setData(prepared_data);this._dataReady()}});var SuggestItem_class=new Class({_element:null,_proxied_events:['click','mousemove'],options:{data_key:'id',data_title:'title',item_block_tpl:'<li class="suggestion-i">${getTitle()}</li>'},initialize:function(item_data){this._data=item_data},init:function(){this._element=Element.from(App.getHTML(this.options.item_block_tpl,this));this._proxied_events.forEach(function(event_name){this._element.addEvent(event_name,this.onElementEvent.bind(this,[event_name]))}.bind(this))},getId:function(){return this._data[this.options.data_key]},getTitle:function(){return this._data[this.options.data_title]},getData:function(key){return key?this._data[key]:this._data},getElement:function(){return this._element},setActive:function(){this.getElement().addClass('active')},setUnactive:function(){this.getElement().removeClass('active')},onElementEvent:function(event_name,e){if(event_name=='click'){new Event(e).stop()}this.fireEvent(event_name,[this])}});SuggestItem_class.implement(new Options(),new Events());var InputSuggest_class=new Class({_data_source:null,_input:null,_hidden_input:null,_items:null,_items_instances_by_id:{},_selected:null,_active:null,_default_data:[],_suggest_block:null,_noresult_element:null,_currentValue:null,_changes_timer:null,options:{suggest_block_tpl:'<ul class="suggestions"></ul>',no_result_item_tpl:'<li class=\"suggestion-i not-found\">Місто не знайдено. <br\/>Перевірте правильність написання або введіть найближчий до вас!<\/li>',default_data:[],show_default_data_on_focus:true,items:{class_name:'SuggestItem_class',options:{data_key:'id',data_title:'title',item_block_tpl:'<li class="suggestion-i">${getTitle()}</li>'}},min_count_chars:3,hidden_value_input:{use_hidden_input:true,input_name:false}},initialize:function(data_source,input_element,suggest_container){this._input=$(input_element);this._data_source=data_source;this._suggest_container=suggest_container;this._data_source.addEvent('dataReady',this.onDataReady.bind(this))},init:function(){if(this.options.hidden_value_input.use_hidden_input){var hidden_input_name;if(this.options.hidden_value_input.input_name){hidden_input_name=this.options.hidden_value_input.input_name}else{hidden_input_name=this._input.getProperty('name');this._input.removeProperty('name')}this._hidden_input=new Element('input',{name:hidden_input_name,type:'hidden'});this._hidden_input.inject(this._input,'after')}this._suggest_block=Element.from(App.getHTML(this.options.suggest_block_tpl));this._suggest_block.hide();if(this._suggest_container){this._suggest_block.inject(this._suggest_container)}else{this._suggest_block.inject(this._input,'before')}this._noresult_element=Element.from(App.getHTML(this.options.no_result_item_tpl));this._input.addEvent('focus',this.onFocus.bind(this)).addEvent('keydown',this.onKeyDown.bind(this)).addEvent('keyup',this.onKeyUp.bind(this));$$('body').addEvent('click',this.onBlur.bind(this));this._loadDataFromDefault();this._loadDataFromDS();return this},update:function(){this._suggest_block.setHTML('');if(this._items&&this._items.length){this._items.forEach(function(item){item.getElement().inject(this._suggest_block)}.bind(this))}else if(this._items!==null){this._noresult_element.inject(this._suggest_block)}},onFocus:function(){if(this._input.value.trim()&&this._items&&this._items.length){this.show()}else if(!this._input.value.trim()&&this.options.default_data.length&&this.options.show_default){this._loadDataFromDefault();this.update();this.show()}},onBlur:function(e){e=new Event(e);if(e.type!='click'||e.target!==this._input){if(this._input.value&&this._selected){this._setSelected(this._selected)}else{this._setSelected(null)}this.hide()}},onKeyDown:function(e){e=new Event(e);if(e.key=='down'||e.key=='up'){e.stop();this._activeMove(e.key)}else if(e.key=='enter'){e.stop();this.onItemSelect(this._getActive());this.hide()}else if(e.key=='esc'){this._setSelected(null);this.hide()}else if(e.key=='tab'){this.onBlur(e)}},_activeMove:function(direction){if(this._items&&this._items.length>0){var to_set_item=this._items[0],index;if(this._getActive()&&this._items.length>1){if(direction=='up'){index=this._items.indexOf(this._getActive())-1;if(index<0){index=this._items.length-1}}else{index=this._items.indexOf(this._getActive())+1;if(index>this._items.length-1){index=0}}to_set_item=this._items[index]}this._setActive(to_set_item);this._scroll()}},_scroll:function(){var active_item=this._getActive(),item_pos,block_pos,offset=null;if(active_item){item_pos=active_item.getElement().getBoundingClientRect();block_pos=this._suggest_block.getBoundingClientRect();if(item_pos.top<block_pos.top){offset=item_pos.top-block_pos.top}else if(item_pos.bottom>block_pos.bottom){offset=item_pos.bottom-block_pos.bottom}if(offset){this._suggest_block.scrollTop=this._suggest_block.scrollTop+offset}}},_setActive:function(item){if(this._active&&this._active!==item){this._active.setUnactive()}this._active=item;this._active.setActive()},onItemSelect:function(item){this._setSelected(item);this.hide()},setValue:function(key){var item=this._items_instances_by_id[key]||null;this._setSelected(item);this.onKeyUp()},_checkChanges:function(value){if(this._input.value==''){this.hide()}else if(value==this._input.value&&(!this.options.min_count_chars||value.length>=this.options.min_count_chars)){var params={name:this._input.value};this._data_source.requestData(params)}},onKeyUp:function(e){e=e?new Event(e):null;if((!e||e.key!='tab')&&this._input.value!==this._currentValue){this._currentValue=this._input.value;clearTimeout(this._changes_timer);this._changes_timer=this._checkChanges.delay(333,this,[this._currentValue])}},getKey:function(){return this.getSelectedItem()?this.getSelectedItem().getId():null},_getActive:function(){return this._active},_setSelected:function(item){if(!this._selected||this._selected!==item){this._selected=item;this._input.value=item?item.getTitle():null;this._currentValue=item?item.getTitle():null;if(this._hidden_input){this._hidden_input.value=item?item.getId():null}this._items=null;this.fireEvent('valueChanged',item)}},getSelectedItem:function(){return this._selected||null},onItemMousemove:function(item){this._setActive(item)},onDataReady:function(){this._loadDataFromDS();this.update();this.show()},_loadDataFromDS:function(){this._loadData(this._data_source.getData())},_loadDataFromDefault:function(){this._loadData(this.options.default_data)},_loadData:function(data){this._items=[];data.forEach(function(item_data){var item_constructor=App.getConstructorByClassName(this.options.items.class_name),key_name=this.options.items.options.data_key,item;if($defined(this._items_instances_by_id[item_data[key_name]])){item=this._items_instances_by_id[item_data[key_name]]}else{item=new item_constructor(item_data).setOptions(this.options.items.options);item.addEvent('click',this.onItemSelect.bind(this));item.addEvent('mousemove',this.onItemMousemove.bind(this));item.init();this._items_instances_by_id[item.getId()]=item}if(this._items.indexOf(item)===-1){this._items.push(item)}}.bind(this))},show:function(){if(this._items!==null){this._suggest_block.show()}},hide:function(){this._suggest_block.hide()}});InputSuggest_class.implement(new Events(),new Options());var BannerApplication_class=new Class({Class:'BannerApplication_class',_popup_banner:null,_mobileDetector:null,options:{tpl:{header_banner:'',popup_banner:{template:'',content:''}},container_id:'banner-application',buttons:{close:'[name=close]',continue:'[name=app-popup-link]',open_app:'[name=app-popup-open-app]'},deep_link:{base:'',afl:'',ifl:'',link:window.location.href}},cookies:{hide_popup_banner:{name:'hide_popup_banner',options:{path:'/',domain:'.'+window.location.hostname,duration:14}}},_popup_campaign_name:'popup',_banner_campaign_name:'banner',_utm_base:'utm_source=fullversion&utm_medium=site&utm_campaign=',_container:null,_allowed_os:['AndroidOS','iOS'],_ios_name:'iOS',_is_disabled:false,show_app_popup:false,initialize:function(options,mobileDetector){this.setOptions(options);this._mobileDetector=mobileDetector},init:function(){this._container=$(this.options.container_id);if(!this._is_disabled&&this._container){this.addEvent('showPopup',this.onShowPopup.bind(this))}return this},run:function(){if(this.checkDevice()){this._initHeaderBanner();this._initPopupBanner();GTMEvents.initDataBlocks([new GTMData_BannerApplication_class()])}},checkDevice:function(){return(this._mobileDetector.phone()&&this._allowed_os.contains(this._mobileDetector.os()))},_initHeaderBanner:function(){this._container.setHTML(App.getHTML(this.options.tpl.header_banner,{deep_link:this._getDeepLinkUrl(this._banner_campaign_name)}))},_initPopupBanner:function(){if(this.show_app_popup&&!Cookie.get(this.cookies.hide_popup_banner.name)){this._showPopup();this._popup_banner.getElement(this.options.buttons.close).addEvent('click',function(){this._closePopup();document.fireEvent('ClosePopupBannerApp')}.bind(this));this._popup_banner.getElement(this.options.buttons.continue).addEvent('click',function(){this._closePopup();document.fireEvent('ContinuePopupBannerApp')}.bind(this));this._popup_banner.getElement(this.options.buttons.open_app).addEvent('click',function(){this._closePopup();document.fireEvent('OpenPopupBannerApp')}.bind(this));this.show_app_popup=false}},onShowPopup:function(){this.show_app_popup=true;if(this.checkDevice()){this._initPopupBanner()}},_showPopup:function(){this._popup_banner=new Popup_class(this.options.tpl.popup_banner.template);this._popup_banner.setOptions({closeOnCOS:false,closeOnEsc:false,holdon:true});this._popup_banner.overlayON({styles:{'background-color':'#FFF'}});this._popup_banner.setElemStyle({'width':'100%'});this._popup_banner.setPositionCalculator(new FixingPositionCalculator_class());this._popup_banner.setContent(this.options.tpl.popup_banner.content,{is_ios:(this._mobileDetector.os()==this._ios_name),pixel_ratio:this._getDevicePixelRatio(),deep_link:this._getDeepLinkUrl(this._popup_campaign_name)});this._loadImagesAndOpenPopup()},_loadImagesAndOpenPopup:function(){var images_src=[];this._popup_banner.getElements('img').each(function(img){images_src.push(img.src)});new Asset.images(images_src,{onComplete:function(){this._popup_banner.open();document.fireEvent('ShowPopupBannerApp')}.bind(this)})},_closePopup:function(){this._popup_banner.close();Cookie.set(this.cookies.hide_popup_banner.name,true,this.cookies.hide_popup_banner.options)},_getDevicePixelRatio:function(){var ratio=1;if(window.devicePixelRatio!==undefined){ratio=window.devicePixelRatio}else if(window.screen.systemXDPI!==undefined&&window.screen.logicalXDPI!==undefined&&window.screen.systemXDPI>window.screen.logicalXDPI){ratio=window.screen.systemXDPI/window.screen.logicalXDPI}return ratio},_getDeepLinkUrl:function(campaign){campaign=campaign||'';var utm=this._utm_base+campaign;return this.options.deep_link.base+'&afl='+encodeURIComponent(this._addParamsToLink(this.options.deep_link.afl,utm))+'&ifl='+encodeURIComponent(this._addParamsToLink(this.options.deep_link.ifl,utm))+'&link='+encodeURIComponent(this._addParamsToLink(this.options.deep_link.link,utm))},_addParamsToLink:function(link,params){var result=link;if(params){var a=document.createElement('a');a.href=link;a.search+=(a.search?'&':'?')+params;result=a.href}return result},disableBanner:function(){this._is_disabled=true}});BannerApplication_class.implement(new Options(),new Events());var PagesBlockSubscription_class=new Class({Class:'PagesBlockSubscription_class',options:{tpl:{process:preloaders.green_process_tpl,message:'<div class=\"pos-fix sprite-side message code${code}\"> <a href=\"\" class=\"message-close-link\" onclick=\"clearUserMessages(event);\"> <img src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" width=\"24\" height=\"24\" class=\"sprite message-close-link-img\"> <\/a> ${content} <\/div>'},selectors:{form:'form[name=subscribe_form]',email:'input[name=email]',msg:'[name=app-message]'},cssClasses:{hidden:'hidden'},_auth_blocks_options:{blocks:{simple_auth:'<div name=\"simple_auth\" class=\"hidden\"> <div class=\"clearfix auth-f-i\"> <div class=\"f-i-title-vert\">Пароль<\/div> <input type=\"password\" class=\"input-text auth-input-text\" _required=\"required\" name=\"password\" tabindex=\"2\"> <div class=\"auth-message hidden\" name=\"wrong_password_block\"> <h5 class=\"auth-forgot-pass-tooltip-title\" name=\"password_hint\"><\/h5> <p class=\"auth-forgot-pass-tooltip-note\">Перевірте розкладку клавіатури і&nbsp;Caps Lock<\/p> <span name=\"send_me_temp_pass\"><\/span> <\/div> <div name=\"recaptcha\" class=\"recaptcha\" data-sitekey=\"6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU\"><\/div> <div class=\"auth-message recaptcha-tooltip hidden\" name=\"wrong_captcha_signin_block\"> Необхiдно пiдтвердити, що ви не робот <\/div> <\/div> <div class=\"clearfix f-i auth-f-submit\"> <div class=\"auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <button class=\"btn-link-i\" id=\"signin\" name=\"auth_submit\" tabindex=\"3\">Увійти<\/button> <\/span> <a href=\"https:\/\/my.rozetka.com.ua\/ua\/remind-password\/\" class=\"xhr novisited auth-forgot-pass-link\" name=\"forgot_button\" tabindex=\"4\">Я забув пароль<\/a> <\/div> <\/div> <\/div>',get_temp_pass:'<div name=\"get_temp_pass\" class=\"hidden\"> <div class=\"clearix f-i\"> <div class=\"auth-remember-pass-submit\"> <span class=\"btn-link btn-link-gray auth-remember-pass-submit-btn\"> <input class=\"btn-link-i\" type=\"submit\" name=\"send_temp_pass_button\" value=\"Отримати тимчасовий пароль\" tabindex=\"2\"> <\/span> <\/div> <div class=\"auth-remember-pass\"> <a href=\"{$menu.my->checkout->authorization.href}\" class=\"xhr novisited auth-remember-pass-link\" name=\"remembered_button\" tabindex=\"3\">Я згадав свій пароль<\/a> <\/div> <\/div> <\/div>',temp_pass_sent:'<div class=\"clearfix f-i hidden\" name=\"temp_pass_sent\"> <div class=\"auth-f-i\"> <div class=\"clearfix f-i-title-vert\"> Тимчасовий пароль <\/div> <input class=\"input-text auth-input-text\" type=\"password\" _required=\"required\" name=\"password\" tabindex=\"2\"> <div class=\"auth-message hidden\" name=\"wrong_temp_pass_block\"> <h5 class=\"auth-forgot-pass-tooltip-title\" name=\"temp_pass_hint\"><\/h5> <\/div> <\/div> <div class=\"clearfix f-i auth-f-submit\"> <div class=\"auth-f-submit-btn\"> <span class=\"btn-link btn-link-blue\"> <input class=\"btn-link-i\" type=\"submit\" name=\"temp_submit\" value=\"Увійти\" tabindex=\"4\"> <\/span> <a href=\"{$menu.my->checkout->authorization.href}\" class=\"xhr novisited auth-remember-pass-link\" name=\"pass_sent_remembered_button\" tabindex=\"3\">Я&nbsp;згадав свій пароль<\/a> <\/div> <\/div> <\/div>'},tpl:{email_hint:'<div class=\"auth-message\"> <p class=\"auth-message-text\" name=\"email_hint\"> {if msg} ${msg} {elseif temp_pass_sent_by_phone} На&nbsp;вказаний телефон надіслано тимчасовий пароль, введіть його {else} На&nbsp;вказану адресу ел.&nbsp;пошти надіслано тимчасовий пароль, введіть його {\/if} <\/p> <\/div>'},selectors:{send_form_btn_block:'[name=subscribe_btn_block]',login:'input[name="email"]'},blocks_type:'subscribe'},location:null},_container:null,_form:null,_email:null,_msg:null,_click_button:false,initialize:function(container){this._container=container},init:function(){this._form=this._container.getElement(this.options.selectors.form);this._form&&this._form.addEvent('submit',this._handlerSubmitForm.bind(this));this._email=this._form.getElement(this.options.selectors.email);this._email&&this._preFilling();this._msg=this._container.getElement(this.options.selectors.msg);if(window['User']){User.addEvent('signIn',this._handlerSignIn.bind(this));User.addEvent('signOut',this._handlerSignOut.bind(this));User.isAuth()&&this._handlerSignIn(User.S)}},_handlerSignIn:function(data){var result=false;if(data['subscribes']){if(this._checkSubscribes(data.subscribes)&&!this._click_button){this._form.hide()}this._preFilling();this._email.readOnly=true}},_handlerSignOut:function(data){this._resetForm()},_resetForm:function(){this._msg.innerHTML='';this._form.show();this._email.readOnly=false;this._click_button=false},_checkSubscribes:function(subscribes){var signed_subscribes=[],result=false;signed_subscribes=Object.values(subscribes).filter(function(subscribe){return subscribe['signed']});return Object.getLength(signed_subscribes)==Object.getLength(subscribes)},_handlerSubmitForm:function(event){var options={process:this.options.tpl.process,onComplete:this._handlerComplete.bind(this)};event&&new Event(event).stop();this._form.trySend(options);this._click_button=true},_handlerComplete:function(response){response=new Response_class(response);this._form.processStop();this._form.showUpHints();if(response.isError()){if(response['Message']&&response.Message.code&&response.Message.code==response.Message.CODE.REQUIRED_AUTHORIZE){this._needAuth(response.Message)}else{response['Message']&&this._msg.setHTML(response.Message.getContentTpl(this.options.tpl.message))}}else{this._form.hide();this._onResponseDone(response)}response.doAction()},_onResponseDone:function(response){response['Message']&&this._msg.setHTML(response.Message.getContentTpl(this.options.tpl.message));if(this.options.location){window.location.href=this.options.location}document.fireEvent('subscribeInPage')},_needAuth:function(msg){new AuthorizationBlocks_class(this._form,this.options._auth_blocks_options).needAuth(msg)},_preFilling:function(){if(window['User']&&User.getEmail()&&this._email){this._email.value=User.getEmail()}}});PagesBlockSubscription_class.implement(new Options());var FooterSubscription_class=PagesBlockSubscription_class.extend({_needAuth:function(msg){Cookie.set('login',this._email.getValue());User.SignIn(msg);document.addEventOnce('userSignedIn',this._handlerSubmitForm.bind(this))},_handlerComplete:function(response){response=new Response_class(response);this._form.processStop();this._form.showUpHints();if(response.isError()){if(response['Message']&&response.Message.code&&response.Message.code==response.Message.CODE.REQUIRED_AUTHORIZE){this._needAuth(response.Message)}else{response['Message']&&this._msg.setHTML(response.Message.getContentTpl(this.options.tpl.message))}}else{this._form.hide();this._onResponseDone(response);document.fireEvent('footerSubscribes',{extend_event:[{name:'eventAction',value:'click'},{name:'eventCategory',value:"Interactions"},{name:'eventLabel',value:'subscribe'},{name:'eventLocation',value:'footer'},{name:'eventContent',value:User.isAuth()?'existing':'new'}]})}response.doAction()},_onResponseDone:function(response){response['Message']&&this._msg.setHTML(response.Message.content);window.scrollTo(null,this._container.getPosition().y)},_checkSubscribes:function(subscribes){var signed_subscribes=[],auto_subscribes=[];auto_subscribes=Object.values(subscribes).filter(function(subscribe){return subscribe['is_auto']});signed_subscribes=Object.values(auto_subscribes).filter(function(subscribe){return subscribe['signed']});return Object.getLength(signed_subscribes)==Object.getLength(auto_subscribes)}});var ABlocker_class=new Class({_dot:null,create:function(){var dot,dotClass='twoads Web-Advert printhousead ad-24x24 side-ad Web-Ad adlabs ads-manager adap',dotStyle='position: absolute !important; top: -1000px !important; left: -10000px !important; width: 1px !important; height: 1px !important;';dot=document.createElement('div');dot.setAttribute('class',dotClass);dot.setAttribute('style',dotStyle);this._dot=document.body.appendChild(dot)},check:function(){var dotTemp;window.adBlock=false;if(this._dot===null){this.create()}if(document.body.getAttribute('abp')!==null||this._dot.offsetParent===null||this._dot.offsetHeight==0||this._dot.offsetLeft==0||this._dot.offsetTop==0||this._dot.offsetWidth==0||this._dot.clientHeight==0||this._dot.clientWidth==0){window.adBlock=true}if(window.getComputedStyle!==undefined){dotTemp=window.getComputedStyle(this._dot,null);if(dotTemp.getPropertyValue('display')=='none'||dotTemp.getPropertyValue('visibility')=='hidden'){window.adBlock=true}}window.dataLayer&&dataLayer.push({'adBlock':window.adBlock});this.destroy()},destroy:function(){document.body.removeChild(this._dot);this._dot=null}});var CityDefinition_class=new Class({cities_suggest:null,maxmind_city_title:null,maxmind_region_title:null,internal_city_id:null,_current_step:null,_json_data:null,_found_city_data:null,initialize:function(){this.cities_suggest=new SuggestDataSourceCities_class()},init:function(defined_user_city_json){this._json_data=defined_user_city_json;if(this._json_data){this._parseJson();this.addEvent('cityNotDefined',this._tryNextDefineMethod.bind(this));this._tryNextDefineMethod()}else{this._onCityNotDefined('defined_user_city_json is empty')}},_parseJson:function(){var defined_user_city=App.getService('JSON').parse(this._json_data);if($defined(defined_user_city.defined_maxmind)){this.maxmind_city_title=defined_user_city.defined_maxmind.city_name||'';this.maxmind_region_title=defined_user_city.defined_maxmind.region_name||''}this.internal_city_id=defined_user_city.defined_internal||''},_tryNextDefineMethod:function(){switch(this._current_step){case null:this._current_step='maxmind';this._tryDefineByMaxMind();break;case'maxmind':this._current_step='internal';this._tryDefineByInternal();break;default:this._current_step=null;this._onCityNotDefined()}},_tryDefineByMaxMind:function(){if(this.maxmind_city_title&&this.maxmind_city_title.length>0){this.cities_suggest.addEventOnce('dataReady',this._onGetDataFromSuggest.bind(this));this.cities_suggest.requestData({name:this.maxmind_city_title})}else{this.fireEvent('cityNotDefined')}},_onGetDataFromSuggest:function(){var result_data=this.cities_suggest.getData();result_data.some(this._maxMindChecker.bind(this));this._found_city_data?this._onGetDefinedCity(this._found_city_data,'defined_MaxMind'):this.fireEvent('cityNotDefined')},_tryDefineByInternal:function(){if(this.internal_city_id&&this.internal_city_id.length>0){this._found_city_data={id:this.internal_city_id};this._onGetDefinedCity(this._found_city_data,'defined_internal')}else{this.fireEvent('cityNotDefined')}},_maxMindChecker:function(result_item){if(result_item.title==this.maxmind_city_title||result_item.old_title==this.maxmind_city_title){if(this.maxmind_region_title&&result_item.region.length>0&&this.maxmind_region_title.test(result_item.region)||this.maxmind_region_title&&result_item.region_old_title.length>0&&this.maxmind_region_title.test(result_item.region_old_title)){this._found_city_data=result_item;return false}else if(this._found_city_data===null){this._found_city_data=result_item}}return true},_internalChecker:function(result_item){if(result_item.id==this.internal_city_id){this._found_city_data=result_item;return false}return true},_onGetDefinedCity:function(found_city_data,define_type){if(found_city_data&&found_city_data.id){App.getService('User').setVisitorCustomVar(found_city_data.id);App.getServiceDelay('CityChooser').then(function(city_chooser){city_chooser.initCurrentCity()});var event_data={extend_event:[{name:'eventContext',value:define_type},{name:'eventContent',value:found_city_data.id}]};document.fireEvent('autoCityChoose',event_data)}else{this._onCityNotDefined('Bad result data: '+App.getService('JSON').stringify(found_city_data))}},_onCityNotDefined:function(error_text){Cookie.set('geoip_not_found',true,{duration:0});if(!error_text){error_text=this._json_data}var event_data={extend_event:[{name:'eventContext',value:'notfound'},{name:'eventContent',value:error_text}]};document.fireEvent('autoCityChoose',event_data)}});CityDefinition_class.implement(new Options(),new Events());var RozetkaJSON=new Class({parse:function(jsonString,reviver){var json_object=null;try{json_object=JSON.parse(jsonString,reviver)}catch(e){e.message=e.message+' in string "'+jsonString+'"';throw e}return json_object},stringify:function(value,replacer,space){return JSON.stringify(value,replacer,space)}});var RozetkaBuyButton_class=new Class({buy_button_default:'',goods:{},setDefaultBuyButtonTitle:function(default_title){this.buy_button_default=default_title},setGoodsBuyButtonTitle:function(goods_id,title){this.goods[goods_id]=title},getBuyButtonTitleByGoodsId:function(goods_id){return this.goods[goods_id]?this.goods[goods_id]:this.buy_button_default}});var ReCaptchaMainRequiredStrategy_class=new Class({options:{is_need_show_captcha:false,check_action:''},isNeedCaptcha:function(){return new Promise(function(resolve){if(this.options.is_need_show_captcha){resolve()}}.bind(this))}});ReCaptchaMainRequiredStrategy_class.implement(new Options());var ReCaptchaSignInRequiredStrategy_class=new Class({options:{action:'/action=getFailedAuthsCount/?name=signin_captcha',num_auth_limit:3},isNeedCaptcha:function(){return new Promise(function(resolve,reject){new Ajax(this.options.action,{method:'get',onComplete:function(resp){var auths_count=JSON.parse(resp);if(auths_count.ip>=Number(this.options.num_auth_limit)){resolve()}else{reject()}}.bind(this)}).request()}.bind(this))}});ReCaptchaSignInRequiredStrategy_class.implement(new Options());var ReCaptchaRemindPasswordRequiredStrategy_class=new Class({options:{action:'/action=getFailedAuthsCount/?name=remind_password',num_auth_limit:3},isNeedCaptcha:function(){return new Promise(function(resolve,reject){new Ajax(this.options.action,{method:'get',onComplete:function(resp){var auths_count=JSON.parse(resp);if(auths_count.ip>=Number(this.options.num_auth_limit)){resolve()}else{reject()}}.bind(this)}).request()}.bind(this))}});ReCaptchaRemindPasswordRequiredStrategy_class.implement(new Options());var ReCaptcha_class=new Class({Class:'ReCaptcha',options:{message:'Необхiдно пiдтвердити, що ви не робот',message_code:Message_class.prototype.CODE.ALERT,response_selector:'[name=g-recaptcha-response]',recaptcha_selector:'[name=recaptcha]',captcha_placeholder:'[name=recaptcha_placeholder]',recaptcha_name:'recaptcha',check_response_captcha_uri:null,check_response_captcha_data:{},captcha_params:{size:'normal'},process_tpl:preloaders.process_tpl,sitekey:'6LfkjwsUAAAAADMhaPs2VdA5sdFj7cP6hU2aiaJU'},_default_required_strategy_class:'ReCaptchaSignInRequiredStrategy_class',_required_strategy:null,initialize:function(options,required_strategy){this.setOptions(options);this._required_strategy=required_strategy},init:function(form){this.tryShowCaptcha(form);if(form){form.addEvent('onResponseError',function(){if(!this.reset(form)){this.tryShowCaptcha(form)}}.bind(this))}},check:function(form,not_show_msg){var result=false;if(this.isValid(this.getCaptchaByForm(form))){result=true}else if(!not_show_msg){this.showMessage(form.getParent())}return result},_getRequiredStrategy:function(){if(!this._required_strategy){this._required_strategy=new(App.getConstructorByClassName(this._default_required_strategy_class))(this)}return this._required_strategy},isValid:function(captcha){return!captcha||!captcha.id||grecaptcha.getResponse(captcha.id)},showMessage:function(elem){App.showMessage(new Message_class({content:this.options.message,code:this.options.message_code}),elem)},onCaptchaResponse:function(form,code){this.fireEvent('correctCaptchaForm');if(this.options.check_response_captcha_uri){var type=null;form.processStart(this.options.process_tpl);this.fireEvent('startCheckCaptcha');this.options.check_response_captcha_data['code']=code;new Ajax('/cgi-bin/form.php',{headers:{ajaxAction:this.options.check_response_captcha_uri,service:type},method:'post',onComplete:function(resp_text){var response=new Response_class(resp_text);if(!response.isError()){this.fireEvent('captchaValid',response)}else{App.showMessage(response.Message,form);this.reset(form)}form.processStop()}.bind(this)}).request(this.options.check_response_captcha_data)}},showCaptcha:function(form){var captcha=this.getCaptchaByForm(form);if(!captcha){captcha=document.createElement('div');captcha.setAttribute('name',this.options.recaptcha_name);captcha.setAttribute('class','recaptcha');captcha.setAttribute('data-sitekey',this.options.sitekey);form.getElement(this.options.captcha_placeholder).appendChild(captcha);captcha=this.getCaptchaByForm(form)}if(captcha.id){grecaptcha.reset(captcha.id)}else{captcha.id=grecaptcha.render(captcha,Object.merge(this.options.captcha_params,{callback:this.onCaptchaResponse.bind(this,form),"error-callback":function(e){console.error("Error",e)},"expired-callback":function(e){console.error("Expired",e)}}));if(form&&form.getValidator()){form.getValidator().addRule('callback',{callback:function(){return this.isValid(captcha)}.bind(this),assert:true,message:this.options.message},this.getResponseElem(captcha))}}this.fireEvent('showCaptcha')},isNeedCaptcha:function(){return this._getRequiredStrategy().isNeedCaptcha()},tryShowCaptcha:function(form){this.isNeedCaptcha().then(this.showCaptcha.bind(this,form),this.remove.bind(this,form))},getResponseElem:function(captcha){return captcha&&captcha.getElement(this.options.response_selector)},reset:function(form){var is_exist=false,captcha=this.getCaptchaByForm(form);if(captcha&&captcha.id){grecaptcha.reset(captcha.id);is_exist=true}if(!is_exist){this.tryShowCaptcha(form)}return is_exist},remove:function(form){var captcha=this.getCaptchaByForm(form);if(captcha){this.getCaptchaByForm(form).remove()}},getCaptchaByForm:function(form){return form.getElement(this.options.recaptcha_selector)}});ReCaptcha_class.implement(new Options(),new Events());var UserAgreementPopup_class=new Class({options:{selectors:{terms_link:'div[name=signup-terms-block] span'}},_popup:null,single_popup:false,initialize:function(popup,single_popup){this._popup=popup;if(single_popup){this.single_popup=true}},init:function(){var popup_link=this._popup.getElement('div[name=signup-terms-block] a');if(popup_link){popup_link.addEvent('click',function(e){new Event(e).stop();var popup_message='<div class=\"popup-agreement-content\"> <h2>Угода користувача <\/h2> <div class=\"popup-info-i-text\"><p>Я погоджуюсь з умовами політики конфіденційності і дозволяю використовувати мої персональні дані на законних засадах.<\/p> <h3>Персональні дані<\/h3> <p>На виконання вимог Закону України &quot;Про захист персональних даних&quot; даю згоду на обробку моїх персональних даних з метою забезпечення реалізації цивільно-правових відносин, надання\/отримання та здійснення розрахунків за придбані товари\/послуги, в тому числі шляхом кредитування. Не заперечую щодо перевірки інформації у відповідних бюро кредитних історій з метою з&rsquo;ясування відомостей, які стосуються виконання мною взятих на себе зобов&rsquo;язань по договорам (в т.ч. кредитним), у випадку наявності таких, тим самим розуміючи, що об&rsquo;єм інформації, яка буде перевірятися, може включати в себе інформацію, яка стосується банківської таємниці, і з&rsquo;ясування якої буде такою, яка буде повною та достатньою для розуміння мого соціального, майнового стану, платоспроможності та несення можливої подальшої майнової відповідальності, у випадку її необхідності. Я також погоджуюсь з тим, що володілець має право надавати доступ та передавати мої персональні дані третім особам без будь-яких додаткових повідомлень, не змінюючи при цьому мети їх обробки. В тому числі, на перевірку зазначеної в даній Заявці інформації та не заперечую про передачу для можливого необхідного з&#39;ясування даної інформації третім особам, під якими розумію: фінансові установи, колекторські компанії, оператори мобільного та поштового зв&rsquo;язку, інші фізичні та\/або юридичні особи.<\/p> <p>Ми цінуємо Ваше право на особисте життя та нерозголошення Вашої персональної інформації. Ця Політика конфіденційності - правило, яким користуються всі співробітники нашого сервісу, та регламентує збір і використання особистої інформації, яка може бути запрошена\/отримана при відвідуванні нашого веб-сайту https:\/\/rozetka.com.ua\/ua\/, при використанні сервісу, при замовленні, листуванні або телефонній розмові. Якщо у Вас виникнуть питання або проблеми у зв&rsquo;язку з конфіденційністю, надсилайте, будь ласка, свої питання або зауваження на електронну адресу: doc@rozetka.ua.<\/p> <h3>Яку інформацію ми збираємо<\/h3> <p>На нашому сайті, в разі, коли Ви робите замовлення, берете учать в акції, дослідженнях або іншим чином взаємодієте з нами, ми збираємо як особисту інформацію, так і загальні дані.<\/p> <p>Особиста інформація стосується окремого споживача - приміром, ім&#39;я, адреса, номер телефону, e-mail, тощо. Такі дані ми отримуємо лише від осіб, які надають її свідомо та з власного бажання. Наприклад, зареєструвавшись на нашому сайті, або вказуючи ім&#39;я та адресу із запитом на отримання подальшої інформації від нас. Ми не вимагаємо реєстрації або надання такої інформації для перегляду нашого сайту та отримання доступу до його змісту.<\/p> <p>Для того щоб зробити замовлення товарів\/послуг, брати участь у акціях, дослідженнях або іншим чином взаємодіяти з нами, Ви повинні уважно ознайомитися з Вашими правами та обов&rsquo;язками щодо обробки персональних даних, які зазначені в ст. 8 З.У. &laquo;Про захист персональних даних&raquo; , уважно ознайомитися з даною Політикою конфіденційності, а також висловити свою повну згоду з їх умовами.<\/p> <p>Якщо Ви не погоджуєтеся з будь-якою з умов даної Політики конфіденційності та вищезазначеного Положення про захист персональних даних, будь ласка, не надавайте особисту інформацію.<\/p> <p>Згоду на використання Вашої особистої інформації Ви можете відкликати в будь-який момент. Для цього достатньо надіслати повідомлення електронною поштою, з поміткою в темі листа &laquo;Персональні дані&raquo;, за адресою: doc@rozetka.ua.<\/p> <h3>Чому ми обробляємо персональні дані<\/h3> <p>Персональні дані - відомості чи сукупність відомостей про фізичну особу, яка ідентифікована або може бути конкретно ідентифікована.<br> Ми можемо обробляти Ваші персональні дані для наступних цілей. При цьому одночасно можуть застосовуватися одна або кілька цілей.<\/p> <p><u>Отримання замовлення<\/u>. Ми можемо використовувати Ваші персональні дані для отримання замовлення, яке Ви зробили, для обробки Ваших запитів, або для інших цілей, які можуть існувати для досягнення кінцевої мети &ndash; задовольнити інтереси споживача, а також для запобігання та розслідування випадків шахрайства та інших зловживань.<\/p> <p><u>Спілкування з Вами<\/u>. Ми можемо використовувати Ваші персональні дані для зв&#39;язку з Вами, наприклад повідомити Вас про зміну наших послуг або надіслати Вам важливі повідомлення та інші подібні повідомлення, що стосуються замовлення, що було Вами зроблено та зв&#39;язатися з Вами в цілях, пов&rsquo;язаних з обслуговуванням споживача\/клієнта.<\/p> <p>Ми діємо відповідно до цієї Політики конфіденційності, на підставі Положення про обробку і захист персональних даних та на підставі чинного законодавства України. Володільцем персональних даних є ТОВ &laquo;Укрпартнер&raquo;, що знаходиться за адресою : м. Київ, вул. Нижньоюркiвська, буд. 3.Ми маємо право зберігати Персональні дані стільки, скільки необхідно для реалізації мети, що зазначена у даній Політиці конфіденційності або у строки, встановлені чинним законодавством України або до моменту видалення Вами цих даних.<\/p> <h3>Як збираємо інформацію<\/h3> <p>Особиста інформація, як ми зазначили вище, надходить безпосередньо від Вас, та з Вашого відома. Так, коли Ви реєструєтеся на сайті, ми отримуємо надану Вами інформацію. Коли Ви реєструєтеся в промо-акції, ми збираємо інформацію, необхідну для Вашої участі, аби виконати наші зобов&#39;язання перед Вами. Коли Ви здійснюєте замовлення товару, ми збираємо вказану Вами інформацію, щоб мати змогу оформити замовлення та доставити його Вам. Коли Ви надсилаєте нам електронного листа, ми зберігаємо вказану Вами адресу електронної пошти, щоб мати змогу відповісти.<\/p> <p>Також ми постійно збираємо загальну інформацію, коли Ви заходите на наш веб-сайт. Процес збору таких даних відбувається з допомогою технологій cookies, як пояснюється нижче.<\/p> <h3>Cookies<\/h3> <p>Як і багато інших компаній, ми використовуємо технологію cookies на нашому сайті та поза його межами. Cookies - це уривки інформації, які веб-сайт передає на жорсткий диск споживача для зберігання інформації, пов&rsquo;язаної з веб-сайтом. Ця технологія розширює Ваші можливості використання інтернету, зберігаючи Ваші пріоритети під час перегляду певного сайту. Технологія cookies не містить особистої інформації і не може жодним чином налаштовувати Вашу систему або зчитувати інформацію з Вашого жорсткого диска.<\/p> <p>Під час перегляду нашого веб-сайту ми можемо розмістити cookies на Вашому комп&#39;ютері. Такі тимчасові cookies використовують для підрахунку кількості візитів на наш сайт. Вони видаляються, коли Ви виходите з браузера. Постійні cookies можуть зберігатися на Вашому комп&#39;ютері Вашим браузером. Під час реєстрації цей тип cookies повідомляє: вперше Ви до нас завітали чи заходили на наш сайт раніше. Cookie не містять Персональних даних і можуть бути заблоковані Вами у будь-який момент. Сookies не отримують особистої інформації про Вас та не надають нам Вашої контактної інформації, а також не отримують жодної інформації з Вашого комп&#39;ютера. Ми використовуємо cookies для визначення характеристик сайту та пропозицій, які Вам найбільше подобаються з метою надання Вам більше інформації, в якій Ви зацікавлені. Крім того, файли cookie використовуються, щоб зробити веб-сайт https:\/\/rozetka.com.ua\/ua\/ безпечним, захищеним і зручним. Файли cookie забезпечують підтримку функцій безпеки та їх запуск. Файли cookie також дозволяють відстежувати порушення ПОЛІТИКИ КОНФІДЕНЦІЙНОСТІ відвідувачами або пристроями. Файли cookie допомагають оцінити кількість і частоту запитів, а також виявляти і блокувати тих відвідувачів або пристрої, які намагаються виконати пакетні завантаження інформації з веб-сайту.<\/p> <p>Ярлик &quot;help&quot; на панелі більшості браузерів проінформує Вас як заборонити браузеру приймати нові cookies, як отримувати повідомлення від браузера, що Ви отримали нові cookies, або як відключити cookies. Пам&#39;ятайте, що cookies дозволяють Вам повною мірою користуватися всіма можливостями веб-сайту https:\/\/rozetka.com.ua\/ua\/, і ми рекомендуємо Вам залишати їх ввімкненими.<\/p> <p>Крім того, веб-сайт https:\/\/rozetka.com.ua\/ua\/ може містити посилання на сайти, які не управляються ТОВ &quot;Укрпартнер &quot;. Такі посилання наведені виключно для інформаційних цілей.<\/p> <p>Технічне оснащення сторінок сайту https:\/\/rozetka.com.ua\/ua\/ може включати в себе модулі:<\/p> <ul style=\"list-style-type:disc;padding:10px 0 10px 20px\"> <li>Соціальної мережі Facebook (facebook.com), управління якої відбувається зі штаб-квартири компанії Facebook Inc , Facebook Corporate Office, який знаходиться за адресою: Headquarters 1601 S. California Ave . Palo Alto , CA 94304 , USA, телефон: +1 (650 ) 543-4800<\/li> <li>Інформаційної мережі Twitter (twitter.com), управління якою здійснюється з офісу компанії Twitter , Inc., який знаходиться за адресою: 1355 Market St, Suite 900 San Francisco, CA 94103, USA, телефон: +1 ( 415 ) 222-9958;<\/li> <li>Соціального форуму Youtube (youtube.com) , управління яким здійснюється з офісу компанії YouTube, LLC, який знаходиться за адресою: 901 Cherry Ave., San Bruno, CA 94066, USA, телефон: +1 (650 ) 253-0000<\/li> <li>Соціальної мережі Google+ (http:\/\/www.google.com\/intl\/ru\/+\/learnmore\/better\/), управління якою здійснюється з офісу компанії 1600 Amphitheatre Parkway, Mountain View, CA 94043, USA, телефон: +1 ( 650 ) 253-0000.<\/li> <\/ul> <p>Ці модулі можуть бути кнопками синхронізації аккаунту на веб-сайті https:\/\/rozetka.com.ua\/ua\/ , Like, ретвітнути або відповідно &quot;Мені подобається&quot;. Якщо відвідувач відкривав одну з веб-сторінок, оснащену таким плагіном, його інтернет-браузер безпосередньо підключить його до серверів Facebook, Twitter, LinkedIn, Google+ або Youtube. Плагін буде передавати на сервер дані про те, які саме веб-сторінки веб-сайту https:\/\/rozetka.com.ua\/ua\/ відвідувач переглядав. При використанні будь-яких функцій плагіну, ця інформація також буде синхронізована з обліковим записом відвідувача на Facebook, Twitter, Google+ або Youtube. Більш детальну інформацію про збір і використання даних мережами Facebook, Twitter, Google+ або Youtube, а також про права і можливості щодо захисту персональних даних в даному контексті можна знайти в розділі про конфіденційність на сайтах Facebook, Twitter, LinkedIn, Google+ або Youtube<\/p> <h3>Конкурси та акції<\/h3> <p>Наш сайт іноді розміщує повідомлення про наші промо-акції, й іноді ми можемо дозволити Вам зареєструватися онлайн. У таких випадках ми використаємо надану Вами інформацію, щоб провести акцію (наприклад, повідомити Вас у разі виграшу). Через певний час після закінчення промо-акції особисту інформацію ми видаляємо із нашої бази даних, якщо Ви не надали згоди на її збереження та використання для отримання подальшої інформації від нас. Беручи участь в акції ви надаєте однозначну згоду на безкоштовне використання вашого імені, прізвища, фотографії, інтерв&rsquo;ю або інших матеріалів про вас з рекламною метою, у тому числі право публікації вашого імені та фотографії у засобах масової інформації, будь-яких друкованих, аудіо- та відеоматеріалах, інтерв&rsquo;ю зі ЗМІ. Таке використання не компенсується (не оплачується).<\/p> <h3>Треті сторони, що надають послуги<\/h3> <p>У процесі роботи ми звертаємося до інших компаній та осіб, які виконують багато функцій. Наприклад, виконання та доставку замовлень, надання підтримки споживачів, замовляємо в певних агенцій адміністрування промо-кампаній, аналіз даних,. Ці агенції можуть мати доступ до особистої інформації, якщо це необхідно для виконання їхніх функцій, однак їм заборонено використовувати особисту інформацію з іншою метою, ніж та, яка зазначена в нашій Політиці конфіденційності та в нашому Положенні про обробку і захист персональних даних, і ми вимагаємо від них дотримання конфіденційності.<\/p> <p>Загальна інформація стосується таких аспектів, як кількість відвідувачів сайту, на які сторінки вони заходять, яку інформацію завантажують, тип веб-браузера та операційна система, яку вони використовують, назва провайдера інтернет-послуг, тощо. Коли Ви заходите на наш сайт, ми автоматично отримуємо цю інформацію та узагальнюємо з подібними даними про інших відвідувачів. Збираючи таку інформацію, ми аналізуємо, як краще пристосувати наш веб-сайт до потреб відвідувачів.<\/p> <h3>Розголошення та передача даних<\/h3> <p>Ми не продаємо, не передаємо та не розголошуємо особисту інформацію, яку отримуємо на нашому сайті, третім сторонам без Вашої попередньої згоди. Ми розкриваємо особисту інформацію лише у випадках визначених чинним законодавством України, а також:<\/p> <ol style=\"padding:10px 0 10px 20px\" type=\"1\"> <li>Ми розкриємо інформацію в випадку запобігання злочину або завдання шкоди нам або третім особам;<\/li> <li>Ми розкриємо інформацію третім особам, що надають нам підтримку та послуги за допомогою яких Ви отримуєте Ваше замовлення.<\/li> <\/ol> <p>Може статися, що ми надамо загальну інформацію про наших відвідувачів (наприклад, відсоток відвідувачів сайту жіночої та чоловічої статі) рекламним агенціям, бізнес партнерам, спонсорам та іншим третім сторонам, щоб налаштувати або розширити зміст і рекламу на нашому сайті для наших споживачів. Ми також можемо збирати дані з файлів веб-реєстрації (таких як Ваш веб-браузер, операційна система, відвідані сторінки тощо), щоб зрозуміти, як відвідувачі подорожують сайтом, та які його сторони є найпопулярнішими.<\/p> <h3>Оновлення цього попередження<\/h3> <p>Ми можемо в односторонньому порядку змінювати або оновлювати частини цієї політики в будь-який час, без попереднього повідомлення. Будь-ласка, час від часу переглядайте Політику конфіденційності, щоб знати про її зміни та оновлення. Усі зміни до цієї Політики конфіденційності набувають чинності з моменту їх публікації. Коли ви робите замовлення, берете учать в акції, дослідженнях або іншим чином взаємодієте з нами, ви погоджуєтесь з новими умовами Політики конфіденційності в редакції, що діє на цей момент.<\/p> <p>У випадку визнання недійсною або нездійсненною будь-якої частини даної Політики конфіденційності, інші її частини будуть залишатися чинними.<\/p> <h3><b>ПУБЛІЧНА ОФЕРТА<\/b><\/h3> <h3><b>&quot;Офіційні правила програми &laquo;Бонус<\/b><b>ний<\/b><b> рахунок&quot; <\/b><\/h3> <p><b>Зміст<\/b><\/p> <p>1. Визначення термінів<\/p> <p>2. Загальні положення<\/p> <p>3. Умови використання Бонусного Рахунку<\/p> <p>4. Початок використання Бонусного Рахунку<\/p> <p>5. Права та обов`язки Організатора .<\/p> <p>6. Використання персональних даних Користувача<\/p> <p>7. Порядок нарахування Бонусів<\/p> <p>8. Порядок використання Бонусів<\/p> <p>9. Інші умови<\/p> <p>10. Відповідальність<\/p> <p>11. Застереження<\/p> <br> <p><b>1. <\/b><b>Визначення термінів.<\/b><\/p> <p>&nbsp;<\/p> <p>1.1 Організатор - юридична особа ТОВ &laquo;Розетка.УА&raquo;, що визначає умови та правила користування Бонусним Рахунком, та здійснює управління та організацію всіх процедур, які є невід`ємною частиною функціонування Програми лояльності &laquo;Бонусний Рахунок&raquo;.<\/p> <p>&nbsp;<\/p> <p>1.2. Програма лояльності &laquo;Бонусний Рахунок&raquo; (далі за текстом &ndash; Програма) система винагородження Учасників\/Користувачів Бонусного Рахунку шляхом надання їм привілеїв та бонусів, які можуть використовуватись, як знижка при купівлі товарів у Точці Продажу або у Партнерів Програми.<\/p> <p>&nbsp;<\/p> <p>1.3. Бонусний Рахунок - віртуальний депозитарій Бонусів Користувача, з якого можуть бути списані Бонуси під час розрахунку Користувача за товар, та на який можуть бути нараховані Бонуси при виконанні Користувачем умов їх отримання<\/p> <p>&nbsp;<\/p> <p>1.4. Користувач Рахунку (далі Користувач) - дієздатна фізична особа, яка досягла 18-річного віку, має громадянство України, та Акцептувала умови даної публічної оферти.<\/p> <p>&nbsp;<\/p> <p>1.5. Партнер Програми &ndash; суб&#39;єкт господарювання, який відповідно до умов та правил участі у Програмі лояльності &laquo;Бонусний Рахунок&raquo; нараховує Користувачам Бонуси та\/або надає їм можливість отримати інші заохочення. Актуальний перелік Партнерів Програми за їх наявності розміщується на сайті rozetka.com.ua<\/p> <p>&nbsp;<\/p> <p>1.6. Персональний Номер Користувача (далі &ndash; ПНУ) &ndash; унікальний номер, що закріплюється за кожним Користувачем у форматі номеру українського GSM-оператора, необхідний для ідентифікації Користувача в інформаційній системі Організатора .<\/p> <p>&nbsp;<\/p> <p>1.7. Бонус - віртуальна одиниця, що нараховується Користувачу та накопичуєтся на його Бонусному Рахунку, та може бути використана під час розрахунку за товари для отримання знижки. Бонус не є грошовою одиницею та не може бути обміняний на грошові кошти.<\/p> <p>&nbsp;<\/p> <p>1.8. Анкета - електронний реєстраційний документ (опитувальник), що розташований у Персональному Кабінеті авторизованого відвідувача сайту Rozetka.com.ua та заповнюється останнім для реєстрації та отримання права використання Бонусного Рахунку.<\/p> <p>&nbsp;<\/p> <p>1.9. Точка продажу &ndash; Інтернет-магазин Rozetka.com.ua<\/p> <p>&nbsp;<\/p> <p>1.10. Транзакція - операція з оплати товарів, які замовлені Користувачем на сайті.<\/p> <p>&nbsp;<\/p> <p>1.11. Верифікація телефонного номеру (далі &ndash; Верифікація) &ndash; процедура підтвердження Користувачем вказаного під час реєстрації власного номеру телефону будь-якого українського GSM-оператора з метою запобігання доступу сторонніх осіб до Бонусного Рахунку Користувача.<\/p> <p>&nbsp;<\/p> <p>1.12. Публічна Оферта - пропозиція Організатора, адресована Користувачам\/потенційним Користувачам, прийняти умови даних правил на визначених нижче умовах.<\/p> <p>&nbsp;<\/p> <p>1.13 Інтернет магазин (Сайт) - засіб для представлення та або реалізації товару, шляхом вчинення електронного правочину в інформаційно-телекомунікаційній мережі за адресою https:\/\/rozetka.com.ua\/ua\/.<\/p> <p>&nbsp;<\/p> <p>1.14. Акцепт - повне та безумовне, прийняття Покупцем\/Користувачем умов Публічної оферти шляхом проходження процедури Верифікації телефонного номеру. Моментом Акцепту вважається вибір Покупцем такої опції у відповідному розділі інтернет магазину на сайті https:\/\/rozetka.com.ua\/ua\/<\/p> <p>&nbsp;<\/p> <p>1.15. Персональний кабінет - сервіс за допомогою якого покупець має можливість отримати інформацію про зроблені замовлення, покупки та Бонусний Рахунок Користувача, а також інші активності здійснювані покупцем на сайті інтернет магазину.<\/p> <p>&nbsp;<\/p> <p>&nbsp;<\/p> <p><b>2. <\/b><b>Загальні положення<\/b><\/p> <p>2.1 Ці Правила є договором приєднання у розумінні ст. 634 Цивільного кодексу України.<\/p> <p>2.2 Програма лояльності &laquo;Бонусний Рахунок&raquo; не є азартною грою, лотереєю, послугою у сфері грального бізнесу.<\/p> <p>2.3 Програма лояльності &laquo;Бонусний Рахунок&raquo; діє по всій території України.<\/p> <p>&nbsp;<\/p> <p><b>3. <\/b><b>Умови користування Бонусним Рахунком <\/b><\/p> <p>3.1. Будь-яка фізична особа, яка відповідає вимогам зазначеним в п.1.3. даної Оферти , має право стати Учасником Програми &laquo;Бонусний Рахунок&raquo; та долучитися до користування Бонусним Рахунком шляхом коректного та достовірного заповнення Анкети Користувача, Верифікації власного номеру мобільного телефону та акцепту умов даної Оферти. Виконання умов зазначених в даній Оферті є обов`язковим для всіх Учасників Програми &laquo;Бонусний Рахунок&raquo; та Користувачів Бонусного Рахунку.<\/p> <p>3.2. Користувачі Бонусного Рахунку мають право отримувати та накопичувати Бонуси. При здійсненні покупок у Точках Продажу, Користувачі Бонусного Рахунку мають право отримувати знижки, розмір яких встановлюється Організатором та розраховується на підставі накопичених та використаних Користувачем Бонусів. За фактом розрахованої та наданої знижки, аналогічна сума Бонусів списується Організатором з Бонусного Рахунку Користувача.<\/p> <p>3.3. Користувачі Бонусного Рахунку мають право на отримання додаткових переваг, які надаються на встановлених Організатором умовах або згідно правил акційних та маркетингових заходів.<\/p> <p>3.4. Користувач надає свою беззаперечну згоду на збір, обробку, зберігання та використання своїх персональних даних Організатором згідно ст.8 Закону України &laquo;Про захист персональних даних&raquo; положення чинного законодавства України та умов даної Оферти.<\/p> <p>Доступ до Персональних даних Користувача можуть мати лише уповноважені представники Організатора.<\/p> <p>3.5. Інформація про умови та правила користування Бонусним Рахунком є публічною та розміщується на сайті www.rozetka.com.ua<\/p> <p>3.6. Основним ідентифікатором Користувача Бонусного Рахунку в інформаційній системі Організатора є його прізвище, ім&#39;я та по батькові, а також Персональний Номер Користувача у форматі номеру українського GSM-оператора.<\/p> <p>3.7. Бонусний Рахунок призначений виключно для особистого користування фізичними особами. Бонуси не можна передавати, продавати, отримати компенсацію в т.ч. грошову, або будь-яким іншим способом відчужувати.<\/p> <p>3.8. Датою початку користування Бонусним Рахунком є дата Акцепту цих Правил Програми &laquo;Бонусний Рахунок&raquo; і умов користування Бонусним Рахунком на сайті Rozetka.com.ua.<\/p> <p>3.9. Персональний Номер Користувача дійсний в якості ідентифікатора Користувача в системі протягом всього терміну користування Бонусним Рахунком.<\/p> <p>3.10. Кожен Користувач Бонусного Рахунку може в будь-який час припинити користуватися Бонусним Рахунком (заблокувати його) та відмовитись від накопичення та використання Бонусів.<\/p> <p>Для цього необхідно відправити запит на відмову від користування Бонусним Рахунком на сайті www.rozetka.com.ua та ввести у відповідне поле смс-код, отриманий на Верифікований номер мобільного телефону Користувача.<\/p> <p>Після блокування Бонусного Рахунку, всі Бонуси, що були накопичені Користувачем, анулюються без змоги їх відновлення. Заблокований Бонусний Рахунок розблокуванню не підлягає. Блокування можливо тільки у випадку, коли дані особи, яка надсилає запит на блокування бонусного рахунку, збігаються з даними, зареєстрованими в інформаційній системі Організатора.<\/p> <p>3.11. У разі зміни номера мобільного телефону Користувача необхідно Верифікувати новий номер мобільного телефона на сайті Rozetka.com.ua у Персональному Кабінеті.<br> 3.12. У разі несвоєчасного інформування Користувачем про зміну номера мобільного телефону, Організатор не несе відповідальності за всі операції, що проводяться на Бонусному Рахунку Користувача до надходження відповідного інформування.<\/p> <p>&nbsp;<\/p> <p><b>4. Початок використання Бонусного Рахунку<\/b><\/p> <p>4.1. Щоб почати використання Бонусного Рахунку, потенційний Користувач повинен:<\/p> <p>1) Бути повнолітньою дієздатною фізичною особою та мати громадянство України<\/p> <p>2) Бути зареєстрованим\/авторизованим відвідувачем сайту Rozetka.com.ua<\/p> <p>3) Достовірно та коректно заповнити Анкету Користувача<\/p> <p>4) Пройти процедуру Верифікації мобільного номеру телефону шляхом введення у відповідне поле на сайті Rozetka.com.ua коду підтвердження, який висилається Організатором Користувачу у смс-повідомленні на номер мобільного телефону, вказаний Користувачем для Верифікації<\/p> <p>5) Акцептувати умови даної публічної Оферти.<\/p> <p>&nbsp;<\/p> <p>4.2. Процедура Верифікації мобільного номеру телефона Користувача є підтвердженням його погодження з даними Правилами Програми &laquo;Бонусний Рахунок&raquo;<\/p> <p>4.3. Після успішного завершення реєстрації Користувача в інформаційній системі Організатора йому присвоюється Персональний Номер Користувача, надається статус Користувача Бонусного Рахунку та активується Бонусний Рахунок.<\/p> <p>Користувач повідомляється про успішне завершення реєстрації та отримання статусу Користувача Бонусного Рахунку шляхом відображення повідомлення на сайті www.rozetka.com.ua та шляхом відправки Оператором електронного листа на електронну адресу Користувача, вказану у Анкеті.<\/p> <p>4.4. Верифікація мобільного номеру телефона доступна лише для форматів номерів українських GSM-операторів.<\/p> <p>&nbsp;<\/p> <p><b>5. Права та обов&rsquo;язки Організатора <\/b><\/p> <p>5.1. Організатор має право в однобічному порядку призупинити або припинити дію Програми &laquo;Бонусний Рахунок&raquo;, або змінити умови і правила користування Бонусним Рахунком в будь-який час. У разі припинення дії Програми, всі Бонуси, які наявні на Рахунку Користувача на цей момент, можуть бути використані ним протягом 30 (тридцяти) календарних днів з моменту публічного розміщення відповідної інформації про припинення дії Програми на сайті www.rozetka.com.ua<\/p> <p>Організатор зобов&#39;язаний публічно повідомляти Користувачів про всі зміни в правилах і умовах користування Бонусним Рахунком шляхом розміщення інформації на сайті www.rozetka.com.ua не пізніше, ніж за 30 (тридцять) календарних днів до вступу в силу таких змін.<\/p> <p>Публічне розміщення інформації про будь-які зміни в правилах і умовах користування Бонусним Рахунком на сайті www.rozetka.com.ua вважається фактом інформування Користувачів про ці зміни.<\/p> <p>5.2. Організатор має право відмовити потенційному Користувачу у бажанні використання Бонусного Рахунку, видалити або припинити дію Персонального Номера Користувача та заблокувати його Бонусний Рахунок у таких випадках:<\/p> <p>5.2.1. Використання або спроба використання Користувачем Персонального Номера, Персонального Кабінету, Бонусного Рахунку способом, який не відповідає Правилам Програми.<\/p> <p>5.2.2. Будь-яка обґрунтована підозра Організатора у зловживаннях з боку Користувача щодо користування Бонусним Рахунком.<\/p> <p>5.2.3. Відсутність активних дій Користувача протягом 36 місяців.<\/p> <p>5.2.4. Інші обставини, які Організатор буде вважати як достатніми для відмови Користувачу у користуванні Бонусним Рахунком.<\/p> <p>5.3. Організатор не несе відповідальності за будь-які втрати або збитки Користувача, які можуть виникнути в результаті таких дій.<\/p> <p>5.4. Організатор має право в односторонньому порядку списувати з Бонусного Рахунку Користувача бонуси, які були зараховані помилково або пов&#39;язані з купівлею, яка була скасована, у разі повернення товару, а також в разі виявлення шахрайства та \/ або недобросовісних дій Користувача з Персональним Номером Користувача або Бонусним Рахунком Користувача.<\/p> <p>&nbsp;<\/p> <p><b>6. Використання персональних даних Користувача.<\/b><\/p> <p>6.1. Інформація, вказана Користувачем в Анкеті (ПІБ, дата народження, номер мобільного телефону, e-mail, поштова адреса і т.п.), є його персональними даними. Персональні дані Користувача є конфіденційною інформацією, збір і подальша обробка персональних даних здійснюється Організатором відповідно до Закону України &laquo;Про захист персональних даних&raquo;, іншими нормативно-правовими актами України.<\/p> <p>6.2. Своєю згодою з цими правилами Користувач добровільно надає Організатору зазначені в Анкеті персональні дані для реєстрації в інформаційній системі в якості Користувача Бонусного Рахунку, а також з метою підтримки довгострокового співробітництва з Організатором. Користувач також дає згоду на використання його персональних даних для обробки замовлень на придбання товарів Організатора, отримання рекламних та спеціальних пропозицій, інформації про акції, розіграші, іншої інформації про діяльність Організатора (комерційних партнерів). Для цілей, передбачених цим пунктом, Організатор має право направляти листи, повідомлення та матеріали на поштову адресу, e-mail Користувача, Push-повідомлення, а також відправляти sms-повідомлення, здійснювати дзвінки на вказаний в Анкеті телефонний мобільний номер.<\/p> <p>6.3. Для цілей, передбачених п. 5.2 Правил, Користувач надає Організатору право здійснювати обробку його персональних даних, в тому числі: записувати персональні дані в бази даних Організатора (без додаткового повідомлення Користувача про це), здійснювати довічне зберігання даних, їх накопичення, оновлення, зміну (у разі необхідності). Організатор зобов&#39;язується забезпечити захист даних від несанкціонованого доступу третіх осіб, не поширювати і не передавати дані будь-якій третій стороні (крім передачі даних пов&#39;язаним особам, комерційним партнерам, особам, уповноваженим Організатором для здійснення безпосередньої обробки даних для зазначених цілей, а також на обов&#39;язковий запит компетентного державного органу).<\/p> <p>6.4. У разі зміни своїх персональних даних Користувач повинен надати Організатору оновлену інформацію, звернувшись за телефоном гарячої лінії Організатора або шляхом внесення змін у розділ &laquo;Персональні дані&raquo; Персонального Кабінету Користувача на сайті www.rozetka.com.ua. У разі невиконання Користувачем даного вимоги, Організатор не несе відповідальності за несприятливі наслідки, пов&#39;язані з використанням застарілих даних.<\/p> <p>6.5. Користувач безпосередньо після реєстрації або в будь-який інший момент може встановити заборону (обмеження) на використання його персональних даних. Для цього Користувач повинен звернутися за телефоном гарячої лінії Організатора з відповідним повідомленням. Користувачу також надаються інші права, передбачені статтею 8 Закону України &laquo;Про захист персональних даних&raquo;.<\/p> <p>6.6. Анкета Користувача не приймається Організатором у випадку некоректного заповнення даних.<\/p> <p>6.7. Організатор зобов&#39;язується вчасно інформувати Користувача про його можливості та винагороди, однак не несе відповідальності за повідомлення, які не були доставлені Користувачу в результаті незалежних від Організатора обставин.<\/p> <p>6.8. Користувач надає Організатору право направляти йому будь-яку інформацію комерційного і \/ або інформаційного характеру про Програму &laquo;Бонусний Рахунок&raquo; або Партнерів Програми та про інші споживчі пропозиції поштою, електронною поштою, телефоном та \/ або SMS.<\/p> <p>6.9. Дані Користувача, зазначені в Анкеті, є конфіденційними. Доступ до даних мають відповідальні особи Організатора і сам Користувач, а також ці дані можуть бути надані на вимогу правоохоронних та \/ або інших органів відповідно до чинного законодавства.<\/p> <p>Відповідальність за недостовірність даних у анкеті персональних даних несе Користувач Бонусного Рахунку.<\/p> <h2>&nbsp;<\/h2> <p><b>7. Порядок нарахування бонусів<\/b><\/p> <p>7.1 Кожен Користувач при здійсненні покупок в інтернет магазині Rozetka.com.ua шляхом оформлення замовлення через сайт www.rozetka.com.ua або за фактом виконання умов Програми &laquo;Бонусний Рахунок&raquo; та\/або спільних маркетингових заходів та пропозицій у Партнерів, має право отримувати Бонуси на свій Бонусний Рахунок та інші додаткові переваги, якщо вони визначені правилами Програми та\/або правилами таких маркетингових заходів.<\/p> <p>7.2 При виконанні Користувачем умов отримання Бонусів, на його Бонусний Рахунок нараховується сума Бонусів, встановлена Організатором для конкретного товару у конкретний проміжок часу та в момент підтвердження Користувачем замовлення товару є дійсною. Сума бонусів до нарахування за конкретний товар встановлюється Організатором в абсолютному або відносному значенні до вартості такого товару та відображується на сайті у абсолютному еквіваленті. Якщо при оплаті такого товару Користувач використав Бонуси для отримання знижки, сума Бонусів до нарахування може бути перерахована відносно до суми, сплаченої грошовими коштами. Сума Бонусів зараховується на Бонусний Рахунок Користувача у абсолютному еквіваленті.<\/p> <p>7.3. Користувач має змогу отримувати на свій Рахунок Бонуси за свої дії, що не підпадають під загальноприйняте визначення операцій купівлі-продажу товарів та не супроводжуються грошовими відносинами між Організатором та Користувачем. Розмір Бонусів та перелік таких дій визначається Організатором та публікується на сайті www.rozetka.com.ua<\/p> <p>7.4. Розмір Бонусів, що підлягають нарахуванню Користувачам за придбання товарів та перелік таких товарів визначається Організатором та публікується на сайті www.rozetka.com.ua<\/p> <p>7.5. Термін активації, термін дії та сума Бонусів, що підлягає нарахуванню на Бонусний Рахунок Користувача за один і той самий товар або за іншу активність Користувача, може відрізнятись в залежності від умов діючих на даний момент акційних пропозицій та маркетингових заходів.<\/p> <p>7. 6 Організатор залишає за собою право на власний розсуд встановлювати суми Бонусів, що підлягають нарахуванню за придбання конкретного товару та\/або іншу активність Користувачів, публічно повідомивши про це Користувачів шляхом розміщення такої інформації на сайті Rozetka.com.ua або шляхом надсилання Користувачам sms-повідомлень\/електронних листів .<\/p> <p>7.7. Нарахування Бонусів відбувається в інформаційній системі Організатора на Бонусний Рахунок Користувача.<\/p> <p>7.8. Нарахування Бонусів Користувачам відбувається при готівковому розрахунку за товар та при розрахунку банківськими картками.<\/p> <p>7.9. У разі придбання товару з використанням кредитних коштів (оплати частинами) Бонуси не нараховуються.<\/p> <p>7.10. Нараховані за придбання товару Бонуси є недоступними для обчислення на їх підставі знижки та списання з Бонусного Рахунку протягом 25 (двадцяти п`яти) календарних днів з дати покупки. Датою покупки вважається дата зміни статусу замовлення таких товарів на &ldquo;Виконано&rdquo;. По завершенні вказаного терміну, нараховані Бонуси стають доступними для списання.<\/p> <p>7.11. У разі повернення Користувачем придбаного раніше товару, Бонуси, використані при придбанні даного товару, повертаються на Бонусний Рахунок Користувача, з якого вони були списані раніше, Бонуси, нараховані Користувачу за придбання даного товару, анулюються.<\/p> <p>7.12. Якщо сума грошових коштів, що підлягають поверненню Користувачеві на підставі повернення придбаного раніше товару, перевищує суму грошових коштів, яка фактично надійшла в якості оплати за такий товар раніше, бонуси, що були використані Користувачем для отримання знижки на товар, що повертається, не підлягають поверненню на Бонусний Рахунок Користувача.<\/p> <p>7.13. Якщо товар надійшов від Користувача у термін 25 днів з дати покупки, нараховані за його придбання Бонуси залишаються в стані НЕАКТИВНІ до моменту прийняття рішення Організатором щодо повернення такого товару.<\/p> <p>7.14. У разі обміну Користувачем придбаного раніше товару на інший товар\/товари, коли вартість нового товару\/товарів не перевищує суму коштів, яка фактично надійшла в якості оплати за товар, що повертається, Бонуси, використані для отримання знижки на товар, що повертається, підлягають поверненню на Бонусний Рахунок Користувача, з якого вони були списані. Бонуси, що підлягають нарахуванню за новий товар\/товари зараховуються на Бонусний Рахунок Користувача, згідно правил нарахування, що діють на момент здійснення обміну товару\/товарів. Бонуси, що були нараховані під час придбання товару, що повертається, списуються з того Бонусного Рахунку Користувача, на який вони були зараховані.<\/p> <p>7.15. У разі обміну Користувачем придбаного раніше товару на інший товар\/товари, коли вартість нового товару\/товарів перевищує суму коштів, яка фактично надійшла в якості оплати за товар, що повертається, Бонуси, використані для отримання знижки на товар, що повертається, не підлягають поверненню на Бонусний Рахунок Користувача. Бонуси, що підлягають нарахуванню за новий товар\/товари, зараховуються на Бонусний Рахунок Користувача, згідно правил нарахування, що діють на момент здійснення обміну товару\/товарів. Бонуси, що були нараховані під час придбання товару, що повертається, списуються з Бонусного Рахунку Користувача.<\/p> <p>7.16. При здійсненні обміну товару\/товарів, Бонуси не можна використати для отримання знижки на новий товар.<\/p> <p>7.17. Повернення і обмін товару, придбаного Користувачем, здійснюється в межах встановлених Законом України &laquo;Про захист прав споживачів&raquo;.<\/p> <p>7.18. Організатор залишає за собою право змінювати умови нарахування Бонусів, повідомивши про це Користувачів у порядку, встановленому даними Правилами.<\/p> <p>7.19. У разі, якщо відсутні необхідні технічні та \/ або інші можливості для нарахування Бонусів, Бонуси будуть нараховані на Бонусний Рахунок Користувача після відновлення необхідних можливостей.<\/p> <p>7.19. Бонуси не нараховуються в разі дії обмежень, встановлених Організатором.<\/p> <p>&nbsp;<\/p> <p><b>8. Порядок використання бонусів<\/b><\/p> <p>8.1 При розрахунку суми знижки, що надається Користувачам, 1 (один) використаний Користувачем Бонус надає право на отримання таким Користувачем 1 (однієї) гривні знижки.<\/p> <p>8.2. Користувач має право використовувати Бонуси, які є на його Рахунку, для отримання знижки при купівлі будь-яких товарів в Точках продажу, перелік яких встановлено Організатором та розміщено на сайті www.rozetka.com.ua<\/p> <p>8.3 Використання Користувачем накопичених Бонусів та отримання на цій підставі знижки можливе лише за умови наявності доступних для використання (списання) Бонусів на Бонусному Рахунку Користувача. Сума доступних для використання Бонусів, що відображується Користувачу під час оформлення замовлення, може відрізнятися від суми доступних для використання Бонусів, що була відображена раніше, якщо з Бонусним Рахунком Користувача в цей час відбулися зміни.<\/p> <p>8.4 Процедура списання\/нарахування Бонусів доступна Користувачам тільки при оформленні замовлення на Сайті або інших діях, за які Організатором встановлено нарахування Бонусів. Якщо оформлене на Сайті замовлення корегується Оператором Колл-центру Організатора за запитом Користувача, у разі необхідності та з метою запобігання неправомірних та шахрайських дій третіх осіб, перерахунок Бонусів до використання проводиться у межах суми, вказаної Користувачем у відповідному полі електронної форми під час оформлення замовлення на сайті і не може її перевищувати.<\/p> <p>У випадку, якщо через технічні збої під час оформлення замовлення на сайті Користувач не мав змоги використати наявні у нього та доступні для списання бонуси, він має змогу використати всі доступні для списання бонуси під час підтвердження замовлення в телефонному режимі або відмовитись від використання Бонусів у даному замовленні<\/p> <p>8.5 Бонуси можуть бути використані Користувачем Бонусного Рахунку за умови, якщо для цього є всі необхідні технічні та \/ або інші можливості: присутній інтернет-зв&#39;язок, електроенергія, справно працює програмне забезпечення, тощо.<\/p> <p>8.6 Бонуси неможливо використовувати (списувати) при придбанні:<\/p> <p>● товарів, придбаних у кредит або у розстрочку<\/p> <p>● подарункових сертифікатів<\/p> <p>● товарів, при сплаті яких використаний промокод<\/p> <p>● в разі дії інших обмежень, встановлених Організатором<\/p> <p>8.7. Організатор залишає за собою право змінювати перелік товарів \/ послуг, при придбанні яких Користувач може використовувати Бонуси.<\/p> <p>8.8. Бонуси не є і не можуть бути засобом платежу, будь-яким видом валюти чи цінного паперу.<\/p> <p>8.9. Накопичені Бонуси не можуть бути переведені в грошовий еквівалент і видані Користувачу готівковими коштами.<\/p> <p>8.10. Організатор не несе відповідальності за сплату Користувачем податків і виконання інших зобов&#39;язань, пов&#39;язаних з використанням Бонусного Рахунку.<\/p> <p>8.11. Бонуси, що не були використані Користувачем протягом 180 днів з дати їх активації на Бонусному Рахунку, вважаються анульованими і списуються з рахунку Користувача. Бонуси списуються в хронологічному порядку в залежності від їхньої дати активації.<\/p> <p>&nbsp;<\/p> <p><b>9. Інші умови<\/b><\/p> <p>9.1. Термін використання Бонусного Рахунку є необмеженим. Організатор має право вносити будь-які зміни у терміни використання Бонусного Рахунку у порядку, встановленому дійсними Правилами.<\/p> <p>9.2. Правила регулюються наказами керівника Організатора та чинним законодавством України.<\/p> <p>При розрахунках з Користувачем Організатор має право тимчасово відмовити Користувачу в нарахуванні або використанні Бонусів, у випадку відсутності, на момент звернення Користувача технічної або іншої можливості для цього.<\/p> <p>9.3. Організатор гарантує, що під час отримання, зберігання, оброблення і використання отриманої від Користувача персональної інформації він буде дотримуватися положень даних Правил та норм чинного законодавства України. У зв&rsquo;язку з цим Користувач підтверджує, що він ознайомився та повністю (однозначно) погодився із Правилами Програми &laquo;Бонусний Рахунок&raquo;, застереженнями щодо отримання, зберігання, оброблення і використання інформації, зазначеної в Анкеті.<\/p> <p>9.4. Користувач Бонусного Рахунку надає однозначну згоду на те, що всі дані, в тому числі персональні, зазначені в Анкеті, і дані про здійснені Користувачем покупки можуть бути отримані, збережені, оброблені та використані Організатором й іншими вповноваженими Організатором організаціями та третіми особами без обмеження за строком і територією, у тому числі й за межами України, з метою функціонування Програми, створення нових пропозицій, вивчення споживчого попиту, у маркетингових, інформаційних, рекламних або інших аналогічних цілях, наданні Користувачеві рекламних та інформаційних матеріалів без обмежень.<\/p> <p>9.5. Організатор залишає за собою право відмовити будь-кому в користуванні Бонусним Рахунком за своїм розсудом, без надання жодних пояснень з цього приводу та без будь-яких негативних наслідків для себе.<\/p> <p>9.6. Організатор має право в односторонньому порядку вносити зміни в дані Правила, з дотриманням процедур, зазначених для таких випадків у цих Правилах.<\/p> <p>9.7. Повідомлення про призупинення або припинення дії Програми &laquo;Бонусний Рахунок&raquo;, а також про зміну Правил Програми вважається направленим Користувачу, якщо воно було розміщено на Сайті та\/або у Точках продажу та\/або направлене Користувачу на зазначені у Анкеті адреси електронної пошти або номер мобільного телефону.<\/p> <p>&nbsp;<\/p> <p><b>10. Відповідальність.<\/b><\/p> <p>10.1. Організатор або Партнер Програми &laquo;Бонусний Рахунок&raquo; не несе відповідальності за не повноту або не достовірність даних наданих Користувачами Бонусного Рахунку. Користувачі самостійно відповідають за достовірність наданих ними даних.<\/p> <p>10.2. Відповідальність Організатора або Партнера не може перевищувати кількість Бонусів на рахунку Користувача і не включає будь-яку упущену вигоду, непрямі збитки, шкоду завдану третім особам.<\/p> <p>10.3. Організатор або Партнер не несе відповідальності за роботу інтернет провайдерів, операторів зв&#39;язку, банківських установ, сервісів оплати Visa\/MasterCard, в результаті яких необхідна інформація, дані не надійшли або надійшли із запізненням, були загублені або пошкоджені.<\/p> <p>10.4. Організатор або Партнер не несе відповідальності за неможливість нарахування\/списання Бонусів у випадку, якщо ім&#39;я та по батькові та \/ або прізвище, номер телефону або інший спосіб зв&#39;язку були вказані невірно та \/ або нерозбірливо, або змінені. При цьому такий Користувач не має права на одержання від Організатора\/Партнера будь-якої компенсації.<\/p> <p>10.5. Організатор\/Партнер не вступає в будь-які суперечки стосовно правильності, своєчасності нарахування\/списання Бонусів та не несе відповідальності за такі дії.<\/p> <p>10.6. У випадку виникнення ситуації, що припускає неоднозначне тлумачення даних Правил, будь-яких спірних питань та \/ або питань, не врегульованих цими Правилами, остаточне рішення приймається Організатором\/Партнером, рішення Організатора\/Партнера є остаточним і оскарженню не підлягає.<\/p> <p>10.7. Порушення Користувачем Бонусного Рахунку цих Правил або відмова Користувача від належного виконання цих Правил (в т.ч. Механіки, порядку, строків тощо), вважається відмовою Користувача від користування Бонусним Рахунком, така особа не має права на одержання від Організатора\/Партнера будь-якої компенсації.<\/p> <p>&nbsp;<\/p> <p><b>11. Застереження.<\/b><\/p> <p>11.1. Будь ласка, для уникнення непорозумінь - уважно ознайомтесь з даними правилами.<\/p> <p>11.2. Відповідно до вимог ст. 634 Цивільного Кодексу України до договорів приєднання, а саме можливості укладання такого договору лише шляхом приєднання однієї сторони до запропонованого договору, своєю участю всі Користувачі Бонусного Рахунку погоджуються з цими Правилами та зобов&#39;язуються їх виконувати.<\/p> <p>&nbsp;<\/p><\/div> <\/div>';var popup_template='<div class=\"popup-css popup-agreement\"> <a href=\"#\" class=\"popup-close\" name=\"close\"><img width=\"27\" height=\"27\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-medium-icon sprite\"><\/a> <div name=\"content\"><\/div> <\/div>';var popup_agreement=new Popup_class(popup_template);popup_agreement.addEvent('open',function(){if(this._popup.elem){this._popup.elem.hide()}}.bind(this));if(this.single_popup){popup_agreement.setOptions({single:true})}else{popup_agreement.setOptions({single:false})}if(!this._popup||!$defined(this._popup._overlay)&&!this._popup._overlay){popup_agreement.overlayON({styles:{'z-index':150}})}popup_agreement.setContent(popup_message,{});popup_agreement.open();document.fireEvent('showUserAgreement');if(this._popup&&$defined(this._popup.closeIgnoreElements)){this._popup.closeIgnoreElements.push(popup_agreement.content)}popup_agreement.addEvent('close',function(){if(this._popup.elem){this._popup.elem.show();this._popup._posUpdate()}}.bind(this))}.bind(this));var user=App.getService('User');if(user.isAuth()){this.hideLink()}user.addEvent('signIn',this.hideLink.bind(this));document.addEvent('authBlocksOpened',this.hideLink.bind(this));user.addEvent('signOut',this.showLink.bind(this));document.addEvent('agreementExistUser',this.hideLink.bind(this));document.addEvent('agreementNotExistUser',function(){var user=App.getService('User');if(!user.isAuth()){this.showLink()}}.bind(this))}},hideLink:function(){if(this._popup){var link_elem=this._popup.getElement(this.options.selectors.terms_link);if(link_elem){link_elem.hide()}}},showLink:function(){if(this._popup){var link_elem=this._popup.getElement(this.options.selectors.terms_link);if(link_elem){link_elem.show()}}}});var SignOutTimer_class=new Class({_class:'SignOutTimer_class',options:{cookie:'autosignout',timer:60,late:10,tpl:{sign_out_popup:'<div class=\"auto-sing-out-popup-wrap popup-css\"> <a href=\"#\" class=\"popup-close\" name=\"close\"> <img width=\"18\" height=\"18\" src=\"https:\/\/i.rozetka.ua\/design\/_.gif\" alt=\"&times;\" class=\"popup-close-icon sprite\"> <\/a> <div name=\"content\"><\/div> <\/div>',sign_out_popup_content:'<div class=\"auto-sing-out-popup\"> <div class=\"auto-sing-out-popup-count-wrap\"> <div class=\"auto-sing-out-popup-count h1\" id=\"final_call_counter\">10<\/div> <\/div> <div class=\"auto-sing-out-popup-text h1\"> Ви&nbsp;ще&nbsp;тут? <\/div> <div class=\"auto-sing-out-popup-btn-wrap\" id=\"final_call_button\"> <span class=\"auto-sing-out-popup-btn btn-link btn-link-green\"> <a href=\"#\" class=\"btn-link-i\"> Так <\/a> <\/span> <\/div> <\/div>'},selectors:{fc_counter:'#final_call_counter',fc_button:'#final_call_button'}},_is_active:null,_user_controller:null,_the_timer:null,_counter:0,_is_final_call:null,_popup:null,_controllers:null,initialize:function(seconds){this._popup=new Popup_class(this.options.tpl.sign_out_popup);this._popup.overlayON();this._popup.setContent(App.getHTML(this.options.tpl.sign_out_popup_content,this));this._controllers={counter:this._popup.getElement(this.options.selectors.fc_counter),button:this._popup.getElement(this.options.selectors.fc_button)};this._popup.addEvent('close',this._onPopupClose.bind(this));this._controllers.button.addEvent('click',this._yesClick.bind(this));if(seconds){this.options.timer=seconds}this.attachToObserver([]);this._user_controller=App.getService('User');document.addEvent('signIn',this._activate.bind(this));document.addEvent('signOut',this._deactivate.bind(this));this._activate()},_setListeners:function(){document.addEvent('mousemove',this._reset.bind(this));document.addEvent('mousewheel',this._reset.bind(this));document.addEvent('keydown',this._reset.bind(this));document.addEvent('click',this._reset.bind(this))},_checkIsActive:function(){this._is_active=(this._user_controller.isAuth()&&!!Cookie.get(this.options.cookie));return this._is_active},_activate:function(){this._checkIsActive();if(this._is_active&&this._the_timer===null){this._reset();this._setListeners();this._the_timer=setInterval(this._ticker.bind(this),1000)}},_deactivate:function(){this._setFinalCall(false);clearInterval(this._the_timer);this._the_timer=null},_reset:function(){if(!this._is_final_call){this._counter=this.options.timer}},_signout:function(){this._user_controller.SignOut()},_setFinalCall:function(value){this._is_final_call=value},_ticker:function(){if(this._counter>=0){this._counter--}else{this._deactivate()}if(this._counter===this.options.late){this._popup.open();this._setFinalCall(true)}else if(this._counter===0){this._deactivate();this._popup.close();this._signout();this._checkIsActive()}if(this._is_final_call){this._controllers.counter.innerText=this._counter}},_yesClick:function(){this._popup.close()},_onPopupClose:function(){this._setFinalCall(false);this._reset()}});SignOutTimer_class.implement(new Options(),new InitElements(),new Events());var PickupPointsMap_class=new Class({options:{ajax_host_href:'',ajax_action:'delivery/action=getOtherSellersDeliveriesJSON',ajax_get_pickups_action:'delivery/action=getAvailablePickupsJSON',ajax_get_similar_pickups_action:'pickups/action=getSimilarPickupsJSON',map_language:null},cache:{pickups:{}},other_services:{},map:null,locality_id:null,ext_pickups_ids:{},_loaded:false,initialize:function(){document.addEvent('CityGet',this._onCityGet.bind(this));App.addOnDomReady(this._onCityGet.bind(this));document.addEvent('pickupPointRequired',this._onPickupRequired.bind(this));document.addEvent('pickupPointNotAvailable',this._onPickupNotAvailable.bind(this))},showPickups:function(service_id,goods_id,pickup_id){var cache;document.fireEvent('openDeliveryLoader');this._onCityGet();cache=this._getFromCache(goods_id,service_id);if(cache.pickups&&cache.pickups.length){this._showMap(cache.pickups,cache.service_image,cache.need_pickup,{id:service_id,title:cache.service_title,goods_id:goods_id},pickup_id)}else{this._loadPickups(service_id,goods_id)}},showSimilarPickups:function(pickup_id){var url=this._getAjaxUrl(this.options.ajax_get_similar_pickups_action+';pickup_id='+pickup_id+'/');new Ajax(url,{method:'get',use_language:true,onComplete:this._onGetSimilarPickups.bind(this,pickup_id)}).request()},showAll:function(){if(this.cache.pickups&&this.cache.pickups[this.locality_id]){var pickups={},key;Object.each(this.cache.pickups[this.locality_id],function(elem){Object.each(elem,function(service){Object.each(service.pickups,function(pickup){key=pickup.coordinates[0]+pickup.coordinates[1];if(!pickups[key]){pickups[key]=pickup;pickups[key].points=[]}pickups[key].points.push(pickup)})})});this._showMap(Object.values(pickups),null,true,{})}},setCache:function(locality_id,goods_id,response){if(!this.cache.pickups[locality_id]){this.cache.pickups[locality_id]=[]}if(!this.cache.pickups[locality_id][goods_id]){this.cache.pickups[locality_id][goods_id]={}}this.cache.pickups[locality_id][goods_id][response.service_id]=response},setServicesData:function(data,locality){this._loaded=true;this.other_services[locality]=data},isOtherServicesLoaded:function(){return this._loaded},getOtherServices:function(goods_id,show_select){var url=this._getAjaxUrl(this.options.ajax_action+';locality_id='+this.locality_id+';goods_id='+goods_id+'/');if(this.locality_id){this.show_select=show_select;if(parseInt(this.locality_id,10)&&!Object.getLength(this.other_services[this.locality_id])){new Ajax(url,{method:'get',use_language:true,onComplete:this._onGetServicesData.bind(this,goods_id)}).request()}else{this._showByGoods(goods_id)}}},hasServices:function(){return Object.values(this.other_services[this.locality_id]).length>1},_onGetSimilarPickups:function(pickup_id,e){var handler=function(response){var pickups=response.pickups;if(pickups.length){this._showMap(pickups,response.service_image,response.need_pickup,{id:response.service_id,title:response.service_title},pickup_id)}};this._pickupsGetter(e,handler.bind(this))},_onGetPickups:function(goods_id,e){var handler=function(response){var pickups=response.pickups;if(response&&response.notification){this._notification=response.notification}if(this.locality_id==response.locality_id||this.locality_id==null){goods_id&&this.setCache(this.locality_id,goods_id,response);if(pickups.length||this._notification==='not_available_pickups_from_service'){this._showMap(pickups,response.service_image,response.need_pickup,{id:response.service_id,title:response.service_title,goods_id:goods_id})}}};this._pickupsGetter(e,handler.bind(this))},_existInCache:function(goods_id,service_id){return this.cache.pickups&&this.cache.pickups[this.locality_id]&&this.cache.pickups[this.locality_id][goods_id]&&this.cache.pickups[this.locality_id][goods_id][service_id]},_getFromCache:function(goods_id,service_id){var cache={};if(this._existInCache(goods_id,service_id)){cache=this.cache.pickups[this.locality_id][goods_id][service_id]}return cache},_onGetServicesData:function(goods_id,resp){resp=new Response_class(resp);this.setServicesData(resp.content,this.locality_id);this._showByGoods(goods_id)},_loadPickups:function(service_id,goods_id){var data='';if(this.locality_id&&service_id){data+=';service_id='+service_id}if(this.ext_pickups_ids&&this.ext_pickups_ids[service_id]&&this.ext_pickups_ids[service_id].length>0){data+=';pickup_ids='+this.ext_pickups_ids[service_id]}data+=';locality_id='+this.locality_id+';goods_id='+goods_id+'/';new Ajax(this._getAjaxUrl(this.options.ajax_get_pickups_action+data),{method:'get',use_language:true,onComplete:this._onGetPickups.bind(this,goods_id)}).request()},_pickupsGetter:function(e,handler){var response;try{response=App.getService('JSON').parse(e);response&&handler(response)}catch(err){document.fireEvent('closeDeliveryLoader');console.log(err)}},_checkUnavailable:function(pickups){var nearest=[];if(this._unavailable){pickups=pickups.filter(function(pickup){return parseInt(pickup.id,10)!==parseInt(this._unavailable.pickup_id,10)}.bind(this));if(this._unavailable.coordinates&&this._unavailable.coordinates[0]&&this._unavailable.coordinates[1]&&pickups.length>3){nearest=this._getNearestPickups(pickups)}if(nearest.length&&pickups.length>nearest.length){Object.each(pickups,function(pickup){pickup.has_unavailable=true;if(nearest.contains(parseInt(pickup.id))){pickup.nearest=true}})}}else{Object.each(pickups,function(pickup){pickup.has_unavailable=false})}return pickups},_getNearestPickups:function(pickups){var nearest=[],distance;Object.each(pickups,function(pickup){pickup.has_unavailable=false;pickup.nearest=false;if(pickup.coordinates[0]&&pickup.coordinates[1]){distance=Math.sqrt(Math.pow(Math.abs(this._unavailable.coordinates[0]-pickup.coordinates[0]),2)+Math.pow(Math.abs(this._unavailable.coordinates[1]-pickup.coordinates[1]),2));nearest.push({id:pickup.id,distance:distance})}}.bind(this));nearest=nearest.sort(function(a,b){return a.distance-b.distance}).splice(0,3);nearest=nearest.map(function(point){return parseInt(point.id,10)});return nearest},_getAjaxUrl:function(action){return this.options.ajax_host_href+action},_getServiceId:function(goods_id){return this.other_services[this.locality_id]&&this.other_services[this.locality_id][goods_id]&&this.other_services[this.locality_id][goods_id].response&&this.other_services[this.locality_id][goods_id].response.length&&this.other_services[this.locality_id][goods_id].response[0].services[0].service.id},_showByGoods:function(goods_id){var service_id=this._getServiceId(goods_id);if(service_id){this.showPickups(service_id,goods_id)}else if(this._message){Cart.addEventOnce('openCart',function(){Cart.showMessage(this._message);this._message=null}.bind(this));Cart.openCart()}},_onPickupRequired:function(data){this._message=data.message;this._notification='required';this._onPickupError(data)},_onPickupError:function(data){this._onCityGet();var goods_id=data.data.goods_id,service_id=this._getServiceId(goods_id);if(data.content&&data.content.unavailable){this._unavailable=data.content.unavailable}if(service_id){this.showPickups(service_id,goods_id)}else{this.getOtherServices(goods_id)}},_onPickupNotAvailable:function(data){this._notification='not_available';this._onPickupError(data)},_onCityGet:function(){this.locality_id=CityChooser.getCurrentCity().id},setExtPickupsIds:function(service_id,pickups_ids){this.ext_pickups_ids[service_id]=pickups_ids},getExtPickupsIds:function(service_id){return this.ext_pickups_ids[service_id]},_showMap:function(pickups,image,required,service,pickup_id){var showMap=function(){if(this.map.isReady()){service.all=this.other_services[this.locality_id];pickups=this._checkUnavailable(pickups);this.map.setNewPoints(pickups,image,required,service);this.map.show();if(pickup_id){this.map.selectPickup(pickup_id)}if(this._notification){if(this._unavailable){this.map.updateUnavailable(this._notification,this._unavailable);this._unavailable=null}this.map.showNotification(this._notification);this._notification=false}this.map.fixScrollHeight();if(this.show_select){this.map.showSelect();this.show_select=false}document.fireEvent('deliveryBlockInfo',{extend_event:[{name:'eventLabel',value:'deliveryMap'},{name:'userCityId',value:this.locality_id}]});document.fireEvent('closeDeliveryLoader')}}.bind(this);if(!this.map){this.map=new RozetkaGoogleMap_class({on_api_ready:showMap,language:this.options.map_language});this.map.init()}else{this.map._popup=null;this.map._recreate_map=true;showMap()}}});PickupPointsMap_class.implement(new Options(),new Events());var PickupPointsAddButtonController_class=new Class({options:{selectors:{buttons:'[name="pickup_button"]'},tpl:'<div class="toOrder">{if in_cart}<span class="sprite-side btn-link map-g-incart"><a href="#" class="btn-link-i">&nbsp;</a></span>{else}<form method="POST"><a href="#" class="sprite-side btn-link map-g-cart"><button type="submit" class="btn-link-i">&nbsp;</button></a></form>{/if}</div>'},initButtons:function(container){Cart.addEvent('UpdateCartContent',function(){this.renderButtons(container)}.bind(this));this.renderButtons(container)},renderButtons:function(container){var position=1;var tpl=this.options.tpl;container.getElements(this.options.selectors.buttons).each(function(elem){var goods_id=elem.getProperty('data-goods_id'),service_id=elem.getProperty('data-service_id'),pickup_id=elem.getProperty('data-pickup_id'),price_usd=elem.getProperty('data-price_usd'),in_cart=this.inCart(goods_id,service_id,pickup_id);elem.setHTML(App.getHTML(tpl,{in_cart:in_cart}));if(!in_cart){elem.getElement('a').addEvent('click',function(position,tpl,elem,e){new Event(e).stop();Cart.doAction('add',{getDataFromSource:function(){return{id:goods_id,goods_id:goods_id,pickup_id:pickup_id,service_id:service_id}},getOnCompleteFn:function(){return function(resp){var extend_event=[{name:'goods_id',value:goods_id},{name:'eventLocation',value:'noDrugstorePopup'},{name:'eventPosition',value:position}];price_usd&&extend_event.push({name:'eventValue',value:parseFloat(price_usd)});resp.isDone()&&document.fireEvent('clickToPurchases',{extend_event:extend_event});if(resp.isDone()&&!!Cart.inPurchases(goods_id)){elem.setHTML(App.getHTML(tpl,{in_cart:true}))}}}},goods_id,null,null,null,'fromMap',1);document.fireEvent('addWithPoint')}.bind(null,position,tpl,elem))}else{elem.getElement('a').addEvent('click',function(e){new Event(e).stop();Cart.openCart()})}position++}.bind(this))},inCart:function(goods_id,service_id,pickup_id){var result=false;if(goods_id){if(!pickup_id){result=!!Cart.inPurchases(goods_id)}else{result=!!Cart.getPurchases().filter(function(purchase){return purchase.goods.id==goods_id&&purchase.service_id==service_id&&purchase.pickup_id==pickup_id}).length}}return result}});var PickupsSelectElement_class=ElementSelectEntity_class.extend({_setLinkHTML:function(element){this._link.setHTML(element.getElement('[name="service_name"]').innerHTML)}});App.addService('PickupPointsAddButtonController',new PickupPointsAddButtonController_class());var GTMData_PickupPointsPopup_class=GTMData_BaseAbstract_class.extend({Class:'GTMData_PickupPointsPopup_class',options:{GTM:{events:{selected_point_click:{event_name:'selectedPointClick',extend_event:[{name:'eventLabel',value:'deliveryMap'},{name:'eventLocation',value:'drugs'}]},choose_point_popup:{event_name:'pickupPointRequired',extend_event:[{name:'eventLabel',value:'drugstoreMap'}]},unavailable_pickup_point:{event_name:'pickupPointNotAvailable',extend_event:[{name:'eventCategory',value:'Non-Interactions'},{name:'eventAction',value:'show'},{name:'eventLabel',value:'noDrugstorePopup'},{name:'eventNoninteraction',value:1}]},nearest_point_click:{event_name:'nearestPointClick',extend_event:[{name:'eventLabel',value:'nearestDrugstore'},{name:'eventLocation',value:'noDrugstorePopup'}]}}}},base_GTM_event:{eventCategory:'Interactions',eventAction:'click'},initialize:function(){}});App.addOnDomReady(function(){GTMEvents.initDataBlocks([new GTMData_PickupPointsPopup_class()])});var AsyncFieldsLoader_class=new Class({options:{url:null,unauthorized_template:'',selectors:{fields:'[name="async_user_details_fields"]',field:'[name="detail_field"]',message:'[name="async_fields_filled"]'}},_user:null,_elem:null,_message_elem:null,_last_ids:null,_load_ids:null,_last_resp:null,_message:null,initialize:function(options){this.setOptions(options);this._user=App.getService('User');this._user.addEvent('signIn',this.onAuthChange.bind(this));this._user.addEvent('signOut',this.onAuthChange.bind(this))},onAuthChange:function(){if(this._load_ids){this.load(this._load_ids)}},load:function(ids){this._load_ids=ids;this._elem=document.getElement(this.options.selectors.fields);this._message_elem=document.getElement(this.options.selectors.message);if(this._user&&this._user.isAuth()){if(ids&&ids.length){ids=ids.join(',');if(this._last_ids&&ids==this._last_ids){this._showFields(this._last_resp)}else{this._last_ids=ids;new Ajax(this.options.url+ids+'/',{method:'get',use_language:true,onComplete:this._onComplete.bind(this)}).request()}}}else if(this._elem){this._message_elem&&this._message_elem.hide();this._elem.setHTML(App.getHTML(this.options.unauthorized_template));this._elem.show();new AuthorizationBlocks_class(this._elem.getElement('form')).needAuth();this.fireEvent('authorizationRequired')}},_onComplete:function(resp){this._last_resp=new Response_class(resp);this._showFields(this._last_resp)},_showFields:function(resp,do_not_run_scripts){if(resp&&resp.isDone()){var div,html=resp.content.html,visible=false,empty_fields=this._user.getProperty('empty_details');if(empty_fields){div=new Element('div').setHTML(html);if(!do_not_run_scripts){this._runScripts(div)}div.getElements(this.options.selectors.field).each(function(elem){if(!empty_fields.contains(parseInt(elem.getProperty('data-detail-id')))){elem.hide()}else{visible=true}});html=div.innerHTML}else{visible=true}if(visible){html&&this._showForm(html)}else{this._message=null;this._elem&&this._elem.hide();this._message_elem&&this._message_elem.show();this.fireEvent('fieldsFilled')}}},_showForm:function(html){var form;this._elem.setHTML(html);App.getService('TokenManager').addProtect(this._elem);form=this._elem.getElement('form');if(this._message){App.showMessage(this._message,form);this._message=null}new ElementSelect_class().init(this._elem);form.addEvent('submit',function(e){new Event(e).stop();form.checkFields()&&form.trySend({process:preloaders.green_process_tpl,onComplete:function(resp){form.processStop();resp=new Response_class(resp);if(resp.isDone()){resp.doAction();if(resp.Message){this._message=resp.Message}this._showFields(this._last_resp,true)}else{App.showMessage(resp.Message,form)}}.bind(this)})}.bind(this));this.fireEvent('fieldsInserted');this._elem.show()}});AsyncFieldsLoader_class.implement(new Options(),new RzEvalScripts_class(),new Events());RozetkaSocialButtons_class.prototype.options.titles.vkontakte="Вконтакте";RozetkaSocialButtons_class.prototype.options.titles.email="Надіслати листом";RozetkaCollectionScrollers_class.prototype.options.tabAll.name="Усі";RozetkaCollectionScrollers_class.prototype.options.tabAll.show_all_name="Усі категорії";RozetkaBuyButton_class.prototype.buy_button_default="Купити";RozetkaCopyText_class.prototype.options.text="Докладніше";Date.month_genitive_names={0:'січня',1:'лютого',2:'березня',3:'квітня',4:'травня',5:'червня',6:'липня',7:'серпня',8:'вересень',9:'жовтня',10:'листопада',11:'грудня'};if($defined(window.Checkout_Certificates_OrderBlock_class)){Checkout_Certificates_OrderBlock_class.prototype.options.titles.add_certificate_link_text='Додати сертифікат до&nbsp;замовлення';Checkout_Certificates_OrderBlock_class.prototype.options.titles.add_another_certificate_link_text='Ще один'}App.addLastEvent('domready',function(){window['dataLayer']!==undefined&&dataLayer.push({event:'domReady'})});